      SIAL TRY4_GRAD     
#
# Make index definitions 
#
      Index   i      = 1, naocc   
      Index   j      = 1, naocc   
      Index   k      = 1, naocc   
      Index   l      = 1, naocc   
      Index   ib     = 1, nbocc 
      Index   jb     = 1, nbocc 
      Index   kb     = 1, nbocc 
      Index   lb     = 1, nbocc 
      Index   ai     = bavirtorb, eavirtorb
      Index   aj     = bavirtorb, eavirtorb
      Index   bi     = bbvirtorb, ebvirtorb
      Index   bj     = bbvirtorb, ebvirtorb
#
      aoindex mu     = 1, norb 
      aoindex nu     = 1, norb 
      aoindex lambda = 1, norb 
      aoindex sigma  = 1, norb 
#
      moaindex i1= baocc, eaocc
      moaindex i2= baocc, eaocc
      moaindex i3= baocc, eaocc
      moaindex i4= baocc, eaocc
#
      moaindex a = bavirt, eavirt
      moaindex a1= bavirt, eavirt
      moaindex a2= bavirt, eavirt
      moaindex a3= bavirt, eavirt 
      moaindex a4= bavirt, eavirt 
#
      mobindex j1= bbocc, ebocc
      mobindex j2= bbocc, ebocc
      mobindex j3= bbocc, ebocc
      mobindex j4= bbocc, ebocc
#
      mobindex b = bbvirt, ebvirt
      mobindex b1= bbvirt, ebvirt
      mobindex b2= bbvirt, ebvirt
      mobindex b3= bbvirt, ebvirt 
      mobindex b4= bbvirt, ebvirt 
#
      moaindex p = baocc, eavirt  
      moaindex p1= baocc, eavirt  
      moaindex p2= baocc, eavirt  
      moaindex p3= baocc, eavirt  
#
      mobindex q = bbocc, ebvirt  
      mobindex q1= bbocc, ebvirt  
      mobindex q2= bbocc, ebvirt  
      mobindex q3= bbocc, ebvirt  
#
# Declare served arrays which are read from disk  
# 
      served VSaaai(a1,a2,a3,i1)
      served VSpipi(p,i1,p1,i2)
      served VSbbbj(b,b1,b2,j1)
      served VSbjjj(b,j1,j2,j3)
      served Vaaii(a,a1,i1,i2)
      served Viaai(i1,a,a1,i2)
      served VSqjqj(q,j1,q2,j2)
      served Vbbjj(b,b1,j1,j2)
      served Vjbbj(j1,b,b1,j2)
      served Vbbii(b,b1,i1,i2)
      served Vjbii(j1,b,i1,i2)
      served Vbbai(b,b1,a,i1)
      served Vpiqj(p,i1,q,j2)
      served Vaajj(a,a1,j1,j2)
      served Viabj(i1,a,b,j1)
      served Vaabj(a,a1,b,j1)

      served Vaiai(a,i1,a1,i2) 
      served Vbjbj(b,j1,b1,j2) 
      served Vaibj(a,i1,b,j1) 
#
      served T2aiai(a,i1,a1,i2)
      served T2bjbj(b,j1,b1,j2) 
      served T2aibj(a,i1,b,j1) 
#
      served Taaii(a,a1,j,k) 
      served Xaaii(a,a1,j,k) 
      served Tbbjj(b,b1,jb,kb) 
      served Tabij(a,b,i,kb) 
      temp XSaaai(a,a1,a2,i) 
      served XSbbbj(b,b1,b2,ib) 
      served Xbbai(b,b1,a,i) 
      served Xaabj(a,a1,b,kb) 
      distributed XSaiii(a,i,i1,j)  
      distributed XSbjjj(b,ib,j1,jb)  
      distributed XaIjJ(a,i,j1,jb)  
      distributed XiIbJ(i1,i,b,jb)  
#
# Two-particle arrays Sabij used in ccsd(t) gradient 
#
      served saaii(a,a1,i,j) 
      served sabij(a,b,i,jb) 
      served sbbjj(b,b1,ib,jb) 
      served Saiai(a,i1,a1,i2) 
      served Sbjbj(b,j1,b1,j2) 
      served Saibj(a,i1,b,j1) 
#
# Declare distributed arrays 
# 
      distributed Paaai(a,a1,a2,i) 
      served Saaai(a,a1,a2,i) 
      served Sbbbj(b,b1,b2,ib) 
      served Saabj(a,a1,b,ib) 
      served Sbbai(b,b1,a,i) 
      distributed Paaaj(a,a1,a2,j) 
      distributed Paaak(a,a1,a2,k) 
      distributed Pbbbi(b,b1,b2,ib)  
      distributed Pbbbj(b,b1,b2,jb)  
      distributed Pbbbk(b,b1,b2,kb)  
      distributed Pbbai(b,b1,a,i) 
      distributed Pbbaj(b,b1,a,j) 
      distributed Paabk(a,a1,b,kb) 
      distributed Paabi(a,a1,b,ib) 
      distributed Paabj(a,a1,b,jb) 
      distributed Pbbak(b,b1,a,k) 
#
      temp Paiii(a,i,i1,j)   
      temp Pbjjj(b,ib,j1,jb)   
      temp PaIjJ(a,i,j1,jb) 
      temp PiIbJ(i1,i,b,jb) 
#
      temp taIII(a,i,j,k) 
      temp tIIbJ(l,j,b,kb) 
      temp tbJJJ(b2,kb,lb,jb) 
      temp taIJJ(a,k,lb,jb) 
      temp tbJII(b1,jb,l,k)    
      temp tpIII(p,i,j,k) 
      temp t1pIII(p,i,j,k) 
      temp tpijj(a,i,lb,kb)   
      temp tqJJJ(b,lb,ib,jb)    
      temp t1qJJJ(b,lb,ib,jb)    
      temp tqpJI(b2,a,ib,k)  
      temp tqjpi(b,ib,a,k)     
#
      temp XaJbK(a,j,b,kb) 
      temp X1aJbK(a,j,b,kb) 
      temp X2aJbK(a,j,b,kb) 
      temp XaIbK(a,i,b,kb) 
      temp X1aIbK(a,i,b,kb) 
      temp X2aIbK(a,i,b,kb) 
      temp XaJaI(a,j,a1,i) 
      temp X1aJaI(a,j,a1,i) 
      temp YaibK(a,i1,b,kb) 
      temp Y1aibK(a,i1,b,kb) 
      temp XaIbj(a,i,b,j1) 
      temp X1aIbj(a,i,b,j1) 
      temp XaJbj(a,j,b,j1) 
      temp X1aJbj(a,j,b,j1) 
      temp XaiaI(a,i1,a1,i) 
      temp XaiaJ(a,i1,a1,j) 
#
      distributed DSbbbj(b,b1,b2,ib) 
      distributed DSaiii(a,i1,k,j) 
      distributed DSbjjj(b,j1,ib,jb) 
      distributed DSbbai(b,b1,a,i) 
      distributed DSaabj(a,a1,b,kb) 
      distributed DSaaii(a,a1,j,k) 
      distributed DSbbjj(b,b1,jb,kb) 
      distributed D1abij(a,b,i1,kb) 
      distributed D1aaii(a,a1,i1,i) 
      distributed D1bbjj(b,b1,j1,kb) 
      distributed Dbaji(b,a,jb,k) 
      distributed DbjbS(b,j1,b1,ib) 
      distributed D1bjbS(b,j1,b1,jb) 
      distributed D2bjbS(b,j1,b1,kb) 
      distributed DbSbS(b,jb,b1,ib) 
      distributed D1bSbS(b,ib,b1,kb) 
      distributed D2bSbS(b,jb,b1,kb) 
      distributed EaSbS(a,k,b,ib) 
      distributed E1aSbS(a,k,b,jb) 
      distributed EaibS(a,i1,b,ib) 
      distributed E1aibS(a,i1,b,jb) 
      distributed EaSbj(a,k,b,j1) 
#
      distributed X3ijk(a,a1,a2) 
      distributed Y3ijk(a,a1,a2) 
      distributed D3ijk(a,a1,a2) 
      distributed E3ijk(a,a1,a2) 
#
      distributed X3bbb(b,b1,b2) 
      distributed Y3bbb(b,b1,b2) 
      distributed D3bbb(b,b1,b2) 
      distributed E3bbb(b,b1,b2) 
#
      distributed X3aab(a,a1,b2) 
      distributed Y3aab(a,a1,b2) 
      distributed D3aab(a,a1,b2) 
      distributed E3aab(a,a1,b2) 
#
      distributed X3bba(b,b1,a2) 
      distributed Y3bba(b,b1,a2) 
      distributed D3bba(b,b1,a2) 
      distributed E3bba(b,b1,a2) 
#
      distributed D1baji(b,a1,j1,i) 
      distributed DSajij(a,j1,j,kb) 
      distributed DSbiji(b,i1,kb,j) 
#
      distributed sai(a,i) 
      distributed sbj(b,kb) 
      temp txai(a,i) 
      temp saai(a,a1,ai) 
      temp siii(i2,i)  
      temp txbj(b,j) 
      temp sbbj(b,bj) 
      temp sjjj(j2,ib)  
      served t1a_old(a,i1) 
      served t1b_old(b,j1) 
      distributed t1ai(a,i) 
      distributed t1bj(b,jb) 
      distributed t1a(a,i1) 
      distributed t1b(b,j1) 
#
# Declare temporary arrays 
#
      temp xa(a) 
      temp tp(p) 
      temp tq(q) 
      temp tI(i) 
      temp tJ(ib) 
      temp xb(b) 
      temp xai(a,i) 
      temp xbj(b,kb) 
      temp Pai(a,i) 
      temp Pbj(b,kb) 
      temp tpp(p,p1) 
      temp t1pp(p,p1) 
      temp t2pp(p,p1) 
      temp tqp(q,p) 
      temp tqq(q,q1) 
      temp t1qq(q,q1) 
      temp t2qq(q,q1) 
#
      temp tppp(p,p1,p2) 
      temp t1ppp(p,p1,p2) 
      temp t2ppp(p,p1,p2) 
      temp t4ppp(p,p1,p2) 
      temp t3ppp(a,a1,a2) 
      temp t5ppp(a,a1,a2) 
      temp taaaiii(a,a1,a2,i,j,k) 
      temp t1aaaiii(a,a1,a2,i,j,k) 
      temp t2aaaiii(a,a1,a2,i,j,k) 
      temp t3aaaiii(a,a1,a2,i,j,k) 
      temp t4aaaiii(a,a1,a2,i,j,k) 
      temp t5aaaiii(a,a1,a2,i,j,k) 
      temp t6aaaiii(a,a1,a2,i,j,k) 
      temp t7aaaiii(a,a1,a2,i,j,k) 
      temp t8aaaiii(a,a1,a2,i,j,k) 
      temp t9aaaiii(a,a1,a2,i,j,k) 
#
      temp Fpppp(p,p1,p2,p3) 
      temp F1pppp(p,p1,p2,p3) 
#
      temp ipppp(p,p1,p2,p3) 
      temp i1pppp(p,p1,p2,p3) 
      temp i2pppp(p,p1,p2,p3) 
      temp iqqqq(q,q1,q2,q3) 
      temp i1qqqq(q,q1,q2,q3) 
      temp i2qqqq(q,q1,q2,q3) 
      temp ipqpq(p,q,p1,q1) 
      temp i1pqpq(p,q,p1,q1) 
      temp i2pqpq(p,q,p1,q1) 
      temp iqpqp(q,p,q1,p1) 
      temp i1qpqp(q,p,q1,p1) 
      temp i2qpqp(q,p,q1,p1) 
      temp ippii(a,i1,j,k)    
      temp ipppi(a,i1,i2,k)   
      temp iqqpp(q,q1,p2,p3) 
      temp i1qqpp(b,j1,i2,i3) 
      temp iqqii(b,j1,j,k)  
      temp iqqpi(b,j1,i2,k) 
      temp ippqq(p,p1,q2,q3) 
      temp i1ppqq(p,p1,q2,q3) 
      temp ippqj(a,i1,j2,kb)   
      temp ippjj(a,i1,jb,kb) 
      temp iqqjj(b,j1,jb,kb)  
      temp iqqqj(b,j1,j2,kb)  
#
      temp tpppp(p,p1,p2,i) 
      temp tppps(p,p1,p2,i) 
      temp t1ppps(p,p1,p2,i) 
      temp t2ppps(p,p1,p2,j) 
      temp t3ppps(p,p1,p2,k) 
      temp tpsps(p,j,p2,i) 
      temp t1psps(p,j,p2,i) 
      temp t2psps(p,j,p2,i) 
#
      temp tpsqq(a,i,b,j1) 
      temp t1psqq(a,j,b,j1) 
#
      temp tpsqs(a,i,b,kb) 
      temp t1psqs(a,j,b,kb) 
#
      temp Fqqqq(q,q1,q2,q3) 
      temp F1qqqq(q,q1,q2,q3) 
#
      temp tqqqq(q,q1,q2,ib) 
      temp tqqqs(q,q1,q2,ib) 
      temp tqSqS(b,jb,b1,ib) 
      temp t1qSqS(b,jb,b1,ib) 
#
      temp Fpqpq(a,b1,i1,j2) 
      temp F1pqpq(a,b1,i1,j2) 
      temp Fppqq(p,p1,q,q1) 
      temp F1ppqq(p,p1,q,q1) 
#
      temp Fqqpp(q,q1,p,p1)  
      temp F1qqpp(q,q1,p,p1)  
#
      temp tqqps(b,b1,a,i) 
      temp tppqs(p,p1,q,kb) 
      temp t1ppqs(p,p1,q,kb) 
#
      temp tqqq(q,q1,q2) 
      temp t1qqq(q,q1,q2) 
      temp t2qqq(q,q1,q2) 
      temp t3qqq(q,q1,q2) 
      temp t4qqq(q,q1,q2) 
      temp t5qqq(q,q1,q2) 
#
      temp tppq(p,p1,q) 
      temp t1ppq(p,p1,q) 
      temp t2ppq(p,p1,q) 
      temp t3ppq(p,p1,q,i,j,kb) 
      temp t4qqp(q,q1,p,ib,jb,k) 

      temp tqqp(q,q1,p) 
      temp t1qqp(q,q1,p) 
      temp t2qqp(q,q1,p) 
      temp t3qqp(q,q1,p) 
      temp tqpp(q,p,p1) 
      temp t1qpp(q,p,p1) 
      temp t2qpp(q,p,p1) 
      temp tqpq(b,a1,j1)      
      temp tpqp(a1,b,i1)  
      temp tpqq(p,q,q1)  
      temp t1pqq(p,q,q1)  
      temp t2pqq(p,q,q1)  
#
      temp tpppi(p,p1,p2,i) 
      temp tppii(p,p1,i,j) 
      temp Sppii(p,p1,i,j) 
      temp tpipi(p,i,p1,j) 
      temp t1pipi(p,i,p1,j) 
      temp t2pipi(p,i,p1,j) 
      temp t3pipi(p,i,p1,j) 
      temp t4pipi(p,i,p1,j) 
      temp t5pipi(p,i,p1,j) 
      temp Y1pipi(p,i,p1,j) 
      temp Y2pipi(p,i,p1,j) 
      temp Y3pipi(p,i,p1,j) 
      temp Y4pipi(p,i,p1,j) 
      temp Y5pipi(p,i,p1,j) 
      temp Y6pipi(p,i,p1,j) 
      temp Y7pipi(p,i,p1,j) 
      temp Y8pipi(p,i,p1,j) 
      temp Y9pipi(p,i,p1,j) 
#
      temp X1pipi(p,i1,p1,i) 
      temp X2pipi(p,i1,p1,i) 
      temp X3pipi(p,i1,p1,i) 
      temp X4pipi(p,i1,p1,i) 
      temp X5pipi(p,i1,p1,i) 
      temp X6pipi(p,i1,p1,i) 
      temp X7pipi(p,i1,p1,i) 
      temp X8pipi(p,i1,p1,i) 
      temp X9pipi(p,i1,p1,i) 
      temp t1ppii(p,p1,i1,i) 
      temp t2aiii(a,i1,j,i)   
#
      temp tppqj(p,p1,q,ib) 
      temp tqqpi(q,q1,p,i) 
#
      temp tqqqj(q,q1,q2,ib) 
      temp tqqjj(q,q1,ib,jb) 
      temp Sqqjj(q,q1,ib,jb) 
      temp tqjqj(q,ib,q1,jb) 
      temp t1qjqj(q,ib,q1,jb) 
      temp t2qjqj(q,ib,q1,jb) 
      temp t3qjqj(q,ib,q1,jb) 
      temp t4qjqj(q,ib,q1,jb) 
      temp tqjii(b,kb,l,j)   

      temp taab(a,a1,b1)
      temp t1aab(a,a1,b1)
      temp tbba(b,b1,a2)
      temp t1bba(b,b1,a2)
      temp tpi(p,i) 
      temp tpj(p,j) 
      temp tpk(p,k) 
      temp tqi(q,ib) 
      temp tqj(q,jb) 
      temp tqk(q,kb) 
      temp tpqpi(p,q1,p,i)
      temp tpqpj(a,b1,i1,jb) 
      
      temp taiaiai(a,i,a1,j,a2,k) 
#
# Arrays used in Tbbbjjj computation
#
      temp Tbbbjjj(b,b1,b2,ib,jb,kb) 
      temp tbjbjbj(b,ib,b1,jb,b2,kb)   
      temp t1bbbjjj(b,b1,b2,ib,jb,kb) 
      temp t2bbbjjj(b,b1,b2,jb,ib,kb) 
      temp t3bbbjjj(b,b1,b2,kb,jb,ib) 
      temp t4bbbjjj(b1,b,b2,ib,jb,kb) 
      temp t5bbbjjj(b2,b1,b,ib,jb,kb) 
      temp t6bbbjjj(b1,b,b2,jb,ib,kb) 
      temp t7bbbjjj(b1,b,b2,kb,jb,ib) 
      temp t8bbbjjj(b2,b1,b,jb,ib,kb) 
      temp t9bbbjjj(b2,b1,b,kb,jb,ib) 
      temp t2bjjj(b,j1,kb,jb)  
      temp X1qjqj(b1,j1,b2,ib) 
      temp X2qjqj(b1,j1,b2,ib) 
      temp X3qjqj(b1,j1,b2,ib) 
      temp X4qjqj(b1,j1,b2,ib) 
      temp X5qjqj(b1,j1,b2,ib) 
      temp X6qjqj(b1,j1,b2,ib) 
      temp X7qjqj(b1,j1,b2,ib) 
      temp X8qjqj(b1,j1,b2,ib) 
      temp X9qjqj(b1,j1,b2,ib) 
      temp t1qqjj(b1,b2,j1,ib)
#
# Arrays used in Taabiij computation
#
      temp Dabij(a,b1,j,kb)  
      temp P2aibj(a,j,b,kb) 
      temp P4aibj(a,j,b,kb) 
      temp P5aibj(a,j,b,kb) 
      temp P6aibj(a,j,b,kb) 
      temp P3aibj(a,i,b,jb) 
      temp Tpq(p,q) 
      temp tppqi(a,a1,b,i)
      temp P1bbai(b,b1,a1,i) 
      temp t1aibj(a1,i,b,j1) 
      temp t1ajij(a,j1,j,kb) 
      temp tabji(a1,b,j1,i) 
      temp t1ppqj(a1,a2,b,kb) 
      temp t2ppqj(a1,a2,b,kb) 
      temp taibj(a1,i,b,kb) 
      temp t4aibj(a1,i,b,kb) 
      temp t3aibj(a1,i1,b,kb) 
      temp tpiqj(a,j,b,kb) 
      temp t1piqj(a,j,b,kb) 
      temp t2piqj(a,j,b,kb) 
      temp t3piqj(a,j,b,kb) 
      temp t4piqj(a,j,b,kb) 
      temp t5piqj(a,j,b,kb) 
      temp tbijj(b,i1,j,kb) 
      temp t1qqpi(b,b1,a,k)  
#
      temp t1aabiij(a,a1,b,i,j,kb) 
      temp t2aabiij(a,a1,b,j,i,kb) 
      temp t3aabiij(a1,a,b,i,j,kb) 
      temp t4aabiij(a1,a,b,j,i,kb) 
      temp taiaibj(a,i,a1,j,b,kb) 
      temp taabjii(a,a1,b,kb,i,j) 
      temp t1aabjii(a,a1,b,kb,i,j) 
#
      temp Taabiij(a,a1,b,i,j,kb) 
      temp tbbjaai(b,b1,a,jb,ib,k)
#
# Arrays used in the Tbbajji computation. 
# --------------------------------------- 
#
      temp P1aibj(a,i,b1,ib) 
      temp P2iibj(i1,k,b,jb) 
      temp P1aabj(a,a2,b1,ib)
      temp P1bjbj(b,jb,b2,ib)
      temp P2bjbj(b,jb,b2,ib)
      temp P3bjbj(b,jb,b2,ib)
      temp P4bjbj(b,jb,b2,ib)
      temp P5bjbj(b,jb,b2,ib)
      temp P6bjbj(b,jb,b2,ib)
      temp P7bjbj(b,jb,b2,ib)
      temp P8bjbj(b,jb,b2,ib)
      temp P9bjbj(b,jb,b2,ib)
      temp P1bbbj(b,b2,b1,ib) 
      temp P2bjjj(b,jb,j1,ib) 
      temp P2aijj(a,k,j1,jb) 
#
      temp t2pqij(a2,b,k,jb) 
      temp tqqaj(b,b1,a,ib)  
      temp t2bbji(b,b2,jb,ib)
      temp tqqai(b,b1,a,k) 
      temp t2abij(a,b2,k,jb) 
      temp t2ajij(a,j1,k,jb) 
#
      temp t1bbajji(b,b1,a,ib,jb,k) 
      temp t2bbajji(b,b1,a,jb,ib,k) 
      temp t3bbajji(b1,b,a,ib,jb,k) 
      temp t4bbajji(b1,b,a,jb,ib,k) 
      temp tbjbjai(b,ib,b1,jb,a,k)
      temp tbbaijj(b,b1,a,k,ib,jb) 
      temp tbiji(b,i1,jb,k) 
     #temp tbjjj(b,j1,jb,ib) 
#
      temp Tbbajji(b,b1,a,ib,jb,k) 
      temp tqqa(b,b1,a) 
#
# Arrays used in the sai computation 
# ----------------------------------- 
#
      temp P1aiai(a1,j,a2,k) 
      temp P2aiai(a1,j,a2,k) 
      temp P3aiai(a1,j,a2,k) 
      temp P4aiai(a1,j,a2,k) 
      temp P5aiai(a1,j,a2,k) 
      temp P6aiai(a1,j,a2,k) 
      temp P7aiai(a1,j,a2,k) 
      temp P8aiai(a1,j,a2,k) 
      temp P9aiai(a1,j,a2,k) 
      temp t1pppi(a,a1,a2,i) 
      temp t2ppii(a1,a2,j,k) 
#
      temp Tabbijj(a,b1,b2,i,jb,kb) 
      temp taibjbj(a,i,b1,jb,b2,kb) 
      temp t1abbijj(a,b1,b2,i,jb,kb) 
      temp t1pqqi(a,b1,b2,i) 
      temp t2qqjj(b1,b2,jb,kb) 
      temp t1ppqi(a,a1,b2,i) 
#
# Arrays used in the sbj computation 
# ----------------------------------- 
#
      temp t1qqqj(b,b1,b2,ib) 
      temp t1qppj(b,a1,a,ib) 
      temp tqqpj(b,b1,a,ib) 
      temp t1qqpj(b,b1,a,ib) 
      temp tpqij(a,b1,i,jb) 
      temp tqpij(b1,a,k,jb) 
#
      temp t1baajii(b,a1,a,ib,j,k) 
#
# Distributed arrays to partially hold amplitudes 
# ------------------------------------------------ 
#
      distributed DaiaS(a,i1,a1,i) 
      distributed D1aiaS(a,i1,a1,j) 
      distributed D2aiaS(a,i1,a1,k) 
      distributed DaSaS(a,j,a1,i) 
      distributed D1aSaS(a,i,a1,k) 
      distributed D2aSaS(a,j,a1,k) 
#
      distributed DaSbj(a,i,b,j1) 
      distributed D1aSbj(a,j,b,j1) 
      distributed DaSbS(a,i,b,kb) 
      distributed D1aSbS(a,j,b,kb) 
      distributed DaibS(a,i1,b,kb) 
#
      distributed Dab(a,b) 
      distributed D1ab(a,b) 
      distributed Daa(a,a1) 
      distributed D1aa(a,a1) 
      distributed D2aa(a,a1) 
      distributed Eab(a,b) 
      distributed E1ab(a,b) 
      distributed Dbb(b,b1) 
      distributed D1bb(b,b1) 
      distributed D2bb(b,b1) 
#
# Arrays used in sarray preparation 
# --------------------------------- 
#
      static tii(i1,i2) 
      static t1ii(i1,i2) 
      static taa(a1,a2) 
      static t1aa(a1,a2) 
      served Sii(i1,i2) 
      served Saa(a2,a1) 
      distributed IIi(i,i1) 
      distributed IAa(ai,a1) 
      temp IaS(a1,ai) 
      temp PIi(i,i1) 
      static PAa(ai,a1) 
      static P1Aa(ai,a1) 
      temp TPAa(ai,a1) 
      distributed fsai(a,i1) 
      temp tps(a1,aj) 
      temp tqs(b1,bj)  
#
      temp sSaa(ai,a1,a2)  
      temp s1Saa(ai,a1,a2) 
      temp sSab(ai,a1,b)  
      temp s1Sab(ai,a1,b) 
      temp sbbS(b,b1,ai)  
      temp s1bbS(b,b1,ai)  
      temp tss(ai,aj) 
      temp t1ss(ai,aj) 
      distributed DaS(ai,aj) 
      temp IbS(b,bi)      
      temp sSbb(bi,b1,b2) 
      temp s1Sbb(bi,b1,b2) 
      temp tuu(bi,bj)     
      distributed DbS(bi,bj) 
      temp saaS(a,a1,bi)  
      temp s1aaS(a,a1,bi) 
      temp sSba(bi,b,a)  
      temp s1Sba(bi,b,a) 
#
      static tjj(j1,j2) 
      static t1jj(j1,j2) 
      static tbb(b1,b2) 
      static t1bb(b1,b2) 
      served Sjj(j1,j2) 
      served Sbb(b2,b1) 
      distributed IJj(jb,j1) 
      distributed IBb(bj,b1) 
      temp PJj(jb,j1) 
      static PBb(bj,b1) 
      static P1Bb(bj,b1) 
      temp TPBb(bj,b1) 
      distributed fsbj(b,j1) 
#
# Two-particle density arrays 
# --------------------------- 
#
      served Gaaai(a,a1,a2,i) 
      served Gbbbj(b,b1,b2,jb) 
      served Gaabj(a,a1,b,jb) 
      served Gbbai(b,b1,a,i) 
#
      served SGaaai(a,a1,a2,i1) 
      served SGbbbj(b,b1,b2,j1) 
      served SGaabj(a,a1,b,j1) 
      served SGbbai(b,b1,a,i1) 
      distributed Giiia(i1,i2,i3,a) 
      distributed Gijib(i1,j2,i3,b) 
      distributed Gjija(j1,i1,j2,a)  
      distributed Gjjjb(j1,j2,j3,b)  
      served Giiaa(i1,i2,a1,a2) 
      served Gijab(i1,j2,a1,b2) 
      served Gjjbb(j1,j2,b1,b2) 
#
      served Gaiii(a,i,j,k) 
      served Gbjjj(b,ib,jb,kb) 
      served Gaijj(a,i,jb,kb) 
      served Gbjii(b,ib,j,k) 
      served Gaiai(a,i,a1,j) 
      served Gbjbj(b,ib,b1,jb) 
      served Gaibj(a,i,b,ib) 
#
      distributed Dai(a,i) 
      distributed Dbj(b,ib) 
      distributed Da(a,a1) 
      distributed Db(b,b1) 
      distributed Di(i,j) 
      temp tIJ(i,j) 
      distributed Dj(ib,jb) 
      temp tIJb(ib,jb) 
      distributed Dii(i1,i2) 
      distributed Djj(j1,j2) 
      distributed DDai(a,i1) 
      distributed DDbj(b,j1) 
#
# Arrays used in backtransformation of density and contraction with I' 
# -------------------------------------------------------------------- 
#
      distributed cai(mu,i) 
      distributed cbj(mu,ib) 
      distributed PaaxI(a,a1,lambda,i) 
      distributed PaxxI(a,nu,lambda,i) 
      distributed PxxxI(mu,nu,lambda,i) 
      served GxxxI(mu,nu,lambda,i) 
      served GxxxJ(mu,nu,lambda,ib) 
      distributed Pbbxi(b,b1,lambda,i) 
      distributed PbxxI(b,nu,lambda,i)         
      distributed Paixi(a,j,lambda,i) 
      distributed Pbjxi(b,jb,lambda,i) 
      distributed PbbxJ(b,b1,lambda,ib) 
      distributed PbxxJ(b,nu,lambda,ib) 
      distributed PxxxJ(mu,nu,lambda,ib) 
      distributed Paaxj(a,a1,lambda,ib) 
      distributed Paxxj(a,nu,lambda,ib) 
      distributed Pbjxj(b,jb,lambda,ib)
      distributed Paixj(a,i,lambda,ib)
      temp txi(mu,i) 
      temp t1xi(mu,i) 
      temp txj(mu,ib) 
      temp t1xj(mu,ib) 
      temp taaxi(a,a1,lambda,i) 
      temp taxxi(a,nu,lambda,i) 
      temp txxxi(mu,nu,lambda,i) 
      temp t1xxxi(mu,nu,lambda,i) 
      temp tbbxj(b,b1,lambda,ib) 
      temp tbxxj(b,nu,lambda,ib) 
      temp txxxj(mu,nu,lambda,ib) 
      temp t1xxxj(mu,nu,lambda,ib) 
      temp tbbxI(b,b1,lambda,i)    
      temp tbxxI(b,nu,lambda,i)    
      temp taixi(a,j,lambda,i) 
      temp tbjxi(b,jb,lambda,i)   
      temp taaxj(a,a1,lambda,ib) 
      temp taxxj(a,nu,lambda,ib) 
      temp tbjxj(b,jb,lambda,ib) 
      temp taixj(a,i,lambda,ib) 
      temp Txxxx(mu,nu,lambda,sigma) 
      temp T1xxxx(mu,nu,lambda,sigma) 
      temp dx1(mu,nu,lambda,sigma)
      temp dy1(mu,nu,lambda,sigma)
      temp dz1(mu,nu,lambda,sigma)
      temp dx2(mu,nu,lambda,sigma)
      temp dy2(mu,nu,lambda,sigma)
      temp dz2(mu,nu,lambda,sigma)
      temp dx3(mu,nu,lambda,sigma)
      temp dy3(mu,nu,lambda,sigma)
      temp dz3(mu,nu,lambda,sigma)
      temp dx4(mu,nu,lambda,sigma)
      temp dy4(mu,nu,lambda,sigma)
      temp dz4(mu,nu,lambda,sigma) 
#
# One particle intermediate arrays 
# -------------------------------- 
#
      distributed Iij_aa(i1,i2) 
      distributed Iij_bb(j1,j2) 
      distributed Iia_aa(i1,a)  
      distributed IMia_aa(i1,a)  
      distributed IMia_bb(j1,b)  
      distributed Iia_bb(j1,b)  
      distributed Iab_aa(a,a1)  
      distributed Iab_bb(b,b1)  
      distributed Iai_aa(a,i3) 
      distributed Iai_bb(b,j3) 
#
# Declare scalars 
#
      scalar fact 
      scalar etemp 
      scalar etemp1
      scalar etemp2
      scalar etemp3
      scalar etemp4
      scalar etemp5
      scalar etempa
      scalar esum 
      scalar esum1
      scalar esum2
      scalar esum3
      scalar esum4
      scalar esum5
      scalar esum6
      scalar esuma  
      scalar ecorraaa 
      scalar ecorraab 
      scalar ecorrbba 
      scalar ecorrbbb 
      scalar ecorrsa 
      scalar ecorrsb 
#
# --------------------------------------------------------------------------
#
     PROC READ_BLOCKDATA  
#    -------------------  
#
#   Read BLOCKDATA file.
#
      execute sip_barrier 
      execute server_barrier
      execute list_to_blocks                VSpipi(p,i1,p1,i2)
      execute list_to_blocks                Vaaii
      execute list_to_blocks                Viaai
      execute list_to_blocks                VSaaai
      execute list_to_blocks                VSqjqj(q,j1,q1,j2)
      execute list_to_blocks                Vbbjj
      execute list_to_blocks                Vjbbj
      execute list_to_blocks                VSbbbj
      execute list_to_blocks                Vbbii
      execute list_to_blocks                Vjbii
      execute list_to_blocks                Vbbai
      execute list_to_blocks                Vpiqj(p,i1,q,j2)
      execute list_to_blocks                Vaajj
      execute list_to_blocks                Viabj
      execute list_to_blocks                Vaabj

      execute list_to_blocks                t1a_old
      execute list_to_blocks                t1b_old
      execute list_to_blocks                T2aiai
      execute list_to_blocks                T2aibj
      execute list_to_blocks                T2bjbj
      execute read_list_to_blocks
      execute server_barrier
      execute sip_barrier
#
      etemp = 0.0 
      etemp1= 0.0 
      etemp2= 0.0 
      etemp3= 0.0 
      etemp4= 0.0 
      etemp5= 0.0 
      esuma = 0.0
      esum  = 0.0 
      esum1 = 0.0 
      esum2 = 0.0 
      esum3 = 0.0 
      esum4 = 0.0 
      esum5 = 0.0 
      esum6 = 0.0 
#
     ENDPROC READ_BLOCKDATA  
#    ----------------------  
#
# --------------------------------------------------------------------------
#
     PROC WRITE_BLOCKDATA  
#    --------------------  
#
#   Write BLOCKDATA file.
#
      create t1a 
      create t1b 
      execute sip_barrier 
      execute server_barrier 
#
      PARDO a, i1 
            REQUEST t1a_old(a,i1) a 
            PUT t1a(a,i1) = t1a_old(a,i1) 
      ENDPARDO a, i1 
#
      PARDO b, j1 
            REQUEST t1b_old(b,j1) b 
            PUT t1b(b,j1) = t1b_old(b,j1) 
      ENDPARDO b, j1 
#
      PARDO a, i1 
            GET Iia_aa(i1,a) 
            tpp(i1,a)  = Iia_aa(i1,a)  
            tpp(i1,a) *= -1.0 
            PUT IMia_aa(i1,a) = tpp(i1,a) 
      ENDPARDO a, i1 
#
      PARDO b, j1 
            GET Iia_bb(j1,b) 
            tqq(j1,b)  = Iia_bb(j1,b)  
            tqq(j1,b) *= -1.0 
            PUT IMia_bb(j1,b) = tqq(j1,b) 
      ENDPARDO b, j1 
#
      execute sip_barrier 
      execute server_barrier
#
#     Two-electron integrals 
#     ---------------------- 
#
      execute blocks_to_list                VSpipi(p,i1,p1,i2)
      execute blocks_to_list                Vaaii
      execute blocks_to_list                Viaai
      execute blocks_to_list                VSaaai
      execute blocks_to_list                VSqjqj(q,j1,q1,j2)
      execute blocks_to_list                Vbbjj
      execute blocks_to_list                Vjbbj
      execute blocks_to_list                VSbbbj
      execute blocks_to_list                Vbbii
      execute blocks_to_list                Vjbii
      execute blocks_to_list                Vbbai
      execute blocks_to_list                Vpiqj(p,i1,q,j2)
      execute blocks_to_list                Vaajj
      execute blocks_to_list                Viabj
      execute blocks_to_list                Vaabj
#
#     CCSD amplitudes 
#     --------------- 
#
      execute blocks_to_list                t1a_old 
      execute blocks_to_list                t1b_old
      execute blocks_to_list                T2aiai 
      execute blocks_to_list                T2aibj 
      execute blocks_to_list                T2bjbj 
#
#     Triples modification of lambda equations 
#     ---------------------------------------- 
#
      execute blocks_to_list                fsai 
      execute blocks_to_list                fsbj  
      execute blocks_to_list                saiai  
      execute blocks_to_list                saibj  
      execute blocks_to_list                sbjbj  
#
#     One-particle intermediates 
#     -------------------------- 
#
      execute blocks_to_list                Iij_aa 
      execute blocks_to_list                Iij_bb 
      execute blocks_to_list                Iia_aa 
      execute blocks_to_list                Iia_bb 
      execute blocks_to_list                Iab_aa 
      execute blocks_to_list                Iab_bb 
      execute blocks_to_list                Iai_aa 
      execute blocks_to_list                Iai_bb 
#
#     Contribution to one-density 
#     --------------------------- 
#
      execute blocks_to_list                Daa 
      execute blocks_to_list                Dbb 
      execute blocks_to_list                Dii 
      execute blocks_to_list                Djj 
      execute blocks_to_list                DDai 
      execute blocks_to_list                DDbj 
#
#     Two particle density 
#     -------------------- 
#
      execute blocks_to_list                SGaaai
      execute blocks_to_list                SGbbbj
      execute blocks_to_list                SGaabj
      execute blocks_to_list                SGbbai
#
     #execute blocks_to_list                Giiia
     #execute blocks_to_list                Gijib
     #execute blocks_to_list                Gjija
     #execute blocks_to_list                Gjjjb
     #execute blocks_to_list                Giiaa
     #execute blocks_to_list                Gijab
     #execute blocks_to_list                Gjjbb
#
      execute write_blocks_to_list
 
      execute server_barrier
      execute sip_barrier
#
     ENDPROC WRITE_BLOCKDATA  
#    -----------------------  
#
# --------------------------------------------------------------------------
#
#
# --------------------------------------------------------------------------
#
     PROC PDATA  
#    ---------- 
#
#    Put the vOoO integrals into a distributed array 
#    ----------------------------------------------- 
#
     create XSaIiI 
     create XSbJjJ 
     create XaIjJ
     create XiIbJ
     create t1ai 
     create t1bj 
     execute sip_barrier 
     PARDO a, i1, i, j 
           PREQUEST PaIiI(a,i,i1,j) = VSpipi(a,i2,i1,i3) 
           PUT XSaIiI(a,i,i1,j)     = Paiii(a,i,i1,j)
     ENDPARDO a, i1, i, j 
#
     PARDO b, j1, ib, jb 
           PREQUEST PbJjJ(b,ib,j1,jb) = VSqjqj(b,j2,j1,j3) 
           PUT XSbJjJ(b,ib,j1,jb)     = Pbjjj(b,ib,j1,jb)
     ENDPARDO b, j1, ib, jb  
#
     PARDO a, j1, i, jb
           PREQUEST PaIjJ(a,i,j1,jb) = Vpiqj(a,i2,j1,j3) 
           PUT XaIjJ(a,i,j1,jb)      = Paijj(a,i,j1,jb)
     ENDPARDO a, j1, i, jb
#
     PARDO b, i1, i, jb  
           PREQUEST PiIbJ(i1,i,b,jb) = Vpiqj(i1,i2,b,j3) 
           PUT XiIbJ(i1,i,b,jb)      = PiIbJ(i1,i,b,jb)
     ENDPARDO b, i1, i, jb
#
#    Put the singles amplitudes into a distributed array t1aI/t1bJ 
#    ------------------------------------------------------------- 
#
     PARDO a, i 
           PREQUEST tpi(a,i) = t1a_old(a,i1)  
           PUT t1ai(a,i)     = tpi(a,i) 
     ENDPARDO a, i 
#
     PARDO b, jb
           PREQUEST tqj(b,jb) = t1b_old(b,j1)  
           PUT t1bj(b,jb)     = tqj(b,jb) 
     ENDPARDO b, jb
#
     execute sip_barrier 
     execute server_barrier 
#
# --------------------------------------------------------------------------
#
     ENDPROC PDATA  
#    ------------- 
#
# --------------------------------------------------------------------------
#
     PROC T4AAA 
#    ---------- 
#
     DO i # segment size of 1  
#
        create Paaai(*,*,*,i) 
        create Pbbai(*,*,*,i) 
        create DaiaS(*,*,*,i) 
        create DaSbj(*,i,*,*) 
        execute sip_barrier 
#
        PARDO a, a1, a2 
              tppps(a,a1,a2,i) = 0.0 
              DO i1 
                 REQUEST             VSaaai(a,a1,a2,i1) a  
                 GET                 IIi(i,i1) 
                 t1pppi(a,a1,a2,i) = VSaaai(a,a1,a2,i1)*IIi(i,i1) 
                 tppps(a,a1,a2,i) += t1pppi(a,a1,a2,i) 
              ENDDO i1 
              PUT Paaai(a,a1,a2,i) = tppps(a,a1,a2,i) 
        ENDPARDO a, a1, a2 
#
        PARDO b, b1, a  
              PREQUEST tqqps(b,b1,a,i) = Vbbai(b,b1,a,i1) 
              PUT Pbbai(b,b1,a,i)      = tqqps(b,b1,a,i) 
        ENDPARDO b, b1, a  
        PARDO a, a1, i1 
              PREQUEST t1ppps(a,i1,a1,i) = T2aiai(a,i1,a1,i2) 
              PUT DaiaS(a,i1,a1,i)       = t1ppps(a,i1,a1,i) 
        ENDPARDO a, a1, i1 
        PARDO a, b, j1 
              PREQUEST tpsqq(a,i,b,j1) = T2aibj(a,i1,b,j1) 
              PUT DaSbj(a,i,b,j1)      = tpsqq(a,i,b,j1) 
        ENDPARDO a, b, j1 
#
        DO j # segment size of 1  
#
       #IF j >= i 
#
        create Paaaj(*,*,*,j) 
        create Pbbaj(*,*,*,j) 
       #create DaSaS(*,j,*,i) 
        create Daa 
        create D1aiaS(*,*,*,j) 
        create D1aSbj(*,j,*,*) 
        execute sip_barrier 
#
        PARDO a, a1, a2 
              tppps(a,a1,a2,j) = 0.0 
              DO i1 
                 REQUEST             VSaaai(a,a1,a2,i1) a  
                 GET                 IIi(j,i1) 
                 t1pppi(a,a1,a2,j) = VSaaai(a,a1,a2,i1)*IIi(j,i1) 
                 tppps(a,a1,a2,j) += t1pppi(a,a1,a2,j) 
              ENDDO i1 
              PUT Paaaj(a,a1,a2,j) = tppps(a,a1,a2,j) 
        ENDPARDO a, a1, a2 
#
        PARDO b, b1, a  
              PREQUEST tqqps(b,b1,a,j) = Vbbai(b,b1,a,i1) 
              PUT Pbbaj(b,b1,a,j)      = tqqps(b,b1,a,j) 
        ENDPARDO b, b1, a  
        PARDO a, a1  
              PREQUEST tpsps(a,j,a1,i) = T2aiai(a,i1,a1,i2) 
              tppii(a,a1,j,i)          = tpsps(a,j,a1,i) 
              tpp(a,a1)                = tppii(a,a1,j,i) 
              PUT Daa(a,a1)            = tpp(a,a1) 
             #PUT DaSaS(a,j,a1,i)      = tpsps(a,j,a1,i) 
        ENDPARDO a, a1  
        PARDO a, a1, i1 
              PREQUEST t2ppps(a,i1,a1,j) = T2aiai(a,i1,a1,i2) 
              PUT D1aiaS(a,i1,a1,j)      = t2ppps(a,i1,a1,j) 
        ENDPARDO a, a1, i1 
        PARDO a, b, j1 
		      PREQUEST t1psqq(a,j,b,j1) = T2aibj(a,i1,b,j1) 
		      PUT D1aSbj(a,j,b,j1)       = t1psqq(a,j,b,j1) 
		ENDPARDO a, b, j1 
	#
	#    alpha/alpha/alpha/ block. 
	#    ------------------------- 
	#
		DO k # segment size of 1  
	#
	       #IF k >=j 
	#
		   CREATE X3ijk 
		   CREATE Y3ijk 
		   CREATE D3ijk 
		   CREATE E3ijk 
		   create Paaak(*,*,*,k) 
		   create D2aiaS(*,*,*,k) 
		  #create D1aSaS(*,i,*,k) 
		   create D1aa 
		  #create D2aSaS(*,j,*,k) 
		   create D2aa 
		   execute sip_barrier 
	#
		   PARDO a, a1, a2 
			 tppps(a,a1,a2,k) = 0.0 
			 DO i1 
			    REQUEST             VSaaai(a,a1,a2,i1) a  
                    GET                 IIi(k,i1) 
                    t1pppi(a,a1,a2,k) = VSaaai(a,a1,a2,i1)*IIi(k,i1) 
                    tppps(a,a1,a2,k) += t1pppi(a,a1,a2,k) 
                 ENDDO i1 
                 PUT Paaak(a,a1,a2,k) = tppps(a,a1,a2,k) 
           ENDPARDO a, a1, a2 
#
           PARDO a, a1, i1 
                 PREQUEST t3ppps(a,i1,a1,k) = T2aiai(a,i1,a1,i2) 
                 PUT D2aiaS(a,i1,a1,k)      = t3ppps(a,i1,a1,k) 
           ENDPARDO a, a1, i1 
           PARDO a, a1  
                 PREQUEST t1psps(a,i,a1,k) = T2aiai(a,i1,a1,i2) 
                 tppii(a,a1,i,k)           = t1psps(a,i,a1,k) 
                 tpp(a,a1)                 = tppii(a,a1,i,k) 
                 PUT D1aa(a,a1)            = tpp(a,a1) 
                #PUT D1aSaS(a,i,a1,k)      = t1psps(a,i,a1,k) 
           ENDPARDO a, a1  
           PARDO a, a1  
                 PREQUEST t2psps(a,j,a1,k) = T2aiai(a,i1,a1,i2) 
                 tppii(a,a1,j,k)           = t2psps(a,j,a1,k) 
                 tpp(a,a1)                 = tppii(a,a1,j,k) 
                 PUT D2aa(a,a1)            = tpp(a,a1) 
                #PUT D2aSaS(a,j,a1,k)      = t2psps(a,j,a1,k) 
           ENDPARDO a, a1  
           execute sip_barrier  
#
#          Form COMPLETE X3 arrays for the (i,j,k) combination. 
#          ---------------------------------------------------- 
#
           PARDO a, a1, a2, i1  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                    GET                    DaiaS(a1,i1,a2,i) 
                    GET                    XSaiii(a,k,i1,j) 
# 
                    t2aiii(a,i1,k,j)     = XSaiii(a,k,i1,j) 
                    t1ppii(a1,a2,i1,i)   = DaiaS(a1,i1,a2,i) 
                    tpp(a,i1)            = t2aiii(a,i1,k,j)
                    tpppp(a,a1,a2,i)     = t1ppii(a1,a2,i1,i)*tpp(a,i1)  
                    tppp(a,a1,a2)        = tpppp(a,a1,a2,i) 
#
                    PUT X3ijk(a,a1,a2)  += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a, a1, a2, i1    
#
#          (a--a1) permutation 
#          ------------------- 
#
           PARDO a1, a, a2, i1  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                    GET                   DaiaS(a,i1,a2,i) 
                    GET                   XSaiii(a1,k,i1,j) 
#
                    t2aiii(a1,i1,k,j)   = XSaiii(a1,k,i1,j) 
                    t1ppii(a,a2,i1,i)   = DaiaS(a,i1,a2,i) 
                    tpp(a1,i1)          = t2aiii(a1,i1,k,j)
                    tpppp(a,a1,a2,i)    = t1ppii(a,a2,i1,i)*tpp(a1,i1)  
                    tppp(a,a1,a2)       = tpppp(a,a1,a2,i) 
                    tppp(a,a1,a2)      *= -1.0  
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a1, a, a2, i1    
#
#          (a--a2) permutation 
#          ------------------- 
#
           PARDO a2, a1, a, i1  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                    GET                   DaiaS(a1,i1,a,i) 
                    GET                   XSaiii(a2,k,i1,j) 
#
                    t2aiii(a2,i1,k,j)   = XSaiii(a2,k,i1,j) 
                    t1ppii(a1,a,i1,i)   = DaiaS(a1,i1,a,i) 
                    tpp(a2,i1)          = t2aiii(a2,i1,k,j)
                    tpppp(a,a1,a2,i)    = t1ppii(a1,a,i1,i)*tpp(a2,i1)  
                    tppp(a,a1,a2)       = tpppp(a,a1,a2,i) 
                    tppp(a,a1,a2)      *= -1.0  
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a2, a1, a, i1    
#
#          (i--j) permutation 
#          ------------------- 
#
           PARDO a, a1, a2, i1  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                    GET                   D1aiaS(a1,i1,a2,j) 
                    GET                   XSaiii(a,k,i1,i) 
#
                    t2aiii(a,i1,k,i)    = XSaiii(a,k,i1,i) 
                    t1ppii(a1,a2,i1,j)  = D1aiaS(a1,i1,a2,j) 
                    tpp(a,i1)           = t2aiii(a,i1,k,i)
                    tpppp(a,a1,a2,j)    = t1ppii(a1,a2,i1,j)*tpp(a,i1)  
                    tppp(a,a1,a2)       = tpppp(a,a1,a2,j) 
                    tppp(a,a1,a2)      *= -1.0  
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a, a1, a2, i1    
#
#          (i--k) permutation 
#          ------------------- 
#
           PARDO a, a1, a2, i1  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                    GET                   D2aiaS(a1,i1,a2,k)  
                    GET                   XSaiii(a,i,i1,j) 
# 
                    t2aiii(a,i1,i,j)    = XSaiii(a,i,i1,j) 
                    t1ppii(a1,a2,i1,k)  = D2aiaS(a1,i1,a2,k) 
                    tpp(a,i1)           = t2aiii(a,i1,i,j)
                    tpppp(a,a1,a2,k)    = t1ppii(a1,a2,i1,k)*tpp(a,i1)  
                    tppp(a,a1,a2)       = tpppp(a,a1,a2,k) 
                    tppp(a,a1,a2)      *= -1.0  
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a, a1, a2, i1    
#
#          (a--a1) (i--j) permutation 
#          -------------------------- 
#
           PARDO a1, a, a2, i1  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                    GET                   D1aiaS(a,i1,a2,j) 
                    GET                   XSaiii(a1,k,i1,i) 
#
                    t2aiii(a1,i1,k,i)   = XSaiii(a1,k,i1,i) 
                    t1ppii(a,a2,i1,j)   = D1aiaS(a,i1,a2,j) 
                    tpp(a1,i1)          = t2aiii(a1,i1,k,i)
                    tpppp(a,a1,a2,j)    = t1ppii(a,a2,i1,j)*tpp(a1,i1)  
                    tppp(a,a1,a2)       = tpppp(a,a1,a2,j) 
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a1, a, a2, i1    
#
#          (a--a1) (i--k) permutation 
#          --------------------------- 
#
           PARDO a1, a, a2, i1  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                    GET                   D2aiaS(a,i1,a2,k) 
                    GET                   XSaiii(a1,i,i1,j) 
#
                    t2aiii(a1,i1,i,j)   = XSaiii(a1,i,i1,j) 
                    t1ppii(a,a2,i1,k)   = D2aiaS(a,i1,a2,k) 
                    tpp(a1,i1)          = t2aiii(a1,i1,i,j)
                    tpppp(a,a1,a2,k)    = t1ppii(a,a2,i1,k)*tpp(a1,i1)  
                    tppp(a,a1,a2)       = tpppp(a,a1,a2,k) 
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a1, a, a2, i1    
#
#          (a--a2) (i--j) permutation 
#          -------------------------- 
#
           PARDO a2, a1, a, i1  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                    GET                   D1aiaS(a1,i1,a,j) 
                    GET                   XSaiii(a2,k,i1,i) 
#
                    t2aiii(a2,i1,k,i)   = XSaiii(a2,k,i1,i) 
                    t1ppii(a1,a,i1,j)   = D1aiaS(a1,i1,a,j) 
                    tpp(a2,i1)          = t2aiii(a2,i1,k,i)
                    tpppp(a,a1,a2,j)    = t1ppii(a1,a,i1,j)*tpp(a2,i1)  
                    tppp(a,a1,a2)       = tpppp(a,a1,a2,j) 
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a2, a1, a, i1    
#
#          (a--a2) (i--l) permutation 
#          -------------------------- 
#
           PARDO a2, a1, a, i1  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                    GET                   D2aiaS(a1,i1,a,k) 
                    GET                   XSaiii(a2,i,i1,j) 
#
                    t2aiii(a2,i1,i,j)   = XSaiii(a2,i,i1,j) 
                    t1ppii(a1,a,i1,k)   = D2aiaS(a1,i1,a,k) 
                    tpp(a2,i1)          = t2aiii(a2,i1,i,j)
                    tpppp(a,a1,a2,k)    = t1ppii(a1,a,i1,k)*tpp(a2,i1)  
                    tppp(a,a1,a2)       = tpppp(a,a1,a2,k) 
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a2, a1, a, i1    
#
           PARDO a2, a1, a, a3  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                   #GET D2aSaS(a,j,a3,k) 
                    GET D2aa(a,a3) 
                    GET Paaai(a1,a3,a2,i) 
#
                   #tppii(a,a3,j,k)     = D2aSaS(a,j,a3,k) 
                   #tpp(a,a3)           = tppii(a,a3,j,k)  
#
                    tpppp(a,a1,a2,i)    = Paaai(a1,a3,a2,i)*D2aa(a,a3)   
                    tppp(a,a1,a2)       = tpppp(a,a1,a2,i) 
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a2, a1, a, a3  
#
#          (a--a1) permutation 
#          ------------------- 
#
           PARDO a2, a1, a, a3  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                   #GET D2aSaS(a1,j,a3,k) 
                    GET D2aa(a1,a3) 
                    GET Paaai(a,a3,a2,i) 
#
                   #tppii(a1,a3,j,k)     = D2aSaS(a1,j,a3,k) 
                   #tpp(a1,a3)           = tppii(a1,a3,j,k)  
#
                    tpppp(a,a1,a2,i)    = Paaai(a,a3,a2,i)*D2aa(a1,a3)   
                    tppp(a,a1,a2)      = tpppp(a,a1,a2,i) 
                    tppp(a,a1,a2)     *= -1.0  
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a2, a1, a, a3  
#
#          (a--a2) permutation 
#          ------------------- 
#
           PARDO a, a1, a2, a3  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                   #GET D2aSaS(a2,j,a3,k) 
                    GET D2aa(a2,a3) 
                    GET Paaai(a1,a3,a,i) 
#
                   #tppii(a2,a3,j,k)     = D2aSaS(a2,j,a3,k) 
                   #tpp(a2,a3)           = tppii(a2,a3,j,k)  
#
                    tpppp(a,a1,a2,i)    = Paaai(a1,a3,a,i)*D2aa(a2,a3)   
                    tppp(a,a1,a2)      = tpppp(a,a1,a2,i) 
                    tppp(a,a1,a2)     *= -1.0  
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a, a1, a2, a3  
#
#          (i--j) permutation 
#          ------------------- 
#
           PARDO a2, a1, a, a3  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                   #GET D1aSaS(a,i,a3,k) 
                    GET D1aa(a,a3) 
                    GET Paaaj(a1,a3,a2,j)  
#
                   #tppii(a,a3,i,k)     = D1aSaS(a,i,a3,k) 
                   #tpp(a,a3)           = tppii(a,a3,i,k)  
#
                    tpppp(a,a1,a2,j)    = Paaaj(a1,a3,a2,j)*D1aa(a,a3)   
                    tppp(a,a1,a2)      = tpppp(a,a1,a2,j) 
                    tppp(a,a1,a2)     *= -1.0  
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a2, a1, a, a3  
#
#          (i--k) permutation 
#          ------------------- 
#
           PARDO a2, a1, a, a3  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                   #GET DaSaS(a,j,a3,i)  
                    GET Daa(a,a3)  
                    GET Paaak(a1,a3,a2,k) 
#
                   #tppii(a,a3,j,i)     = DaSaS(a,j,a3,i) 
                   #tpp(a,a3)           = tppii(a,a3,j,i)  
#
                    tpppp(a,a1,a2,k)    = Paaak(a1,a3,a2,k)*Daa(a,a3)   
                    tppp(a,a1,a2)      = tpppp(a,a1,a2,k) 
                    tppp(a,a1,a2)     *= -1.0  
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a2, a1, a, a3  
#
#          (a--a1) (i--j) permutation 
#          -------------------------- 
#
           PARDO a2, a1, a, a3  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                   #GET D1aSaS(a1,i,a3,k) 
                    GET D1aa(a1,a3) 
                    GET Paaaj(a,a3,a2,j) 
# 
                   #tppii(a1,a3,i,k)     = D1aSaS(a1,i,a3,k) 
                   #tpp(a1,a3)           = tppii(a1,a3,i,k)  
#
                    tpppp(a,a1,a2,j)    = Paaaj(a,a3,a2,j)*D1aa(a1,a3)   
                    tppp(a,a1,a2)      = tpppp(a,a1,a2,j) 
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a2, a1, a, a3  
#
#          (a--a1) (i--k) permutation 
#          -------------------------- 
#
           PARDO a, a2, a1, a3  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                   #GET DaSaS(a1,j,a3,i) 
                    GET Daa(a1,a3) 
                    GET Paaak(a,a3,a2,k) 
#
                   #tppii(a1,a3,j,i)    = DaSaS(a1,j,a3,i) 
                   #tpp(a1,a3)           = tppii(a1,a3,j,i)  
#
                    tpppp(a,a1,a2,k)    = Paaak(a,a3,a2,k)*Daa(a1,a3)   
                    tppp(a,a1,a2)      = tpppp(a,a1,a2,k) 
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a, a2, a1, a3  
#
#          (a--a2) (i--j) permutation 
#          -------------------------- 
#
           PARDO a, a1, a2, a3  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                   #GET D1aSaS(a2,i,a3,k) 
                    GET D1aa(a2,a3) 
                    GET Paaaj(a1,a3,a,j) 
#
                   #tppii(a2,a3,i,k)     = D1aSaS(a2,i,a3,k) 
                   #tpp(a2,a3)           = tppii(a2,a3,i,k)  
#
                    tpppp(a,a1,a2,j)    = Paaaj(a1,a3,a,j)*D1aa(a2,a3)   
                    tppp(a,a1,a2)      = tpppp(a,a1,a2,j) 
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a, a1, a2, a3  
#
#          (a--a2) (i--k) permutation 
#          -------------------------- 
#
           PARDO a, a1, a2, a3  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                   #GET DaSaS(a2,j,a3,i) 
                    GET Daa(a2,a3) 
                    GET Paaak(a1,a3,a,k) 
#
                   #tppii(a2,a3,j,i)     = DaSaS(a2,j,a3,i) 
                   #tpp(a2,a3)           = tppii(a2,a3,j,i)  
#
                    tpppp(a,a1,a2,k)    = Paaak(a1,a3,a,k)*Daa(a2,a3)   
                    tppp(a,a1,a2)      = tpppp(a,a1,a2,k) 
#
                    PUT X3ijk(a,a1,a2) += tppp(a,a1,a2) 
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a, a1, a2, a3  
#
#      Compute disconnected contribution to the amplitude 
#      -------------------------------------------------- 
#
#          (1) 
#          --- 
#
           PARDO a, a1, a2 
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                #PREQUEST tpi(a,i)          = t1a_old(a,i1)  
                 PREQUEST P1aiai(a1,j,a2,k) = VSpipi(a1,i1,a2,i2) 
                 GET t1ai(a,i) 
#
                 tppii(a1,a2,j,k)    = P1aiai(a1,j,a2,k)
                 tpp(a1,a2)          = tppii(a1,a2,j,k)
#
                 tpppi(a,a1,a2,i)    = tpp(a1,a2)^t1ai(a,i)
                 tppp(a,a1,a2)       = tpppi(a,a1,a2,i) 
                 PUT D3ijk(a,a1,a2) += tppp(a,a1,a2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a, a1, a2 
           execute sip_barrier 
#
#          (-P_ij) 
#          ------- 
#
           PARDO a, a1, a2 
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                #PREQUEST tpj(a,j)          = t1a_old(a,i1)  
                 PREQUEST P2aiai(a1,i,a2,k) = VSpipi(a1,i1,a2,i2) 
                 GET t1ai(a,j)     
#
                 tppii(a1,a2,i,k)    = P2aiai(a1,i,a2,k)
                 tpp(a1,a2)          = tppii(a1,a2,i,k)
#
                 tpppi(a,a1,a2,j)    = tpp(a1,a2)^t1ai(a,j)
                 tppp(a,a1,a2)       = tpppi(a,a1,a2,j) 
                 tppp(a,a1,a2)      *= -1.0  
                 PUT D3ijk(a,a1,a2) += tppp(a,a1,a2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a, a1, a2 
           execute sip_barrier 
#
#          (-P_ik) 
#          ------- 
#
           PARDO a, a1, a2 
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                #PREQUEST tpk(a,k)          = t1a_old(a,i1)  
                 PREQUEST P3aiai(a1,j,a2,i) = VSpipi(a1,i1,a2,i2) 
                 GET t1ai(a,k)     
#
                 tppii(a1,a2,j,i)    = P3aiai(a1,j,a2,i)
                 tpp(a1,a2)          = tppii(a1,a2,j,i)
#
                 tpppi(a,a1,a2,k)    = tpp(a1,a2)^t1ai(a,k)
                 tppp(a,a1,a2)       = tpppi(a,a1,a2,k) 
                 tppp(a,a1,a2)      *= -1.0  
                 PUT D3ijk(a,a1,a2) += tppp(a,a1,a2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a, a1, a2 
           execute sip_barrier 
#
#          (-a<->a1) 
#          --------- 
#
           PARDO a1, a, a2 
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                #PREQUEST tpi(a1,i)        = t1a_old(a1,i1)  
                 PREQUEST P4aiai(a,j,a2,k) = VSpipi(a,i1,a2,i2) 
                 GET t1ai(a1,i)   
#
                 tppii(a,a2,j,k)     = P4aiai(a,j,a2,k)
                 tpp(a,a2)           = tppii(a,a2,j,k)
#
                 tpppi(a,a1,a2,i)    = tpp(a,a2)^t1ai(a1,i)
                 tppp(a,a1,a2)       = tpppi(a,a1,a2,i) 
                 tppp(a,a1,a2)      *= -1.0  
                 PUT D3ijk(a,a1,a2) += tppp(a,a1,a2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a1, a, a2 
           execute sip_barrier 
#
#          (-a<->a2) 
#          --------- 
#
           PARDO a2, a1, a 
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                #PREQUEST tpi(a2,i)        = t1a_old(a2,i1)  
                 PREQUEST P5aiai(a1,j,a,k) = VSpipi(a1,i1,a,i2) 
                 GET t1ai(a2,i) 
#
                 tppii(a1,a,j,k)     = P5aiai(a1,j,a,k)
                 tpp(a1,a)           = tppii(a1,a,j,k)
#
                 tpppi(a,a1,a2,i)    = tpp(a1,a)^t1ai(a2,i)
                 tppp(a,a1,a2)       = tpppi(a,a1,a2,i) 
                 tppp(a,a1,a2)      *= -1.0  
                 PUT D3ijk(a,a1,a2) += tppp(a,a1,a2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a2, a1, a 
           execute sip_barrier 
#
#          (i<-j a<->a1) 
#          ------------- 
#
           PARDO a1, a, a2 
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                #PREQUEST tpj(a1,j)        = t1a_old(a1,i1)  
                 PREQUEST P6aiai(a,i,a2,k) = VSpipi(a,i1,a2,i2) 
                 GET t1ai(a1,j)     
#
                 tppii(a,a2,i,k)     = P6aiai(a,i,a2,k)
                 tpp(a,a2)           = tppii(a,a2,i,k)
#
                 tpppi(a,a1,a2,j)    = tpp(a,a2)^t1ai(a1,j)
                 tppp(a,a1,a2)       = tpppi(a,a1,a2,j) 
                 PUT D3ijk(a,a1,a2) += tppp(a,a1,a2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a1, a, a2 
           execute sip_barrier 
#
#          (i<-j a<->a2) 
#          ------------- 
#
           PARDO a2, a1, a 
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                #PREQUEST tpj(a2,j)         = t1a_old(a2,i1)  
                 PREQUEST P7aiai(a1,i,a,k) = VSpipi(a1,i1,a,i2) 
                 GET t1ai(a2,j)   
#
                 tppii(a1,a,i,k)     = P7aiai(a1,i,a,k)
                 tpp(a1,a)           = tppii(a1,a,i,k)
#
                 tpppi(a,a1,a2,j)    = tpp(a1,a)^t1ai(a2,j)
                 tppp(a,a1,a2)       = tpppi(a,a1,a2,j) 
                 PUT D3ijk(a,a1,a2) += tppp(a,a1,a2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a2, a1, a 
           execute sip_barrier 
#
#          (i<-k a<->a1) 
#          ------------- 
#
           PARDO a1, a, a2 
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                #PREQUEST tpk(a1,k)        = t1a_old(a1,i1)  
                 PREQUEST P8aiai(a,j,a2,i) = VSpipi(a,i1,a2,i2) 
                 GET t1ai(a1,k)  
#
                 tppii(a,a2,j,i)     = P8aiai(a,j,a2,i)
                 tpp(a,a2)           = tppii(a,a2,j,i)
#
                 tpppi(a,a1,a2,k)    = tpp(a,a2)^t1ai(a1,k)
                 tppp(a,a1,a2)       = tpppi(a,a1,a2,k) 
                 PUT D3ijk(a,a1,a2) += tppp(a,a1,a2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a1, a, a2 
           execute sip_barrier 
#
#          (i<-k a<->a2) 
#          ------------- 
#
           PARDO a2, a1, a 
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                #PREQUEST tpk(a2,k)        = t1a_old(a2,i1)  
                 PREQUEST P9aiai(a1,j,a,i) = VSpipi(a1,i1,a,i2) 
                 GET t1ai(a2,k)     
#
                 tppii(a1,a,j,i)     = P9aiai(a1,j,a,i)
                 tpp(a1,a)           = tppii(a1,a,j,i)
#
                 tpppi(a,a1,a2,k)    = tpp(a1,a)^t1ai(a2,k)
                 tppp(a,a1,a2)       = tpppi(a,a1,a2,k) 
                 PUT D3ijk(a,a1,a2) += tppp(a,a1,a2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a2, a1, a 
#
           execute server_barrier 
           execute sip_barrier 
#
# Symmetrize amplitude array 
# --------------------------- 
#
           PARDO a, a1, a2  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                    GET                   X3ijk(a,a1,a2) 
                    t1ppp(a1,a,a2)      = X3ijk(a,a1,a2) 
                    t2ppp(a2,a1,a)      = X3ijk(a,a1,a2) 
                    t3ppp(a,a2,a1)      = X3ijk(a,a1,a2) 
                    t4ppp(a1,a2,a)      = X3ijk(a,a1,a2) 
                    t5ppp(a2,a,a1)      = X3ijk(a,a1,a2) 
                    t1ppp(a1,a,a2)     *= -1.0 
                    t2ppp(a2,a1,a)     *= -1.0 
                    t3ppp(a,a2,a1)     *= -1.0  

                    PUT Y3ijk(a,a1,a2) = X3ijk(a,a1,a2)  
                    PUT Y3ijk(a1,a,a2) = t1ppp(a1,a,a2)  
                    PUT Y3ijk(a2,a1,a) = t2ppp(a2,a1,a)  
                    PUT Y3ijk(a,a2,a1) = t3ppp(a,a2,a1)  
                    PUT Y3ijk(a1,a2,a) = t4ppp(a1,a2,a)  
                    PUT Y3ijk(a2,a,a1) = t5ppp(a2,a,a1)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a, a1, a2   
#
#          Disconnected part 
#          ----------------- 
#
           PARDO a, a1, a2  
#
                 IF a <= a1 
                 IF a1 <= a2 
#
                    GET                   D3ijk(a,a1,a2) 
                    t1ppp(a1,a,a2)      = D3ijk(a,a1,a2) 
                    t2ppp(a2,a1,a)      = D3ijk(a,a1,a2) 
                    t3ppp(a,a2,a1)      = D3ijk(a,a1,a2) 
                    t4ppp(a1,a2,a)      = D3ijk(a,a1,a2) 
                    t5ppp(a2,a,a1)      = D3ijk(a,a1,a2) 
                    t1ppp(a1,a,a2)     *= -1.0 
                    t2ppp(a2,a1,a)     *= -1.0 
                    t3ppp(a,a2,a1)     *= -1.0  

                    PUT E3ijk(a,a1,a2) = D3ijk(a,a1,a2)  
                    PUT E3ijk(a1,a,a2) = t1ppp(a1,a,a2)  
                    PUT E3ijk(a2,a1,a) = t2ppp(a2,a1,a)  
                    PUT E3ijk(a,a2,a1) = t3ppp(a,a2,a1)  
                    PUT E3ijk(a1,a2,a) = t4ppp(a1,a2,a)  
                    PUT E3ijk(a2,a,a1) = t5ppp(a2,a,a1)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO a, a1, a2   
           execute server_barrier 
           execute sip_barrier 
#
# Form contribution to the energy 
# ------------------------------- 
#
           PARDO a, a1, a2 
#
                 GET Y3ijk(a,a1,a2) 
                 GET E3ijk(a,a1,a2) 
#
                 t1aaaiii(a,a1,a2,i,j,k) = Y3ijk(a,a1,a2)
                 taiaiai(a,i,a1,j,a2,k)   = T1aaaiii(a,a1,a2,i,j,k) 
                 execute energy_denominator taiaiai(a,i,a1,j,a2,k)  
                 t2aaaiii(a,a1,a2,i,j,k) = taiaiai(a,i,a1,j,a2,k)  
                 t1ppp(a,a1,a2) = t2aaaiii(a,a1,a2,i,j,k) 

                 tppp(a,a1,a2) = Y3ijk(a,a1,a2) 
                 tppp(a,a1,a2) += E3ijk(a,a1,a2) 

                 etemp = tppp(a,a1,a2)*t1ppp(a,a1,a2)
                 etemp = etemp/36.0  
                #etemp*= 6.0  
                 esum1 += etemp 
#
           ENDPARDO a, a1, a2 
#
# Form contribution to Saaii 
# -------------------------- 
#
           PARDO a, a1, a2  
#
                 GET                        Y3ijk(a,a1,a2) 
                 GET                        E3ijk(a,a1,a2) 
#
                 tppp(a,a1,a2)            = Y3ijk(a,a1,a2) 
                 tppp(a,a1,a2)           *= 2.0  
                 tppp(a,a1,a2)           += E3ijk(a,a1,a2)
                 taaaiii(a,a1,a2,i,j,k)   = tppp(a,a1,a2) 
                 taiaiai(a,i,a1,j,a2,k)   = Taaaiii(a,a1,a2,i,j,k) 
                 execute energy_denominator taiaiai(a,i,a1,j,a2,k)  
                 t2aaaiii(a,a1,a2,k,j,i)  = taiaiai(a,i,a1,j,a2,k)  
                 tpppi(a,a1,a2,k)         = t2aaaiii(a,a1,a2,k,j,i) 
#
                 DO a3 
#
                    GET                        Paaak(a1,a3,a2,k) 
#
                    tpp(a,a3)                = tpppi(a,a1,a2,k)*Paaak(a1,a3,a2,k) 
                    tpp(a,a3)               *= 0.5 
                    tppii(a,a3,i,j)          = tpp(a,a3) 
                    Sppii(a3,a,i,j)         = tppii(a,a3,i,j) 
                    Sppii(a3,a,i,j)        *= -1.0  
                    PREPARE Saaii(a,a3,i,j) += tppii(a,a3,i,j) 
                    PREPARE Saaii(a3,a,i,j) += Sppii(a3,a,i,j) 
#
                 ENDDO a3 
#
                 DO l 
#
                    PREQUEST taIII(a2,k,l,j) = VSpipi(a2,i1,i2,i3)  
#
                    tpi(a2,k)                = taIII(a2,k,l,j) 
                    tpp(a,a1)                = tpppi(a,a1,a2,k)*tpi(a2,k)  
                    tpp(a,a1)               *= -0.5 
                    tppii(a,a1,i,l)          = tpp(a,a1) 
                    Sppii(a,a1,l,i)         = tpp(a,a1) 
                    Sppii(a,a1,l,i)        *= -1.0 
                    PREPARE Saaii(a,a1,i,l) += tppii(a,a1,i,l) 
                    PREPARE Saaii(a,a1,l,i) += Sppii(a,a1,l,i) 
#
                 ENDDO l 
#
           ENDPARDO a, a1, a2  
#
# Done contribution to Saaii 
# -------------------------- 
#
# Form Contribution to Sai
# ------------------------
#
# Perm 1
# -------
#
           PARDO a, a1, a2
#
                 PREQUEST P1aiai(a1,j,a2,k) = VSpipi(a1,i1,a2,i2)
                 GET                          Y3ijk(a,a1,a2)

                 taaaiii(a,a1,a2,i,j,k) = Y3ijk(a,a1,a2)
                 taiaiai(a,i,a1,j,a2,k) = taaaiii(a,a1,a2,i,j,k)
                 execute energy_denominator taiaiai(a,i,a1,j,a2,k)
                 t1aaaiii(a,a1,a2,i,j,k) = taiaiai(a,i,a1,j,a2,k)
#
                 t1pppi(a,a1,a2,i) = t1aaaiii(a,a1,a2,i,j,k)
                 t2ppii(a1,a2,j,k) = P1aiai(a1,j,a2,k)
                 tpp(a1,a2) = t2ppii(a1,a2,j,k)
#
                 xai(a,i) = t1pppi(a,a1,a2,i)*tpp(a1,a2)
                 xai(a,i) *= 2.0
                 PUT sai(a,i) += xai(a,i)
#
           ENDPARDO a, a1, a2
           execute server_barrier
           execute sip_barrier
#
# Perm 2
# -------
#
           PARDO a1, a, a2
#
                 PREQUEST P2aiai(a,i,a2,k) = VSpipi(a,i1,a2,i3)
                 GET Y3ijk(a,a1,a2)
                 tppp(a1,a,a2) = Y3ijk(a,a1,a2)

                 taaaiii(a1,a,a2,j,i,k) = tppp(a1,a,a2)
                 taiaiai(a1,j,a,i,a2,k) = taaaiii(a1,a,a2,j,i,k)
                 execute energy_denominator taiaiai(a1,j,a,i,a2,k)
                 t1aaaiii(a1,a,a2,j,i,k) = taiaiai(a1,j,a,i,a2,k)
#
                 t1pppi(a1,a,a2,j) = t1aaaiii(a1,a,a2,j,i,k)
                 t2ppii(a,a2,i,k) = P2aiai(a,i,a2,k)
                 tpp(a,a2) = t2ppii(a,a2,i,k)
#
                 xai(a1,j) = t1pppi(a1,a,a2,j)*tpp(a,a2)
                 xai(a1,j) *= 2.0
                #PUT sai(a1,j) += xai(a1,j)
#
           ENDPARDO a1, a, a2
           execute server_barrier
           execute sip_barrier
#
# Perm 3
# -------
#
           PARDO a2, a1, a
#
                 PREQUEST P3aiai(a1,j,a,i) = VSpipi(a1,i3,a,i2)
                 GET Y3ijk(a,a1,a2)
                 tppp(a2,a1,a) = Y3ijk(a,a1,a2)
#
                 taaaiii(a2,a1,a,k,j,i) = tppp(a2,a1,a)
                 taiaiai(a2,k,a1,j,a,i) = taaaiii(a2,a1,a,k,j,i)
                 execute energy_denominator taiaiai(a2,k,a1,j,a,i)
                 t1aaaiii(a2,a1,a,k,j,i) = taiaiai(a2,k,a1,j,a,i)
#
                 t1pppi(a2,a1,a,k) = t1aaaiii(a2,a1,a,k,j,i)
                 t2ppii(a1,a,j,i) = P3aiai(a1,j,a,i)
                 tpp(a1,a) = t2ppii(a1,a,j,i)
#
                 xai(a2,k) = t1pppi(a2,a1,a,k)*tpp(a1,a)
                 xai(a2,k) *= 2.0
                #PUT sai(a2,k) += xai(a2,k)
#
           ENDPARDO a2, a1, a
#
           execute sip_barrier 
           execute server_barrier 
#
# Form contributions to two-particle density 
# ------------------------------------------ 
#
           PARDO a, a1, a2 # i, j, k 
#
                 GET                        Y3ijk(a,a1,a2)
                 GET                        E3ijk(a,a1,a2)
#
                 tppp(a,a1,a2)            = Y3ijk(a,a1,a2)
                 tppp(a,a1,a2)           *= 2.0
                 tppp(a,a1,a2)           += E3ijk(a,a1,a2)
                 taaaiii(a,a1,a2,i,j,k)   = tppp(a,a1,a2)
                 taiaiai(a,i,a1,j,a2,k)   = Taaaiii(a,a1,a2,i,j,k)
                 execute energy_denominator taiaiai(a,i,a1,j,a2,k)
                 t2aaaiii(a,a1,a2,j,i,k)  = taiaiai(a,i,a1,j,a2,k)
                 tppp(a,a1,a2)            = t2aaaiii(a,a1,a2,j,i,k) 
#
# Form contribution to Gaaai
# --------------------------
#
                 tpppi(a,a1,a2,j)         = tppp(a,a1,a2)
#
                 DO a3 
#
                    PREQUEST t3pipi(a3,i,a2,k) = T2aiai(a3,i1,a2,i2) 
                    tppii(a3,a2,i,k)          = t3pipi(a3,i,a2,k) 
                    tpp(a3,a2)                = tppii(a3,a2,i,k) 
                    tpppp(a,a3,a1,j)          = tpppi(a,a1,a2,j)*tpp(a3,a2) 
                    tpppp(a,a3,a1,j)         *= 0.25   
                    PREPARE Gaaai(a,a3,a1,j)     += tpppp(a,a3,a1,j) 
#
                 ENDDO a3 
#
# Form contribution to Gaiii
# --------------------------
#
                 tpppi(a,a1,a2,k)         = tppp(a,a1,a2)
#
                 DO l 
#
                    PREQUEST t1pipi(a1,l,a2,k) = T2aiai(a1,i1,a2,i2)  
                    tpi(a,l)                  = tpppi(a,a1,a2,k)*t1pipi(a1,l,a2,k) 
                    tpiii(a,l,i,j)            = tpi(a,l) 
                    t1piii(a,i,l,j)           = tpiii(a,l,i,j) 
                    t1piii(a,i,l,j)          *=-0.25 # 0.25  
                    PREPARE Gaiii(a,i,l,j)       += t1piii(a,i,l,j)  
#
                 ENDDO l 
#
# Form contribution to Gaiai
# --------------------------
#
                 tppp(a,a1,a2)            = Y3ijk(a,a1,a2)
                 taaaiii(a,a1,a2,i,j,k)   = tppp(a,a1,a2)
                 taiaiai(a,i,a1,j,a2,k)   = Taaaiii(a,a1,a2,i,j,k)
                 execute energy_denominator taiaiai(a,i,a1,j,a2,k)
                 t2aaaiii(a,a1,a2,j,i,k)  = taiaiai(a,i,a1,j,a2,k)
                 tppp(a,a1,a2)            = t2aaaiii(a,a1,a2,j,i,k) 
                 tpppi(a,a1,a2,k)         = tppp(a,a1,a2)
# 
                 GET                        t1ai(a2,k) 
                 tpp(a,a1)                = tpppi(a,a1,a2,k)*t1ai(a2,k) 
                 tppii(a,a1,i,j)          = tpp(a,a1) 
                 tpipi(a,i,a1,j)          = tppii(a,a1,i,j) 
                 tpipi(a,i,a1,j)         *= 0.125  
                 PREPARE Gaiai(a,i,a1,j) += tpipi(a,i,a1,j) 
#
# Done forming contributions to two-particle density 
# -------------------------------------------------- 
#
# Form contribution to Dai 
# ------------------------ 
#
                 tpppi(a,a1,a2,i)          = tppp(a,a1,a2) 
                 PREQUEST t2pipi(a1,j,a2,k) = T2aiai(a1,i1,a2,i2)
                 tppii(a1,a2,j,k)          = t2pipi(a1,j,a2,k)
                 tpp(a1,a2)                = tppii(a1,a2,j,k) 
                 tpi(a,i)                  = tpppi(a,a1,a2,i)*tpp(a1,a2) 
                 PUT Dai(a,i)             += tpi(a,i) 
#
           ENDPARDO a, a1, a2 # i, j, k 
           execute sip_barrier 
           execute server_barrier 
#
           PARDO a, a1, a2 # i, j, k 
#
                 GET Y3ijk(a,a1,a2)
                 GET E3ijk(a,a1,a2) 
#
# Form contribution to Da 
# ----------------------- 
#
                 tppp(a,a1,a2)            = Y3ijk(a,a1,a2)
                 tppp(a,a1,a2)           += E3ijk(a,a1,a2)
                 taaaiii(a,a1,a2,i,j,k)   = tppp(a,a1,a2)
                 taiaiai(a,i,a1,j,a2,k)   = Taaaiii(a,a1,a2,i,j,k)
                 execute energy_denominator taiaiai(a,i,a1,j,a2,k)
                 execute energy_denominator taiaiai(a,i,a1,j,a2,k)
                 t2aaaiii(a,a1,a2,j,i,k)  = taiaiai(a,i,a1,j,a2,k)
                 tppp(a,a1,a2)            = t2aaaiii(a,a1,a2,j,i,k) 
#
                 etemp        = Y3ijk(a,a1,a2)*tppp(a,a1,a2)
                 tIJ(i,i)     = etemp 
                #tIJ(i,i)    *= 3.0  
                 PUT Di(i,i) += tIJ(i,i) 
           DO ai  
#
                 GET               IAa(ai,a) 
                 IaS(a,ai)       = IAa(ai,a) 
                 sSaa(ai,a1,a2)  = Y3ijk(a,a1,a2)*IaS(a,ai) 
                 s1Saa(ai,a1,a2) = tppp(a,a1,a2)*IaS(a,ai) 
                 etemp           = sSaa(ai,a1,a2)*s1Saa(ai,a1,a2)  
                 tss(ai,ai)     = etemp 
                #tss(ai,ai) *= 3.0  
                 PUT DaS(ai,ai) += tss(ai,ai) 
#
           ENDDO ai  
#
           ENDPARDO a, a1, a2 # i, j, k 
#
           execute server_barrier
           execute sip_barrier
#
           DELETE D3ijk 
           DELETE E3ijk 
           DELETE X3ijk 
           DELETE Y3ijk 
           delete D2aiaS(*,*,*,k)  
           delete Paaak(*,*,*,k)  
          #delete D1aSaS(*,i,*,k) 
           delete D1aa 
          #delete D2aSaS(*,j,*,k) 
           delete D2aa(*,*) 
#
       #ENDIF # k >=j 
        ENDDO k # segment size of 1  
#
#    DONE alpha/alpha/alpha/ block. 
#    ------------------------------ 
#    alpha/alpha/beta/ block.
#    ------------------------
#
        DO kb  # segment size of 1
#
           create X3aab 
           create Y3aab 
           create D3aab 
           create E3aab 
           create Paabk(*,*,*,kb) 
          #create DaSbS(*,i,*,kb) 
           create Dab 
          #create D1aSbS(*,j,*,kb) 
           create D1ab(*,*) 
           create DaibS(*,*,*,kb) 
           execute sip_barrier 
#
           PARDO a, a1, b 
                 tppqs(a,a1,b,kb) = 0.0 
                 DO j1 
                    REQUEST             Vaabj(a,a1,b,j1) a  
                    GET                 IJj(kb,j1) 
                    t1ppqj(a,a1,b,kb) = Vaabj(a,a1,b,j1)*IJj(kb,j1) 
                    tppqs(a,a1,b,kb) += t1ppqj(a,a1,b,kb) 
                 ENDDO j1 
                 PUT Paabk(a,a1,b,kb) = tppqs(a,a1,b,kb) 
           ENDPARDO a, a1, b 
#
           PARDO a, b, i2 
                 PREQUEST t1ppqs(a,i2,b,kb) = T2aibj(a,i2,b,j1) 
                 PUT DaibS(a,i2,b,kb)       = t1ppqs(a,i2,b,kb) 
           ENDPARDO a, b, i2 
           PARDO a, b 
                 PREQUEST tpsqs(a,i,b,kb)  = T2aibj(a,i1,b,j1) 
                 tpqij(a,b,i,kb)           = tpsqs(a,i,b,kb) 
                 tpq(a,b)                  = tpqij(a,b,i,kb) 
                 PUT Dab(a,b)              = tpq(a,b) 
                #PUT DaSbS(a,i,b,kb)       = tpsqs(a,i,b,kb) 
           ENDPARDO a, b 
           PARDO a, b 
                 PREQUEST t1psqs(a,j,b,kb) = T2aibj(a,i1,b,j1) 
                 tpqij(a,b,j,kb)           = t1psqs(a,j,b,kb) 
                 tpq(a,b)                  = tpqij(a,b,j,kb) 
                 PUT D1ab(a,b)              = tpq(a,b) 
                #PUT D1aSbS(a,j,b,kb)      = t1psqs(a,j,b,kb) 
           ENDPARDO a, b 
           execute sip_barrier 
          #execute server_barrier 
#
#    LOOP 1 
#    ------- 
#
#          (1)
#          -----------------------------
#
           PARDO a, a1, b, b1 
#
                 IF a <= a1 
#
                   #GET D1aSbS(a,j,b1,kb) 
                    GET D1ab(a,b1) 
                    GET Pbbai(b,b1,a1,i)
#
                   #Dabij(a,b1,j,kb)   = D1aSbS(a,j,b1,kb) 
                   #Tpq(a,b1)          = Dabij(a,b1,j,kb)
#
                    tppqi(a,a1,b,i)    = Pbbai(b,b1,a1,i)*D1ab(a,b1)   
                    tppqi(a,a1,b,i)   *= -1.0  
                    tppq(a,a1,b)       = tppqi(a,a1,b,i) 
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, b, b1 
#
#          ( - P_ij )
#          -----------------------------
#
           PARDO a, a1, b, b1 
#
                 IF a <= a1 
#
                   #GET DaSbS(a,i,b1,kb) 
                    GET Dab(a,b1) 
                    GET Pbbaj(b,b1,a1,j) 
#
                   #Dabij(a,b1,i,kb)   = DaSbS(a,i,b1,kb) 
                   #Tpq(a,b1)          = Dabij(a,b1,i,kb)
#
                    tppqi(a,a1,b,j)    = Pbbaj(b,b1,a1,j)*Dab(a,b1)   
                    tppq(a,a1,b)       = tppqi(a,a1,b,j) 
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, b, b1 
#
#          ( - P_ab )
#          -----------------------------
#
           PARDO a, a1, b, b1 
#
                 IF a <= a1 
#
                   #GET D1aSbS(a1,j,b1,kb) 
                    GET D1ab(a1,b1) 
                    GET Pbbai(b,b1,a,i) 
#
                   #Dabij(a1,b1,j,kb)   = D1aSbS(a1,j,b1,kb) 
                   #Tpq(a1,b1)          = Dabij(a1,b1,j,kb)
#
                    tppqi(a,a1,b,i)    = Pbbai(b,b1,a,i)*D1ab(a1,b1)   
                    tppq(a,a1,b)       = tppqi(a,a1,b,i) 
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, b, b1 
#
#          (+ P_ij P_ab)
#          -----------------------------
#
           PARDO a, a1, b, b1 
#
                 IF a <= a1 
#
                   #GET DaSbS(a1,i,b1,kb) 
                    GET Dab(a1,b1) 
                    GET Pbbaj(b,b1,a,j) 
#
                   #Dabij(a1,b1,i,kb)   = DaSbS(a1,i,b1,kb) 
                   #Tpq(a1,b1)          = Dabij(a1,b1,i,kb)
#
                    tppqi(a,a1,b,j)    = Pbbaj(b,b1,a,j)*Dab(a1,b1)   
                    tppq(a,a1,b)       = tppqi(a,a1,b,j) 
                    tppq(a,a1,b)   *= -1.0  
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, b, b1 
#
#    LOOP 2 
#    ------- 
#
#    ( - P_ac )
#    -----------------------------
#
           PARDO a, a1, a2, b 
#
                 IF a <= a1 
#
                   #GET D1aSbS(a2,j,b,kb) 
                    GET D1ab(a2,b) 
                    GET Paaai(a,a2,a1,i) 
#
                   #tabij(a2,b,j,kb) = D1aSbS(a2,j,b,kb)
                   #tpq(a2,b)        = tabij(a2,b,j,kb)
#
                    tppqi(a,a1,b,i)  = Paaai(a,a2,a1,i)*D1ab(a2,b) 
                    tppqi(a,a1,b,i) *= -1.0  
                    tppq(a,a1,b)     = tppqi(a,a1,b,i)
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, a2, b 
#
#    ( + P_ij P_ac)
#    -----------------------------
#
           PARDO a, a1, a2, b 
#
                 IF a <= a1 
#
                   #GET DaSbS(a2,i,b,kb) 
                    GET Dab(a2,b) 
                    GET Paaaj(a,a2,a1,j) 
#
                   #tabij(a2,b,i,kb) = DaSbS(a2,i,b,kb)
                   #tpq(a2,b)        = tabij(a2,b,i,kb)
#
                    tppqi(a,a1,b,j)  = Paaaj(a,a2,a1,j)*Dab(a2,b) 
                    tppq(a,a1,b)     = tppqi(a,a1,b,j)
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, a2, b 
#
#    LOOP 3 
#    ------- 
#
#    ( - P_ik )
#    -----------------------------
#
           PARDO a, a1, a2, b 
#
                 IF a <= a1 
#
                   #GET DaSaS(a,j,a2,i) 
                    GET Daa(a,a2) 
                    GET Paabk(a1,a2,b,kb) 
#
                   #taaii(a,a2,j,i) = DaSaS(a,j,a2,i) 
                   #tpp(a,a2)       = taaii(a,a2,j,i)
#
                    t1ppqj(a,a1,b,kb) = Paabk(a1,a2,b,kb)*Daa(a,a2)  
#
                    tppq(a,a1,b) = t1ppqj(a,a1,b,kb) 
                    tppq(a,a1,b)*= -1.0  
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, a2, b 
#
#    ( + P_ik P_ab)
#    -----------------------------
#
           PARDO a, a1, a2, b 
#
                 IF a <= a1 
#
                   #GET DaSaS(a1,j,a2,i) 
                    GET Daa(a1,a2) 
                    GET Paabk(a,a2,b,kb) 
#
                   #taaii(a1,a2,j,i) = DaSaS(a1,j,a2,i) 
                   #tpp(a1,a2)       = taaii(a1,a2,j,i)
#
                    t1ppqj(a,a1,b,kb) = Paabk(a,a2,b,kb)*Daa(a1,a2)  
#
                    tppq(a,a1,b) = t1ppqj(a,a1,b,kb) 
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, a2, b 
#
#    LOOP 5 
#    ------- 
#
#    ( - P_ik )
#    -----------------------------
#
           PARDO a, a1, i1, b 
#
                 IF a <= a1 
#
                    GET DaibS(a1,i1,b,kb) 
                    GET XSaIiI(a,j,i1,i) 
#
                    tppii(a,i1,j,i)  = XSaIiI(a,j,i1,i) 
                    tpp(a,i1)        = tppii(a,i1,j,i) 
                    tppqj(a,a1,b,kb) = DaibS(a1,i1,b,kb)*tpp(a,i1) 
#
                    tppq(a,a1,b) = tppqj(a,a1,b,kb) 
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, i1, b 
#
#    (  P_ik P_ab)
#    -----------------------------
#
           PARDO a, a1, i1, b 
#
                 IF a <= a1 
#
                    GET DaibS(a,i1,b,kb) 
                    GET XSaIiI(a1,j,i1,i) 
#
                    tppii(a1,i1,j,i)  = XSaIiI(a1,j,i1,i) 
                    tpp(a1,i1)        = tppii(a1,i1,j,i) 
                    tppqj(a,a1,b,kb) = DaibS(a,i1,b,kb)*tpp(a1,i1) 
#
                    tppq(a,a1,b) = tppqj(a,a1,b,kb) 
                    tppq(a,a1,b) *= -1.0  
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, i1, b 
#
#    LOOP 4 
#    ------- 
#
#    (1 )
#    -----------------------------
#
           PARDO a, a1, j1, b
#
                 IF a <= a1 
#
                    GET DaSbj(a1,i,b,j1) 
                    GET Xaijj(a,j,j1,kb) 
#
                    tabji(a1,b,j1,i) = DaSbj(a1,i,b,j1) 
                    t1ajij(a,j1,j,kb)= Xaijj(a,j,j1,kb) 
                    tpq(a,j1)        = t1ajij(a,j1,j,kb)
                    tppqi(a,a1,b,i)  = tabji(a1,b,j1,i)*tpq(a,j1)  
#
                    tppq(a,a1,b) = tppqi(a,a1,b,i) 
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, j1, b
#
#    ( - P_ij )
#    -----------------------------
#
           PARDO a, a1, j1, b
#
                 IF a <= a1 
#
                    GET D1aSbj(a1,j,b,j1) 
                    GET Xaijj(a,i,j1,kb) 
#
                    tabji(a1,b,j1,j) = D1aSbj(a1,j,b,j1) 
                    t1ajij(a,j1,i,kb)= Xaijj(a,i,j1,kb) 
                    tpq(a,j1)        = t1ajij(a,j1,i,kb)
                    tppqi(a,a1,b,j)  = tabji(a1,b,j1,j)*tpq(a,j1)  
#
                    tppq(a,a1,b) = tppqi(a,a1,b,j) 
                    tppq(a,a1,b) *= -1.0  
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, j1, b
#
#    ( - P_ab )
#    -----------------------------
#
           PARDO a, a1, j1, b
#
                 IF a <= a1 
#
                    GET DaSbj(a,i,b,j1) 
                    GET Xaijj(a1,j,j1,kb) 
#
                    tabji(a,b,j1,i)   = DaSbj(a,i,b,j1) 
                    t1ajij(a1,j1,j,kb)= Xaijj(a1,j,j1,kb) 
                    tpq(a1,j1)        = t1ajij(a1,j1,j,kb)
                    tppqi(a,a1,b,i)  = tabji(a,b,j1,i)*tpq(a1,j1)  
#
                    tppq(a,a1,b) = tppqi(a,a1,b,i) 
                    tppq(a,a1,b) *= -1.0  
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, j1, b
#
#    ( + P_ij P_ab)
#    -----------------------------
#
           PARDO a, a1, j1, b
#
                 IF a <= a1 
#
                    GET D1aSbj(a,j,b,j1) 
                    GET Xaijj(a1,i,j1,kb) 
#
                    tabji(a,b,j1,j) = D1aSbj(a,j,b,j1) 
                    t1ajij(a1,j1,i,kb)= Xaijj(a1,i,j1,kb) 
                    tpq(a1,j1)        = t1ajij(a1,j1,i,kb)
                    tppqi(a,a1,b,j)  = tabji(a,b,j1,j)*tpq(a1,j1)  
#
                    tppq(a,a1,b) = tppqi(a,a1,b,j) 
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, j1, b
#
#    LOOP 6 
#    ------- 
#
#     ( - P_ac )
#     -----------------------------
#
           PARDO a, a1, i1, b 
#
                 IF a <= a1 
#
                    GET DaiaS(a,i1,a1,i) 
                    GET XiIbJ(i1,j,b,kb) 
#
                    tbijj(b,i1,j,kb) = XiIbJ(i1,j,b,kb) 
                    tqp(b,i1)        = tbijj(b,i1,j,kb) 
#
                    tppqi(a,a1,b,i) = DaiaS(a,i1,a1,i)*tqp(b,i1)  
#
                    tppq(a,a1,b) = tppqi(a,a1,b,i) 
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, i1, b 
#
#     ( + P_ij P_ac)
#     -----------------------------
#
           PARDO a, a1, i1, b 
#
                 IF a <= a1 
#
                    GET D1aiaS(a,i1,a1,j) 
                    GET XiIbJ(i1,i,b,kb) 
#
                    tbijj(b,i1,i,kb) = XiIbJ(i1,i,b,kb) 
                    tqp(b,i1)        = tbijj(b,i1,i,kb) 
#
                    tppqi(a,a1,b,j) = D1aiaS(a,i1,a1,j)*tqp(b,i1)  
#
                    tppq(a,a1,b) = tppqi(a,a1,b,j) 
                    tppq(a,a1,b) *= -1.0  
                    PUT X3aab(a,a1,b) += tppq(a,a1,b) 
#
                 ENDIF 
#
           ENDPARDO a, a1, i1, b 
           execute sip_barrier 
#
#      Compute disconnected contribution to the amplitude 
#      -------------------------------------------------- 
#
           PARDO b, a, a1 
#
                 IF a <= a1 
#
                   #PREQUEST tqk(b,kb) = t1b_old(b,j1) 
                    PREQUEST P1aiai(a,i,a1,j) = VSpipi(a,i1,a1,i2) 
                    GET t1bj(b,kb) 
#
                    tppii(a,a1,i,j) = P1aiai(a,i,a1,j)
                    tpp(a,a1)       = tppii(a,a1,i,j)
#
                    tppqj(a,a1,b,kb) = tpp(a,a1)^t1bj(b,kb) 
                    tppq(a,a1,b)     = tppqj(a,a1,b,kb) 
                    PUT D3aab(a,a1,b) += tppq(a,a1,b)  
#
                 ENDIF 
#
           ENDPARDO b, a, a1 
           execute sip_barrier 
#
#          (1) 
#          --- 
#
           PARDO a, a1, b 
#
                 IF a <= a1 
#
                #PREQUEST tpi(a,i) = t1a_old(a,i1)  
                 PREQUEST P4aibj(a1,j,b,kb) = Vpiqj(a1,i1,b,j2) 
                 GET t1ai(a,i) 
#
                 tpqij(a1,b,j,kb)   = P4aibj(a1,j,b,kb)
                 tpq(a1,b)          = tpqij(a1,b,j,kb)
#
                 tppqi(a,a1,b,i)    = tpq(a1,b)^t1ai(a,i)
                 tppq(a,a1,b)       = tppqi(a,a1,b,i) 
                 PUT D3aab(a,a1,b) += tppq(a,a1,b)  
#
                 ENDIF 
#
           ENDPARDO a, a1, b 
           execute sip_barrier 
#
#          (-P_ij) 
#          ------- 
#
           PARDO a, a1, b 
#
                 IF a <= a1 
#
                #PREQUEST tpj(a,j) = t1a_old(a,i1)  
                 PREQUEST P4aibj(a1,i,b,kb) = Vpiqj(a1,i1,b,j2) 
                 GET t1ai(a,j) 
#
                 tpqij(a1,b,i,kb)   = P4aibj(a1,i,b,kb)
                 tpq(a1,b)          = tpqij(a1,b,i,kb)
#
                 tppqi(a,a1,b,j)    = tpq(a1,b)^t1ai(a,j)
                 tppq(a,a1,b)       = tppqi(a,a1,b,j) 
                 tppq(a,a1,b)      *= -1.0  
                 PUT D3aab(a,a1,b) += tppq(a,a1,b)  
#
                 ENDIF 
#
           ENDPARDO a, a1, b 
           execute sip_barrier 
#
#          (-a<->a1) 
#          -------- 
#
           PARDO a1, a, b 
#
                 IF a <= a1 
#
                #PREQUEST tpi(a1,i) = t1a_old(a1,i1)  
                 GET t1ai(a1,i) 
                 PREQUEST P4aibj(a,j,b,kb) = Vpiqj(a,i1,b,j2) 
#
                 tpqij(a,b,j,kb)   = P4aibj(a,j,b,kb)
                 tpq(a,b)          = tpqij(a,b,j,kb)
#
                 tppqi(a,a1,b,i)    = tpq(a,b)^t1ai(a1,i)
                 tppq(a,a1,b)       = tppqi(a,a1,b,i) 
                 tppq(a,a1,b)      *= -1.0  
                 PUT D3aab(a,a1,b) += tppq(a,a1,b)  
#
                 ENDIF 
#
           ENDPARDO a1, a, b 
           execute sip_barrier 
#
#          (P_ij P_aa1) 
#          ------------ 
#
           PARDO a1, a, b 
#
                 IF a <= a1 
#
                #PREQUEST tpj(a1,j) = t1a_old(a1,i1)  
                 PREQUEST P4aibj(a,i,b,kb) = Vpiqj(a,i1,b,j2) 
                 GET t1ai(a1,j) 
#
                 tpqij(a,b,i,kb)   = P4aibj(a,i,b,kb)
                 tpq(a,b)          = tpqij(a,b,i,kb)
#
                 tppqi(a,a1,b,j)    = tpq(a,b)^t1ai(a1,j)
                 tppq(a,a1,b)       = tppqi(a,a1,b,j) 
                 PUT D3aab(a,a1,b) += tppq(a,a1,b)  
#
                 ENDIF 
#
           ENDPARDO a1, a, b 
           execute sip_barrier 
#
# Symmetrize amplitude array 
# --------------------------- 
#
           PARDO a, a1, b  
#
                 IF a <= a1 
#
                    GET                 X3aab(a,a1,b) 
                    tppq(a1,a,b)      = X3aab(a,a1,b) 
                    tppq(a1,a,b)     *= -1.0  

                    PUT Y3aab(a,a1,b) = X3aab(a,a1,b)  
                    PUT Y3aab(a1,a,b) = tppq(a1,a,b)  
#
                 ENDIF 
#
           ENDPARDO a, a1, b  
#
           PARDO a, a1, b  
#
                 IF a <= a1 
#
                    GET                 D3aab(a,a1,b) 
                    tppq(a1,a,b)      = D3aab(a,a1,b) 
                    tppq(a1,a,b)     *= -1.0  

                    PUT E3aab(a,a1,b) = D3aab(a,a1,b)  
                    PUT E3aab(a1,a,b) = tppq(a1,a,b)  
#
                 ENDIF 
#
           ENDPARDO a, a1, b  
           execute sip_barrier 
#
# Compute contribution to energy
# ------------------------------ 
#
           PARDO a, a1, b 
#
                 GET Y3aab(a,a1,b)
                 GET E3aab(a,a1,b)
                 T1aabiij(a,a1,b,i,j,kb) = Y3aab(a,a1,b) 
                 taiaibj(a,i,a1,j,b,kb) = T1aabiij(a,a1,b,i,j,kb)
                 execute energy_denominator taiaibj(a,i,a1,j,b,kb)  
                 t1aabiij(a,a1,b,i,j,kb) = taiaibj(a,i,a1,j,b,kb)
                 t1ppq(a,a1,b) = T1aabiij(a,a1,b,i,j,kb)

                 tppq(a,a1,b) = Y3aab(a,a1,b) 
                 tppq(a,a1,b) += E3aab(a,a1,b) 
#
                 etemp = tppq(a,a1,b)*t1ppq(a,a1,b) 
                 etemp = etemp/4.0 
                 esum2 += etemp 
#
           ENDPARDO a, a1, b 
#
# Form the contribution to Saaii 
# ------------------------------ 
#
           PARDO a, a1, b 
#
                 GET                        Y3aab(a,a1,b)
                 GET                        E3aab(a,a1,b)
                 tppq(a,a1,b)             = Y3aab(a,a1,b) 
                 tppq(a,a1,b)            *= 2.0  
                 tppq(a,a1,b)            += E3aab(a,a1,b) 

                 T1aabiij(a,a1,b,i,j,kb)  = tppq(a,a1,b) 
                 taiaibj(a,i,a1,j,b,kb)   = T1aabiij(a,a1,b,i,j,kb)
                 execute energy_denominator taiaibj(a,i,a1,j,b,kb)  
                 taabjii(a,a1,b,kb,j,i)   = taiaibj(a,i,a1,j,b,kb)
                 t1ppqj(a,a1,b,kb)        = Taabjii(a,a1,b,kb,j,i)
#
                 DO a3 
#
                    GET                        Paabk(a1,a3,b,kb) 
#
                    tpp(a,a3)                = t1ppqj(a,a1,b,kb)*Paabk(a1,a3,b,kb)  
                   #tpp(a,a3)               *= 0.5
                    tppii(a,a3,i,j)          = tpp(a,a3)
                    Sppii(a3,a,i,j)         = tppii(a,a3,i,j)
                    Sppii(a3,a,i,j)        *= -1.0 
#
                    PREPARE Saaii(a,a3,i,j) += tppii(a,a3,i,j)  
                    PREPARE Saaii(a3,a,i,j) += Sppii(a3,a,i,j)  
#
                 ENDDO a3 
#
                 DO l 
#
                    PREQUEST tIIbJ(l,j,b,kb) = Vpiqj(i1,i2,b,j1) 
#
                    tqjii(b,kb,l,j)          = tIIbJ(l,j,b,kb)
                    tqj(b,kb)                = tqjii(b,kb,l,j)
                    tpp(a,a1)                = t1ppqj(a,a1,b,kb)*tqj(b,kb) 
                   #tpp(a,a1)               *= -0.5 
                    tpp(a,a1)               *= -1.0 
                    tppii(a,a1,i,l)          = tpp(a,a1) 
                    Sppii(a,a1,l,i)         = tpp(a,a1) 
                    Sppii(a,a1,l,i)        *= -1.0 
#
                    PREPARE Saaii(a,a1,i,l) += tppii(a,a1,i,l)  
                    PREPARE Saaii(a,a1,l,i) += Sppii(a,a1,l,i)  
#
                 ENDDO l 
#
           ENDPARDO a, a1, b 
#
# Form the contribution to Sabij 
# ------------------------------ 
#
           PARDO a, a1, b 
#
                 GET                        Y3aab(a,a1,b)
                 GET                        E3aab(a,a1,b)
                 tppq(a,a1,b)             = Y3aab(a,a1,b) 
                 tppq(a,a1,b)            *= 2.0  
                 tppq(a,a1,b)            += E3aab(a,a1,b) 

                 T1aabiij(a,a1,b,i,j,kb)  = tppq(a,a1,b) 
                 taiaibj(a,i,a1,j,b,kb)   = T1aabiij(a,a1,b,i,j,kb)
                 execute energy_denominator taiaibj(a,i,a1,j,b,kb)  
                 taabiij(a,a1,b,j,i,kb)   = taiaibj(a,i,a1,j,b,kb)
                 t1ppqi(a,a1,b,j)         = Taabiij(a,a1,b,j,i,kb)
#
                 DO b1 
#
                    GET                         Pbbaj(b,b1,a1,j) 
                    tpq(a,b1)                 = t1ppqi(a,a1,b,j)*Pbbaj(b,b1,a1,j) 
                   #tpq(a,b1)                *= 0.5  
                    tpqij(a,b1,i,kb)          = tpq(a,b1) 
                    PREPARE Sabij(a,b1,i,kb) += tpqij(a,b1,i,kb)  
#
                 ENDDO b1 
#
                 DO a2 
#
                    GET                         Paaaj(a,a2,a1,j) 
                    tpq(a2,b)                 = t1ppqi(a,a1,b,j)*Paaaj(a,a2,a1,j) 
                    tpq(a2,b)                *= 0.5  
                    tpqij(a2,b,i,kb)          = tpq(a2,b) 
                    PREPARE Sabij(a2,b,i,kb) += tpqij(a2,b,i,kb)  
#
                 ENDDO a2  
#
                 DO l 
#
                    PREQUEST   TaIII(a1,j,l,i) = VSpipi(a1,i1,i2,i3)   
                    tpi(a1,j)                  = TaIII(a1,j,l,i) 
                    tpq(a,b)                   = t1ppqi(a,a1,b,j)*tpi(a1,j) 
                    tpqij(a,b,l,kb)            = tpq(a,b)  
                    tpqij(a,b,l,kb)           *= -0.5 
                    PREPARE Sabij(a,b,l,kb)   += tpqij(a,b,l,kb)  
#
                 ENDDO l 
#
                 DO lb 
#
                    PREQUEST TaIJJ(a1,j,lb,kb) = Vpiqj(a1,i1,j1,j2)   
                    tpi(a1,j)                  = TaIJJ(a1,j,lb,kb) 
                    tpq(a,b)                   = t1ppqi(a,a1,b,j)*tpi(a1,j) 
                   #tpq(a,b)                  *= -0.5  
                    tpq(a,b)                  *= -1.0  
                    tpqij(a,b,i,lb)            = tpq(a,b) 
                    PREPARE Sabij(a,b,i,lb)   += tpqij(a,b,i,lb)  
#
                 ENDDO lb 
#
           ENDPARDO a, a1, b 
#
#
#    Form contribution to sai
#    ------------------------
#
#          PERM 1
#          ------
#
           PARDO a, a1, b2
#
                 PREQUEST P1aibj(a1,j,b2,kb) = Vpiqj(a1,i1,b2,j2)
                 GET Y3aab(a,a1,b2)
                 Taabiij(a,a1,b2,i,j,kb) = Y3aab(a,a1,b2)
                 taiaibj(a,i,a1,j,b2,kb) = Taabiij(a,a1,b2,i,j,kb)
                 execute energy_denominator taiaibj(a,i,a1,j,b2,kb)
                 t1aabiij(a,a1,b2,i,j,kb) = taiaibj(a,i,a1,j,b2,kb)
#
                 t1ppqi(a,a1,b2,i) = t1aabiij(a,a1,b2,i,j,kb)
                 t2pqij(a1,b2,j,kb) = P1aibj(a1,j,b2,kb)
                 tpq(a1,b2) = t2pqij(a1,b2,j,kb)
#
                 xai(a,i) = t1ppqi(a,a1,b2,i)*tpq(a1,b2)
                 xai(a,i) *= 4.0
                 PUT sai(a,i) += xai(a,i)
#
           ENDPARDO a, a1, b2
#
#          PERM 2
#          ------
#
           PARDO a1, a, b2
#
                 PREQUEST P2aibj(a,i,b2,kb) = Vpiqj(a,i1,b2,j2)
                 GET Y3aab(a,a1,b2)
                 Taabiij(a,a1,b2,j,i,kb) = Y3aab(a,a1,b2)
                 taiaibj(a,j,a1,i,b2,kb) = Taabiij(a,a1,b2,j,i,kb)
                 execute energy_denominator taiaibj(a,j,a1,i,b2,kb)
                 t1aabiij(a,a1,b2,j,i,kb) = taiaibj(a,j,a1,i,b2,kb)
#
                 t1ppqi(a,a1,b2,j) = t1aabiij(a,a1,b2,j,i,kb)
                 t2pqij(a,b2,i,kb) = P2aibj(a,i,b2,kb)
                 tpq(a,b2) = t2pqij(a,b2,i,kb)
#
                 xai(a1,j) = t1ppqi(a,a1,b2,j)*tpq(a,b2)
                 xai(a1,j) *= 4.0
                 PUT sai(a1,j) += xai(a1,j)
#
           ENDPARDO a1, a, b2
#
#    Form contribution to sbj
#    ------------------------
#
           PARDO b, a1, a
#
                 PREQUEST P3aiai(a,i,a1,j) = VSpipi(a,i1,a1,i2)
                 GET Y3aab(a,a1,b)
                 Taabiij(a,a1,b,i,j,kb) = Y3aab(a,a1,b)
                 taiaibj(a,i,a1,j,b,kb) = Taabiij(a,a1,b,i,j,kb)
                 execute energy_denominator taiaibj(a,i,a1,j,b,kb)
                 taabjii(a,a1,b,kb,i,j) = taiaibj(a,i,a1,j,b,kb)
#
                 t1ppqj(a,a1,b,kb) = taabjii(a,a1,b,kb,i,j)
                 tppii(a,a1,i,j) = P3aiai(a,i,a1,j)
                 tpp(a,a1) = tppii(a,a1,i,j)
#
                 xbj(b,kb)  = t1ppqj(a,a1,b,kb)*tpp(a,a1)
                 xbj(b,kb) *= 2.0
                 PUT sbj(b,kb) += xbj(b,kb)
#
           ENDPARDO b, a1, a
#
           execute sip_barrier 
           execute server_barrier 
#
# Form contributions to two-particle density 
# ------------------------------------------ 
#
           PARDO a, a1, b # i, j, kb  
#
                 GET                        Y3aab(a,a1,b)
                 GET                        E3aab(a,a1,b)
                 tppq(a,a1,b)             = Y3aab(a,a1,b)
                 tppq(a,a1,b)            *= 2.0
                 tppq(a,a1,b)            += E3aab(a,a1,b)

                 T1aabiij(a,a1,b,i,j,kb)  = tppq(a,a1,b)
                 taiaibj(a,i,a1,j,b,kb)   = T1aabiij(a,a1,b,i,j,kb)
                 execute energy_denominator taiaibj(a,i,a1,j,b,kb)
                 taabiij(a,a1,b,j,i,kb)   = taiaibj(a,i,a1,j,b,kb)
                 tppq(a,a1,b)             = taabiij(a,a1,b,j,i,kb)  
#
# Form contribution to Gaaai 
# -------------------------- 
#
                 t1ppqi(a,a1,b,j)         = tppq(a,a1,b)  
#
                 DO a2 
#
                    PREQUEST tpiqj(a2,i,b,kb) = T2aibj(a2,i1,b,j1)
                    tpqij(a2,b,i,kb)          = tpiqj(a2,i,b,kb) 
                    tpq(a2,b)                 = tpqij(a2,b,i,kb) 
                    tpppp(a,a2,a1,j)          = t1ppqi(a,a1,b,j)*tpq(a2,b) 
                    tpppp(a,a2,a1,j)         *= 0.5 # -0.25  
                    PREPARE Gaaai(a,a2,a1,j)     += tpppp(a,a2,a1,j) 
#
                 ENDDO a2 
#
# Form contribution to Gaabj 
# -------------------------- 
#
                 t1ppqj(a,a1,b,kb)         = tppq(a,a1,b)  
#
                 DO a2 
#
                    PREQUEST t2pipi(a2,i,a1,j) = T2aiai(a2,i1,a1,i2)  
                    tppii(a2,a1,i,j)          = t2pipi(a2,i,a1,j) 
                    tpp(a2,a1)                = tppii(a2,a1,i,j) 
                    tppqj(a,a2,b,kb)          = t1ppqj(a,a1,b,kb)*tpp(a2,a1) 
                    tppqj(a,a2,b,kb)         *= 0.25 # -0.25  
                    PREPARE Gaabj(a,a2,b,kb)     += tppqj(a,a2,b,kb)
#
                 ENDDO a2 
#
# Form contribution to Gbbai 
# -------------------------- 
#
                 t1ppqi(a,a1,b,i)         = tppq(a,a1,b)  
#
                 DO b1 
#
                    PREQUEST t1piqj(a1,j,b1,kb) = T2aibj(a1,i1,b1,j1) 
                    tpqij(a1,b1,j,kb)          = t1piqj(a1,j,b1,kb)
                    tpq(a1,b1)                 = tpqij(a1,b1,j,kb) 
                    tqqpi(b,b1,a,i)            = t1ppqi(a,a1,b,i)*tpq(a1,b1)  
                    tqqpi(b,b1,a,i)           *= 0.5 # 0.25  
                    PREPARE Gbbai(b,b1,a,i)       += tqqpi(b,b1,a,i) 
#
                 ENDDO b1 
#
# Form contribution to Gaiii  
# -------------------------- 
#
                 t1ppqi(a,a1,b,i)         = tppq(a,a1,b)  
#
                 DO l 
#
                    PREQUEST t2piqj(a1,l,b,kb) = T2aibj(a1,i1,b,j1) 
                    tpqij(a1,b,l,kb)          = t2piqj(a1,l,b,kb) 
                    tpq(a1,b)                 = tpqij(a1,b,l,kb)
                    tpi(a,i)                  = t1ppqi(a,a1,b,i)*tpq(a1,b) 
                    tpiii(a,i,l,j)            = tpi(a,i) 
                    tpiii(a,i,l,j)           *=-0.5 # 0.25  
                    PREPARE Gaiii(a,i,l,j)       += tpiii(a,i,l,j)  
#
                 ENDDO l 
#
# Form contribution to Gbjii  
# -------------------------- 
#
                 t1ppqj(a,a1,b,kb)         = tppq(a,a1,b)  
#
                 DO k 
#
                    PREQUEST t3pipi(a,k,a1,j) = T2aiai(a,i1,a1,i2) 
                    tppii(a,a1,k,j)          = t3pipi(a,k,a1,j)  
                    tpp(a,a1)                = tppii(a,a1,k,j) 
                    tqj(b,kb)                = t1ppqj(a,a1,b,kb)*tpp(a,a1) 
                    tqjii(b,kb,k,i)          = tqj(b,kb) 
                    tqjii(b,kb,k,i)         *=-0.25 # 0.25  
                    PREPARE Gbjii(b,kb,k,i)     += tqjii(b,kb,k,i) 
#
                 ENDDO k 
#
# Form contribution to Gaijj  
# -------------------------- 
#
                 t1ppqi(a,a1,b,i)         = tppq(a,a1,b)  
#
                 DO lb 
#
                    PREQUEST taibj(a1,j,b,lb) = T2aibj(a1,i1,b,j1)  
                    tpqij(a1,b,j,lb)          = taibj(a1,j,b,lb) 
                    tpq(a1,b)                 = tpqij(a1,b,j,lb) 
                    tpi(a,i)                  = t1ppqi(a,a1,b,i)*tpq(a1,b) 
                    tpijj(a,i,lb,kb)          = tpi(a,i) 
                    tpijj(a,i,lb,kb)         *=-0.5 # 0.25  
                    PREPARE Gaijj(a,i,lb,kb)     += tpijj(a,i,lb,kb) 
#
                 ENDDO lb 
#
# Form contribution to Gaiai 
# -------------------------- 
#
                 GET                        Y3aab(a,a1,b)
                 tppq(a,a1,b)             = Y3aab(a,a1,b)

                 T1aabiij(a,a1,b,i,j,kb)  = tppq(a,a1,b)
                 taiaibj(a,i,a1,j,b,kb)   = T1aabiij(a,a1,b,i,j,kb)
                 execute energy_denominator taiaibj(a,i,a1,j,b,kb)
                 taabiij(a,a1,b,j,i,kb)   = taiaibj(a,i,a1,j,b,kb)
                 tppq(a,a1,b)             = taabiij(a,a1,b,j,i,kb)  
#
                 t1ppqj(a,a1,b,kb)        = tppq(a,a1,b) 
                 GET                        t1bj(b,kb) 
                 tpp(a,a1)                = t1ppqj(a,a1,b,kb)*t1bj(b,kb) 
                 tppii(a,a1,i,j)          = tpp(a,a1) 
                 t5pipi(a,i,a1,j)          = tppii(a,a1,i,j)
                 t5pipi(a,i,a1,j)         *= 0.125  
                 PREPARE Gaiai(a,i,a1,j)     += t5pipi(a,i,a1,j) 
#
# Form contribution to Gaibj 
# -------------------------- 
#
                 t1ppqi(a,a1,b,j)         = tppq(a,a1,b) 
                 GET                        t1ai(a1,j) 
                 tpq(a,b)                 = t1ppqi(a,a1,b,j)*t1ai(a1,j) 
                 tpqij(a,b,i,kb)          = tpq(a,b)  
                 t4piqj(a,i,b,kb)          = tpqij(a,b,i,kb)  
                 t4piqj(a,i,b,kb)         *= 0.125  
                 PREPARE Gaibj(a,i,b,kb)     += t4piqj(a,i,b,kb) 
#
# Done forming contributions to two-particle density 
# -------------------------------------------------- 
#
# Form contribution to Dai 
# ------------------------ 
#
                 tppqi(a,a1,b,i)          = tppq(a,a1,b) 
                 PREQUEST t3piqj(a1,j,b,kb) = T2aibj(a1,i1,b,j1)
                 tpqij(a1,b,j,kb)          = t3piqj(a1,j,b,kb)
                 tpq(a1,b)                = tpqij(a1,b,j,kb) 
                 tpi(a,i)                  = tppqi(a,a1,b,i)*tpq(a1,b) 
                 tpi(a,i)                 *= 4.0 
                 PUT Dai(a,i)             += tpi(a,i) 
#
# Form contribution to Dbj 
# ------------------------ 
#
                 tppqj(a,a1,b,kb)          = tppq(a,a1,b) 
                 PREQUEST t4pipi(a,i,a1,j) = T2aiai(a,i1,a1,i2)
                 tppii(a,a1,i,j)         = t4pipi(a,i,a1,j) 
                 tpp(a,a1)                 = tppii(a,a1,i,j) 
                 tqj(b,kb)                 = tppqj(a,a1,b,kb)*tpp(a,a1) 
                 PUT Dbj(b,kb)             += tqj(b,kb) 
#
           ENDPARDO a, a1, b # i, j, kb  
#
           PARDO a, a1, b # i, j, kb  
#
                 GET Y3aab(a,a1,b) 
                 GET E3aab(a,a1,b) 
#
# Form contribution to Da 
# ----------------------- 
#
                 tppq(a,a1,b)             = Y3aab(a,a1,b)
                 tppq(a,a1,b)            += E3aab(a,a1,b)

                 T1aabiij(a,a1,b,i,j,kb)  = tppq(a,a1,b)
                 taiaibj(a,i,a1,j,b,kb)   = T1aabiij(a,a1,b,i,j,kb)
                 execute energy_denominator taiaibj(a,i,a1,j,b,kb)
                 execute energy_denominator taiaibj(a,i,a1,j,b,kb)
                 taabiij(a,a1,b,j,i,kb)   = taiaibj(a,i,a1,j,b,kb)
                 tppq(a,a1,b)             = taabiij(a,a1,b,j,i,kb)  
#
#
                 etemp                    = Y3aab(a,a1,b)*tppq(a,a1,b)
#
                 tIJ(i,i)                 = etemp 
                 tIJ(i,i)                *= 6.0  
                 PUT Di(i,i)             += tIJ(i,i) 
#
                 tIJb(kb,kb)              = etemp 
                 tIJb(kb,kb)             *= 3.0  
                 PUT Dj(kb,kb)           += tIJb(kb,kb) 
#
           DO bi  
#
                 GET               IBb(bi,b) 
                 IbS(b,bi)       = IBb(bi,b) 
                 saaS(a,a1,bi)  = Y3aab(a,a1,b)*IbS(b,bi) 
                 s1aaS(a,a1,bi) = tppq(a,a1,b)*IbS(b,bi) 
                 etemp           = saaS(a,a1,bi)*s1aaS(a,a1,bi)  
                 tuu(bi,bi)     = etemp 
                 tuu(bi,bi) *= 3.0  
                 PUT DbS(bi,bi) += tuu(bi,bi) 
#
           ENDDO bi  
#
           DO ai 
#
                 GET              IAa(ai,a) 
                 IaS(a,ai)      = IAa(ai,a) 
                 sSab(ai,a1,b)  = Y3aab(a,a1,b)*IaS(a,ai) 
                 s1Sab(ai,a1,b) = tppq(a,a1,b)*IaS(a,ai) 
                 etemp          = sSab(ai,a1,b)*s1Sab(ai,a1,b)  
                 tss(ai,ai)    = etemp 
                 tss(ai,ai) *= 6.0  
                 PUT DaS(ai,ai) += tss(ai,ai) 
#
           ENDDO ai  
#
           ENDPARDO a, a1, b # i, j, k 
#
           execute sip_barrier 
           execute server_barrier 
#
           delete D3aab 
           delete E3aab 
           delete X3aab 
           delete Y3aab 
           delete DaibS(*,*,*,kb) 
          #delete DaSbS(*,i,*,kb) 
           delete Dab 
          #delete D1aSbS(*,j,*,kb) 
           delete D1ab 
           delete Paabk(*,*,*,kb) 
#
        ENDDO kb # segment size of 1
#
        execute sip_barrier 
        delete D1aSbj(*,j,*,*) 
        delete D1aiaS(*,*,*,j)  
       #delete DaSaS(*,j,*,i) 
        delete Daa 
        delete Paaaj(*,*,*,j)  
        delete Pbbaj(*,*,*,j)  
       #ENDIF # i>=j 
        ENDDO j # segment size of 1  
#
        execute sip_barrier 
        delete DaSbj(*,i,*,*) 
        delete DaiaS(*,*,*,i) 
        delete Paaai(*,*,*,i)  
        delete Pbbai(*,*,*,i)  
     ENDDO i # segment size of 1  

#VVV
     execute server_barrier 
    #PARDO a, i, a3, j  
    #      REQUEST Saaii(a3,a,i,j) a 
    #      execute dump_amp Saaii  
    #ENDPARDO a, i, a3, j  

    #PARDO a, a3, a1, j 
    #      REQUEST Gaaai(a,a3,a1,j) a
    #      execute dump_amp Gaaai 
    #ENDPARDO a, a3, a1, j 

    #PARDO a, i, j, k  
    #      REQUEST Gaiii(a,i,j,k) a 
    #      execute dump_amp Gaiii  
    #ENDPARDO a, i, j, k  

    #PARDO a, a1, i, j 
    #      REQUEST Gaiai(a,i,a1,j) a 
    #      execute dump_amp Gaiai(a,i,a1,j)  
    #ENDPARDO a, a1, i, j 

     execute server_barrier 
#
#
     execute sip_barrier
     collective ecorraaa += esum1 
     execute print_scalar ecorraaa 
#
     execute server_barrier 
     execute sip_barrier
     collective ecorraab += esum2 
     execute print_scalar ecorraab 

     esum = 0.0 
     esum = ecorraaa 
     esum += ecorraab 
     execute print_scalar ecorraaa  
     execute print_scalar ecorraab  
     execute print_scalar esum 
     totenerg += esum 
#
     ENDPROC T4AAA 
#    ------------- 
#
# --------------------------------------------------------------------------
#
     PROC T4BBB 
#    ---------- 
#
     esum4 = 0.0 
     esum1 = 0.0 
     execute sip_barrier 
#
#    beta/beta/beta/ block. 
#    ----------------------- 
#
     DO ib # segment size of 1  
#
        create Pbbbi(*,*,*,ib) 
        create Paabi(*,*,*,ib) 
        create DbjbS(*,*,*,ib) 
        create EaibS(*,*,*,ib) 
        execute sip_barrier 
        PARDO b, b1, b2 
              PREQUEST tqqqs(b,b1,b2,ib) = VSbbbj(b,b1,b2,j1) 
              PUT Pbbbi(b,b1,b2,ib)      = tqqqs(b,b1,b2,ib) 
        ENDPARDO b, b1, b2 
        PARDO a, a1, b 
              PREQUEST tppqj(a,a1,b,ib)  = Vaabj(a,a1,b,j1) 
              PUT Paabi(a,a1,b,ib)       = tppqj(a,a1,b,ib) 
        ENDPARDO a, a1, b 
        PARDO b, b1, j1 
              PREQUEST tqqqS(b,j1,b1,ib) = T2bjbj(b,j1,b1,j2) 
              PUT DbjbS(b,j1,b1,ib)      = tqqqS(b,j1,b1,ib)  
        ENDPARDO b, b1, j1 
        PARDO a, b, i1 
              PREQUEST tppqs(a,i1,b,ib) = T2aibj(a,i1,b,j1) 
              PUT EaibS(a,i1,b,ib)      = tppqs(a,i1,b,ib) 
        ENDPARDO a, b, i1 
#
        DO jb # segment size of 1  
#
       #IF jb >= ib  
#
        create Pbbbj(*,*,*,jb) 
        create Paabj(*,*,*,jb) 
        create D1bjbS(*,*,*,jb) 
       #create DbSbS(*,jb,*,ib) 
        create Dbb 
        create E1aibS(*,*,*,jb) 
        execute sip_barrier 
        PARDO b, b1, b2 
              PREQUEST tqqqs(b,b1,b2,jb) = VSbbbj(b,b1,b2,j1) 
              PUT Pbbbj(b,b1,b2,jb)      = tqqqs(b,b1,b2,jb) 
        ENDPARDO b, b1, b2 
        PARDO a, a1, b 
              PREQUEST tppqj(a,a1,b,jb)  = Vaabj(a,a1,b,j1) 
              PUT Paabj(a,a1,b,jb)       = tppqj(a,a1,b,jb) 
        ENDPARDO a, a1, b 
        PARDO b, b1, j1 
              PREQUEST tqqqS(b,j1,b1,jb) = T2bjbj(b,j1,b1,j2) 
              PUT D1bjbS(b,j1,b1,jb)     = tqqqS(b,j1,b1,jb)  
        ENDPARDO b, b1, j1 
        PARDO b, b1  
              PREQUEST tqSqS(b,jb,b1,ib) = T2bjbj(b,j1,b1,j2) 
              tqqjj(b,b1,jb,ib)          = tqSqS(b,jb,b1,ib) 
              tqq(b,b1)                  = tqqjj(b,b1,jb,ib)
              PUT Dbb(b,b1)              = Tqq(b,b1) 
             #PUT DbSbS(b,jb,b1,ib)      = tqSqS(b,jb,b1,ib)  
        ENDPARDO b, b1  
        PARDO a, b, i1 
              PREQUEST tppqs(a,i1,b,jb) = T2aibj(a,i1,b,j1) 
              PUT E1aibS(a,i1,b,jb)      = tppqs(a,i1,b,jb) 
        ENDPARDO a, b, i1 
#
	DO kb # segment size of 1  
#
          #IF kb >=jb 
#
           CREATE X3bbb  
           CREATE Y3bbb  
           CREATE D3bbb  
           CREATE E3bbb  
           create Pbbbk(*,*,*,kb) 
           create D2bjbS(*,*,*,kb) 
          #create D1bSbS(*,ib,*,kb) 
           create D1bb 
          #create D2bSbS(*,jb,*,kb) 
           create D2bb 
           execute sip_barrier 
           PARDO b, b1, b2 
                 PREQUEST tqqqs(b,b1,b2,kb) = VSbbbj(b,b1,b2,j1) 
                 PUT Pbbbk(b,b1,b2,kb)      = tqqqs(b,b1,b2,kb) 
           ENDPARDO b, b1, b2 
           PARDO b, b1, j1 
                 PREQUEST tqqqS(b,j1,b1,kb) = T2bjbj(b,j1,b1,j2) 
                 PUT D2bjbS(b,j1,b1,kb)     = tqqqS(b,j1,b1,kb)  
           ENDPARDO b, b1, j1 
           PARDO b, b1  
                 PREQUEST tqSqS(b,ib,b1,kb) = T2bjbj(b,j1,b1,j2) 
                 tqqjj(b,b1,ib,kb)          = tqSqS(b,ib,b1,kb)
                 tqq(b,b1)                  = tqqjj(b,b1,ib,kb)
                 PUT D1bb(b,b1)             = tqq(b,b1) 
                #PUT D1bSbS(b,ib,b1,kb)     = tqSqS(b,ib,b1,kb)  
           ENDPARDO b, b1  
           PARDO b, b1  
                 PREQUEST t1qSqS(b,jb,b1,kb) = T2bjbj(b,j1,b1,j2) 
                 tqqjj(b,b1,jb,kb)          = t1qSqS(b,jb,b1,kb)
                 tqq(b,b1)                  = tqqjj(b,b1,jb,kb)
                 PUT D2bb(b,b1)             = tqq(b,b1) 
                #PUT D2bSbS(b,jb,b1,kb)     = t1qSqS(b,jb,b1,kb)  
           ENDPARDO b, b1  
#
           execute sip_barrier  
#
#          Form COMPLETE X3 arrays for the (i,j,k) combination. 
#          ---------------------------------------------------- 
#
           PARDO b, b1, b2, j1  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET DbjbS(b1,j1,b2,ib) 
                    GET XSbjjj(b,kb,j1,jb) 
# 
                    t2bjjj(b,j1,kb,jb)          = XSbjjj(b,kb,j1,jb) 
                    t1qqjj(b1,b2,j1,ib)         = DbjbS(b1,j1,b2,ib) 
                    tqq(b,j1)          = t2bjjj(b,j1,kb,jb)
                    tqqqq(b,b1,b2,ib)   = t1qqjj(b1,b2,j1,ib)*tqq(b,j1)  
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,ib) 
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, j1    
#
#          (b--b1) permutation 
#          ------------------- 
#
           PARDO b, b1, b2, j1  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET DbjbS(b,j1,b2,ib) 
                    GET XSbjjj(b1,kb,j1,jb) 
# 
                    t2bjjj(b1,j1,kb,jb)         = XSbjjj(b1,kb,j1,jb) 
                    t1qqjj(b,b2,j1,ib)          = DbjbS(b,j1,b2,ib) 
#
                    tqq(b1,j1)         = t2bjjj(b1,j1,kb,jb)
                    tqqqq(b,b1,b2,ib)   = t1qqjj(b,b2,j1,ib)*tqq(b1,j1)  
#
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,ib) 
                    tqqq(b,b1,b2)     *= -1.0  
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, j1    
#
#          (b--b2) permutation 
#          ------------------- 
#
           PARDO b, b1, b2, j1  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET DbjbS(b1,j1,b,ib) 
                    GET XSbjjj(b2,kb,j1,jb) 
#
                    t2bjjj(b2,j1,kb,jb)         = XSbjjj(b2,kb,j1,jb) 
                    t1qqjj(b1,b,j1,ib)          = DbjbS(b1,j1,b,ib) 
#
                    tqq(b2,j1)         = t2bjjj(b2,j1,kb,jb)
                    tqqqq(b,b1,b2,ib)   = t1qqjj(b1,b,j1,ib)*tqq(b2,j1)  
#
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,ib) 
                    tqqq(b,b1,b2)     *= -1.0  
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, j1    
#
#          (i--jb) permutation 
#          ------------------- 
#
           PARDO b, b1, b2, j1  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET XSbjjj(b,kb,j1,ib) 
                    GET D1bjbS(b1,j1,b2,jb) 
# 
                    t2bjjj(b,j1,kb,ib)          = XSbjjj(b,kb,j1,ib) 
                    t1qqjj(b1,b2,j1,jb)         = D1bjbS(b1,j1,b2,jb) 
#
                    tqq(b,j1)          = t2bjjj(b,j1,kb,ib)
                    tqqqq(b,b1,b2,jb)   = t1qqjj(b1,b2,j1,jb)*tqq(b,j1)  
#
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,jb) 
                    tqqq(b,b1,b2)     *= -1.0  
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, j1    
#
#          (i--kb) permutbtion 
#          ------------------- 
#
           PARDO b, b1, b2, j1  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET D2bjbS(b1,j1,b2,kb) 
                    GET XSbjjj(b,ib,j1,jb) 
#
                    t2bjjj(b,j1,ib,jb)          = XSbjjj(b,ib,j1,jb) 
                    t1qqjj(b1,b2,j1,kb)         = D2bjbS(b1,j1,b2,kb) 
#
                    tqq(b,j1)          = t2bjjj(b,j1,ib,jb)
                    tqqqq(b,b1,b2,kb)   = t1qqjj(b1,b2,j1,kb)*tqq(b,j1)  
#
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,kb) 
                    tqqq(b,b1,b2)     *= -1.0  
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, j1    
#
#          (b--b1) (i--jb) permutation 
#          -------------------------- 
#
           PARDO b, b1, b2, j1  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET D1bjbS(b,j1,b2,jb) 
                    GET XSbjjj(b1,kb,j1,ib) 
#
                    t2bjjj(b1,j1,kb,ib)         = XSbjjj(b1,kb,j1,ib) 
                    t1qqjj(b,b2,j1,jb)          = D1bjbS(b,j1,b2,jb) 
#
                    tqq(b1,j1)          = t2bjjj(b1,j1,kb,ib)
                    tqqqq(b,b1,b2,jb)   = t1qqjj(b,b2,j1,jb)*tqq(b1,j1)  
#
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,jb) 
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, j1    
#
#          (b--b1) (i--kb) permutation 
#          --------------------------- 
#
           PARDO b, b1, b2, j1  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET D2bjbS(b,j1,b2,kb) 
                    GET XSbjjj(b1,ib,j1,jb) 
#
                    t2bjjj(b1,j1,ib,jb)         = XSbjjj(b1,ib,j1,jb) 
                    t1qqjj(b,b2,j1,kb)          = D2bjbS(b,j1,b2,kb) 
#
                    tqq(b1,j1)         = t2bjjj(b1,j1,ib,jb)
                    tqqqq(b,b1,b2,kb)   = t1qqjj(b,b2,j1,kb)*tqq(b1,j1)  
#
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,kb) 
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, j1    
#
#          (b--b2) (i--jb) permutation 
#          -------------------------- 
#
           PARDO b, b1, b2, j1  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET D1bjbS(b1,j1,b,jb) 
                    GET XSbjjj(b2,kb,j1,ib) 
#
                    t2bjjj(b2,j1,kb,ib)         = XSbjjj(b2,kb,j1,ib) 
                    t1qqjj(b1,b,j1,jb)          = D1bjbS(b1,j1,b,jb) 
#
                    tqq(b2,j1)         = t2bjjj(b2,j1,kb,ib)
                    tqqqq(b,b1,b2,jb)   = t1qqjj(b1,b,j1,jb)*tqq(b2,j1)  
#
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,jb) 
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, j1    
#
#          (b--b2) (i--l) permutation 
#          -------------------------- 
#
           PARDO b, b1, b2, j1  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET D2bjbS(b1,j1,b,kb) 
                    GET XSbjjj(b2,ib,j1,jb) 
# 
                    t2bjjj(b2,j1,ib,jb)         = XSbjjj(b2,ib,j1,jb) 
                    t1qqjj(b1,b,j1,kb)          = D2bjbS(b1,j1,b,kb) 
#
                    tqq(b2,j1)         = t2bjjj(b2,j1,ib,jb)
                    tqqqq(b,b1,b2,kb)   = t1qqjj(b1,b,j1,kb)*tqq(b2,j1)  
#
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,kb) 
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, j1    
#
           PARDO b, b1, b2, b3  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET Pbbbi(b1,b3,b2,ib) 
                   #GET D2bSbS(b,jb,b3,kb) 
                    GET D2bb(b,b3) 
#
                   #tqqjj(b,b3,jb,kb)        = D2bSbS(b,jb,b3,kb) 
                   #tqq(b,b3)           = tqqjj(b,b3,jb,kb)  
#
                    tqqqq(b,b1,b2,ib)    = Pbbbi(b1,b3,b2,ib)*D2bb(b,b3)   
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,ib) 
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, b3  
#
#          (b--b1) permutation 
#          ------------------- 
#
           PARDO b, b1, b2, b3  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET Pbbbi(b,b3,b2,ib) 
                   #GET D2bSbS(b1,jb,b3,kb) 
                    GET D2bb(b1,b3) 
#
                   #tqqjj(b1,b3,jb,kb)          = D2bSbS(b1,jb,b3,kb) 
                   #tqq(b1,b3)           = tqqjj(b1,b3,jb,kb)  
#
                    tqqqq(b,b1,b2,ib)    = Pbbbi(b,b3,b2,ib)*D2bb(b1,b3)   
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,ib) 
                    tqqq(b,b1,b2)     *= -1.0  
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, b3  
#
#          (b--b2) permutation 
#          ------------------- 
#
           PARDO b, b1, b2, b3  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET Pbbbi(b1,b3,b,ib) 
                   #GET D2bSbS(b2,jb,b3,kb) 
                    GET D2bb(b2,b3) 
#
                   #tqqjj(b2,b3,jb,kb)          = D2bSbS(b2,jb,b3,kb) 
                   #tqq(b2,b3)           = tqqjj(b2,b3,jb,kb)  
#
                    tqqqq(b,b1,b2,ib)    = Pbbbi(b1,b3,b,ib)*D2bb(b2,b3)   
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,ib) 
                    tqqq(b,b1,b2)     *= -1.0  
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, b3  
#
#          (i--jb) permutation 
#          ------------------- 
#
           PARDO b, b1, b2, b3  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET Pbbbj(b1,b3,b2,jb)
                   #GET D1bSbS(b,ib,b3,kb) 
                    GET D1bb(b,b3) 
#
                   #tqqjj(b,b3,ib,kb)          = D1bSbS(b,ib,b3,kb) 
                   #tqq(b,b3)           = tqqjj(b,b3,ib,kb)  
#
                    tqqqq(b,b1,b2,jb)    = Pbbbj(b1,b3,b2,jb)*D1bb(b,b3)   
#
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,jb) 
                    tqqq(b,b1,b2)     *= -1.0  
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, b3  
#
#          (i--kb) permutation 
#          ------------------- 
#
           PARDO b, b1, b2, b3  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET Pbbbk(b1,b3,b2,kb) 
                   #GET DbSbS(b,jb,b3,ib) 
                    GET Dbb(b,b3) 
#
                   #tqqjj(b,b3,jb,ib)          = DbSbS(b,jb,b3,ib) 
                   #tqq(b,b3)           = tqqjj(b,b3,jb,ib)  
#
                    tqqqq(b,b1,b2,kb)    = Pbbbk(b1,b3,b2,kb)*Dbb(b,b3)   
#
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,kb) 
                    tqqq(b,b1,b2)     *= -1.0  
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, b3  
#
#          (b--b1) (i--jb) permutation 
#          -------------------------- 
#
           PARDO b, b1, b2, b3  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET Pbbbj(b,b3,b2,jb)
                   #GET D1bSbS(b1,ib,b3,kb) 
                    GET D1bb(b1,b3) 
#
                   #tqqjj(b1,b3,ib,kb)          = D1bSbS(b1,ib,b3,kb) 
                   #tqq(b1,b3)           = tqqjj(b1,b3,ib,kb)  
#
                    tqqqq(b,b1,b2,jb)    = Pbbbj(b,b3,b2,jb)*D1bb(b1,b3)   
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,jb) 
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, b3  
#
#          (b--b1) (i--kb) permutation 
#          -------------------------- 
#
           PARDO b, b1, b2, b3  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET Pbbbk(b,b3,b2,kb) 
                   #GET DbSbS(b1,jb,b3,ib) 
                    GET Dbb(b1,b3) 
#
                   #tqqjj(b1,b3,jb,ib)          = DbSbS(b1,jb,b3,ib) 
                   #tqq(b1,b3)           = tqqjj(b1,b3,jb,ib)  
#
                    tqqqq(b,b1,b2,kb)    = Pbbbk(b,b3,b2,kb)*Dbb(b1,b3)   
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,kb) 
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, b3  
#
#          (b--b2) (i--jb) permutation 
#          -------------------------- 
#
           PARDO b, b1, b2, b3  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET Pbbbj(b1,b3,b,jb)
                   #GET D1bSbS(b2,ib,b3,kb) 
                    GET D1bb(b2,b3) 
#
                   #tqqjj(b2,b3,ib,kb)          = D1bSbS(b2,ib,b3,kb) 
                   #tqq(b2,b3)           = tqqjj(b2,b3,ib,kb)  
#
                    tqqqq(b,b1,b2,jb)   = Pbbbj(b1,b3,b,jb)*D1bb(b2,b3)   
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,jb) 
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, b3  
#
#          (b--b2) (i--kb) permutation 
#          -------------------------- 
#
           PARDO b, b1, b2, b3  
#
                 IF b  <= b1 
                 IF b1 <= b2 
#
                    GET Pbbbk(b1,b3,b,kb)
                   #GET DbSbS(b2,jb,b3,ib) 
                    GET Dbb(b2,b3) 
#
                   #tqqjj(b2,b3,jb,ib)        = DbSbS(b2,jb,b3,ib) 
                   #tqq(b2,b3)           = tqqjj(b2,b3,jb,ib)  
#
                    tqqqq(b,b1,b2,kb)    = Pbbbk(b1,b3,b,kb)*Dbb(b2,b3)   
#
                    tqqq(b,b1,b2)      = tqqqq(b,b1,b2,kb) 
#
                    PUT X3bbb(b,b1,b2) += tqqq(b,b1,b2) 
# 
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2, b3  
           execute sip_barrier 
           execute server_barrier 
#
#      Compute disconnected contribution to the amplitude 
#      -------------------------------------------------- 
#
#          (1) 
#          --- 
#
           PARDO b, b1, b2 
#
                 IF b <= b1 
                 IF b1 <= b2 
#
                #PREQUEST tqi(b,ib)           = t1b_old(b,j1)  
                 PREQUEST P1bjbj(b1,jb,b2,kb) = VSqjqj(b1,j1,b2,j2) 
                 GET t1bj(b,ib)  
#
                 tqqjj(b1,b2,jb,kb)  = P1bjbj(b1,jb,b2,kb)
                 tqq(b1,b2)          = tqqjj(b1,b2,jb,kb)
#
                 tqqqj(b,b1,b2,ib)   = t1bj(b,ib)^tqq(b1,b2)
                 tqqq(b,b1,b2)       = tqqqj(b,b1,b2,ib) 
                 PUT D3bbb(b,b1,b2) += tqqq(b,b1,b2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2 
           execute sip_barrier 
#
#          (-P_ij) 
#          ------- 
#
           PARDO b, b1, b2 
#
                 IF b <= b1 
                 IF b1 <= b2 
#
                #PREQUEST tqj(b,jb)          = t1b_old(b,j1)  
                 PREQUEST P2bjbj(b1,ib,b2,kb) = VSqjqj(b1,j1,b2,j2) 
                 GET t1bj(b,jb)   
#
                 tqqjj(b1,b2,ib,kb)    = P2bjbj(b1,ib,b2,kb)
                 tqq(b1,b2)          = tqqjj(b1,b2,ib,kb)
#
                 tqqqj(b,b1,b2,jb)    = tqq(b1,b2)^t1bj(b,jb)
                 tqqq(b,b1,b2)       = tqqqj(b,b1,b2,jb) 
                 tqqq(b,b1,b2)      *= -1.0  
                 PUT D3bbb(b,b1,b2) += tqqq(b,b1,b2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2 
           execute sip_barrier 
#
#          (-P_ik) 
#          ------- 
#
           PARDO b, b1, b2 
#
                 IF b <= b1 
                 IF b1 <= b2 
#
                #PREQUEST tqk(b,kb)          = t1b_old(b,j1)  
                 PREQUEST P3bjbj(b1,jb,b2,ib) = VSqjqj(b1,j1,b2,j2) 
                 GET t1bj(b,kb)   
#
                 tqqjj(b1,b2,jb,ib)    = P3bjbj(b1,jb,b2,ib)
                 tqq(b1,b2)          = tqqjj(b1,b2,jb,ib)
#
                 tqqqj(b,b1,b2,kb)   = t1bj(b,kb)^tqq(b1,b2) 
                 tqqq(b,b1,b2)       = tqqqj(b,b1,b2,kb) 
                 tqqq(b,b1,b2)      *= -1.0  
                 PUT D3bbb(b,b1,b2) += tqqq(b,b1,b2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2 
           execute sip_barrier 
#
#          (-b<->b1) 
#          --------- 
#
           PARDO b1, b, b2 
#
                 IF b <= b1 
                 IF b1 <= b2 
#
                #PREQUEST tqi(b1,ib)        = t1b_old(b1,j1)  
                 PREQUEST P4bjbj(b,jb,b2,kb) = VSqjqj(b,j1,b2,j2) 
                 GET t1bj(b1,ib)    
#
                 tqqjj(b,b2,jb,kb)     = P4bjbj(b,jb,b2,kb)
                 tqq(b,b2)           = tqqjj(b,b2,jb,kb)
#
                 tqqqj(b,b1,b2,ib)    = tqq(b,b2)^t1bj(b1,ib)
                 tqqq(b,b1,b2)       = tqqqj(b,b1,b2,ib) 
                 tqqq(b,b1,b2)      *= -1.0  
                 PUT D3bbb(b,b1,b2) += tqqq(b,b1,b2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b1, b, b2 
           execute sip_barrier 
#
#          (-b<->b2) 
#          --------- 
#
           PARDO b2, b1, b 
#
                 IF b <= b1 
                 IF b1 <= b2 
#
                #PREQUEST tqi(b2,ib)        = t1b_old(b2,j1)  
                 PREQUEST P5bjbj(b1,jb,b,kb) = VSqjqj(b1,j1,b,j2) 
                 GET t1bj(b2,ib)    
#
                 tqqjj(b1,b,jb,kb)     = P5bjbj(b1,jb,b,kb)
                 tqq(b1,b)           = tqqjj(b1,b,jb,kb)
#
                 tqqqj(b,b1,b2,ib)    = tqq(b1,b)^t1bj(b2,ib)
                 tqqq(b,b1,b2)       = tqqqj(b,b1,b2,ib) 
                 tqqq(b,b1,b2)      *= -1.0  
                 PUT D3bbb(b,b1,b2) += tqqq(b,b1,b2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b2, b1, b 
           execute sip_barrier 
#
#          (i<-j b<->b1) 
#          ------------- 
#
           PARDO b1, b, b2 
#
                 IF b <= b1 
                 IF b1 <= b2 
#
                #PREQUEST tqj(b1,jb)        = t1b_old(b1,j1)  
                 PREQUEST P6bjbj(b,ib,b2,kb) = VSqjqj(b,j1,b2,j2) 
                 GET t1bj(b1,jb)    
#
                 tqqjj(b,b2,ib,kb)     = P6bjbj(b,ib,b2,kb)
                 tqq(b,b2)           = tqqjj(b,b2,ib,kb)
#
                 tqqqj(b,b1,b2,jb)    = tqq(b,b2)^t1bj(b1,jb)
                 tqqq(b,b1,b2)       = tqqqj(b,b1,b2,jb) 
                 PUT D3bbb(b,b1,b2) += tqqq(b,b1,b2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b1, b, b2 
           execute sip_barrier 
#
#          (i<-j a<->a2) 
#          ------------- 
#
           PARDO b2, b1, b 
#
                 IF b <= b1 
                 IF b1 <= b2 
#
                #PREQUEST tqj(b2,jb)         = t1b_old(b2,j1)  
                 PREQUEST P7bjbj(b1,ib,b,kb) = VSqjqj(b1,j1,b,j2) 
                 GET t1bj(b2,jb)    
#
                 tqqjj(b1,b,ib,kb)     = P7bjbj(b1,ib,b,kb)
                 tqq(b1,b)           = tqqjj(b1,b,ib,kb)
#
                 tqqqj(b,b1,b2,jb)    = tqq(b1,b)^t1bj(b2,jb)
                 tqqq(b,b1,b2)       = tqqqj(b,b1,b2,jb) 
                 PUT D3bbb(b,b1,b2) += tqqq(b,b1,b2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b2, b1, b 
           execute sip_barrier 
#
#          (i<-k b<->b1) 
#          ------------- 
#
           PARDO b1, b, b2 
#
                 IF b <= b1 
                 IF b1 <= b2 
#
                #PREQUEST tqk(b1,kb)        = t1b_old(b1,j1)  
                 PREQUEST P8bjbj(b,jb,b2,ib) = VSqjqj(b,j1,b2,j2) 
                 GET t1bj(b1,kb)   
#
                 tqqjj(b,b2,jb,ib)     = P8bjbj(b,jb,b2,ib)
                 tqq(b,b2)           = tqqjj(b,b2,jb,ib)
#
                 tqqqj(b,b1,b2,kb)    = tqq(b,b2)^t1bj(b1,kb)
                 tqqq(b,b1,b2)       = tqqqj(b,b1,b2,kb) 
                 PUT D3bbb(b,b1,b2) += tqqq(b,b1,b2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b1, b, b2 
           execute sip_barrier 
#
#          (i<-k a<->a2) 
#          ------------- 
#
           PARDO b2, b1, b 
#
                 IF b <= b1 
                 IF b1 <= b2 
#
                #PREQUEST tqk(b2,kb)        = t1b_old(b2,j1)  
                 PREQUEST P9bjbj(b1,jb,b,ib) = VSqjqj(b1,j1,b,j2) 
                 GET t1bj(b2,kb)  
#
                 tqqjj(b1,b,jb,ib)     = P9bjbj(b1,jb,b,ib)
                 tqq(b1,b)           = tqqjj(b1,b,jb,ib)
#
                 tqqqj(b,b1,b2,kb)    = tqq(b1,b)^t1bj(b2,kb)
                 tqqq(b,b1,b2)       = tqqqj(b,b1,b2,kb) 
                 PUT D3bbb(b,b1,b2) += tqqq(b,b1,b2)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b2, b1, b 
#
           execute server_barrier 
           execute sip_barrier 
#
# Symmetrize amplitude array 
# --------------------------- 
#
           PARDO b, b1, b2  
#
                 IF b <= b1 
                 IF b1 <= b2 
#
                    GET                   X3bbb(b,b1,b2) 
                    t1qqq(b1,b,b2)      = X3bbb(b,b1,b2) 
                    t2qqq(b2,b1,b)      = X3bbb(b,b1,b2) 
                    t3qqq(b,b2,b1)      = X3bbb(b,b1,b2) 
                    t4qqq(b1,b2,b)      = X3bbb(b,b1,b2) 
                    t5qqq(b2,b,b1)      = X3bbb(b,b1,b2) 
                    t1qqq(b1,b,b2)     *= -1.0 
                    t2qqq(b2,b1,b)     *= -1.0 
                    t3qqq(b,b2,b1)     *= -1.0  

                    PUT Y3bbb(b,b1,b2) = X3bbb(b,b1,b2)  
                    PUT Y3bbb(b1,b,b2) = t1qqq(b1,b,b2)  
                    PUT Y3bbb(b2,b1,b) = t2qqq(b2,b1,b)  
                    PUT Y3bbb(b,b2,b1) = t3qqq(b,b2,b1)  
                    PUT Y3bbb(b1,b2,b) = t4qqq(b1,b2,b)  
                    PUT Y3bbb(b2,b,b1) = t5qqq(b2,b,b1)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2   
#
           PARDO b, b1, b2  
#
                 IF b <= b1 
                 IF b1 <= b2 
#
                    GET                   D3bbb(b,b1,b2) 
                    t1qqq(b1,b,b2)      = D3bbb(b,b1,b2) 
                    t2qqq(b2,b1,b)      = D3bbb(b,b1,b2) 
                    t3qqq(b,b2,b1)      = D3bbb(b,b1,b2) 
                    t4qqq(b1,b2,b)      = D3bbb(b,b1,b2) 
                    t5qqq(b2,b,b1)      = D3bbb(b,b1,b2) 
                    t1qqq(b1,b,b2)     *= -1.0 
                    t2qqq(b2,b1,b)     *= -1.0 
                    t3qqq(b,b2,b1)     *= -1.0  

                    PUT E3bbb(b,b1,b2) = D3bbb(b,b1,b2)  
                    PUT E3bbb(b1,b,b2) = t1qqq(b1,b,b2)  
                    PUT E3bbb(b2,b1,b) = t2qqq(b2,b1,b)  
                    PUT E3bbb(b,b2,b1) = t3qqq(b,b2,b1)  
                    PUT E3bbb(b1,b2,b) = t4qqq(b1,b2,b)  
                    PUT E3bbb(b2,b,b1) = t5qqq(b2,b,b1)  
#
                 ENDIF 
                 ENDIF 
#
           ENDPARDO b, b1, b2   
           execute server_barrier 
           execute sip_barrier 
#
# Form contribution to the energy 
# ------------------------------- 
#
           PARDO b, b1, b2 
#
                 GET Y3bbb(b,b1,b2) 
                 GET E3bbb(b,b1,b2) 
                 tqqq(b,b1,b2) = Y3bbb(b,b1,b2) 
                 t1bbbjjj(b,b1,b2,ib,jb,kb) = tqqq(b,b1,b2)
                 tbjbjbj(b,ib,b1,jb,b2,kb)   = T1bbbjjj(b,b1,b2,ib,jb,kb) 
                 execute energy_denominator tbjbjbj(b,ib,b1,jb,b2,kb)  
                 t2bbbjjj(b,b1,b2,ib,jb,kb) = tbjbjbj(b,ib,b1,jb,b2,kb)  
                 t1qqq(b,b1,b2) = t2bbbjjj(b,b1,b2,ib,jb,kb) 

                 tqqq(b,b1,b2) = Y3bbb(b,b1,b2) 
                 tqqq(b,b1,b2) += E3bbb(b,b1,b2) 
                 etemp = tqqq(b,b1,b2)*t1qqq(b,b1,b2)
                 etemp = etemp/36.0  
                #etemp*= 6.0  
                 esum4 += etemp 
#
           ENDPARDO b, b1, b2 
#
# Form contribution to Sbbjj 
# -------------------------- 
#
           PARDO b, b1, b2  
#
                 GET                          Y3bbb(b,b1,b2) 
                 GET                          E3bbb(b,b1,b2) 
#
                 tqqq(b,b1,b2)              = Y3bbb(b,b1,b2) 
                 tqqq(b,b1,b2)             *= 2.0  
                 tqqq(b,b1,b2)             += E3bbb(b,b1,b2)
                 tbbbjjj(b,b1,b2,ib,jb,kb)  = tqqq(b,b1,b2) 
                 tbjbjbj(b,ib,b1,jb,b2,kb)  = Tbbbjjj(b,b1,b2,ib,jb,kb) 
                 execute energy_denominator   tbjbjbj(b,ib,b1,jb,b2,kb)  
                 t2bbbjjj(b,b1,b2,kb,jb,ib) = tbjbjbj(b,ib,b1,jb,b2,kb)  
                 tqqqj(b,b1,b2,kb)          = t2bbbjjj(b,b1,b2,kb,jb,ib) 
#
                 DO b3 
#
                    GET                          Pbbbk(b1,b3,b2,kb) 
#
                    tqq(b,b3)                  = tqqqj(b,b1,b2,kb)*Pbbbk(b1,b3,b2,kb) 
                    tqq(b,b3)                 *= 0.5 
                    tqqjj(b,b3,ib,jb)          = tqq(b,b3) 
                    Sqqjj(b3,b,ib,jb)         = tqqjj(b,b3,ib,jb) 
                    Sqqjj(b3,b,ib,jb)        *= -1.0  
                    PREPARE Sbbjj(b,b3,ib,jb) += tqqjj(b,b3,ib,jb) 
                    PREPARE Sbbjj(b3,b,ib,jb) += Sqqjj(b3,b,ib,jb) 
#
                 ENDDO b3 
#
                 DO lb 
#
                    PREQUEST tbJJJ(b2,kb,lb,jb)= VSqjqj(b2,j1,j2,j3)  
#
                    tqj(b2,kb)                 = tbJJJ(b2,kb,lb,jb) 
                    tqq(b,b1)                  = tqqqj(b,b1,b2,kb)*tqj(b2,kb)  
                    tqq(b,b1)                 *= -0.5 
                    tqqjj(b,b1,ib,lb)          = tqq(b,b1) 
                    Sqqjj(b,b1,lb,ib)         = tqq(b,b1) 
                    Sqqjj(b,b1,lb,ib)        *= -1.0 
                    PREPARE Sbbjj(b,b1,ib,lb) += tqqjj(b,b1,ib,lb) 
                    PREPARE Sbbjj(b,b1,lb,ib) += Sqqjj(b,b1,lb,ib) 
#
                 ENDDO lb 
#
           ENDPARDO b, b1, b2  
#
# Done contribution to Sbbjj 
# -------------------------- 
#
# Form contribution to sbj
# ------------------------
#
# Perm 1
# -------
#
           PARDO b, b1, b2
#
                 PREQUEST P2bjbj(b1,jb,b2,kb) = VSqjqj(b1,j1,b2,j2)
                 GET                          Y3bbb(b,b1,b2)

                 tbbbjjj(b,b1,b2,ib,jb,kb) = Y3bbb(b,b1,b2)
                 tbjbjbj(b,ib,b1,jb,b2,kb) = tbbbjjj(b,b1,b2,ib,jb,kb)
                 execute energy_denominator tbjbjbj(b,ib,b1,jb,b2,kb)
                 t1bbbjjj(b,b1,b2,ib,jb,kb) = tbjbjbj(b,ib,b1,jb,b2,kb)
#
                 t1qqqj(b,b1,b2,ib) = t1bbbjjj(b,b1,b2,ib,jb,kb)
                 t2qqjj(b1,b2,jb,kb) = P2bjbj(b1,jb,b2,kb)
                 tqq(b1,b2) = t2qqjj(b1,b2,jb,kb)
#
                 xbj(b,ib) = t1qqqj(b,b1,b2,ib)*tqq(b1,b2)
                 xbj(b,ib) *= 2.0
                 PUT sbj(b,ib) += xbj(b,ib)
#
           ENDPARDO b, b1, b2
           execute server_barrier
           execute sip_barrier
#
# Perm 2
# -------
#
           PARDO b1, b, b2
#
                 PREQUEST P2bjbj(b,ib,b2,kb) = VSqjqj(b,j1,b2,j3)
                 GET Y3bbb(b,b1,b2)
                 tqqq(b1,b,b2) = Y3bbb(b,b1,b2)

                 tbbbjjj(b1,b,b2,jb,ib,kb) = tqqq(b1,b,b2)
                 tbjbjbj(b1,jb,b,ib,b2,kb) = tbbbjjj(b1,b,b2,jb,ib,kb)
                 execute energy_denominator tbjbjbj(b1,jb,b,ib,b2,kb)
                 t1bbbjjj(b1,b,b2,jb,ib,kb) = tbjbjbj(b1,jb,b,ib,b2,kb)
#
                 t1qqqj(b1,b,b2,jb) = t1bbbjjj(b1,b,b2,jb,ib,kb)
                 t2qqjj(b,b2,ib,kb) = P2bjbj(b,ib,b2,kb)
                 tqq(b,b2) = t2qqjj(b,b2,ib,kb)
#
                 xbj(b1,jb) = t1qqqj(b1,b,b2,jb)*tqq(b,b2)
                 xbj(b1,jb) *= 2.0
                #PUT sbj(b1,jb) += xbj(b1,jb)
#
           ENDPARDO b1, b, b2
           execute server_barrier
           execute sip_barrier
#
# Perm 3
# -------
#
           PARDO b2, b1, b
#
                 PREQUEST P3bjbj(b1,jb,b,ib) = VSqjqj(b1,j3,b,j2)
                 GET Y3bbb(b,b1,b2)
                 tqqq(b2,b1,b) = Y3bbb(b,b1,b2)
#
                 tbbbjjj(b2,b1,b,kb,jb,ib) = tqqq(b2,b1,b)
                 tbjbjbj(b2,kb,b1,jb,b,ib) = tbbbjjj(b2,b1,b,kb,jb,ib)
                 execute energy_denominator tbjbjbj(b2,kb,b1,jb,b,ib)
                 t1bbbjjj(b2,b1,b,kb,jb,ib) = tbjbjbj(b2,kb,b1,jb,b,ib)
#
                 t1qqqj(b2,b1,b,kb) = t1bbbjjj(b2,b1,b,kb,jb,ib)
                 t2qqjj(b1,b,jb,ib) = P3bjbj(b1,jb,b,ib)
                 tqq(b1,b) = t2qqjj(b1,b,jb,ib)
#
                 xbj(b2,kb) = t1qqqj(b2,b1,b,kb)*tqq(b1,b)
                 xbj(b2,kb) *= 2.0
                #PUT sbj(b2,kb) += xbj(b2,kb)
#
           ENDPARDO b2, b1, b
#
           execute sip_barrier 
           execute server_barrier 
#
# Form contributions to two-particle density 
# ------------------------------------------ 
#
           PARDO b, b1, b2 # ib, jb, kb 
#
                 GET                        Y3bbb(b,b1,b2)
                 GET                        E3bbb(b,b1,b2)
#
                 tqqq(b,b1,b2)            = Y3bbb(b,b1,b2)
                 tqqq(b,b1,b2)           *= 2.0
                 tqqq(b,b1,b2)           += E3bbb(b,b1,b2)
                 tbbbjjj(b,b1,b2,ib,jb,kb)   = tqqq(b,b1,b2)
                 tbjbjbj(b,ib,b1,jb,b2,kb)   = Tbbbjjj(b,b1,b2,ib,jb,kb)
                 execute energy_denominator tbjbjbj(b,ib,b1,jb,b2,kb)
                 t2bbbjjj(b,b1,b2,jb,ib,kb)  = tbjbjbj(b,ib,b1,jb,b2,kb)
                 tqqq(b,b1,b2)            = t2bbbjjj(b,b1,b2,jb,ib,kb) 
#
# Form contribution to Gbbbj
# --------------------------
#
                 tqqqj(b,b1,b2,jb)         = tqqq(b,b1,b2)
#
                 DO b3 
#
                    PREQUEST t3qjqj(b3,ib,b2,kb) = T2bjbj(b3,j1,b2,j2) 
                    tqqjj(b3,b2,ib,kb)          = t3qjqj(b3,ib,b2,kb) 
                    tqq(b3,b2)                = tqqjj(b3,b2,ib,kb) 
                    tqqqq(b,b3,b1,jb)          = tqqqj(b,b1,b2,jb)*tqq(b3,b2) 
                    tqqqq(b,b3,b1,jb)         *= 0.25  
                    PREPARE Gbbbj(b,b3,b1,jb)     += tqqqq(b,b3,b1,jb) 
#
                 ENDDO b3 
#
# Form contribution to Gbjjj
# --------------------------
#
                 tqqqj(b,b1,b2,kb)         = tqqq(b,b1,b2)
#
                 DO lb 
#
                    PREQUEST t1qjqj(b1,lb,b2,kb) = T2bjbj(b1,j1,b2,j2)  
                    tqj(b,lb)                  = tqqqj(b,b1,b2,kb)*t1qjqj(b1,lb,b2,kb) 
                    tqjjj(b,lb,ib,jb)            = tqj(b,lb) 
                    t1qjjj(b,ib,lb,jb)           = tqjjj(b,lb,ib,jb) 
                    t1qjjj(b,ib,lb,jb)          *=-0.25 # 0.25  
                    PREPARE Gbjjj(b,ib,lb,jb)       += t1qjjj(b,ib,lb,jb)  
#
                 ENDDO lb  
#
# Form contribution to Gbjbj
# --------------------------
#
                 tqqq(b,b1,b2)            = Y3bbb(b,b1,b2)
                 tbbbjjj(b,b1,b2,ib,jb,kb)   = tqqq(b,b1,b2)
                 tbjbjbj(b,ib,b1,jb,b2,kb)   = Tbbbjjj(b,b1,b2,ib,jb,kb)
                 execute energy_denominator tbjbjbj(b,ib,b1,jb,b2,kb)
                 t2bbbjjj(b,b1,b2,jb,ib,kb)  = tbjbjbj(b,ib,b1,jb,b2,kb)
                 tqqq(b,b1,b2)            = t2bbbjjj(b,b1,b2,jb,ib,kb) 
                 tqqqj(b,b1,b2,kb)         = tqqq(b,b1,b2)
# 
                 GET                        t1bj(b2,kb) 
                 tqq(b,b1)                = tqqqj(b,b1,b2,kb)*t1bj(b2,kb) 
                 tqqjj(b,b1,ib,jb)          = tqq(b,b1) 
                 tqjqj(b,ib,b1,jb)         = tqqjj(b,b1,ib,jb) 
                 tqjqj(b,ib,b1,jb)        *= 0.125  
                 PREPARE Gbjbj(b,ib,b1,jb) += tqjqj(b,ib,b1,jb) 
#
# Done forming contributions to two-particle density 
# -------------------------------------------------- 
#
# Form contribution to Dbj 
# ------------------------ 
#
                 tqqqj(b,b1,b2,ib)          = tqqq(b,b1,b2) 
                 PREQUEST t2qjqj(b1,jb,b2,kb) = T2bjbj(b1,j1,b2,j2)
                 tqqjj(b1,b2,jb,kb)         = t2qjqj(b1,jb,b2,kb)
                 tqq(b1,b2)                 = tqqjj(b1,b2,jb,kb) 
                 tqj(b,ib)                  = tqqqj(b,b1,b2,ib)*tqq(b1,b2) 
                 PUT Dbj(b,ib)             += tqj(b,ib) 
#
# Form contribution to Db 
# ----------------------- 
#
                 tqqq(b,b1,b2)              = Y3bbb(b,b1,b2)
                 tqqq(b,b1,b2)             += E3bbb(b,b1,b2)
                 tbbbjjj(b,b1,b2,ib,jb,kb)  = tqqq(b,b1,b2)
                 tbjbjbj(b,ib,b1,jb,b2,kb)  = Tbbbjjj(b,b1,b2,ib,jb,kb)
                 execute energy_denominator   tbjbjbj(b,ib,b1,jb,b2,kb)
                 execute energy_denominator   tbjbjbj(b,ib,b1,jb,b2,kb)
                 t2bbbjjj(b,b1,b2,jb,ib,kb) = tbjbjbj(b,ib,b1,jb,b2,kb)
                 tqqq(b,b1,b2)              = t2bbbjjj(b,b1,b2,jb,ib,kb) 
#
                 etemp                      = Y3bbb(b,b1,b2)*tqqq(b,b1,b2)
                #etemp *= 3.0 
                 tIJb(ib,ib) = etemp 
                 PUT Dj(ib,ib) += tIJb(ib,ib)
#
           DO bi  
#
                 GET               IBb(bi,b) 
                 IbS(b,bi)       = IBb(bi,b) 
                 sSbb(bi,b1,b2)  = Y3bbb(b,b1,b2)*IbS(b,bi) 
                 s1Sbb(bi,b1,b2) = tqqq(b,b1,b2)*IbS(b,bi) 
                 etemp           = sSbb(bi,b1,b2)*s1Sbb(bi,b1,b2)  
                 tuu(bi,bi)     = etemp 
                #tuu(bi,bi) *= 3.0  
                 PUT DbS(bi,bi) += tuu(bi,bi) 
#
           ENDDO bi  
#
           ENDPARDO b, b1, b2 # ib, jb, kb  
#
           execute server_barrier
           execute sip_barrier
#
           DELETE D3bbb  
           DELETE E3bbb  
           DELETE X3bbb  
           DELETE Y3bbb  
#
          #delete D1bSbS(*,ib,*,kb) 
           delete D1bb 
          #delete D2bSbS(*,jb,*,kb) 
           delete D2bb 
           delete D2bjbS(*,*,*,kb) 
           delete Pbbbk(*,*,*,kb)  
          #ENDIF # kb >=j 
           ENDDO kb # segment size of 1  
#
	execute sip_barrier 
	execute server_barrier 
#
#    alpha/beta/beta/ block.
#    ------------------------
#
	DO k # segment size of 1  
#
	   create X3bba 
	   create Y3bba 
	   create D3bba 
	   create E3bba 
	   create Pbbak(*,*,*,k) 
	   create EaSbj(*,k,*,*) 
	  #create EaSbS(*,k,*,ib) 
	  #create E1aSbS(*,k,*,jb) 
	   create Eab
	   create E1ab
	   execute sip_barrier 
	   PARDO a, b1, b  
		 PREQUEST tqqps(b,b1,a,k) = Vbbai(b,b1,a,i1) 
		 PUT Pbbak(b,b1,a,k)      = tqqps(b,b1,a,k) 
	   ENDPARDO a, b1, b  
           PARDO a, b, j1 
                 PREQUEST tpsqq(a,k,b,j1) = T2aibj(a,i1,b,j1) 
                 PUT EaSbj(a,k,b,j1)       = tpsqq(a,k,b,j1) 
           ENDPARDO a, b, j1 
           PARDO a, b 
                 PREQUEST tpsqs(a,k,b,ib)  = T2aibj(a,i1,b,j1) 
                 tpqij(a,b,k,ib)           = tpsqs(a,k,b,ib) 
                 tpq(a,b)                  = tpqij(a,b,k,ib)
                 PUT Eab(a,b)              = tpq(a,b) 
                #PUT EaSbS(a,k,b,ib)       = tpsqs(a,k,b,ib) 
           ENDPARDO a, b 
           PARDO a, b 
                 PREQUEST t1psqs(a,k,b,jb) = T2aibj(a,i1,b,j1) 
                 tpqij(a,b,k,jb)           = t1psqs(a,k,b,jb) 
                 tpq(a,b)                  = tpqij(a,b,k,jb)
                 PUT E1ab(a,b)              = tpq(a,b) 
                #PUT E1aSbS(a,k,b,jb)      = t1psqs(a,k,b,jb) 
           ENDPARDO a, b 
           execute sip_barrier 
#
#       Loop 1 
#       ------ 
#
#            (-1) 
#            ---- 
#
	     PARDO a, b, a2, b1 

		 IF b <= b1 
#
		  #GET E1aSbS(a2,k,b,jb) 
		   GET E1ab(a2,b) 
		   GET Paabi(a,a2,b1,ib) 
#
		  #t2pqij(a2,b,k,jb) = E1aSbS(a2,k,b,jb) 
		  #tpq(a2,b)         = t2pqij(a2,b,k,jb)

		   tqqaj(b,b1,a,ib)  = Paabi(a,a2,b1,ib)*E1ab(a2,b) 
		   tqqa(b,b1,a)      = tqqaj(b,b1,a,ib) 
		   tqqa(b,b1,a)     *= -1.0 
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, a2, b1 
	     execute sip_barrier 
#
#            ( P_ij ) 
#            -------- 
#
	     PARDO a, b, a2, b1 
#
		 IF b <= b1 
#
		  #GET EaSbS(a2,k,b,ib) 
		   GET Paabj(a,a2,b1,jb) 
		   GET Eab(a2,b) 
#
		  #t2pqij(a2,b,k,ib) = EaSbS(a2,k,b,ib) 
		  #tpq(a2,b)         = t2pqij(a2,b,k,ib)
#
		   tqqaj(b,b1,a,jb)  = Paabj(a,a2,b1,jb)*Eab(a2,b) 
		   tqqa(b,b1,a)      = tqqaj(b,b1,a,jb)  
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, a2, b1 
	     execute sip_barrier 
#
#            ( P_b b1) 
#            --------- 
#
	     PARDO a, b, a2, b1 
#
		 IF b <= b1 
#
		  #GET E1aSbS(a2,k,b1,jb) 
		   GET E1ab(a2,b1) 
		   GET Paabi(a,a2,b,ib) 
#
		  #t2pqij(a2,b1,k,jb) = E1aSbS(a2,k,b1,jb) 
		  #tpq(a2,b1)         = t2pqij(a2,b1,k,jb)

		   tqqaj(b,b1,a,ib)  = Paabi(a,a2,b,ib)*E1ab(a2,b1) 
		   tqqa(b,b1,a)      = tqqaj(b,b1,a,ib)   
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, a2, b1 
	     execute sip_barrier 
#
#            (- P_ij P_b b1) 
#            --------------- 
#
	     PARDO a, b, a2, b1 
#
		 IF b <= b1 
#
		  #GET EaSbS(a2,k,b1,ib) 
		   GET Eab(a2,b1) 
		   GET Paabj(a,a2,b,jb) 
#
		  #t2pqij(a2,b1,k,ib) = EaSbS(a2,k,b1,ib) 
		  #tpq(a2,b1)         = t2pqij(a2,b1,k,ib)
#
		   tqqaj(b,b1,a,jb)  = Paabj(a,a2,b,jb)*Eab(a2,b1) 
		   tqqa(b,b1,a)      = tqqaj(b,b1,a,jb)   
		   tqqa(b,b1,a)     *= -1.0 
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, a2, b1 
	     execute sip_barrier 
#
# Loop 2 
# -------
#
#            (1) 
#            --- 
#
	     PARDO a, b, i1, b1 
#
		 IF b <= b1 
#
		   GET EaibS(a,i1,b1,ib) 
		   GET Xiibj(i1,k,b,jb) 
#
		   tbiji(b,i1,jb,k) = Xiibj(i1,k,b,jb)
		   tqp(b,i1)        = tbiji(b,i1,jb,k) 
		   tqqaj(b,b1,a,ib) = EaibS(a,i1,b1,ib)*tqp(b,i1) 
		   tqqa(b,b1,a)     = tqqaj(b,b1,a,ib)
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, i1, b1 
	     execute sip_barrier 
#
#            (-P_ij ) 
#            -------- 
#
	     PARDO a, b, i1, b1 
#
		 IF b <= b1 
#
		   GET E1aibS(a,i1,b1,jb) 
		   GET Xiibj(i1,k,b,ib) 
#
		   tbiji(b,i1,ib,k) = Xiibj(i1,k,b,ib)
		   tqp(b,i1)        = tbiji(b,i1,ib,k) 
		   tqqaj(b,b1,a,jb) = E1aibS(a,i1,b1,jb)*tqp(b,i1) 
		   tqqa(b,b1,a)     = tqqaj(b,b1,a,jb)
		   tqqa(b,b1,a)    *= -1.0  
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, i1, b1 
	     execute sip_barrier 
#
#            (-P_b b1) 
#            ---------  
#
	     PARDO a, b, i1, b1 
#
		 IF b <= b1 
#
		   GET EaibS(a,i1,b,ib) 
		   GET Xiibj(i1,k,b1,jb) 
#
		   tbiji(b1,i1,jb,k) = Xiibj(i1,k,b1,jb)
		   tqp(b1,i1)        = tbiji(b1,i1,jb,k) 
		   tqqaj(b,b1,a,ib) = EaibS(a,i1,b,ib)*tqp(b1,i1) 
		   tqqa(b,b1,a)     = tqqaj(b,b1,a,ib)
		   tqqa(b,b1,a)    *= -1.0  
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, i1, b1 
	     execute sip_barrier 
#
#            (P_ij P_b b1) 
#            ------------- 
#
	     PARDO a, b, i1, b1 
#
		 IF b <= b1 
#
		   GET E1aibS(a,i1,b,jb) 
		   GET Xiibj(i1,k,b1,ib) 
#
		   tbiji(b1,i1,ib,k) = Xiibj(i1,k,b1,ib)
		   tqp(b1,i1)        = tbiji(b1,i1,ib,k) 
		   tqqaj(b,b1,a,jb) = E1aibS(a,i1,b,jb)*tqp(b1,i1) 
		   tqqa(b,b1,a)     = tqqaj(b,b1,a,jb)
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, i1, b1 
	     execute sip_barrier 
#
# Loop 3 
# ------- 
#
	     PARDO a, b, b1, b2 
#
		 IF b <= b1 
#
		  #GET DbSbS(b,jb,b2,ib) 
		   GET Dbb(b,b2) 
		   GET Pbbak(b1,b2,a,k) 
#
		  #t2bbji(b,b2,jb,ib) = DbSbS(b,jb,b2,ib) 
		  #tqq(b,b2)          = t2bbji(b,b2,jb,ib) 
#
		   tqqai(b,b1,a,k)  = Pbbak(b1,b2,a,k)*Dbb(b,b2)  
		   tqqai(b,b1,a,k) *= -1.0  
		   tqqa(b,b1,a) = tqqai(b,b1,a,k)   
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, b1, b2 
	     execute sip_barrier 
#
#           (-b->b1)
#           -------- 
#
	     PARDO a, b, b1, b2 
#
		 IF b <= b1 
#
		  #GET DbSbS(b1,jb,b2,ib) 
		   GET Dbb(b1,b2) 
		   GET Pbbak(b,b2,a,k) 
#
		  #t2bbji(b1,b2,jb,ib) = DbSbS(b1,jb,b2,ib) 
		  #tqq(b1,b2)          = t2bbji(b1,b2,jb,ib) 
#
		   tqqai(b,b1,a,k)  = Pbbak(b,b2,a,k)*Dbb(b1,b2)  
		   tqqa(b,b1,a) = tqqai(b,b1,a,k)   
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, b1, b2 
	     execute sip_barrier 
#
# Loop 4 
# ------ 
#
	     PARDO a, b, b1, b2 
#
		 IF b <= b1 
#
		  #GET E1aSbS(a,k,b2,jb) 
		   GET E1ab(a,b2) 
		   GET Pbbbi(b,b2,b1,ib) 
#
		  #t2abij(a,b2,k,jb) = E1aSbS(a,k,b2,jb)
		  #tpq(a,b2) = t2abij(a,b2,k,jb)

		   tqqaj(b,b1,a,ib) = Pbbbi(b,b2,b1,ib)*E1ab(a,b2)  
		   tqqaj(b,b1,a,ib)*= -1.0 
		   tqqa(b,b1,a) = tqqaj(b,b1,a,ib)   
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, b1, b2 
	     execute sip_barrier 
#
#            (-i-<j) 
#            ------- 
#
	     PARDO a, b, b1, b2 
#
		 IF b <= b1 
#
		  #GET EaSbS(a,k,b2,ib) 
		   GET Eab(a,b2) 
		   GET Pbbbj(b,b2,b1,jb) 
#
		  #t2abij(a,b2,k,ib) = EaSbS(a,k,b2,ib)
		  #tpq(a,b2) = t2abij(a,b2,k,ib)
#
		   tqqaj(b,b1,a,jb) = Pbbbj(b,b2,b1,jb)*Eab(a,b2)  
		   tqqa(b,b1,a) = tqqaj(b,b1,a,jb)   
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, b1, b2 
	     execute sip_barrier 
#
# Loop 5 
# ------ 
#
	     PARDO a, b, b1, j1 
#
		 IF b <= b1 
#
		   GET EaSbj(a,k,b1,j1) 
		   GET XSbJjJ(b,jb,j1,ib)   
#
		   tqqjj(b,j1,jb,ib) = XSbJjj(b,jb,j1,ib) 
		   tqq(b,j1) = tqqjj(b,j1,jb,ib)
		   tqqai(b,b1,a,k) = EaSbj(a,k,b1,j1)*tqq(b,j1) 
		   tqqa(b,b1,a) = tqqai(b,b1,a,k)   
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, b1, j1 
	     execute sip_barrier 
#
#            (-b->b1) 
#            -------- 
#
	     PARDO a, b, b1, j1 
#
		 IF b <= b1 
#
		   GET EaSbj(a,k,b,j1) 
		   GET XSbJjJ(b1,jb,j1,ib) 
#
		   tqqjj(b1,j1,jb,ib) = XSbJjJ(b1,jb,j1,ib) 
		   tqq(b1,j1) = tqqjj(b1,j1,jb,ib)
		   tqqai(b,b1,a,k) = EaSbj(a,k,b,j1)*tqq(b1,j1) 
		   tqqa(b,b1,a) = tqqai(b,b1,a,k)   
		   tqqa(b,b1,a) *= -1.0  
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, b1, j1 
	     execute sip_barrier 
#
# Loop 6 
# ------ 
#
	     PARDO a, b, b1, j1 
#
		 IF b <= b1 
#
		   GET DbjbS(b,j1,b1,ib) 
		   GET Xaijj(a,k,j1,jb) 
#
		   t2ajij(a,j1,k,jb) = Xaijj(a,k,j1,jb) 
		   tpq(a,j1) = t2ajij(a,j1,k,jb)
		   tqqaj(b,b1,a,ib) = DbjbS(b,j1,b1,ib)*tpq(a,j1) 
		   tqqa(b,b1,a) = tqqaj(b,b1,a,ib)   
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, b1, j1 
	     execute sip_barrier 
#
#            (-P_ij) 
#            ------- 
#
	     PARDO a, b, b1, j1 
#
		 IF b <= b1 
#
		   GET D1bjbS(b,j1,b1,jb) 
		   GET Xaijj(a,k,j1,ib) 
#
		   t2ajij(a,j1,k,ib) = Xaijj(a,k,j1,ib) 
		   tpq(a,j1) = t2ajij(a,j1,k,ib)
		   tqqaj(b,b1,a,jb) = D1bjbS(b,j1,b1,jb)*tpq(a,j1) 
		   tqqa(b,b1,a) = tqqaj(b,b1,a,jb)   
		   tqqa(b,b1,a) *= -1.0  
		   PUT X3bba(b,b1,a) += tqqa(b,b1,a) 
#
		 ENDIF 
#
	     ENDPARDO a, b, b1, j1 
	     execute sip_barrier 
#
#      Compute disconnected contribution to the amplitude 
#      -------------------------------------------------- 
#
           PARDO a, b1, b 
#
                 IF b <= b1 
#
                #PREQUEST tpk(a,k)         = t1a_old(a,i1)  
                 PREQUEST P1bjbj(b,ib,b1,jb) = VSqjqj(b,j1,b1,j2) 
                 GET t1ai(a,k)     
#
                 tqqjj(b,b1,ib,jb) = P1bjbj(b,ib,b1,jb)
                 tqq(b,b1) = tqqjj(b,b1,ib,jb) 
#
                 tqqpi(b,b1,a,k) = tqq(b,b1)^t1ai(a,k) 
                 tqqa(b,b1,a) = tqqpi(b,b1,a,k) 
                 PUT D3bba(b,b1,a) += tqqa(b,b1,a)
#
                 ENDIF
#
           ENDPARDO a, b1, b
           execute sip_barrier 
#
#          (1) 
#          --- 
#
           PARDO b, b1, a 
#
                 IF b <= b1 
#
                #PREQUEST tqi(b,ib)         = t1b_old(b,j1)  
                 PREQUEST P1aibj(a,k,b1,jb) = Vpiqj(a,i1,b1,j1) 
                 GET t1bj(b,ib)   
#
                 tqpij(b1,a,k,jb)   = P1aibj(a,k,b1,jb)
                 tqp(b1,a)          = tqpij(b1,a,k,jb) 
#
                 tqqpj(b,b1,a,ib)   = tqp(b1,a)^t1bj(b,ib) 
                 tqqa(b,b1,a)       = tqqpj(b,b1,a,ib) 
                 PUT D3bba(b,b1,a) += tqqa(b,b1,a) 
#
                 ENDIF 
#
           ENDPARDO b, b1, a 
           execute sip_barrier 
#
#          (-P_ij) 
#          ------- 
#
           PARDO b, b1, a 
#
                 IF b <= b1 
#
                #PREQUEST tqj(b,jb)         = t1b_old(b,j1)  
                 PREQUEST P2aibj(a,k,b1,ib) = Vpiqj(a,i1,b1,j1) 
                 GET t1bj(b,jb)  
#
                 tqpij(b1,a,k,ib)   = P2aibj(a,k,b1,ib)
                 tqp(b1,a)          = tqpij(b1,a,k,ib) 
#
                 tqqpj(b,b1,a,jb)   = tqp(b1,a)^t1bj(b,jb) 
                 tqqa(b,b1,a)       = tqqpj(b,b1,a,jb) 
                 tqqa(b,b1,a)      *= -1.0  
                 PUT D3bba(b,b1,a) += tqqa(b,b1,a) 
#
                 ENDIF 
#
           ENDPARDO b, b1, a 
           execute sip_barrier 
#
#          (-P_b b1) 
#          --------- 
#
           PARDO b1, b, a 
#
                 IF b <= b1 
#
                #PREQUEST tqi(b1,ib)        = t1b_old(b1,j1)  
                 PREQUEST P3aibj(a,k,b,jb) = Vpiqj(a,i1,b,j1) 
                 GET t1bj(b1,ib)    
#
                 tqpij(b,a,k,jb)   = P3aibj(a,k,b,jb)
                 tqp(b,a)          = tqpij(b,a,k,jb) 
#
                 tqqpj(b,b1,a,ib)   = tqp(b,a)^t1bj(b1,ib) 
                 tqqa(b,b1,a)       = tqqpj(b,b1,a,ib) 
                 tqqa(b,b1,a)      *= -1.0  
                 PUT D3bba(b,b1,a) += tqqa(b,b1,a) 
#
                 ENDIF 
#
           ENDPARDO b1, b, a 
           execute sip_barrier 
#
#          (P_ij P_b b1) 
#          ------------- 
#
           PARDO b1, b, a 
#
                 IF b <= b1 
#
                #PREQUEST tqj(b1,jb)         = t1b_old(b1,j1)  
                 PREQUEST P4aibj(a,k,b,ib) = Vpiqj(a,i1,b,j1) 
                 GET t1bj(b1,jb)  
#
                 tqpij(b,a,k,ib)   = P4aibj(a,k,b,ib)
                 tqp(b,a)          = tqpij(b,a,k,ib) 
#
                 tqqpj(b,b1,a,jb)   = tqp(b,a)^t1bj(b1,jb) 
                 tqqa(b,b1,a)       = tqqpj(b,b1,a,jb) 
                 PUT D3bba(b,b1,a) += tqqa(b,b1,a) 
#
                 ENDIF 
#
           ENDPARDO b1, b, a 
           execute sip_barrier 
#
# Symmetrize amplitude array 
# --------------------------- 
#
	   PARDO b, b1, a  
#
		 IF b <= b1 
#
		    GET                 X3bba(b,b1,a) 
		    tqqp(b1,b,a)      = X3bba(b,b1,a) 
		    tqqp(b1,b,a)     *= -1.0  

		    PUT Y3bba(b,b1,a) = X3bba(b,b1,a)  
		    PUT Y3bba(b1,b,a) = tqqp(b1,b,a)  
#
		 ENDIF 
#
	   ENDPARDO b, b1, a  
#
	   PARDO b, b1, a  
#
		 IF b <= b1 
#
		    GET                 D3bba(b,b1,a) 
		    tqqp(b1,b,a)      = D3bba(b,b1,a) 
		    tqqp(b1,b,a)     *= -1.0  

		    PUT E3bba(b,b1,a) = D3bba(b,b1,a)  
		    PUT E3bba(b1,b,a) = tqqp(b1,b,a)  
#
		 ENDIF 
#
	   ENDPARDO b, b1, a  
	   execute sip_barrier 
#
# Compute the contribution to the energy 
# -------------------------------------- 
#
	     PARDO a, b, b1 
#
		   GET Y3bba(b,b1,a) 
		   GET E3bba(b,b1,a) 
		   Tbbajji(b,b1,a,ib,jb,k) = Y3bba(b,b1,a) 
		   tbjbjai(b,ib,b1,jb,a,k) = Tbbajji(b,b1,a,ib,jb,k) 
		   execute energy_denominator tbjbjai(b,ib,b1,jb,a,k)
		   t1bbajji(b,b1,a,ib,jb,k) = tbjbjai(b,ib,b1,jb,a,k)
		   t1bba(b,b1,a) = t1bbajji(b,b1,a,ib,jb,k) 

                   tbba(b,b1,a) = Y3bba(b,b1,a) 
                   tbba(b,b1,a)+= E3bba(b,b1,a) 
		   etemp = tbba(b,b1,a)*t1bba(b,b1,a) 
		   etemp = etemp/4.0 
		   esum1 += etemp 
#
	     ENDPARDO a, b, b1 
#
# Form the contribution to Sbbjj 
# ------------------------------ 
#
           PARDO b, b1, a 
#
                 GET                        Y3bba(b,b1,a)
                 GET                        E3bba(b,b1,a)
                 tqqp(b,b1,a)             = Y3bba(b,b1,a) 
                 tqqp(b,b1,a)            *= 2.0  
                 tqqp(b,b1,a)            += E3bba(b,b1,a) 

                 T1bbajji(b,b1,a,ib,jb,k) = tqqp(b,b1,a) 
                 tbjbjai(b,ib,b1,jb,a,k)  = T1bbajji(b,b1,a,ib,jb,k)
                 execute energy_denominator tbjbjai(b,ib,b1,jb,a,k)  
                 tbbaijj(b,b1,a,k,jb,ib)  = tbjbjai(b,ib,b1,jb,a,k)
                 t1qqpi(b,b1,a,k)         = Tbbaijj(b,b1,a,k,jb,ib)
#
                 DO b3 
#
                    GET                        Pbbak(b1,b3,a,k) 
#
                    tqq(b,b3)                  = t1qqpi(b,b1,a,k)*Pbbak(b1,b3,a,k)  
                   #tqq(b,b3)                 *= 0.5
                    tqqjj(b,b3,ib,jb)          = tqq(b,b3)
                    Sqqjj(b3,b,ib,jb)         = tqqjj(b,b3,ib,jb)
                    Sqqjj(b3,b,ib,jb)        *= -1.0 
#
                    PREPARE Sbbjj(b,b3,ib,jb) += tqqjj(b,b3,ib,jb)  
                    PREPARE Sbbjj(b3,b,ib,jb) += Sqqjj(b3,b,ib,jb)  
#
                 ENDDO b3 
#
                 DO lb 
#
                   #PREQUEST tIIbJ(lb,jb,a,k) = Vpiqj(j1,j2,a,i1) 
                    PREQUEST taIJJ(a,k,lb,jb) = Vpiqj(a,i1,j1,j2) 
#
                    tpi(a,k)                   = taIJJ(a,k,lb,jb)
                    tqq(b,b1)                  = t1qqpi(b,b1,a,k)*tpi(a,k) 
                   #tqq(b,b1)                 *= -0.5 
                    tqq(b,b1)                 *= -1.0 
                    tqqjj(b,b1,ib,lb)          = tqq(b,b1) 
                    Sqqjj(b,b1,lb,ib)         = tqq(b,b1) 
                    Sqqjj(b,b1,lb,ib)        *= -1.0 
#
                    PREPARE Sbbjj(b,b1,ib,lb) += tqqjj(b,b1,ib,lb)  
                    PREPARE Sbbjj(b,b1,lb,ib) += Sqqjj(b,b1,lb,ib)  
#
                 ENDDO lb 
#
           ENDPARDO b, b1, a 
#
# Form the contribution to Sabij 
# ------------------------------ 
#
           PARDO b, b1, a 
#
                 GET                        Y3bba(b,b1,a)
                 GET                        E3bba(b,b1,a)
                 tqqp(b,b1,a)             = Y3bba(b,b1,a) 
                 tqqp(b,b1,a)            *= 2.0  
                 tqqp(b,b1,a)            += E3bba(b,b1,a) 

                 T1bbajji(b,b1,a,ib,jb,k) = tqqp(b,b1,a) 
                 tbjbjai(b,ib,b1,jb,a,k)  = T1bbajji(b,b1,a,ib,jb,k)
                 execute energy_denominator tbjbjai(b,ib,b1,jb,a,k)  
                 tbbajji(b,b1,a,jb,ib,k)  = tbjbjai(b,ib,b1,jb,a,k)
                 t1qqpj(b,b1,a,jb)        = Tbbajji(b,b1,a,jb,ib,k)
#
                 DO b2 
# 
                    GET                         Pbbbj(b,b2,b1,jb) 
                    tpq(a,b2)                 = t1qqpj(b,b1,a,jb)*Pbbbj(b,b2,b1,jb) 
                    tpq(a,b2)                *= 0.5 
                    tpqij(a,b2,k,ib)          = tpq(a,b2) 
                    PREPARE Sabij(a,b2,k,ib) += tpqij(a,b2,k,ib) 
# 
                 ENDDO b2 
#
                 DO a1 
#
                    GET                         Paabj(a,a1,b1,jb) 
                    tpq(a1,b)                 = Paabj(a,a1,b1,jb)*t1qqpj(b,b1,a,jb) 
                   #tpq(a1,b)                *= 0.5 
                    tpqij(a1,b,k,ib)          = tpq(a1,b) 
                    PREPARE Sabij(a1,b,k,ib) += tpqij(a1,b,k,ib)  
#
                 ENDDO a1 
#
                 DO lb 
#
                    PREQUEST TbJJJ(b1,jb,lb,ib) = VSqjqj(b1,j1,j2,j3) 
                    tqj(b1,jb)                  = TbJJJ(b1,jb,lb,ib) 
                    tpq(a,b)                    = t1qqpj(b,b1,a,jb)*tqj(b1,jb)  
                    tpq(a,b)                   *= -0.5 
                    tpqij(a,b,k,lb)             = tpq(a,b)  
                    PREPARE Sabij(a,b,k,lb)    += tpqij(a,b,k,lb) 
#
                 ENDDO lb 
#
                 DO l 
#
                    PREQUEST TIIbJ(l,k,b1,jb) = Vpiqj(i1,i2,b1,j1)  
                    TbJII(b1,jb,l,k)          = TIIbJ(l,k,b1,jb)  
                    tqj(b1,jb)                = TbJII(b1,jb,l,k)
                    tpq(a,b)                  = t1qqpj(b,b1,a,jb)*tqj(b1,jb)  
                   #tpq(a,b)                  *= -0.5 
                    tpq(a,b)                  *= -1.0 
                    tpqij(a,b,l,ib)            = tpq(a,b)  
                    PREPARE Sabij(a,b,l,ib)   += tpqij(a,b,l,ib) 
#
                 ENDDO l 
#
           ENDPARDO b, b1, a 
#
# Compute the contribution to Sai
# -------------------------------
#
             PARDO a, b1, b2
#
                   PREQUEST P4bjbj(b1,ib,b2,jb) = VSqjqj(b1,j1,b2,j2)
                   GET Y3bba(b1,b2,a)
                   Tbbajji(b1,b2,a,ib,jb,k) = Y3bba(b1,b2,a)
                   taibjbj(a,k,b1,ib,b2,jb) = Tbbajji(b1,b2,a,ib,jb,k)
                   execute energy_denominator taibjbj
                   t1abbijj(a,b1,b2,k,ib,jb) = taibjbj(a,k,b1,ib,b2,jb)
#
                   t1pqqi(a,b1,b2,k) = t1abbijj(a,b1,b2,k,ib,jb)
                   t2qqjj(b1,b2,ib,jb) = P4bjbj(b1,ib,b2,jb)
                   tqq(b1,b2) = t2qqjj(b1,b2,ib,jb)
#
                   xai(a,k) = t1pqqi(a,b1,b2,k)*tqq(b1,b2)
                   xai(a,k) *= 2.0
                   PUT sai(a,k) += xai(a,k)
#
             ENDPARDO a, b1, b2
#
# Compute the contribution to Sbj
# -------------------------------
#
#            PERM 1
#            ------
#
             PARDO b, b1, a
#
                      PREQUEST P1aibj(a,k,b1,jb) = Vpiqj(a,i1,b1,j1)
                      GET Y3bba(b,b1,a)
                      Tbbajji(b,b1,a,ib,jb,k) = Y3bba(b,b1,a)
                      tbjbjai(b,ib,b1,jb,a,k) = Tbbajji(b,b1,a,ib,jb,k)
                      execute energy_denominator tbjbjai(b,ib,b1,jb,a,k)
                      t1bbajji(b,b1,a,ib,jb,k) = tbjbjai(b,ib,b1,jb,a,k)
#
                      tqqpj(b,b1,a,ib) = t1bbajji(b,b1,a,ib,jb,k)
                      tpqij(a,b1,k,jb) = P1aibj(a,k,b1,jb)
                      tpq(a,b1) = tpqij(a,b1,k,jb)
#
                      xbj(b,ib) = tqqpj(b,b1,a,ib)*tpq(a,b1)
                      xbj(b,ib) *= 4.0
                      PUT sbj(b,ib) += xbj(b,ib)
#
             ENDPARDO b, b1, a
#
           execute sip_barrier
#
#            PERM 2
#            ------
#
             PARDO b1, b, a
#
                      PREQUEST P2aibj(a,k,b,ib) = Vpiqj(a,i1,b,j1)
                      GET Y3bba(b,b1,a)
                      Tbbajji(b,b1,a,jb,ib,k) = Y3bba(b,b1,a)
                      tbjbjai(b,jb,b1,ib,a,k) = Tbbajji(b,b1,a,jb,ib,k)
                      execute energy_denominator tbjbjai(b,jb,b1,ib,a,k)
                      t1bbajji(b,b1,a,jb,ib,k) = tbjbjai(b,jb,b1,ib,a,k)
#
                      tqqpj(b,b1,a,jb) = t1bbajji(b,b1,a,jb,ib,k)
                      tpqij(a,b,k,ib) = P2aibj(a,k,b,ib)
                      tpq(a,b) = tpqij(a,b,k,ib)
#
                      xbj(b1,jb) = tqqpj(b,b1,a,jb)*tpq(a,b)
                      xbj(b1,jb) *= 4.0
                      PUT sbj(b1,jb) += xbj(b1,jb)
#
             ENDPARDO b1, b, a  
#
           execute sip_barrier 
           execute server_barrier 
#
# Form contributions to two-particle density 
# ------------------------------------------ 
#
           PARDO b, b1, a # ib, jb, k  
#
                 GET                        Y3bba(b,b1,a)
                 GET                        E3bba(b,b1,a)
                 tqqp(b,b1,a)             = Y3bba(b,b1,a)
                 tqqp(b,b1,a)            *= 2.0
                 tqqp(b,b1,a)            += E3bba(b,b1,a)

                 T1bbajji(b,b1,a,ib,jb,k)  = tqqp(b,b1,a)
                 tbjbjai(b,ib,b1,jb,a,k)   = T1bbajji(b,b1,a,ib,jb,k)
                 execute energy_denominator tbjbjai(b,ib,b1,jb,a,k)
                 tbbjaai(b,b1,a,jb,ib,k)   = tbjbjai(b,ib,b1,jb,a,k)
                 tqqp(b,b1,a)             = tbbjaai(b,b1,a,jb,ib,k)  
#
# Form contribution to Gbbbj 
# -------------------------- 
#
                 t1qqpj(b,b1,a,jb)         = tqqp(b,b1,a)  
#
                 DO b2 
#
                    PREQUEST tpiqj(a,k,b2,ib) = T2aibj(a,i1,b2,j1)
                    tqpji(b2,a,ib,k)          = tpiqj(a,k,b2,ib) 
                    tqp(b2,a)                 = tqpji(b2,a,ib,k) 
                    tqqqq(b,b2,b1,jb)          = t1qqpj(b,b1,a,jb)*tqp(b2,a) 
                    tqqqq(b,b2,b1,jb)         *= 0.5 # -0.25  
                    PREPARE Gbbbj(b,b2,b1,jb)     += tqqqq(b,b2,b1,jb) 
#
                 ENDDO b2 
#
# Form contribution to Gbbai 
# -------------------------- 
#
                 t1qqpi(b,b1,a,k)         = tqqp(b,b1,a)  
#
                 DO b2 
#
                    PREQUEST t2qjqj(b2,ib,b1,jb) = T2bjbj(b2,j1,b1,j2)  
                    tqqjj(b2,b1,ib,jb)          = t2qjqj(b2,ib,b1,jb) 
                    tqq(b2,b1)                = tqqjj(b2,b1,ib,jb) 
                    tqqpi(b,b2,a,k)          = t1qqpi(b,b1,a,k)*tqq(b2,b1) 
                    tqqpi(b,b2,a,k)         *= 0.25 # -0.25  
                    PREPARE Gbbai(b,b2,a,k)     += tqqpi(b,b2,a,k)
#
                 ENDDO b2 
#
# Form contribution to Gaabj 
# -------------------------- 
#
                 t1qqpj(b,b1,a,ib)         = tqqp(b,b1,a)  
#
                 DO a1 
#
                    PREQUEST t1piqj(a1,k,b1,jb) = T2aibj(a1,i1,b1,j1) 
                    tpqij(a1,b1,k,jb)          = t1piqj(a1,k,b1,jb)
                    tpq(a1,b1)                 = tpqij(a1,b1,k,jb) 
                    t1ppqj(a,a1,b,ib)           = t1qqpj(b,b1,a,ib)*tpq(a1,b1)  
                    t1ppqj(a,a1,b,ib)          *= 0.5 # 0.25  
                    PREPARE Gaabj(a,a1,b,ib)       += t1ppqj(a,a1,b,ib) 
#
                 ENDDO a1 
#
# Form contribution to Gbjjj  
# -------------------------- 
#
                 t1qqpj(b,b1,a,ib)         = tqqp(b,b1,a)  
#
                 DO lb 
#
                    PREQUEST t2piqj(a,k,b1,lb) = T2aibj(a,i1,b1,j1) 
                    tqpji(b1,a,lb,k)          = t2piqj(a,k,b1,lb) 
                    tqp(b1,a)                 = tqpji(b1,a,lb,k)
                    tqj(b,ib)                  = t1qqpj(b,b1,a,ib)*tqp(b1,a) 
                    tqjjj(b,ib,lb,jb)            = tqj(b,ib) 
                    tqjjj(b,ib,lb,jb)           *=-0.5 # 0.25  
                    PREPARE Gbjjj(b,ib,lb,jb)      += tqjjj(b,ib,lb,jb)  
#
                 ENDDO lb
#
# Form contribution to Gaijj  
# -------------------------- 
#
                 t1qqpi(b,b1,a,k)         = tqqp(b,b1,a)  
#
                 DO kb 
#
                    PREQUEST t3qjqj(b,kb,b1,jb) = T2bjbj(b,j1,b1,j2) 
                    tqqjj(b,b1,kb,jb)          = t3qjqj(b,kb,b1,jb)  
                    tqq(b,b1)                = tqqjj(b,b1,kb,jb) 
                    tpi(a,k)                = t1qqpi(b,b1,a,k)*tqq(b,b1) 
                    tpijj(a,k,kb,ib)          = tpi(a,k) 
                    tpijj(a,k,kb,ib)         *=-0.25 # 0.25  
                    PREPARE Gaijj(a,k,kb,ib)     += tpijj(a,k,kb,ib) 
#
                 ENDDO kb 
#
# Form contribution to Gbjii  
# -------------------------- 
#
                 t1qqpj(b,b1,a,ib)         = tqqp(b,b1,a)  
#
                 DO l 
#
                    PREQUEST t4aibj(a,l,b1,jb) = T2aibj(a,i1,b1,j1)  
                    tqpji(b1,a,jb,l)          = t4aibj(a,l,b1,jb) 
                    tqp(b1,a)                 = tqpji(b1,a,jb,l) 
                    tqj(b,ib)                  = t1qqpj(b,b1,a,ib)*tqp(b1,a) 
                    tqjii(b,ib,l,k)          = tqj(b,ib) 
                    tqjii(b,ib,l,k)         *=-0.5 # 0.25  
                    PREPARE Gbjii(b,ib,l,k)     += tqjii(b,ib,l,k) 
#
                 ENDDO l 
#
# Form contribution to Gbjbj 
# -------------------------- 
#
                 GET                        Y3bba(b,b1,a)
                 tqqp(b,b1,a)             = Y3bba(b,b1,a)

                 T1bbajji(b,b1,a,ib,jb,k)  = tqqp(b,b1,a)
                 tbjbjai(b,ib,b1,jb,a,k)   = T1bbajji(b,b1,a,ib,jb,k)
                 execute energy_denominator tbjbjai(b,ib,b1,jb,a,k)
                 tbbajji(b,b1,a,jb,ib,k)   = tbjbjai(b,ib,b1,jb,a,k)
                 tqqp(b,b1,a)             = tbbajji(b,b1,a,jb,ib,k)  
#
                 t1qqpi(b,b1,a,k)        = tqqp(b,b1,a) 
                 GET                        t1ai(a,k) 
                 tqq(b,b1)                = t1qqpi(b,b1,a,k)*t1ai(a,k) 
                 tqqjj(b,b1,ib,jb)          = tqq(b,b1) 
                 tqjqj(b,ib,b1,jb)          = tqqjj(b,b1,ib,jb)
                 tqjqj(b,ib,b1,jb)         *= 0.125  
                 PREPARE Gbjbj(b,ib,b1,jb)     += tqjqj(b,ib,b1,jb) 
#
# Form contribution to Gbjai 
# -------------------------- 
#
                 t1qqpj(b,b1,a,jb)         = tqqp(b,b1,a) 
                 GET                        t1bj(b1,jb) 
                 tqp(b,a)                 = t1qqpj(b,b1,a,jb)*t1bj(b1,jb) 
                 tqpji(b,a,ib,k)          = tqp(b,a)  
                 t5piqj(a,k,b,ib)          = tqpji(b,a,ib,k)  
                 t5piqj(a,k,b,ib)         *= 0.125  
                 PREPARE Gaibj(a,k,b,ib)     += t5piqj(a,k,b,ib) 
#
# Done forming contributions to two-particle density 
# -------------------------------------------------- 
#
# Form contribution to Dbj 
# ------------------------ 
#
                 tqqpj(b,b1,a,ib)          = tqqp(b,b1,a) 
                 PREQUEST t3piqj(a,k,b1,jb) = T2aibj(a,i1,b1,j1)
                 tqpji(b1,a,jb,k)          = t3piqj(a,k,b1,jb)
                 tqp(b1,a)                = tqpji(b1,a,jb,k) 
                 tqj(b,ib)                  = tqqpj(b,b1,a,ib)*tqp(b1,a) 
                 tqj(b,ib)                 *= 4.0 
                 PUT Dbj(b,ib)             += tqj(b,ib) 
#
# Form contribution to Dai 
# ------------------------ 
#
                 tqqpi(b,b1,a,k)          = tqqp(b,b1,a) 
                 PREQUEST t4qjqj(b,ib,b1,jb) = T2bjbj(b,j1,b1,j2)
                 tqqjj(b,b1,ib,jb)         = t4qjqj(b,ib,b1,jb) 
                 tqq(b,b1)                 = tqqjj(b,b1,ib,jb) 
                 tpi(a,k)                 = tqqpi(b,b1,a,k)*tqq(b,b1) 
                 PUT Dai(a,k)             += tpi(a,k) 
#
           ENDPARDO b, b1, a # ib, jb, k  
#
#
           PARDO a, b, b1 # ib, jb, k  
#
                 GET             Y3bba(b,b1,a)
                 GET             E3bba(b,b1,a)
#
# Form contribution to Da 
# ----------------------- 
#
                 tqqp(b,b1,a)             = Y3bba(b,b1,a)
                 tqqp(b,b1,a)            += E3bba(b,b1,a)

                 T1bbajji(b,b1,a,ib,jb,k)  = tqqp(b,b1,a)
                 tbjbjai(b,ib,b1,jb,a,k)   = T1bbajji(b,b1,a,ib,jb,k)
                 execute energy_denominator tbjbjai(b,ib,b1,jb,a,k)
                 execute energy_denominator tbjbjai(b,ib,b1,jb,a,k)
                 tbbjaai(b,b1,a,jb,ib,k)   = tbjbjai(b,ib,b1,jb,a,k)
                 tqqp(b,b1,a)             = tbbjaai(b,b1,a,jb,ib,k)  
#
                 etemp                    = Y3bba(b,b1,a)*tqqp(b,b1,a)
#
                 tIJb(ib,ib)              = etemp 
                 tIJb(ib,ib)             *= 6.0  
                 PUT Dj(ib,ib)           += tIJb(ib,ib) 

                 etemp                   *= 3.0 
                 tIJ(k,k)                 = etemp 
                 PUT Di(k,k)             += tIJ(k,k) 
#
           DO bi  
#
                 GET               IBb(bi,b) 
                 IbS(b,bi)       = IBb(bi,b) 
                 sSba(bi,b1,a)  = Y3bba(b,b1,a)*IbS(b,bi) 
                 s1Sba(bi,b1,a) = tqqp(b,b1,a)*IbS(b,bi) 
                 etemp           = sSba(bi,b1,a)*s1Sba(bi,b1,a)  
                 tuu(bi,bi)     = etemp 
                 tuu(bi,bi) *= 6.0  
                 PUT DbS(bi,bi) += tuu(bi,bi) 
#
           ENDDO bi  
#
           DO ai 
#
                 GET              IAa(ai,a) 
                 IaS(a,ai)      = IAa(ai,a) 
                 sbbS(b,b1,ai)  = Y3bba(b,b1,a)*IaS(a,ai) 
                 s1bbS(b,b1,ai) = tqqp(b,b1,a)*IaS(a,ai) 
                 etemp          = sbbS(b,b1,ai)*s1bbS(b,b1,ai)  
                 tss(ai,ai)     = etemp 
                 tss(ai,ai)     *= 3.0  
                 PUT DaS(ai,ai) += tss(ai,ai) 
#
           ENDDO ai  
#
           ENDPARDO a, b, b1 # i, j, k 
#
           execute sip_barrier 
           execute server_barrier 
#
	  #delete EaSbS(*,k,*,ib) 
	   delete Eab 
	  #delete E1aSbS(*,k,*,jb) 
	   delete E1ab 
	   delete EaSbj(*,k,*,*) 
	   delete Pbbak(*,*,*,k) 
	   delete D3bba 
	   delete E3bba 
	   delete X3bba 
	   delete Y3bba 
#
	ENDDO k # segment size of 1  
#
        delete E1aibS(*,*,*,jb) 
       #delete DbSbS(*,jb,*,ib) 
        delete Dbb 
	delete D1bjbS(*,*,*,jb) 
	delete Pbbbj(*,*,*,jb)  
	delete Paabj(*,*,*,jb)  
       #ENDIF # i>=j 
	ENDDO jb # segment size of 1  
        delete EaibS(*,*,*,ib) 
	delete Pbbbi(*,*,*,ib)  
	delete Paabi(*,*,*,ib)  
	delete DbjbS(*,*,*,ib) 
     ENDDO ib # segment size of 1  
#
     execute server_barrier 
     execute sip_barrier
     collective ecorrbbb += esum4
     execute print_scalar ecorrbbb  
     collective ecorrbba += esum1
     execute print_scalar ecorrbba  

     esum = 0.0 
     esum = ecorrbbb 
     esum += ecorrbba 
     execute print_scalar ecorrbbb  
     execute print_scalar ecorrbba  
     execute print_scalar esum 
     totenerg += esum 
#
     ENDPROC T4BBB 
#    ------------- 
#
# --------------------------------------------------------------------------
#
     PROC ST5 
#    -------- 
#
# Compute contribution to the energy from sai 
# -------------------------------------------  
#
     esum = 0.0 
     execute sip_barrier 
     PARDO a, i 
#
	   PREQUEST Pai(a,i) = t1a_old(a,i1) 
	   GET sai(a,i) 
	   etemp = Pai(a,i)*sai(a,i) 
	   etemp *= 0.25
	   esum += etemp  
#
     ENDPARDO a, i 
#
     execute sip_barrier 
     collective ecorrsa += esum 
     execute sip_barrier 
     execute print_scalar ecorrsa  
     execute server_barrier 
#
# Compute contribution to the energy from sbj 
# ------------------------------------------- 
#
     esum = 0.0 
     execute sip_barrier 
     PARDO b, ib 
#
	   PREQUEST Pbj(b,ib) = t1b_old(b,j1) 
	   GET sbj(b,ib) 
	   etemp = Pbj(b,ib)*sbj(b,ib) 
	   etemp *= 0.25
	   esum += etemp  
#
     ENDPARDO b, ib 
#
     execute sip_barrier 
     collective ecorrsb += esum 
     execute sip_barrier 
     execute print_scalar ecorrsb  
     execute server_barrier 

     ENDPROC ST5 
#    ----------- 
#
# --------------------------------------------------------------------------
#
     PROC FORM_IDENTITY   
#    ------------------  
#
     create IIi 
     create IJj 
     create IAa 
     create IBb 
#
# Form identity arrays 
# -------------------- 
#
     DO i1 
     DO i2 
           tii(i1,i2) = 1.0 
           t1ii(i1,i2) = 0.0 
           execute return_diagonal tii t1ii  
           tpp(i1,i2) = t1ii(i1,i2) 
           PREPARE Sii(i1,i2) = tpp(i1,i2) 
     ENDDO i2 
     ENDDO i1 
#
     DO a1 
     DO a2 
           taa(a2,a1) = 1.0 
           t1aa(a2,a1) = 0.0 
           execute return_diagonal taa t1aa  
           tpp(a2,a1) = t1aa(a2,a1) 
           PREPARE Saa(a2,a1) = tpp(a2,a1) 
     ENDDO a2 
     ENDDO a1 
#
     DO b1 
     DO b2 
           tbb(b2,b1) = 1.0 
           t1bb(b2,b1) = 0.0 
           execute return_diagonal tbb t1bb  
           tqq(b2,b1) = t1bb(b2,b1) 
           PREPARE Sbb(b2,b1) = tqq(b2,b1) 
     ENDDO b2 
     ENDDO b1 
#
     DO j1 
     DO j2 
           tjj(j1,j2) = 1.0 
           t1jj(j1,j2) = 0.0 
           execute return_diagonal tjj t1jj  
           tqq(j1,j2) = t1jj(j1,j2) 
           PREPARE Sjj(j1,j2) = tqq(j1,j2) 
     ENDDO j2 
     ENDDO j1 
     execute sip_barrier 
     execute server_barrier
#
     PARDO i1, i 
#
           PREQUEST PIi(i,i1) = Sii(i2,i1) 
           PUT IIi(i,i1) = PIi(i,i1) 
#
     ENDPARDO i1, i 
#
     DO ai 
     DO a1 
#
           PAa(ai,a1) = 1.0 
           P1Aa(ai,a1) = 0.0 
           execute return_diagonal PAa P1Aa  
           TPAa(ai,a1) = P1Aa(ai,a1) 
          #PREQUEST PAa(ai,a1) = Saa(a2,a1) 
           PUT IAa(ai,a1) = TPAa(ai,a1) 
#
     ENDDO a1 
     ENDDO ai 
#
     DO bj 
     DO b1  
#
           PBb(bj,b1) = 1.0 
           P1Bb(bj,b1) = 0.0 
           execute return_diagonal PBb P1Bb  
          #PREQUEST PBb(bj,b1) = Sbb(b2,b1) 
           TPBb(bj,b1) = P1Bb(bj,b1) 
           PUT IBb(bj,b1) = TPBb(bj,b1) 
#
     ENDDO b1  
     ENDDO bj 
#
     PARDO j1, jb  
#
           PREQUEST PJj(jb,j1) = Sjj(j2,j1) 
           PUT IJj(jb,j1) = PJj(jb,j1) 
#
     ENDPARDO j1, jb  
     execute sip_barrier 
#
     ENDPROC FORM_IDENTITY   
#    ---------------------  
#
# --------------------------------------------------------------------------
#
     PROC S_PREP  
#    ----------- 
#
     create fsai 
     create fsbj 
     create DDai 
     create DDbj
     create Daa 
     create Dbb 
     create Dii 
     create Djj 
     execute sip_barrier 
#
# Form fs and DDAI arrays 
# -----------------------  
#
     PARDO a, i1 
#
           tpp(a,i1)  = 0.0 
           t1pp(a,i1) = 0.0 
#
           DO i 
#
              GET sai(a,i) 
              GET Dai(a,i) 
              GET IIi(i,i1) 
#
              t2pp(a,i1) = sai(a,i)*IIi(i,i1) 
              tpp(a,i1) += t2pp(a,i1)  
#
              t2pp(a,i1) = Dai(a,i)*IIi(i,i1) 
              t1pp(a,i1)+= t2pp(a,i1)  
#
           ENDDO i 
#
           tpp(a,i1)     *= 0.125 
           t1pp(a,i1)    *= 0.0 # 0.25  
           PUT fsai(a,i1) = tpp(a,i1) 
           PUT DDai(a,i1) = t1pp(a,i1) 
#
     ENDPARDO a, i1 
#
     PARDO b, j1 
#
           tqq(b,j1)  = 0.0 
           t1qq(b,j1) = 0.0 
#
           DO jb  
#
              GET sbj(b,jb) 
              GET Dbj(b,jb) 
              GET IJj(jb,j1) 
#
              t2qq(b,j1) = sbj(b,jb)*IJj(jb,j1) 
              tqq(b,j1) += t2qq(b,j1)  
#
              t2qq(b,j1) = Dbj(b,jb)*IJj(jb,j1) 
              t1qq(b,j1)+= t2qq(b,j1)  
#
           ENDDO jb  
#
           tqq(b,j1)     *= 0.125 
           t1qq(b,j1)    *= 0.0 # 0.25  
           PUT fsbj(b,j1) = tqq(b,j1) 
           PUT DDbj(b,j1) = t1qq(b,j1) 
#
     ENDPARDO b, j1 
     execute sip_barrier 
#
     PARDO a, a1, i1, i2 
#
          Fpppp(a,a1,i1,i2) = 0.0 
#
          DO i 
          DO j  
#
             REQUEST              Saaii(a,a1,i,j) a  
             GET                  IIi(i,i1) 
             GET                  IIi(j,i2) 
             tpppp(a,a1,i1,j)   = Saaii(a,a1,i,j)*IIi(i,i1) 
             F1pppp(a,a1,i1,i2) = tpppp(a,a1,i1,j)*IIi(j,i2) 
             Fpppp(a,a1,i1,i2) += F1pppp(a,a1,i1,i2) 
#
          ENDDO j  
          ENDDO i 
#
          F1pppp(a,i1,a1,i2)        = Fpppp(a,a1,i1,i2)
         #F1pppp(a,i1,a1,i2)       *= 2.0  
          PREPARE Saiai(a,i1,a1,i2) = F1pppp(a,i1,a1,i2)  
#
     ENDPARDO a, a1, i1, i2 
#
     PARDO b, b1, j1, j2 
#
          Fqqqq(b,b1,j1,j2) = 0.0 
#
          DO ib  
          DO jb 
#
             REQUEST              Sbbjj(b,b1,ib,jb) b  
             GET                  IJj(ib,j1) 
             GET                  IJj(jb,j2) 
             tqqqq(b,b1,j1,jb)  = Sbbjj(b,b1,ib,jb)*IJj(ib,j1) 
             F1qqqq(b,b1,j1,j2) = tqqqq(b,b1,j1,jb)*IJj(jb,j2) 
             Fqqqq(b,b1,j1,j2) += F1qqqq(b,b1,j1,j2) 
#
          ENDDO jb 
          ENDDO ib
#
          F1qqqq(b,j1,b1,j2)        = Fqqqq(b,b1,j1,j2)
         #F1qqqq(b,j1,b1,j2)       *= 2.0  
          PREPARE Sbjbj(b,j1,b1,j2) = F1qqqq(b,j1,b1,j2)  
#
     ENDPARDO b, b1, j1, j2 
#
     PARDO a, b1, i1, j2 
#
          Fpqpq(a,b1,i1,j2) = 0.0 
#
          DO i 
          DO jb  
#
             REQUEST              Sabij(a,b1,i,jb) a  
             GET                  IIi(i,i1) 
             GET                  IJj(jb,j2) 
             tpqpj(a,b1,i1,jb)   = Sabij(a,b1,i,jb)*IIi(i,i1) 
             F1pqpq(a,b1,i1,j2) = tpqpj(a,b1,i1,jb)*IJj(jb,j2) 
             Fpqpq(a,b1,i1,j2) += F1pqpq(a,b1,i1,j2) 
#
          ENDDO jb 
          ENDDO i 
#
          Fppqq(a,i1,b1,j2)         = Fpqpq(a,b1,i1,j2)
         #Fppqq(a,i1,b1,j2)        *= 2.0  
          PREPARE Saibj(a,i1,b1,j2) = Fppqq(a,i1,b1,j2)  
#
     ENDPARDO a, b1, i1, j2 
#
     execute server_barrier 
#
# Prepare virtual-virtual blocks of the one-density 
# ------------------------------------------------- 
#
#    alpha/alpha block 
#    ----------------- 
#
     PARDO a2, a1 
#
           tpp(a1,a2) = 0.0 
#
           DO ai  
           DO aj 
#
              IF ai == aj 
#
              GET           IAa(ai,a1) 
              GET           IAa(aj,a2) 
              GET           DaS(ai,aj) 
#
              tps(a1,aj)   = DaS(ai,aj)*IAa(ai,a1) 
              t1pp(a1,a2) = tps(a1,aj)*IAa(aj,a2)   
              tpp(a1,a2) += t1pp(a1,a2) 
#
              ENDIF 
#
           ENDDO aj 
           ENDDO ai 
#
           etemp          = 1.0/12.0 
           tpp(a1,a2)    *= etemp 
           PUT Daa(a1,a2) = tpp(a1,a2) 
#
     ENDPARDO a2, a1 
#
#    beta/beta block 
#    --------------- 
#
     PARDO b2, b1 
#
           tqq(b1,b2) = 0.0 
#
           DO bi  
           DO bj 
#
              IF bi == bj 
#
              GET           IBb(bi,b1) 
              GET           IBb(bj,b2) 
              GET           DbS(bi,bj) 
#
              tqs(b1,bj)  = DbS(bi,bj)*IBb(bi,b1) 
              t1qq(b1,b2) = tqs(b1,bj)*IBb(bj,b2)   
              tqq(b1,b2) += t1qq(b1,b2) 
#
              ENDIF 
#
           ENDDO bj 
           ENDDO bi 
#
           etemp          = 1.0/12.0 
           tqq(b1,b2)    *= etemp 
           PUT Dbb(b1,b2) = tqq(b1,b2) 
#
     ENDPARDO b2, b1 
#
#    alpha/alpha block 
#    ----------------- 
#
#    PARDO a, a1 
#
#          IF a == a1 
#
#          GET         Da(a,a1) 
#          tpp(a,a1) = 0.0 
#
#          t1aa(a,a1)     = 0.0
#          taa(a,a1)    = Da(a,a1)  
#          execute return_diagonal taa t1aa 
#          tpp(a,a1) = t1aa(a,a1) 
#
#          etemp         = 1.0/24.0 # 12.0 
#          tpp(a,a1)    *= etemp  
#          PUT Daa(a,a1) = tpp(a,a1) 
#
#          ENDIF 
#
#    ENDPARDO a, a1 
#
#    beta/beta block 
#    --------------- 
#
#    PARDO b, b1 
#
#          IF b == b1 
#
#          GET         Db(b,b1) 
#          tqq(b,b1) = 0.0 
#
#          t1bb(b,b1)     = 0.0
#          tbb(b,b1)    = Db(b,b1)  
#          execute return_diagonal tbb t1bb 
#          tqq(b,b1) = t1bb(b,b1) 
#
#          etemp         = 1.0/12.0 
#          tqq(b,b1)    *= 0.0 # etemp  
#          PUT Dbb(b,b1) = tqq(b,b1) 
#
#          ENDIF 
#
#    ENDPARDO b, b1 
#
# Prepare occupied-occupied blocks of the one-density 
# --------------------------------------------------- 
#
#    alpha/alpha block 
#    ----------------- 
#
     PARDO i2, i1 
#
           tpp(i1,i2) = 0.0 
#
           DO i 
           DO j 
#
              IF i == j 
#
              GET           IIi(i,i1) 
              GET           IIi(j,i2) 
              GET           Di(i,j) 
#
              tpi(i1,j)   = Di(i,j)*IIi(i,i1) 
              t1pp(i1,i2) = tpi(i1,j)*IIi(j,i2)   
              tpp(i1,i2) += t1pp(i1,i2) 
#
              ENDIF 
#
           ENDDO j 
           ENDDO i 
#
           etemp          = -1.0/12.0 
           tpp(i1,i2)    *= etemp 
           PUT Dii(i1,i2) = tpp(i1,i2) 
#
     ENDPARDO i2, i1 
#
#    beta/beta block 
#    --------------- 
#
     PARDO j2, j1 
#
           tqq(j1,j2) = 0.0 
#
           DO ib 
           DO jb  
#
              IF ib == jb 
#
              GET           IJj(ib,j1) 
              GET           IJj(jb,j2) 
              GET           Dj(ib,jb) 
#
              tqj(j1,jb)  = Dj(ib,jb)*IJj(ib,j1) 
              t1qq(j1,j2) = tqj(j1,jb)*IJj(jb,j2)   
              tqq(j1,j2) += t1qq(j1,j2) 
#
              ENDIF 
#
           ENDDO jb  
           ENDDO ib  
#
           etemp          = -1.0/12.0 
           tqq(j1,j2)    *= etemp 
           PUT Djj(j1,j2) = tqq(j1,j2) 
#
     ENDPARDO j2, j1 
#
     execute sip_barrier 
#
    #PARDO a, i1 
    #      GET DDai(a,i1) 
    #      execute dump_amp DDai 
    #ENDPARDO a, i1 
    #PARDO b, j1 
    #      GET DDbj(b,j1) 
    #      execute dump_amp DDbj  
    #ENDPARDO b, j1 
    #PARDO i2, i1 
    #      GET Dii(i2,i1) 
    #      execute dump_amp Dii(i2,i1) 
    #ENDPARDO i2, i1 
    #PARDO j2, j1 
    #      GET Djj(j2,j1) 
    #      execute dump_amp Djj(j2,j1) 
    #ENDPARDO j2, j1 
    #PARDO a2, a1 
    #      GET Daa(a2,a1) 
    #      execute dump_amp Daa(a2,a1) 
    #ENDPARDO a2, a1 
    #PARDO b2, b1 
    #      GET Dbb(b2,b1) 
    #      execute dump_amp Dbb(b2,b1) 
    #ENDPARDO b2, b1 
#
     PARDO a, a1, a2, i1  
#
          F1pppp(a,a1,a2,i1) = 0.0 
#
          DO i 
#
             REQUEST              Gaaai(a,a1,a2,i) a  
             GET                  IIi(i,i1) 
             Fpppp(a,a1,a2,i1)  = Gaaai(a,a1,a2,i)*IIi(i,i1) 
             F1pppp(a,a1,a2,i1) += Fpppp(a,a1,a2,i1) 
#
          ENDDO i 
#
          PREPARE SGaaai(a,a1,a2,i1) = F1pppp(a,a1,a2,i1)  
#
     ENDPARDO a, a1, a2, i1 
#
     PARDO b, b1, a2, i1  
#
          F1qqpp(b,b1,a2,i1) = 0.0 
#
          DO i 
#
             REQUEST              Gbbai(b,b1,a2,i) b  
             GET                  IIi(i,i1) 
             Fqqpp(b,b1,a2,i1)  = Gbbai(b,b1,a2,i)*IIi(i,i1) 
             F1qqpp(b,b1,a2,i1) += Fqqpp(b,b1,a2,i1) 
#
          ENDDO i 
#
          PREPARE SGbbai(b,b1,a2,i1) = F1qqpp(b,b1,a2,i1)  
#
     ENDPARDO b, b1, a2, i1 
#
     PARDO b, b1, b2, j1  
#
          F1qqqq(b,b1,b2,j1) = 0.0 
#
          DO jb  
#
             REQUEST              Gbbbj(b,b1,b2,jb) b  
             GET                  IJj(jb,j1) 
             Fqqqq(b,b1,b2,j1)  = Gbbbj(b,b1,b2,jb)*IJj(jb,j1) 
             F1qqqq(b,b1,b2,j1) += Fqqqq(b,b1,b2,j1) 
#
          ENDDO jb 
#
          PREPARE SGbbbj(b,b1,b2,j1) = F1qqqq(b,b1,b2,j1)  
#
     ENDPARDO b, b1, b2, j1 
#
     PARDO a, a1, b2, j1  
#
          F1ppqq(a,a1,b2,j1) = 0.0 
#
          DO jb  
#
             REQUEST              Gaabj(a,a1,b2,jb) a  
             GET                  IJj(jb,j1) 
             Fppqq(a,a1,b2,j1)  = Gaabj(a,a1,b2,jb)*IJj(jb,j1) 
             F1ppqq(a,a1,b2,j1) += Fppqq(a,a1,b2,j1) 
#
          ENDDO jb 
#
          PREPARE SGaabj(a,a1,b2,j1) = F1ppqq(a,a1,b2,j1)  
#
     ENDPARDO a, a1, b2, j1 
#
     ENDPROC S_PREP  
#    -------------- 
#
# --------------------------------------------------------------------------
#
     PROC PRINT_Gaaai 
#    ---------------- 
#
     esum1 = 0.0 
     esum2 = 0.0 
     esum3 = 0.0 
     esum4 = 0.0 
#
     PARDO a, a1, a2, i 
           REQUEST Gaaai(a,a1,a2,i) a
           etemp = Gaaai(a,a1,a2,i)*Gaaai(a,a1,a2,i)
           esum1 += etemp 
          #execute dump_block Gaaai(a,a1,a2,i) 
     ENDPARDO a, a1, a2, i 
#
     PARDO b, b1, b2, ib 
           REQUEST Gbbbj(b,b1,b2,ib) b
           etemp = Gbbbj(b,b1,b2,ib)*Gbbbj(b,b1,b2,ib)
           esum2 += etemp 
          #execute dump_block Gbbbj(b,b1,b2,ib) 
     ENDPARDO b, b1, b2, ib  
#
     PARDO a, a1, b, ib 
           REQUEST Gaabj(a,a1,b,ib) a
           etemp = Gaabj(a,a1,b,ib)*Gaabj(a,a1,b,ib) 
           esum3 += etemp 
          #execute dump_amp Gaabj(a,a1,b,ib) 
     ENDPARDO a, a1, b, ib  
#
     PARDO b, b1, a, i 
           REQUEST Gbbai(b,b1,a,i) b
           etemp = Gbbai(b,b1,a,i)*Gbbai(b,b1,a,i)
           esum4 += etemp 
          #execute dump_amp Gbbai(b,b1,a,i) 
     ENDPARDO b, b1, a, i 
#
     execute server_barrier 
     etemp = 0.0 
     collective etemp += esum1 
     execute print_scalar etemp 
     etemp = 0.0 
     collective etemp += esum2 
     execute print_scalar etemp 
     etemp = 0.0 
     collective etemp += esum3 
     execute print_scalar etemp 
     etemp = 0.0 
     collective etemp += esum4 
     execute print_scalar etemp 
#
     ENDPROC PRINT_Gaaai 
#    ------------------- 
#
# --------------------------------------------------------------------------
#
# --------------------------------------------------------------------------
#
     PROC PRINT_Gaiii 
#    ---------------- 
#
     esum1 = 0.0 
     esum2 = 0.0 
     esum3 = 0.0 
     esum4 = 0.0 
     PARDO a, i, j, k  
           REQUEST Gaiii(a,i,j,k) a
           etemp = Gaiii(a,i,j,k)*Gaiii(a,i,j,k)
           esum1 += etemp 
          #execute dump_block Gaiii(a,i,j,k) 
     ENDPARDO a, i, j, k 
#
     PARDO b, ib, jb, kb  
           REQUEST Gbjjj(b,ib,jb,kb) b
           etemp = Gbjjj(b,ib,jb,kb)*Gbjjj(b,ib,jb,kb)
           esum2 += etemp 
          #execute dump_block Gbjjj(b,ib,jb,kb) 
     ENDPARDO b, ib, jb, kb  
#
     PARDO a, i, jb, kb  
           REQUEST Gaijj(a,i,jb,kb) a
           etemp = Gaijj(a,i,jb,kb)*Gaijj(a,i,jb,kb)
           esum3 += etemp 
          #execute dump_block Gaijj(a,i,jb,kb) 
     ENDPARDO a, i, jb, kb 
#
     PARDO b, ib, j, k  
           REQUEST Gbjii(b,ib,j,k) b
           etemp = Gbjii(b,ib,j,k)*Gbjii(b,ib,j,k)
           esum4 += etemp 
          #execute dump_block Gbjii(b,ib,j,k) 
     ENDPARDO b, ib, j, k  
     execute server_barrier 
     etemp = 0.0 
     collective etemp += esum1 
     execute print_scalar etemp 
     etemp = 0.0 
     collective etemp += esum2 
     execute print_scalar etemp 
     etemp = 0.0 
     collective etemp += esum3 
     execute print_scalar etemp 
     etemp = 0.0 
     collective etemp += esum4 
     execute print_scalar etemp 
#
     ENDPROC PRINT_Gaiii  
#    ------------------- 
#
# --------------------------------------------------------------------------
#
     PROC PRINT_Gaiai 
#    ---------------- 
#
     esum1 = 0.0 
     esum2 = 0.0 
     esum3 = 0.0 
     PARDO a, i, a1, j  
           REQUEST Gaiai(a,i,a1,j) a
           etemp = Gaiai(a,i,a1,j)*Gaiai(a,i,a1,j)
           esum1 += etemp 
     ENDPARDO a, i, a1, j 
#
     PARDO b, ib, b1, jb  
           REQUEST Gbjbj(b,ib,b1,jb) b
           etemp = Gbjbj(b,ib,b1,jb)*Gbjbj(b,ib,b1,jb)
           esum2 += etemp 
     ENDPARDO b, ib, b1, jb 
#
     PARDO a, i, b1, jb  
           REQUEST Gaibj(a,i,b1,jb) a
           etemp = Gaibj(a,i,b1,jb)*Gaibj(a,i,b1,jb)
           esum3 += etemp 
     ENDPARDO a, i, b1, jb 
     execute server_barrier 
     etemp = 0.0 
     collective etemp += esum1 
     execute print_scalar etemp 
     etemp = 0.0 
     collective etemp += esum2 
     execute print_scalar etemp 
     etemp = 0.0 
     collective etemp += esum3 
     execute print_scalar etemp 
#
     ENDPROC PRINT_Gaiai  
#    ------------------- 
#
# --------------------------------------------------------------------------
#
     PROC PRINT_Dai  
#    -------------- 
#
     esum1 = 0.0 
     esum2 = 0.0 
     execute sip_barrier 
     PARDO a, i 
           GET Dai(a,i) 
           etemp = Dai(a,i)*Dai(a,i) 
           esum1 += etemp 
     ENDPARDO a, i 
#
     PARDO b, ib 
           GET Dbj(b,ib) 
           etemp = Dbj(b,ib)*Dbj(b,ib) 
           esum2 += etemp 
     ENDPARDO b, ib 
     execute sip_barrier 
     etemp = 0.0 
     collective etemp += esum1 
     execute print_scalar etemp 
     etemp = 0.0 
     collective etemp += esum2 
     execute print_scalar etemp 
#
     ENDPROC PRINT_Dai  
#    ----------------- 
#
# --------------------------------------------------------------------------
#
     PROC B3TRAN   
#    ----------- 
#
# Transform ca and cb to index basis 
# ---------------------------------- 
#
     create cai 
     create cbj
     execute sip_barrier 
#
     PARDO mu, i 
#
           txi(mu,i) = 0.0 
#
           DO i1 
#
              GET          IIi(i,i1) 
              t1xi(mu,i) = ca(mu,i1)*IIi(i,i1) 
              txi(mu,i) += t1xi(mu,i)  
#
           ENDDO i1  
#
           PUT cai(mu,i) = txi(mu,i) 
#
     ENDPARDO mu, i 
#
     PARDO mu, ib 
#
           txj(mu,ib) = 0.0 
#
           DO j1 
#
              GET          IJj(ib,j1) 
              t1xj(mu,ib) = cb(mu,j1)*IJj(ib,j1) 
              txj(mu,ib) += t1xj(mu,ib)  
#
           ENDDO j1  
#
           PUT cbj(mu,ib) = txj(mu,ib) 
#
     ENDPARDO mu, ib 
#
# Temporary control over what is used in PDCONT
# --------------------------------------------- VFL 
#
#     PARDO a, a1, a2, i 
#           tpppp(a,a1,a2,i) = 0.0 
#           PREPARE Gaaai(a,a1,a2,i) = tpppp(a,a1,a2,i) 
#     ENDPARDO a, a1, a2, i 
#
#     PARDO b, b1, b2, ib  
#           tqqqq(b,b1,b2,ib) = 0.0 
#           PREPARE Gbbbj(b,b1,b2,ib) = tqqqq(b,b1,b2,ib) 
#     ENDPARDO b, b1, b2, ib 
#
#     PARDO a, a1, b, ib  
#           tppqj(a,a1,b,ib) = 0.0 
#           PREPARE Gaabj(a,a1,b,ib) = tppqj(a,a1,b,ib) 
#     ENDPARDO a, a1, b, ib  
#
#     PARDO b, b1, a2, i  
#           tqqpi(b,b1,a2,i) = 0.0 
#           PREPARE Gbbai(b,b1,a2,i) = tqqpi(b,b1,a2,i) 
#     ENDPARDO b, b1, a2, i 
#
#     PARDO a, i, j, k 
#           tpiii(a,i,j,k) = 0.0 
#           PREPARE Gaiii(a,i,j,k) = tpiii(a,i,j,k) 
#     ENDPARDO a, i, j, k 
#
#     PARDO b, ib, jb, kb 
#           tqjjj(b,ib,jb,kb) = 0.0 
#           PREPARE Gbjjj(b,ib,jb,kb) = tqjjj(b,ib,jb,kb) 
#     ENDPARDO b, ib, jb, kb 
#
#     PARDO a, i, jb, kb 
#           tpijj(a,i,jb,kb) = 0.0 
#           PREPARE Gaijj(a,i,jb,kb) = tpijj(a,i,jb,kb) 
#     ENDPARDO a, i, jb, kb 
#
#     PARDO b, ib, j, k 
#           tqjii(b,ib,j,k) = 0.0 
#           PREPARE Gbjii(b,ib,j,k) = tqjii(b,ib,j,k) 
#     ENDPARDO b, ib, j, k 
#
#     PARDO a, a1, i, j 
#           tpipi(a,i,a1,j) = 0.0 
#           PREPARE Gaiai(a,i,a1,j) = tpipi(a,i,a1,j) 
#     ENDPARDO a, a1, i, j 
#
#     PARDO b, b1, ib, jb 
#           tqjqj(b,ib,b1,jb) = 0.0 
#           PREPARE Gbjbj(b,ib,b1,jb) = tqjqj(b,ib,b1,jb) 
#     ENDPARDO b, b1, ib, jb 
#
#     PARDO a, b1, i, jb 
#           tpiqj(a,i,b1,jb) = 0.0 
#           PREPARE Gaibj(a,i,b1,jb) = tpiqj(a,i,b1,jb) 
#     ENDPARDO a, b1, i, jb 
#
      execute server_barrier 
#
# Form Gxxxi from Gaaai, Gbbai, Gaiii, Gbjii, Gaiai 
# -------------------------------------------------  
#
     DO i 
#
# Transform Gaaai --> Gxxxi 
# ------------------------- 
#
        create PaaxI(*,*,*,i) 
        execute sip_barrier 
#
        PARDO a, a1, a2 
#
              REQUEST Gaaai(a,a1,a2,i) a 
#
              DO lambda 
#
                 taaxi(a,a1,lambda,i)      = Gaaai(a,a1,a2,i)*ca(lambda,a2) 
                 PUT PaaxI(a,a1,lambda,i) += taaxi(a,a1,lambda,i)
#
              ENDDO lambda  
#
        ENDPARDO a, a1, a2 
#
        create PaxxI(*,*,*,i) 
        execute sip_barrier 
#
        PARDO a, a1, lambda 
#
              GET PaaxI(a,a1,lambda,i) 
#
              DO nu 
#
                 taxxi(a,nu,lambda,i)      = PaaxI(a,a1,lambda,i)*ca(nu,a1) 
                 PUT PaxxI(a,nu,lambda,i) += taxxi(a,nu,lambda,i)  
#
              ENDDO nu 
#
        ENDPARDO a, a1, lambda 
#
        execute sip_barrier 
        delete PaaxI(*,*,*,i)
        create PxxxI(*,*,*,i) 
        execute sip_barrier 
#
        PARDO a, nu, lambda 
#
              GET PaxxI(a,nu,lambda,i) 
#
              DO mu 
#
                 txxxI(mu,nu,lambda,i)      = PaxxI(a,nu,lambda,i)*ca(mu,a) 
                 t1xxxI(mu,lambda,nu,i)     = txxxI(mu,nu,lambda,i)  
                 PUT PxxxI(mu,nu,lambda,i) += txxxI(mu,nu,lambda,i) 
                #PUT PxxxI(mu,lambda,nu,i) += t1xxxI(mu,lambda,nu,i) 
#
              ENDDO mu 
#
        ENDPARDO a, nu, lambda 
        execute sip_barrier 
        delete PaxxI(*,*,*,i)
#
# Done transforming Gaaai --> Gxxxi 
# --------------------------------- 
#
# Transform Gbbai --> Gxxxi 
# ------------------------- 
#
        create Pbbxi(*,*,*,i) 
        execute sip_barrier 
#
        PARDO b, b1, a 
#
              REQUEST Gbbai(b,b1,a,i) a 
#
              DO lambda 
#
                 tbbxI(b,b1,lambda,i)      = Gbbai(b,b1,a,i)*ca(lambda,a) 
                 PUT Pbbxi(b,b1,lambda,i) += tbbxI(b,b1,lambda,i)
#
              ENDDO lambda 
#
        ENDPARDO b, b1, a 
#
        execute sip_barrier 
        create PbxxI(*,*,*,i) 
        execute sip_barrier 
#
        PARDO b, b1, lambda 
#
              GET Pbbxi(b,b1,lambda,i) 
#
              DO nu 
#
                 tbxxI(b,nu,lambda,i)      = Pbbxi(b,b1,lambda,i)*cb(nu,b1) 
                 PUT PbxxI(b,nu,lambda,i) += tbxxI(b,nu,lambda,i) 
#
              ENDDO nu 
#
        ENDPARDO b, b1, lambda 
#
        execute sip_barrier 
        delete Pbbxi(*,*,*,i) 
#
        PARDO b, nu, lambda 
#
              GET PbxxI(b,nu,lambda,i)         
#
              DO mu 
#
                 txxxI(mu,nu,lambda,i)      = PbxxI(b,nu,lambda,i)*cb(mu,b) 
                 t1xxxI(mu,lambda,nu,i)     = txxxI(mu,nu,lambda,i) 
                 PUT PxxxI(mu,nu,lambda,i) += txxxI(mu,nu,lambda,i) 
                #PUT PxxxI(mu,lambda,nu,i) += t1xxxI(mu,lambda,nu,i) 
#
              ENDDO mu 
#
        ENDPARDO b, nu, lambda 
#
        execute sip_barrier 
        delete PbxxI(*,*,*,i) 
#
# Done transforming Gbbai --> Gxxxi 
# --------------------------------- 
#
# Transform Gaiii --> Gxxxi 
# ------------------------- 
#
        create Paixi(*,*,*,i) 
        execute sip_barrier 
#
        PARDO a, j, k 
#
              REQUEST Gaiii(a,j,k,i) a 
#
              DO lambda 
#
                 GET                        cai(lambda,k) 
                 taixi(a,j,lambda,i)      = Gaiii(a,j,k,i)*cai(lambda,k) 
                 PUT Paixi(a,j,lambda,i) += taixi(a,j,lambda,i)          
#
              ENDDO lambda 
#
        ENDPARDO a, j, k 
#
        create Paxxi(*,*,*,i)  
        execute sip_barrier 
#
        PARDO a, j, lambda 
#
              GET Paixi(a,j,lambda,i) 
#
              DO nu 
#
                 GET                         cai(nu,j) 
                 taxxi(a,nu,lambda,i)      = Paixi(a,j,lambda,i)*cai(nu,j)
                 PUT Paxxi(a,nu,lambda,i) += taxxi(a,nu,lambda,i)  
#
              ENDDO nu 
#
        ENDPARDO a, j, lambda 
#
        execute sip_barrier 
        delete Paixi(*,*,*,i)
#
        PARDO a, nu, lambda  
#
              GET Paxxi(a,nu,lambda,i) 
#
              DO mu 
#
                 txxxi(mu,nu,lambda,i)      = Paxxi(a,nu,lambda,i)*ca(mu,a) 
                 PUT Pxxxi(mu,nu,lambda,i) += txxxi(mu,nu,lambda,i) 
#
              ENDDO mu 
#
        ENDPARDO a, nu, lambda  
#
        execute sip_barrier 
        delete Paxxi(*,*,*,i) 
#
# Done transforming Gaiii --> Gxxxi 
# --------------------------------- 
#
# Transform Gbjii --> Gxxxi 
# ------------------------- 
#
        create Pbjxi(*,*,*,i) 
        execute sip_barrier 
#
        PARDO b, jb, k 
#
              REQUEST Gbjii(b,jb,k,i) b 
#
              DO lambda 
#
                 GET                         cai(lambda,k) 
                 tbjxi(b,jb,lambda,i)      = Gbjii(b,jb,k,i)*cai(lambda,k) 
                 PUT Pbjxi(b,jb,lambda,i) += tbjxi(b,jb,lambda,i)                
#
              ENDDO lambda 
#
        ENDPARDO b, jb, k 
#
        create Pbxxi(*,*,*,i)  
        execute sip_barrier 
#
        PARDO b, jb, lambda 
#
              GET Pbjxi(b,jb,lambda,i) 
#
              DO nu 
#
                 GET                         cbj(nu,jb) 
                 tbxxi(b,nu,lambda,i)      = Pbjxi(b,jb,lambda,i)*cbj(nu,jb)
                 PUT Pbxxi(b,nu,lambda,i) += tbxxi(b,nu,lambda,i)  
#
              ENDDO nu 
#
        ENDPARDO b, jb, lambda 
#
        execute sip_barrier 
        delete Pbjxi(*,*,*,i)
#
        PARDO b, nu, lambda  
#
              GET Pbxxi(b,nu,lambda,i) 
#
              DO mu 
#
                 txxxi(mu,nu,lambda,i)      = Pbxxi(b,nu,lambda,i)*cb(mu,b) 
                 PUT Pxxxi(mu,nu,lambda,i) += txxxi(mu,nu,lambda,i) 
#
              ENDDO mu 
#
        ENDPARDO b, nu, lambda  
#
        execute sip_barrier 
        delete Pbxxi(*,*,*,i) 
#
# Done transforming Gbjii --> Gxxxi 
# --------------------------------- 
#
# Transform Gaiai --> Gxxxi 
# ------------------------- 
#
        create Paixi(*,*,*,i) 
        execute sip_barrier 
#
        PARDO a, a1, j 
#
              REQUEST            Gaiai(a,j,a1,i) a 
              tpipi(a,j,a1,i)  = Gaiai(a,j,a1,i) 
              tpipi(a,j,a1,i) *=  2.0  
#
              DO lambda 
#
                 taixi(a,j,lambda,i)      = tpipi(a,j,a1,i)*ca(lambda,a1) 
                 PUT Paixi(a,j,lambda,i) += taixi(a,j,lambda,i) 
#
              ENDDO lambda 
#
        ENDPARDO a, a1, j 
#
        create Paxxi(*,*,*,i) 
        execute sip_barrier 
#
        PARDO a, lambda, j 
#
              GET Paixi(a,j,lambda,i)
#
              DO nu 
#
                 GET                         cai(nu,j) 
                 taxxi(a,nu,lambda,i)      = Paixi(a,j,lambda,i)*cai(nu,j) 
                 PUT Paxxi(a,nu,lambda,i) += taxxi(a,nu,lambda,i) 
#
              ENDDO nu 
#
        ENDPARDO a, lambda, j 
#
        execute sip_barrier 
        delete Paixi(*,*,*,i) 
#
        PARDO a, lambda, nu 
#
              GET Paxxi(a,nu,lambda,i)
#
              DO mu 
#
                 txxxi(mu,nu,lambda,i) = Paxxi(a,nu,lambda,i)*ca(mu,a) 
                 t1xxxi(mu,lambda,nu,i)     = txxxi(mu,nu,lambda,i) 
                 PUT Pxxxi(mu,nu,lambda,i) += txxxi(mu,nu,lambda,i) 
                #PUT Pxxxi(mu,lambda,nu,i) += t1xxxi(mu,lambda,nu,i) 
#
              ENDDO mu 
#
        ENDPARDO a, lambda, nu 
#
        execute sip_barrier 
#
        PARDO mu, nu, lambda 
              GET                             Pxxxi(mu,nu,lambda,i) 
              PREPARE Gxxxi(mu,nu,lambda,i) = Pxxxi(mu,nu,lambda,i) 
        ENDPARDO mu, nu, lambda 
#
# Done transforming Gaiai --> Gxxxi 
# --------------------------------- 
#
        execute sip_barrier 
        delete Paxxi(*,*,*,i) 
        delete Pxxxi(*,*,*,i) 
#
     ENDDO i 
#
# --------------------------------------------------------------------------
#
# Done forming Gxxxi from Gaaai, Gbbai, Gaiii, Gbjii, Gaiai 
# ---------------------------------------------------------  
#
# Form Gxxxj from Gbbbj, Gaabj, Gbjjj, Gbjii, Gaiai, Gaibj 
# --------------------------------------------------------  
#
     DO ib  
#
# Transform Gbbbj --> Gxxxj 
# ------------------------- 
#
        create PbbxJ(*,*,*,ib)  
        execute sip_barrier 
#
        PARDO b, b1, b2 
#
              REQUEST Gbbbj(b,b1,b2,ib) b 
#
              DO lambda 
#
                 tbbxj(b,b1,lambda,ib)      = Gbbbj(b,b1,b2,ib)*cb(lambda,b2) 
                 PUT PbbxJ(b,b1,lambda,ib) += tbbxj(b,b1,lambda,ib)
#
              ENDDO lambda  
#
        ENDPARDO b, b1, b2 
#
        create PbxxJ(*,*,*,ib) 
        execute sip_barrier 
#
        PARDO b, b1, lambda 
#
              GET PbbxJ(b,b1,lambda,ib) 
#
              DO nu 
#
                 tbxxj(b,nu,lambda,ib)      = PbbxJ(b,b1,lambda,ib)*cb(nu,b1) 
                 PUT PbxxJ(b,nu,lambda,ib) += tbxxj(b,nu,lambda,ib)  
#
              ENDDO nu 
#
        ENDPARDO b, b1, lambda 
#
        execute sip_barrier 
        delete PbbxJ(*,*,*,ib)
        create PxxxJ(*,*,*,ib) 
        execute sip_barrier 
#
        PARDO b, nu, lambda 
#
              GET PbxxJ(b,nu,lambda,ib) 
#
              DO mu 
#
                 txxxJ(mu,nu,lambda,ib)      = PbxxJ(b,nu,lambda,ib)*cb(mu,b) 
                 t1xxxJ(mu,lambda,nu,ib)     = txxxJ(mu,nu,lambda,ib) 
                 PUT PxxxJ(mu,nu,lambda,ib) += txxxJ(mu,nu,lambda,ib) 
                #PUT PxxxJ(mu,lambda,nu,ib) += t1xxxJ(mu,lambda,nu,ib) 
#
              ENDDO mu 
#
        ENDPARDO b, nu, lambda 
        execute sip_barrier 
        delete PbxxJ(*,*,*,ib)
#
# Done transforming Gbbbj --> Gxxxj 
# --------------------------------- 
#
# Transform Gaabj --> Gxxxj 
# ------------------------- 
#
        create Paaxj(*,*,*,ib) 
        execute sip_barrier 
#
        PARDO a, a1, b 
#
              REQUEST Gaabj(a,a1,b,ib) a 
#
              DO lambda 
#
                 taaxj(a,a1,lambda,ib) = Gaabj(a,a1,b,ib)*cb(lambda,b) 
                 PUT Paaxj(a,a1,lambda,ib) += taaxj(a,a1,lambda,ib) 
#
              ENDDO lambda 
#
        ENDPARDO a, a1, b 
#
        create Paxxj(*,*,*,ib) 
        execute sip_barrier 
#
        PARDO a, a1, lambda 
#
              GET Paaxj(a,a1,lambda,ib) 
#
              DO nu 
#
                 taxxj(a,nu,lambda,ib) = Paaxj(a,a1,lambda,ib)*ca(nu,a1) 
                 PUT Paxxj(a,nu,lambda,ib) += taxxj(a,nu,lambda,ib) 
#
              ENDDO nu 
#
        ENDPARDO a, a1, lambda 
#
        execute sip_barrier 
        delete Paaxj(*,*,*,ib)
#
        PARDO a, nu, lambda 
#
              GET Paxxj(a,nu,lambda,ib) 
#
              DO mu 
#
                 txxxj(mu,nu,lambda,ib) = Paxxj(a,nu,lambda,ib)*ca(mu,a) 
                 t1xxxj(mu,lambda,nu,ib) = txxxj(mu,nu,lambda,ib) 
                 PUT Pxxxj(mu,nu,lambda,ib) += txxxj(mu,nu,lambda,ib) 
                #PUT Pxxxj(mu,lambda,nu,ib) += t1xxxj(mu,lambda,nu,ib) 
#
              ENDDO mu 
#
        ENDPARDO a, nu, lambda 
#
        execute sip_barrier 
        delete Paxxj(*,*,*,ib)
#
# Done transforming Gaabj --> Gxxxj 
# --------------------------------- 
#
# Transform Gbjjj --> Gxxxj 
# ------------------------- 
#
        create Pbjxj(*,*,*,ib)
        execute sip_barrier
#
        PARDO b, jb, kb
#
              REQUEST Gbjjj(b,jb,kb,ib) b
#
              DO lambda
#
                 GET cbj(lambda,kb)
                 tbjxj(b,jb,lambda,ib) = Gbjjj(b,jb,kb,ib)*cbj(lambda,kb)
                 PUT Pbjxj(b,jb,lambda,ib) += tbjxj(b,jb,lambda,ib)
#
              ENDDO lambda
#
        ENDPARDO b, jb, kb
#
        create Pbxxj(*,*,*,ib)
        execute sip_barrier
#
        PARDO b, jb, lambda
#
              GET Pbjxj(b,jb,lambda,ib)
#
              DO nu
#
                 GET cbj(nu,jb)
                 tbxxj(b,nu,lambda,ib) = Pbjxj(b,jb,lambda,ib)*cbj(nu,jb)
                 PUT Pbxxj(b,nu,lambda,ib) += tbxxj(b,nu,lambda,ib)
#
              ENDDO nu
#
        ENDPARDO b, jb, lambda
#
        execute sip_barrier
        delete Pbjxj(*,*,*,ib)
#
        PARDO b, nu, lambda
#
              GET Pbxxj(b,nu,lambda,ib)
#
              DO mu
#
                 txxxj(mu,nu,lambda,ib) = Pbxxj(b,nu,lambda,ib)*cb(mu,b)
                 PUT Pxxxj(mu,nu,lambda,ib) += txxxj(mu,nu,lambda,ib)
#
              ENDDO mu
#
        ENDPARDO b, nu, lambda
#
        execute sip_barrier
        delete Pbxxj(*,*,*,ib)
#
# Done transforming Gbjjj --> Gxxxj
# ---------------------------------
#
# Transform Gaijj --> Gxxxj
# -------------------------
#
        create Paixj(*,*,*,ib)
        execute sip_barrier
#
        PARDO a, i, jb
#
              REQUEST Gaijj(a,i,jb,ib) a
#
              DO lambda
#
                 GET cbj(lambda,jb)
                 taixj(a,i,lambda,ib) = Gaijj(a,i,jb,ib)*cbj(lambda,jb)
                 PUT Paixj(a,i,lambda,ib) += taixj(a,i,lambda,ib)
#
              ENDDO lambda
#
        ENDPARDO a, i, jb
#
        create Paxxj(*,*,*,ib)
        execute sip_barrier
#
        PARDO a, i, lambda
#
              GET Paixj(a,i,lambda,ib)
#
              DO nu
#
                 GET cai(nu,i)
                 taxxj(a,nu,lambda,ib) = Paixj(a,i,lambda,ib)*cai(nu,i)
                 PUT Paxxj(a,nu,lambda,ib) += taxxj(a,nu,lambda,ib)
#
              ENDDO nu
#
        ENDPARDO a, i, lambda
#
        execute sip_barrier
        delete Paixj(*,*,*,ib)
#
        PARDO a, nu, lambda
#
              GET Paxxj(a,nu,lambda,ib)
#
              DO mu
#
                 txxxj(mu,nu,lambda,ib) = Paxxj(a,nu,lambda,ib)*ca(mu,a)
                 PUT Pxxxj(mu,nu,lambda,ib) += txxxj(mu,nu,lambda,ib)
#
              ENDDO mu
#
        ENDPARDO a, nu, lambda
#
        execute sip_barrier
        delete Paxxj(*,*,*,ib)
#
# Done transforming Gaijj --> Gxxxj
# ---------------------------------
#
# Transform Gbjbj --> Gxxxj
# -------------------------
#
        create Pbjxj(*,*,*,ib)
        execute sip_barrier
#
        PARDO b, jb, b1
#
              REQUEST              Gbjbj(b,jb,b1,ib) b 
              tqjqj(b,jb,b1,ib)  = Gbjbj(b,jb,b1,ib) 
              tqjqj(b,jb,b1,ib) *=  2.0 
#
              DO lambda
#
                 tbjxj(b,jb,lambda,ib) = tqjqj(b,jb,b1,ib)*cb(lambda,b1)
                 PUT Pbjxj(b,jb,lambda,ib) += tbjxj(b,jb,lambda,ib)
#
              ENDDO lambda
#
        ENDPARDO b, jb, b1
#
        create Pbxxj(*,*,*,ib)
        execute sip_barrier
#
        PARDO b, jb, lambda
#
              GET Pbjxj(b,jb,lambda,ib)
#
              DO nu
#
                 GET cbj(nu,jb)
                 tbxxj(b,nu,lambda,ib) = Pbjxj(b,jb,lambda,ib)*cbj(nu,jb)
                 PUT Pbxxj(b,nu,lambda,ib) += tbxxj(b,nu,lambda,ib)
#
              ENDDO nu
#
        ENDPARDO b, jb, lambda
#
        execute sip_barrier
        delete Pbjxj(*,*,*,ib)
#
        PARDO b, nu, lambda
#
              GET Pbxxj(b,nu,lambda,ib)
#
              DO mu
#
                 txxxj(mu,nu,lambda,ib) = Pbxxj(b,nu,lambda,ib)*cb(mu,b)
                 t1xxxj(mu,lambda,nu,ib)     = txxxj(mu,nu,lambda,ib) 
                 PUT Pxxxj(mu,nu,lambda,ib) += txxxj(mu,nu,lambda,ib)
                #PUT Pxxxj(mu,lambda,nu,ib) += t1xxxj(mu,lambda,nu,ib)
#
              ENDDO mu
#
        ENDPARDO b, nu, lambda
#
        execute sip_barrier
        delete Pbxxj(*,*,*,ib)
#
# Done transforming Gbjbj --> Gxxxj
# ---------------------------------
#
# Transform Gaibj --> Gxxxj 
# ------------------------- 
#
        create Paixj(*,*,*,ib)
        execute sip_barrier
#
        PARDO a, i, b
#
              REQUEST            Gaibj(a,i,b,ib) a 
              tpiqj(a,i,b,ib)  = Gaibj(a,i,b,ib) 
              tpiqj(a,i,b,ib) *= 4.0  
#
              DO lambda 
#
                 taixj(a,i,lambda,ib) = tpiqj(a,i,b,ib)*cb(lambda,b) 
                 PUT Paixj(a,i,lambda,ib) += taixj(a,i,lambda,ib) 
#
              ENDDO lambda 
#
        ENDPARDO a, i, b
#
        create Paxxj(*,*,*,ib) 
        execute sip_barrier 
#
        PARDO a, i, lambda 
#
              GET Paixj(a,i,lambda,ib) 
#
              DO nu
#
                 GET cai(nu,i) 
                 taxxj(a,nu,lambda,ib) = Paixj(a,i,lambda,ib)*cai(nu,i) 
                 PUT Paxxj(a,nu,lambda,ib) += taxxj(a,nu,lambda,ib)  
#
              ENDDO nu
#
        ENDPARDO a, i, lambda 
#
        execute sip_barrier 
        delete Paixj(*,*,*,ib) 
#
        PARDO a, nu, lambda 
#
              GET Paxxj(a,nu,lambda,ib) 
#
              DO mu 
#
                 txxxj(mu,nu,lambda,ib) = Paxxj(a,nu,lambda,ib)*ca(mu,a) 
                 t1xxxj(mu,lambda,nu,ib)     = txxxj(mu,nu,lambda,ib) 
                 PUT Pxxxj(mu,nu,lambda,ib) += txxxj(mu,nu,lambda,ib)  
                #PUT Pxxxj(mu,lambda,nu,ib) += t1xxxj(mu,lambda,nu,ib)  
#
              ENDDO mu 
#
        ENDPARDO a, nu, lambda 
# 
        execute sip_barrier 
#
        PARDO mu, nu, lambda 
              GET                              Pxxxj(mu,nu,lambda,ib) 
              PREPARE Gxxxj(mu,nu,lambda,ib) = Pxxxj(mu,nu,lambda,ib) 
        ENDPARDO mu, nu, lambda 
#
# Done transforming Gaibj --> Gxxxj 
# --------------------------------- 
# 
        execute sip_barrier 
        delete Paxxj(*,*,*,ib) 
        delete PxxxJ(*,*,*,ib) 
#
     ENDDO ib  
#
# Done forming Gxxxj from Gbbbj, Gaabj, Gbjjj, Gbjii, Gaiai, Gaibj 
# ----------------------------------------------------------------  
#
     execute server_barrier 
#
     ENDPROC B3TRAN   
#    -------------- 
#
# --------------------------------------------------------------------------
#
     PROC PDCONT    
#    ----------- 
#
      PARDO mu, nu, lambda, sigma
#     
            Txxxx(mu,nu,lambda,sigma) = 0.0
#     
#           Fully transform Dxxxi
#           ---------------------
            DO i
#              
               REQUEST                       Gxxxi(mu,nu,lambda,i) i
               GET                           cai(sigma,i) 
               T1xxxx(mu,nu,lambda,sigma)  = Gxxxi(mu,nu,lambda,i)*cai(sigma,i)
               Txxxx(mu,nu,lambda,sigma)  += T1xxxx(mu,nu,lambda,sigma)
#           
            ENDDO i
#           
#           Fully transform Dxxxj
#           ---------------------
            DO ib  
#              
               REQUEST                       Gxxxj(mu,nu,lambda,ib) ib  
               GET                           cbj(sigma,ib) 
               T1xxxx(mu,nu,lambda,sigma)  = Gxxxj(mu,nu,lambda,ib)*cbj(sigma,ib)
               Txxxx(mu,nu,lambda,sigma)  += T1xxxx(mu,nu,lambda,sigma)
#           
            ENDDO ib 
#           
#           INTEGRAL BLOCK 1
#           ----------------
            execute der_int_setup dx1(mu,nu,lambda,sigma)
            execute der_int_setup dy1(mu,nu,lambda,sigma)
            execute der_int_setup dz1(mu,nu,lambda,sigma)
            execute der_int_setup dx2(mu,nu,lambda,sigma)
            execute der_int_setup dy2(mu,nu,lambda,sigma)
            execute der_int_setup dz2(mu,nu,lambda,sigma)
            execute der_int_setup dx3(mu,nu,lambda,sigma)
            execute der_int_setup dy3(mu,nu,lambda,sigma)
            execute der_int_setup dz3(mu,nu,lambda,sigma)
            execute der_int_setup dx4(mu,nu,lambda,sigma)
            execute der_int_setup dy4(mu,nu,lambda,sigma)
            execute der_int_setup dz4(mu,nu,lambda,sigma)
#
            execute compute_derivative_integrals
#
            Txxxx(mu,nu,lambda,sigma) *= 2.0 
            T1xxxx(mu,lambda,nu,sigma) = Txxxx(mu,nu,lambda,sigma) 
            execute DCONT2 Txxxx(mu,nu,lambda,sigma)
#
      ENDPARDO mu, nu, lambda, sigma
      execute server_barrier
#
     ENDPROC PDCONT    
#    -------------- 
#
# --------------------------------------------------------------------------
#
     PROC FORM_ONEI    
#    --------------  
#
     create Iij_aa 
     create Iij_bb 
     create Iia_aa 
     create Iia_bb 
     create IMia_aa 
     create IMia_bb 
     create Iab_aa 
     create Iab_bb 
     create Iai_aa 
     create Iai_bb 
     execute sip_barrier 
     etemp = 1.0 # -0.5 
#
# Compute contributions to one-particle intermediates from Gaaai
# --------------------------------------------------------------
#
      PARDO i2, a, a2, a1
#
            i2pppp(a,a1,a2,i2) = 0.0
#
            DO i
               REQUEST               Gaaai(a,a2,a1,i) a
               GET                   IIi(i,i2) 
               ipppp(a,a1,a2,i2)   = Gaaai(a,a2,a1,i)*IIi(i,i2)
               i2pppp(a,a1,a2,i2) += ipppp(a,a1,a2,i2)
            ENDDO i
            i2pppp(a,a1,a2,i2)*= etemp 
#
#           Contribution to Iij_aa
#           -----------------------
#
            DO  i1
#
               REQUEST              VSaaai(a,a2,a1,i1) i1
               ipppp(i1,a,a1,a2)  = VSaaai(a,a2,a1,i1)
               Tpp(i1,i2)         = ipppp(i1,a,a1,a2)*i2pppp(a,a1,a2,i2)
               Tpp(i1,i2)        *= -0.5
               PUT Iij_aa(i1,i2) += Tpp(i1,i2)
#
            ENDDO i1
#
#           Contribution to Iia_aa
#           ----------------------
#
            DO i1
#
               REQUEST              VSpipi(a,i1,a1,i2) a  
               Tpp(i1,a2)         = i2pppp(a,a1,a2,i2)*VSpipi(a,i1,a1,i2)
               Tpp(i1,a2)        *= -0.5
               PUT Iia_aa(i1,a2) += Tpp(i1,a2)
#
            ENDDO i1
#
            DO i1
#
               REQUEST              Vaaii(a2,a,i2,i1) i1
               REQUEST              Viaai(i2,a,a2,i1) i1
#
               ipppp(i2,a,a2,i1)  = Vaaii(a2,a,i2,i1)
               ipppp(i2,a,a2,i1) -= Viaai(i2,a,a2,i1)
               Tpp(i1,a1)         = i2pppp(a,a1,a2,i2)*ipppp(i2,a,a2,i1)
               Tpp(i1,a1)        *= -1.0
               PUT Iia_aa(i1,a1) += Tpp(i1,a1)
#
            ENDDO i1
#
#           Contribution to Iab_aa
#           ----------------------
#
            DO a3
#
               REQUEST              VSaaai(a,a3,a1,i2) a  
               Tpp(a3,a2)         = VSaaai(a,a3,a1,i2)*i2pppp(a,a1,a2,i2)
               Tpp(a3,a2)        *= -0.5
               PUT Iab_aa(a3,a2) += Tpp(a3,a2)
#
            ENDDO a3
#
#           Contribution to Iab_aa
#           ----------------------
#
            DO a3
#
               REQUEST              VSaaai(a3,a2,a1,i2) a1  
               Tpp(a3,a)          = VSaaai(a3,a2,a1,i2)*i2pppp(a,a1,a2,i2)
               Tpp(a3,a)         *= -1.0
               PUT Iab_aa(a3,a)  += Tpp(a3,a)
#
            ENDDO a3 
#
      ENDPARDO i2, a, a2, a1
#
# Compute contributions to one-particle intermediates from Gbbbj
# --------------------------------------------------------------
#
      PARDO j2, b, b2, b1
#
            i2qqqq(b,b1,b2,j2) = 0.0 
#
            DO jb  
               REQUEST               Gbbbj(b,b2,b1,jb) b
               GET                   IJj(jb,j2) 
               iqqqq(b,b1,b2,j2)   = Gbbbj(b,b2,b1,jb)*IJj(jb,j2) 
               i2qqqq(b,b1,b2,j2) += iqqqq(b,b1,b2,j2) 
            ENDDO jb  
            i2qqqq(b,b1,b2,j2)*=etemp 
#
#           Contribution to Iij_bb
#           -----------------------
#
            DO  j1
#
               REQUEST              VSbbbj(b,b2,b1,j1) j1
               iqqqq(j1,b,b1,b2)  = VSbbbj(b,b2,b1,j1)
               Tqq(j1,j2)         = iqqqq(j1,b,b1,b2)*i2qqqq(b,b1,b2,j2)
               Tqq(j1,j2)        *= -0.5
               PUT Iij_bb(j1,j2) += Tqq(j1,j2)
#
            ENDDO j1
#
#           Contribution to Iia_bb
#           ----------------------
#
            DO j1
#
               REQUEST              VSqjqj(b,j1,b1,j2) b
               Tqq(j1,b2)         = i2qqqq(b,b1,b2,j2)*VSqjqj(b,j1,b1,j2)
               Tqq(j1,b2)        *= -0.5
               PUT Iia_bb(j1,b2) += Tqq(j1,b2)
#
            ENDDO j1
#
            DO j1
#
               REQUEST              Vbbjj(b2,b,j2,j1) j1
               REQUEST              Vjbbj(j2,b,b2,j1) j1
#
               iqqqq(j2,b,b2,j1)  = Vbbjj(b2,b,j2,j1)
               iqqqq(j2,b,b2,j1) -= Vjbbj(j2,b,b2,j1)
               Tqq(j1,b1)         = i2qqqq(b,b1,b2,j2)*iqqqq(j2,b,b2,j1)
               Tqq(j1,b1)        *= -1.0
               PUT Iia_bb(j1,b1) += Tqq(j1,b1)
#
            ENDDO j1
#
#           Contribution to Iab_bb
#           ----------------------
#
            DO b3
#
               REQUEST              VSbbbj(b,b3,b1,j2) b  
               Tqq(b3,b2)         = VSbbbj(b,b3,b1,j2)*i2qqqq(b,b1,b2,j2)
               Tqq(b3,b2)        *= -0.5
               PUT Iab_bb(b3,b2) += Tqq(b3,b2)
#
            ENDDO b3
#
            DO b3
#
               REQUEST              VSbbbj(b3,b2,b1,j2) b1  
               Tqq(b3,b)          = VSbbbj(b3,b2,b1,j2)*i2qqqq(b,b1,b2,j2)
               Tqq(b3,b)         *= -1.0
               PUT Iab_bb(b3,b)  += Tqq(b3,b)
#
            ENDDO b3
#
      ENDPARDO j2, b, b2, b1 
#
# Compute contributions to one-particle intermediates from Gbbai
# --------------------------------------------------------------
#
      PARDO a, j2, a1, b
#
            i2pqpq(a,b,a1,j2) = 0.0 
#
            DO jb  
               REQUEST              Gaabj(a,a1,b,jb) a
               GET                  IJj(jb,j2) 
               ipqpq(a,b,a1,j2)   = Gaabj(a,a1,b,jb)*IJj(jb,j2) 
               i2pqpq(a,b,a1,j2) += ipqpq(a,b,a1,j2) 
            ENDDO jb 
            i2pqpq(a,b,a1,j2)*=etemp 
#
#           Contribution to Iij_bb
#           ----------------------
#
            DO j1
#
               REQUEST              Vaabj(a,a1,b,j1) j1
               Tqq(j1,j2)         = Vaabj(a,a1,b,j1)*i2pqpq(a,b,a1,j2)
               Tqq(j1,j2)        *= -1.0
               PUT Iij_bb(j1,j2) += Tqq(j1,j2)
#
            ENDDO j1
#
#           Contribution to Iab_aa
#           ----------------------
#
            DO a2
#
               REQUEST             Vaabj(a2,a1,b,j2) b
               Tpp(a2,a)         = Vaabj(a2,a1,b,j2)*i2pqpq(a,b,a1,j2)
               Tpp(a2,a)        *= -1.0
               PUT Iab_aa(a2,a) += Tpp(a2,a)
#
            ENDDO a2
#
#           Contribution to Iia_aa
#           ----------------------
#
            DO i1 
#
               REQUEST             Viabj(i1,a1,b,j2) b
               Tpp(i1,a)         = Viabj(i1,a1,b,j2)*i2pqpq(a,b,a1,j2)
               Tpp(i1,a)        *= -1.0
               PUT Iia_aa(i1,a) += Tpp(i1,a)
#
            ENDDO i1 
#
#           Contribution to Iab_aa
#           ----------------------
#
            DO a2
#
               REQUEST              Vaabj(a,a2,b,j2) a
               Tpp(a2,a1)         = Vaabj(a,a2,b,j2)*i2pqpq(a,b,a1,j2)
               Tpp(a2,a1)        *= -1.0
               PUT Iab_aa(a2,a1) += Tpp(a2,a1)
#
            ENDDO a2
#
#           Contribution to Iab_bb
#           ----------------------
#
            DO b1
#
               REQUEST             Vaabj(a,a1,b1,j2) a
               Tqq(b1,b)         = Vaabj(a,a1,b1,j2)*i2pqpq(a,b,a1,j2)
               Tqq(b1,b)        *= -1.0
               PUT Iab_bb(b1,b) += Tqq(b1,b)
#
            ENDDO b1
#
#           Contribution to Iia_aa
#           ----------------------
#
            DO i1 
#
               REQUEST             Vpiqj(a,i1,b,j2) b
               Tpp(i1,a1)         = i2pqpq(a,b,a1,j2)*Vpiqj(a,i1,b,j2)
               Tpp(i1,a1)        *= -1.0
               PUT Iia_aa(i1,a1) += Tpp(i1,a1)
#
            ENDDO i1 
#
#           Contribution to  Iia_bb
#           -----------------------
#
            DO j1
#
               REQUEST             Vaajj(a1,a,j2,j1) j1
               Tqq(j1,b)         = i2pqpq(a,b,a1,j2)*Vaajj(a1,a,j2,j1)
               Tqq(j1,b)        *= -1.0
               PUT Iia_bb(j1,b) += Tqq(j1,b)
#
            ENDDO j1
#
      ENDPARDO a, j2, a1, b
#
# Compute contributions to one-particle intermediates from Gbbai
# --------------------------------------------------------------
#
      PARDO b1, i2, a, b
#
            i2qpqp(b1,a,b,i2) = 0.0 
#
            DO i 
               REQUEST              Gbbai(b,b1,a,i) a
               GET                  IIi(i,i2) 
               iqpqp(b1,a,b,i2)   = Gbbai(b,b1,a,i)*IIi(i,i2) 
               i2qpqp(b1,a,b,i2) += iqpqp(b1,a,b,i2)  
            ENDDO i 
            i2qpqp(b1,a,b,i2)*=etemp 
#
#           Contribution to Iij_aa
#           ----------------------
#
            DO i1
#
               REQUEST              Vbbai(b,b1,a,i1) i1
               Tpp(i1,i2)         = Vbbai(b,b1,a,i1)*i2qpqp(b1,a,b,i2)
               Tpp(i1,i2)        *= -1.0
               PUT Iij_aa(i1,i2) += Tpp(i1,i2)
#
            ENDDO i1
#
#           Contribution to Iab_bb
#           ----------------------
#
            DO b2
#
               REQUEST              Vbbai(b2,b,a,i2) a
               Tqq(b2,b1)         = Vbbai(b2,b,a,i2)*i2qpqp(b1,a,b,i2)
               Tqq(b2,b1)        *= -1.0
               PUT Iab_bb(b2,b1) += Tqq(b2,b1)
#
            ENDDO b2
#
#           Contribution to Iia_bb
#           ----------------------
#
            DO j1  
#
               REQUEST             Viabj(i2,a,b,j1) a
               Tqq(j1,b1)         = i2qpqp(b1,a,b,i2)*Viabj(i2,a,b,j1)
               Tqq(j1,b1)        *= -1.0
               PUT Iia_bb(j1,b1) += Tqq(j1,b1)
#
            ENDDO j1  
#
#           Contribution to Iab_bb
#           ----------------------
#
            DO b2
#
               REQUEST             Vbbai(b1,b2,a,i2) a
               Tqq(b2,b)         = Vbbai(b1,b2,a,i2)*i2qpqp(b1,a,b,i2)
               Tqq(b2,b)        *= -1.0
               PUT Iab_bb(b2,b) += Tqq(b2,b)
#
            ENDDO b2
#
#           Contribution to Iab_aa
#           ----------------------
#
            DO a1
#
               REQUEST             Vbbai(b1,b,a1,i2) b  
               Tpp(a1,a)         = Vbbai(b1,b,a1,i2)*i2qpqp(b1,a,b,i2)
               Tpp(a1,a)        *= -1.0
               PUT Iab_aa(a1,a) += Tpp(a1,a)
#
            ENDDO a1
#
#           Contribution to Iia_aa
#           ----------------------
#
            DO i1
#
               REQUEST             Vbbii(b,b1,i2,i1) b1
               Tpp(i1,a)         = i2qpqp(b1,a,b,i2)*Vbbii(b,b1,i2,i1)
               Tpp(i1,a)        *= -1.0
               PUT Iia_aa(i1,a) += Tpp(i1,a)
#
            ENDDO i1
#
#           Contribution to Iia_bb
#           ----------------------
#
            DO j1  
#
               REQUEST             Vpiqj(a,i2,b1,j1) a
               Tqq(j1,b)         = i2qpqp(b1,a,b,i2)*Vpiqj(a,i2,b1,j1)
               Tqq(j1,b)        *= -1.0
               PUT Iia_bb(j1,b) += Tqq(j1,b)
#
            ENDDO j1  
#
      ENDPARDO b1, i2, a, b
#
# Prepare Gaijk --> Gkija to be used in intermediate construction 
# ---------------------------------------------------------------
#
     etemp = 1.0 # 0.5 
     create Giiia 
     execute sip_barrier 
#
# alpha/alpha/alpha/alpha component 
# --------------------------------- 
# 
     PARDO a, i1, i2, i3 
#
           i1pppp(a,i1,i2,i3) = 0.0 
#
           DO i 
           DO j 
           DO k 
#
              REQUEST               Gaiii(a,j,i,k) a 
              GET                   IIi(i,i1) 
              GET                   IIi(j,i2) 
              GET                   IIi(k,i3) 
              ippii(a,i1,j,k)     = Gaiii(a,j,i,k)*IIi(i,i1) 
              ipppi(a,i1,i2,k)    = ippii(a,i1,j,k)*IIi(j,i2) 
              ipppp(a,i1,i2,i3)   = ipppi(a,i1,i2,k)*IIi(k,i3) 
              i1pppp(a,i1,i2,i3) += ipppp(a,i1,i2,i3)  
#
           ENDDO k 
           ENDDO j 
           ENDDO i 
           i1pppp(a,i1,i2,i3)*=etemp 
#
           i2pppp(i3,i2,i1,a)    = i1pppp(a,i1,i2,i3) 
           PUT Giiia(i3,i2,i1,a) = i2pppp(i3,i2,i1,a) 
#
     ENDPARDO a, i1, i2, i3 
     execute sip_barrier 
#
# Compute contributions to one-particle intermediates
# ---------------------------------------------------
#
#     Contribution to Iij_aa
#     ----------------------
#
      PARDO i1, i2, i3, a 
#
            REQUEST              VSpipi(a,i2,i3,i1) a
            ipppp(i2,i3,a,i1)  = VSpipi(a,i2,i3,i1)
#
            DO i4
#
               GET                  Giiia(i4,i2,i3,a) 
               Tpp(i1,i4)         = Giiia(i4,i2,i3,a)*ipppp(i2,i3,a,i1)
               Tpp(i1,i4)        *= -1.0
               PUT Iij_aa(i1,i4) += Tpp(i1,i4)
#
            ENDDO i4
#
      ENDPARDO i1, i2, i3, a 
#
      PARDO i1, i2, i3, a   
#
            REQUEST VSpipi(a,i2,i1,i3) i3
#
            DO i4
#
               GET                  Giiia(i3,i2,i4,a) 
               Tpp(i1,i4)         = VSpipi(a,i2,i1,i3)*Giiia(i3,i2,i4,a)
               Tpp(i1,i4)        *= -0.5
               PUT Iij_aa(i1,i4) += Tpp(i1,i4)
#
            ENDDO i4
#
      ENDPARDO i1, i2, i3, a  
#
#     Contribution to Iab_aa
#     ----------------------
#
      PARDO a, i2, i3, i1
#
            REQUEST             VSpipi(a,i1,i2,i3) a
            ipppp(a,i3,i1,i2) = VSpipi(a,i1,i2,i3)
#
            DO a1
#
               GET                 Giiia(i3,i1,i2,a1) 
               Tpp(a,a1)         = ipppp(a,i3,i1,i2)*Giiia(i3,i1,i2,a1)
               Tpp(a,a1)        *= -0.5
               PUT Iab_aa(a,a1) += Tpp(a,a1)
#
            ENDDO a1
#
      ENDPARDO a, i2, i3, i1
#
#     Contribution to Iai_aa
#     ----------------------
#
      PARDO a, a1, i1, i2
#
            REQUEST Viaai(i1,a1,a,i2) i2
            REQUEST Vaaii(a,a1,i1,i2) i2
#
            ipppp(i1,i2,a1,a)  = Viaai(i1,a1,a,i2)
            i1pppp(i1,i2,a1,a) = Vaaii(a,a1,i1,i2)
            ipppp(i1,i2,a1,a) -= i1pppp(i1,i2,a1,a)
#
            DO i3 
#
               GET                 Giiia(i3,i1,i2,a1) 
               Tpp(a,i3)         = Giiia(i3,i1,i2,a1)*ipppp(i1,i2,a1,a)
               PUT Iai_aa(a,i3) += Tpp(a,i3)
#
            ENDDO i3 
#
      ENDPARDO a, a1, i1, i2
#
      PARDO a, a1, i1, i2
#
            REQUEST VSpipi(a,i1,a1,i2) a  
#
            DO i3 
#
               GET                 Giiia(i1,i2,i3,a1) 
               Tpp(a,i3)         = VSpipi(a,i1,a1,i2)*Giiia(i1,i2,i3,a1)
               Tpp(a,i3)        *= 0.5
               PUT Iai_aa(a,i3) += Tpp(a,i3)
#
            ENDDO i3  
#
      ENDPARDO a, a1, i1, i2 
#
      PARDO a, i3, i1, i2
#
            GET Giiia(i1,i2,i3,a) 
#
            DO i4 
#
               REQUEST               VSpipi(i1,i3,i2,i4) i1  
               ipppp(i4,i1,i2,i3)  = VSpipi(i1,i3,i2,i4)
               Tpp(i4,a)           = ipppp(i4,i1,i2,i3)*Giiia(i1,i2,i3,a)
               Tpp(i4,a)          *= -0.5
               PUT Iia_aa(i4,a)   += Tpp(i4,a)
#
            ENDDO i4  
#
      ENDPARDO a, i3, i1, i2 
#
     execute sip_barrier 
#
# alpha/beta/alpha/beta component 
# --------------------------------- 
#
     create Gijib 
     execute sip_barrier 
# 
     PARDO b, j1, i2, i3 
#
           i1qqpp(b,j1,i2,i3) = 0.0 
#
           DO ib  
           DO j 
           DO k 
#
              REQUEST               Gbjii(b,ib,j,k) b 
              GET                   IJj(ib,j1) 
              GET                   IIi(j,i2) 
              GET                   IIi(k,i3) 
              iqqii(b,j1,j,k)     = Gbjii(b,ib,j,k)*IJj(ib,j1) 
              iqqpi(b,j1,i2,k)    = iqqii(b,j1,j,k)*IIi(j,i2) 
              iqqpp(b,j1,i2,i3)   = iqqpi(b,j1,i2,k)*IIi(k,i3) 
              i1qqpp(b,j1,i2,i3) += iqqpp(b,j1,i2,i3)  
#
           ENDDO k 
           ENDDO j 
           ENDDO ib  
           i1qqpp(b,j1,i2,i3)*=etemp 
#
           i2pqpq(i3,j1,i2,b)    = i1qqpp(b,j1,i2,i3) 
           PUT Gijib(i3,j1,i2,b) = i2pqpq(i3,j1,i2,b) 
#
     ENDPARDO b, j1, i2, i3 
     execute sip_barrier 
#
# Compute contributions to one-particle intermediates
# --------------------------------------------------- 
#
#     Contribution to Iij_aa
#     ----------------------
#
      PARDO j1, i2, b, i3 
#
            REQUEST Vpiqj(i2,i3,b,j1) j1
#
            DO i1
#
               GET                  Gijib(i1,j1,i2,b) 
               Tpp(i3,i1)         = Gijib(i1,j1,i2,b)*Vpiqj(i2,i3,b,j1)
               Tpp(i3,i1)        *= -1.0
               PUT Iij_aa(i3,i1) += Tpp(i3,i1)
#
            ENDDO i1
#
      ENDPARDO j1, i2, b, i3 
#
# Sixth-term of Iij_aa
# --------------------
#
      PARDO i2, j1, b, i3  
#
            REQUEST Vpiqj(i3,i2,b,j1) j1
#
            DO i1
#
               GET                  Gijib(i2,j1,i1,b) 
               Tpp(i3,i1)         = Vpiqj(i3,i2,b,j1)*Gijib(i2,j1,i1,b)
               Tpp(i3,i1)        *= -1.0
               PUT Iij_aa(i3,i1) += Tpp(i3,i1)
#
            ENDDO i1
#
      ENDPARDO i2, j1, b, i3  
#
# Fifth-term of Iij_bb
# --------------------
#
      PARDO i2, i1, b, j1
#
            REQUEST Vpiqj(i1,i2,b,j1) i2
#
            DO j2  
#
               GET                  Gijib(i2,j2,i1,b) 
               Tqq(j1,j2)         = Gijib(i2,j2,i1,b)*Vpiqj(i1,i2,b,j1)
               Tqq(j1,j2)        *= -1.0
               PUT Iij_bb(j1,j2) += Tqq(j1,j2)
#
            ENDDO j2
#
      ENDPARDO i2, i1, b, j1
#
# Sixth-term of Iab_bb
# --------------------
#
      PARDO b1, i1, i2, j1 
#
            REQUEST Vpiqj(i1,i2,b1,j1) j1
#
            DO b
#
               GET                 Gijib(i2,j1,i1,b) 
               Tqq(b1,b)         = Vpiqj(i1,i2,b1,j1)*Gijib(i2,j1,i1,b)
               Tqq(b1,b)        *= -1.0
               PUT Iab_bb(b1,b) += Tqq(b1,b)
#
            ENDDO b
#
      ENDPARDO b1, i1, i2, j1
#
# Third-term of Iai_aa
# --------------------
#
      PARDO a, b, j1, i1
#
            REQUEST Viabj(i1,a,b,j1) j1
            iqpqp(j1,i1,b,a)  = Viabj(i1,a,b,j1)
#
            DO i2 
#
               GET                 Gijib(i2,j1,i1,b) 
               Tpp(a,i2)         = Gijib(i2,j1,i1,b)*iqpqp(j1,i1,b,a)
               PUT Iai_aa(a,i2) += Tpp(a,i2)
#
            ENDDO i2
#
      ENDPARDO a, b, j1, i1
#
# Fourth-term of Iai_aa
# ---------------------
#
      PARDO a, b, i1, j1 
#
            REQUEST Vpiqj(a,i1,b,j1) j1
#
            DO i2 
#
               GET                 Gijib(i1,j1,i2,b) 
               Tpp(a,i2)         = Vpiqj(a,i1,b,j1)*Gijib(i1,j1,i2,b)
               PUT Iai_aa(a,i2) += Tpp(a,i2)
#
            ENDDO i2 
#
      ENDPARDO a, b, i1, j1
#
# Third-term of Iai_bb
# --------------------
#
      PARDO b, b1, i2, i1
#
            REQUEST Vbbii(b,b1,i2,i1) b1
#
            DO j1
#
               GET                 Gijib(i2,j1,i1,b1) 
               Tqq(b,j1)         = Gijib(i2,j1,i1,b1)*Vbbii(b,b1,i2,i1)
               PUT Iai_bb(b,j1) += Tqq(b,j1)
#
            ENDDO j1
#
      ENDPARDO b, b1, i2, i1
#
# Sixth-term of Iia_bb
# --------------------
#
      PARDO b, i1, i2, j1
#
            GET Gijib(i2,j1,i1,b) 
#
            DO j2
#
               REQUEST             Vpiqj(i2,i1,j1,j2) j2
               Tqq(j2,b)         = Gijib(i2,j1,i1,b)*Vpiqj(i2,i1,j1,j2)
               Tqq(j2,b)        *= -1.0
               PUT Iia_bb(j2,b) += Tqq(j2,b)
#
            ENDDO j2
#
      ENDPARDO b, i1, i2, j1
#
     execute sip_barrier 
#
# beta/alpha/beta/alpha component 
# --------------------------------- 
#
     create Gjija 
     execute sip_barrier 
# 
     PARDO a, i1, j2, j3 
#
           i1ppqq(a,i1,j2,j3) = 0.0 
#
           DO i  
           DO jb 
           DO kb 
#
              REQUEST               Gaijj(a,i,jb,kb) a 
              GET                   IIi(i,i1) 
              GET                   IJj(jb,j2) 
              GET                   IJj(kb,j3) 
              ippjj(a,i1,jb,kb)     = Gaijj(a,i,jb,kb)*IIi(i,i1) 
              ippqj(a,i1,j2,kb)    = ippjj(a,i1,jb,kb)*IJj(jb,j2) 
              ippqq(a,i1,j2,j3)   = ippqj(a,i1,j2,kb)*IJj(kb,j3) 
              i1ppqq(a,i1,j2,j3) += ippqq(a,i1,j2,j3)  
#
           ENDDO kb
           ENDDO jb
           ENDDO i   
           i1ppqq(a,i1,j2,j3)*= etemp 
#
           i2qpqp(j3,i1,j2,a)    = i1ppqq(a,i1,j2,j3) 
           PUT Gjija(j3,i1,j2,a) = i2qpqp(j3,i1,j2,a) 
#
     ENDPARDO a, i1, j2, j3 
     execute sip_barrier 
#
# Compute contributions to one-particle intermediates
# ---------------------------------------------------
#
# Fifth-term of Iij_aa
# --------------------
#
      PARDO j1, j2, a, i2 
#
            REQUEST Vpiqj(a,i2,j2,j1) j1
#
            DO i1
#
               GET                  Gjija(j1,i1,j2,a) 
               Tpp(i2,i1)         = Gjija(j1,i1,j2,a)*Vpiqj(a,i2,j2,j1)
               Tpp(i2,i1)        *= -1.0
               PUT Iij_aa(i2,i1) += Tpp(i2,i1)
#
            ENDDO i1
#
      ENDPARDO j1, j2, a, i2 
#
# Fifth-term of Iij_bb
# --------------------
#
      PARDO i1, j2, a, j1
#
            REQUEST Vpiqj(a,i1,j2,j1) j1
#
            DO j3 
#
               GET                  Gjija(j3,i1,j2,a) 
               Tqq(j1,j3)         = Gjija(j3,i1,j2,a)*Vpiqj(a,i1,j2,j1)
               Tqq(j1,j3)        *= -1.0
               PUT Iij_bb(j1,j3) += Tqq(j1,j3)
#
            ENDDO j3 
#
      ENDPARDO i1, j2, a, j1
#
# Sixth-term of Iij_bb
# --------------------
#
      PARDO j2, i1, a, j1
#
            REQUEST Vpiqj(a,i1,j1,j2) a
#
            DO j3 
#
               GET                  Gjija(j2,i1,j3,a) 
               Tqq(j1,j3)         = Vpiqj(a,i1,j1,j2)*Gjija(j2,i1,j3,a)
               Tqq(j1,j3)        *= -1.0
               PUT Iij_bb(j1,j3) += Tqq(j1,j3)
#
            ENDDO j3 
#
      ENDPARDO j2, i1, a, j1
#
# Sixth-term of Iab_aa
# --------------------
#
      PARDO a, j1, j2, i1
#
            REQUEST Vpiqj(a,i1,j1,j2) a
#
            DO a1
#
               GET                 Gjija(j2,i1,j1,a1) 
               Tpp(a,a1)         = Vpiqj(a,i1,j1,j2)*Gjija(j2,i1,j1,a1)
               Tpp(a,a1)        *= -1.0
               PUT Iab_aa(a,a1) += Tpp(a,a1)
#
            ENDDO a1
#
      ENDPARDO a, j1, j2, i1
#
# Third-term of Iai_aa
# --------------------
#
      PARDO a, a1, j2, j1
#
            REQUEST             Vaajj(a,a1,j2,j1) j1
            iqqpp(j2,j1,a1,a) = Vaajj(a,a1,j2,j1)
#
            DO i1
#
               GET                 Gjija(j2,i1,j1,a1) 
               Tpp(a,i1)         = Gjija(j2,i1,j1,a1)*iqqpp(j2,j1,a1,a)
               PUT Iai_aa(a,i1) += Tpp(a,i1)
#
            ENDDO i1
#
      ENDPARDO a, a1, j2, j1
#
# Third-term of Iai_bb
# --------------------
#
      PARDO b, a, i1, j1
#
            REQUEST             Viabj(i1,a,b,j1) j1
            ipqpq(i1,j1,a,b)  = Viabj(i1,a,b,j1)
#
            DO j2
#
               GET                 Gjija(j2,i1,j1,a) 
               Tqq(b,j2)         = Gjija(j2,i1,j1,a)*ipqpq(i1,j1,a,b)
               PUT Iai_bb(b,j2) += Tqq(b,j2)
#
            ENDDO j2 
#
      ENDPARDO b, a, i1, j1
#
# Fourth-term of Iai_bb
# ---------------------
#
      PARDO b, a, j1, i1
#
            REQUEST Vpiqj(a,i1,b,j1) j1
#
            DO j2 
#
               GET                 Gjija(j1,i1,j2,a) 
               Tqq(b,j2)         = Vpiqj(a,i1,b,j1)*Gjija(j1,i1,j2,a)
               PUT Iai_bb(b,j2) += Tqq(b,j2)
#
            ENDDO j2 
#
      ENDPARDO b, a, j1, i1
#
# Sixth-term of Iia_aa
# --------------------
#
      PARDO a, j1, j2, i1
#
            GET Gjija(j2,i1,j1,a) 
#
            DO i2
#
               REQUEST             Vpiqj(i1,i2,j2,j1) j1
               Tpp(i2,a)         = Gjija(j2,i1,j1,a)*Vpiqj(i1,i2,j2,j1)
               Tpp(i2,a)        *= -1.0
               PUT Iia_aa(i2,a) += Tpp(i2,a)
#
            ENDDO i2
#
      ENDPARDO a, j1, j2, i1
#
      execute sip_barrier
#
# Prepare Gbijk --> Gkijb to be used in intermediate construction 
# ---------------------------------------------------------------
#
     create Gjjjb  
     execute sip_barrier 
#
# beta/beta/beta/beta component 
# ----------------------------- 
# 
     PARDO b, j1, j2, j3 
#
           i1qqqq(b,j1,j2,j3) = 0.0 
#
           DO ib 
           DO jb 
           DO kb 
#
              REQUEST               Gbjjj(b,jb,ib,kb) b 
              GET                   IJj(ib,j1) 
              GET                   IJj(jb,j2) 
              GET                   IJj(kb,j3) 
              iqqjj(b,j1,jb,kb)   = Gbjjj(b,jb,ib,kb)*IJj(ib,j1) 
              iqqqj(b,j1,j2,kb)   = iqqjj(b,j1,jb,kb)*IJj(jb,j2) 
              iqqqq(b,j1,j2,j3)   = iqqqj(b,j1,j2,kb)*IJj(kb,j3) 
              i1qqqq(b,j1,j2,j3) += iqqqq(b,j1,j2,j3)  
#
           ENDDO kb 
           ENDDO jb 
           ENDDO ib 
           i1qqqq(b,j1,j2,j3)*=etemp 
#
           i2qqqq(j3,j2,j1,b)    = i1qqqq(b,j1,j2,j3) 
           PUT Gjjjb(j3,j2,j1,b) = i2qqqq(j3,j2,j1,b) 
#
     ENDPARDO b, j1, j2, j3 
     execute sip_barrier 
#
# Compute contributions to one-particle intermediates
# ---------------------------------------------------
#
#     Contribution to Iij_bb
#     ----------------------
#
      PARDO j1, j2, j3, b 
#
            REQUEST              VSqjqj(b,j2,j3,j1) b
            iqqqq(j2,j3,b,j1)  = VSqjqj(b,j2,j3,j1)
#
            DO j4
#
               GET                  Gjjjb(j4,j2,j3,b) 
               Tqq(j1,j4)         = Gjjjb(j4,j2,j3,b)*iqqqq(j2,j3,b,j1)
               Tqq(j1,j4)        *= -1.0
               PUT Iij_bb(j1,j4) += Tqq(j1,j4)
#
            ENDDO j4
#
      ENDPARDO j1, j2, j3, b 
#
      PARDO j1, j2, j3, b   
#
            REQUEST VSqjqj(b,j2,j1,j3) j3
#
            DO j4
#
               GET                  Gjjjb(j3,j2,j4,b) 
               Tqq(j1,j4)         = VSqjqj(b,j2,j1,j3)*Gjjjb(j3,j2,j4,b)
               Tqq(j1,j4)        *= -0.5
               PUT Iij_bb(j1,j4) += Tqq(j1,j4)
#
            ENDDO j4
#
      ENDPARDO j1, j2, j3, b  
#
#     Contribution to Iab_bb
#     ----------------------
#
      PARDO b, j2, j3, j1
#
            REQUEST             VSqjqj(b,j1,j2,j3) b
            iqqqq(b,j3,j1,j2) = VSqjqj(b,j1,j2,j3)
#
            DO b1
#
               GET                 Gjjjb(j3,j1,j2,b1) 
               Tqq(b,b1)         = iqqqq(b,j3,j1,j2)*Gjjjb(j3,j1,j2,b1)
               Tqq(b,b1)        *= -0.5
               PUT Iab_bb(b,b1) += Tqq(b,b1)
#
            ENDDO b1
#
      ENDPARDO b, j2, j3, j1
#
#     Contribution to Iai_bb
#     ----------------------
#
      PARDO b, b1, j1, j2
#
            REQUEST Vjbbj(j1,b1,b,j2) j2
            REQUEST Vbbjj(b,b1,j1,j2) j2
#
            iqqqq(j1,j2,b1,b)  = Vjbbj(j1,b1,b,j2)
            i1qqqq(j1,j2,b1,b) = Vbbjj(b,b1,j1,j2)
            iqqqq(j1,j2,b1,b) -= i1qqqq(j1,j2,b1,b)
#
            DO j3 
#
               GET                 Gjjjb(j3,j1,j2,b1) 
               Tqq(b,j3)         = Gjjjb(j3,j1,j2,b1)*iqqqq(j1,j2,b1,b)
               PUT Iai_bb(b,j3) += Tqq(b,j3)
#
            ENDDO j3 
#
      ENDPARDO b, b1, j1, j2
#
      PARDO b, b1, j1, j2
#
            REQUEST VSqjqj(b,j1,b1,j2) b  
#
            DO j3 
#
               GET                 Gjjjb(j1,j2,j3,b1) 
               Tqq(b,j3)         = VSqjqj(b,j1,b1,j2)*Gjjjb(j1,j2,j3,b1)
               Tqq(b,j3)        *= 0.5
               PUT Iai_bb(b,j3) += Tqq(b,j3)
#
            ENDDO j3  
#
      ENDPARDO b, b1, j1, j2 
#
      PARDO b, j3, j1, j2
#
            GET Gjjjb(j1,j2,j3,b) 
#
            DO j4 
#
               REQUEST               VSqjqj(j1,j3,j2,j4) j1  
               iqqqq(j4,j1,j2,j3)  = VSqjqj(j1,j3,j2,j4)
               Tqq(j4,b)           = iqqqq(j4,j1,j2,j3)*Gjjjb(j1,j2,j3,b)
               Tqq(j4,b)          *= -0.5
               PUT Iia_bb(j4,b)   += Tqq(j4,b)
#
            ENDDO j4  
#
      ENDPARDO b, j3, j1, j2 
#
     execute sip_barrier 
#
# Prepare Gaibj --> Gijab to be used in intermediate construction 
# ---------------------------------------------------------------
     etemp =-1.0 
#
# alpha/alpha/alpha/alpha component 
# --------------------------------- 
# 
     PARDO a1, a2, i1, i2 
#
           i1pppp(a1,i1,a2,i2) = 0.0 
#
           DO i 
           DO j 
#
              REQUEST                Gaiai(a1,i,a2,j) a1  
              GET                    IIi(i,i1) 
              GET                    IIi(j,i2) 
              tpppi(a1,i1,a2,j)    = Gaiai(a1,i,a2,j)*IIi(i,i1) 
              ipppp(a1,i1,a2,i2)   = tpppi(a1,i1,a2,j)*IIi(j,i2) 
              i1pppp(a1,i1,a2,i2) += ipppp(a1,i1,a2,i2)  
#
           ENDDO j 
           ENDDO i 
          #i1pppp(a1,i1,a2,i2)*=-2.0 
#
           i2pppp(i1,i2,a1,a2)        = i1pppp(a1,i1,a2,i2) 
           PREPARE Giiaa(i1,i2,a1,a2) = i2pppp(i1,i2,a1,a2) 
#
     ENDPARDO a1, a2, i1, i2 
     execute server_barrier 
#
# Compute contributions to one-particle intermediates
# ---------------------------------------------------
#
# First-term of Iij_aa
# --------------------
#
      PARDO i2, a1, a, i3
#
           REQUEST              VSpipi(a,i2,a1,i3) i3
           ipppp(i2,a1,a,i3)  = VSpipi(a,i2,a1,i3)
#
           DO i1
#
              REQUEST              Giiaa(i1,i2,a1,a) a
              Tpp(i3,i1)         = Giiaa(i1,i2,a1,a)*ipppp(i2,a1,a,i3)
              Tpp(i3,i1)        *= -2.0
              PUT Iij_aa(i3,i1) += Tpp(i3,i1)
#
           ENDDO i1
#
      ENDPARDO i2, a1, a, i3
#
# First-term of Iab_aa
# --------------------
#
      PARDO a, a2, i2, i1
#
            REQUEST VSpipi(a,i2,a2,i1) i1
#
            DO a1
#
               REQUEST             Giiaa(i2,i1,a1,a2) a2
               Tpp(a,a1)         = VSpipi(a,i2,a2,i1)*Giiaa(i2,i1,a1,a2)
               Tpp(a,a1)        *= -2.0
               PUT Iab_aa(a,a1) += Tpp(a,a1)
#
            ENDDO a1
#
      ENDPARDO a, a2, i2, i1
#
# First-term of Iai_aa
# --------------------
#
      PARDO a, a1, a2, i1
#
            REQUEST             VSaaai(a1,a,a2,i1) i1
            ipppp(i1,a1,a2,a) = VSaaai(a1,a,a2,i1)
#
            DO i2
#
               REQUEST             Giiaa(i2,i1,a1,a2) a2
               Tpp(a,i2)         = Giiaa(i2,i1,a1,a2)*ipppp(i1,a1,a2,a)
               Tpp(a,i2)        *= 2.0
               PUT Iai_aa(a,i2) += Tpp(a,i2)
#
            ENDDO i2
#
      ENDPARDO a, a1, a2, i1
#
# First-term of Iia_aa
# --------------------
#
      PARDO a, a1, i2, i1
#
            REQUEST Giiaa(i2,i1,a,a1) a1
#
            DO i3
#
               REQUEST              VSpipi(a1,i1,i3,i2) i2
               Tpp(i3,a)           = VSpipi(a1,i1,i3,i2)*Giiaa(i2,i1,a,a1)
               Tpp(i3,a)          *= -2.0
               PUT Iia_aa(i3,a)   += Tpp(i3,a)
#
            ENDDO i3
#
      ENDPARDO a, a1, i2, i1
#
# Prepare Gaibj --> Gijab to be used in intermediate construction 
# ---------------------------------------------------------------
#
# alpha/beta/alpha/beta component 
# --------------------------------- 
# 
     PARDO a1, b2, i1, j2 
#
           i1ppqq(a1,i1,b2,j2) = 0.0 
#
           DO i 
           DO jb 
#
              REQUEST                Gaibj(a1,i,b2,jb) a1  
              GET                    IIi(i,i1) 
              GET                    IJJ(jb,j2) 
              tppqj(a1,i1,b2,jb)   = Gaibj(a1,i,b2,jb)*IIi(i,i1) 
              ippqq(a1,i1,b2,j2)   = tppqj(a1,i1,b2,jb)*IJJ(jb,j2) 
              i1ppqq(a1,i1,b2,j2) += ippqq(a1,i1,b2,j2)  
#
           ENDDO jb 
           ENDDO i 
          #i1ppqq(a1,i1,b2,j2)*=-4.0 
#
           i2pqpq(i1,j2,a1,b2)        = i1ppqq(a1,i1,b2,j2) 
           PREPARE Gijab(i1,j2,a1,b2) = i2pqpq(i1,j2,a1,b2) 
#
     ENDPARDO a1, b2, i1, j2 
     execute server_barrier 
#
# Compute contributions to one-particle intermediates
# ---------------------------------------------------
#
# First-term of Iij_aa
# --------------------
#
      PARDO j1, a, b, i2
#
           REQUEST Vpiqj(a,i2,b,j1) j1
#
           DO i1
#
              REQUEST              Gijab(i1,j1,a,b) b
              Tpp(i2,i1)         = Gijab(i1,j1,a,b)*Vpiqj(a,i2,b,j1)
              Tpp(i2,i1)        *= -4.0
              PUT Iij_aa(i2,i1) += Tpp(i2,i1)
#
           ENDDO i1
#
      ENDPARDO j1, a, b, i2
#
# First-term of Iij_bb
# --------------------
#
      PARDO i1, b, a, j1
#
            REQUEST Vpiqj(a,i1,b,j1) j1
#
            DO j2
#
               REQUEST              Gijab(i1,j2,a,b) b
               Tqq(j1,j2)         = Gijab(i1,j2,a,b)*Vpiqj(a,i1,b,j1)
               Tqq(j1,j2)        *= -4.0
               PUT Iij_bb(j1,j2) += Tqq(j1,j2)
#
            ENDDO j2
#
      ENDPARDO i1, b, a, j1
#
# First-term of Iab_aa
# --------------------
#
      PARDO a, b, i1, j1
#
            REQUEST Vpiqj(a,i1,b,j1) j1
#
            DO a1
#
               REQUEST             Gijab(i1,j1,a1,b) b
               Tpp(a,a1)         = Vpiqj(a,i1,b,j1)*Gijab(i1,j1,a1,b)
               Tpp(a,a1)        *= -4.0
               PUT Iab_aa(a,a1) += Tpp(a,a1)
#
            ENDDO a1
#
      ENDPARDO a, b, i1, j1
#
# First-term of Iab_bb
# --------------------
#
      PARDO b1, a, j1, i1
#
            REQUEST Vpiqj(a,i1,b1,j1) j1
#
            DO b
#
               REQUEST             Gijab(i1,j1,a,b) b
               Tqq(b1,b)         = Vpiqj(a,i1,b1,j1)*Gijab(i1,j1,a,b)
               Tqq(b1,b)        *= -4.0
               PUT Iab_bb(b1,b) += Tqq(b1,b)
#
            ENDDO b
#
      ENDPARDO b1, a, j1, i1
#
# First-term of Iai_aa
# --------------------
#
      PARDO a, a1, b, j1
#
            REQUEST Vaabj(a1,a,b,j1) j1
            iqpqp(j1,a1,b,a)  = Vaabj(a1,a,b,j1)
#
            DO i1
#
               REQUEST             Gijab(i1,j1,a1,b) b
               Tpp(a,i1)         = Gijab(i1,j1,a1,b)*iqpqp(j1,a1,b,a)
               Tpp(a,i1)        *= 4.0
               PUT Iai_aa(a,i1) += Tpp(a,i1)
#
            ENDDO i1
#
      ENDPARDO a, a1, b, j1
#
# First-term of Iai_bb
# --------------------
#
      PARDO b, b1, a, i1
#
            REQUEST             Vbbai(b1,b,a,i1) i1
            ipqpq(i1,b1,a,b)  = Vbbai(b1,b,a,i1)
#
            DO j1
#
               REQUEST             Gijab(i1,j1,a,b1) b1
               Tqq(b,j1)         = Gijab(i1,j1,a,b1)*ipqpq(i1,b1,a,b)
               Tqq(b,j1)        *= 4.0
               PUT Iai_bb(b,j1) += Tqq(b,j1)
#
            ENDDO j1
#
      ENDPARDO b, b1, a, i1
#
# First-term of Iia_aa
# --------------------
#
      PARDO a, b, i1, j1
#
            REQUEST Gijab(i1,j1,a,b) b
#
            DO i2
#
               REQUEST             Vpiqj(i2,i1,b,j1) j1
               Tpp(i2,a)         = Vpiqj(i2,i1,b,j1)*Gijab(i1,j1,a,b)
               Tpp(i2,a)        *= -4.0
               PUT Iia_aa(i2,a) += Tpp(i2,a)
#
            ENDDO i2
#
      ENDPARDO a, b, i1, j1
#
# First-term of Iia_bb
# --------------------
#
      PARDO b, a, j1, i1
#
            REQUEST Gijab(i1,j1,a,b) b
#
            DO j2
#
               REQUEST             Vpiqj(a,i1,j2,j1) j1
               Tqq(j2,b)         = Vpiqj(a,i1,j2,j1)*Gijab(i1,j1,a,b)
               Tqq(j2,b)        *= -4.0
               PUT Iia_bb(j2,b) += Tqq(j2,b)
#
            ENDDO j2
#
      ENDPARDO b, a, j1, i1
#
# Prepare Gaibj --> Gijab to be used in intermediate construction 
# ---------------------------------------------------------------
#
# beta/beta/beta/beta component 
# --------------------------------- 
# 
     PARDO b1, b2, j1, j2 
#
           i1qqqq(b1,j1,b2,j2) = 0.0 
#
           DO ib 
           DO jb 
#
              REQUEST                Gbjbj(b1,ib,b2,jb) b1  
              GET                    IJj(ib,j1) 
              GET                    IJj(jb,j2) 
              tqqqj(b1,j1,b2,jb)   = Gbjbj(b1,ib,b2,jb)*IJj(ib,j1) 
              iqqqq(b1,j1,b2,j2)   = tqqqj(b1,j1,b2,jb)*IJj(jb,j2) 
              i1qqqq(b1,j1,b2,j2) += iqqqq(b1,j1,b2,j2)  
#
           ENDDO jb  
           ENDDO ib  
          #i1qqqq(b1,j1,b2,j2)*=-2.0 
#
           i2qqqq(j1,j2,b1,b2)        = i1qqqq(b1,j1,b2,j2) 
           PREPARE Gjjbb(j1,j2,b1,b2) = i2qqqq(j1,j2,b1,b2) 
#
     ENDPARDO b1, b2, j1, j2 
     execute server_barrier 
#
# Compute contributions to one-particle intermediates
# ---------------------------------------------------
#
# First-term of Iij_bb
# --------------------
#
      PARDO j2, b1, b, j3
#
           REQUEST              VSqjqj(b,j2,b1,j3) j3
           iqqqq(j2,b1,b,j3)  = VSqjqj(b,j2,b1,j3)
#
           DO j1
#
              REQUEST              Gjjbb(j1,j2,b1,b) b
              Tqq(j3,j1)         = Gjjbb(j1,j2,b1,b)*iqqqq(j2,b1,b,j3)
              Tqq(j3,j1)        *= -2.0
              PUT Iij_bb(j3,j1) += Tqq(j3,j1)
#
           ENDDO j1
#
      ENDPARDO j2, b1, b, j3
#
# First-term of Iab_bb
# --------------------
#
      PARDO b, b2, j2, j1
#
            REQUEST VSqjqj(b,j2,b2,j1) j1
#
            DO b1
#
               REQUEST             Gjjbb(j2,j1,b1,b2) b2
               Tqq(b,b1)         = VSqjqj(b,j2,b2,j1)*Gjjbb(j2,j1,b1,b2)
               Tqq(b,b1)        *= -2.0
               PUT Iab_bb(b,b1) += Tqq(b,b1)
#
            ENDDO b1
#
      ENDPARDO b, b2, j2, j1
#
# First-term of Iai_bb
# --------------------
#
      PARDO b, b1, b2, j1
#
            REQUEST             VSbbbj(b1,b,b2,j1) j1
            iqqqq(j1,b1,b2,b) = VSbbbj(b1,b,b2,j1)
#
            DO j2
#
               REQUEST             Gjjbb(j2,j1,b1,b2) b2
               Tqq(b,j2)         = Gjjbb(j2,j1,b1,b2)*iqqqq(j1,b1,b2,b)
               Tqq(b,j2)        *= 2.0
               PUT Iai_bb(b,j2) += Tqq(b,j2)
#
            ENDDO j2
#
      ENDPARDO b, b1, b2, j1
#
# First-term of Iia_bb
# --------------------
#
      PARDO b, b1, j2, j1
#
            REQUEST Gjjbb(j2,j1,b,b1) b1
#
            DO j3
#
               REQUEST              VSqjqj(b1,j1,j3,j2) j2
               Tqq(j3,b)           = VSqjqj(b1,j1,j3,j2)*Gjjbb(j2,j1,b,b1)
               Tqq(j3,b)          *= -2.0
               PUT Iia_bb(j3,b)   += Tqq(j3,b)
#
            ENDDO j3
#
      ENDPARDO b, b1, j2, j1
#
# Done formation of the one-particle intermediate contributions coming from
# the two-particle density from T3. 
# -------------------------------------------------------------------------- 
#
     ENDPROC FORM_ONEI    
#    -----------------  
#
# --------------------------------------------------------------------------
#
# --------------------------------------------------------------------------
#
# MAIN PROGRAM 
#
# --------------------------------------------------------------------------
#
# Compute E^{(T)} contribution and form sai, sbj, saaii, sbbjj, and sabij   
# -----------------------------------------------------------------------  
#
     execute sip_barrier 
     create sai  
     create sbj  
     create Dai  
     create Dbj  
     create Da  
     create DaS 
     create DbS 
     create Db 
     create Di  
     create Dj 
     execute sip_barrier 
#
     CALL READ_BLOCKDATA  
     CALL PDATA 
     CALL FORM_IDENTITY   
     CALL T4AAA 
#
     CALL T4BBB 
  ###CALL T4AAB --> NOT USED ANYMORE  
  ###CALL T4ABB --> NOT USED ANYMORE  
     CALL ST5  #--> Not used in this version to compute the energy only for comparison  
#
# Compute contributions to one-particle intermediates 
# --------------------------------------------------- 
#
     CALL FORM_ONEI 
#
# Backtransform two-density to Gxxxi and Gxxxj 
# -------------------------------------------- 
#
     CALL B3TRAN 
#
# Compute gradient contribution from Gxxxx * I'xxxx 
# ------------------------------------------------- 
#
      CALL PDCONT 

# Test routines to print data out for debugging 
# --------------------------------------------- 
#
#     CALL PRINT_Gaaai # --> Symmetric  
#     CALL PRINT_Gaiii # --> Symmetric  
#     CALL PRINT_Gaiai # --> Symmetric  
#
     execute sip_barrier 

# Prepare s arrays to be written out and used in lambda  
# -----------------------------------------------------  
#
     CALL S_PREP 
      destroy VSpipi
      destroy Vaaii
      destroy Viaai
      destroy VSaaai
      destroy VSqjqj
      destroy Vbbjj
      destroy Vjbbj
      destroy VSbbbj
      destroy Vbbii
      destroy Vjbii
      destroy Vbbai
      destroy Vpiqj
      destroy Vaajj
      destroy Viabj
      destroy Vaabj

      destroy t1a_old
      destroy t1b_old
      destroy T2aiai
      destroy T2aibj
      destroy T2bjbj

     execute server_barrier
     CALL READ_BLOCKDATA
     execute server_barrier
#
     execute sip_barrier 
     CALL WRITE_BLOCKDATA  
     execute sip_barrier 
     ENDSIAL TRY4_GRAD     
#
#
#
#
