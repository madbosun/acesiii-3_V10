#  Copyright (c) 2003-2010 University of Florida
#
#  This program is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 2 of the License, or
#  (at your option) any later version.
#
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#
#  The GNU General Public License is included in this distribution
#  in the file COPYRIGHT.
                           SIAL CCSD_RHF_SV1
#
#-------------------------------------------------------------------------------
#
# Declare indeces
# ---------------
#
      index N1       = 1, 1 # cc_iter
      index NT       = 1, 10000 
      index i7       = 1, 7 
      index ii       = 1, naocc
      index jj       = 1, naocc
      index kk       = 1, naocc
      index kiter    = 1, 1
      index kptr1    = 1, 2
#
      aoindex mu     = 1, norb
      aoindex nu     = 1, norb
      aoindex lambda = 1, norb
      aoindex sigma  = 1, norb
#
      moaindex  i= baocc, eaocc
      moaindex  k= baocc, eaocc
      moaindex i1= baocc, eaocc
      mobindex k1= bbocc, ebocc

      moaindex i2= baocc, eaocc
      moaindex i3= baocc, eaocc
#
      moaindex a = bavirt, eavirt
      moaindex a1= bavirt, eavirt
      moaindex a2= bavirt, eavirt
      moaindex a3= bavirt, eavirt
#
      mobindex  j= bbocc, ebocc
      mobindex j1= bbocc, ebocc
      mobindex j2= bbocc, ebocc
      mobindex j3= bbocc, ebocc
#
      moaindex k2= baocc, eaocc
      moaindex k3= baocc, eaocc
#
      mobindex b = bbvirt, ebvirt
      mobindex b1= bbvirt, ebvirt
      mobindex b2= bbvirt, ebvirt
      mobindex b3= bbvirt, ebvirt
#
      mobindex bb= bbvirt, ebvirt
      mobindex bb1= bbvirt, ebvirt
      mobindex jj1= bbocc, ebocc
      mobindex jj2= bbocc, ebocc
#
      moaindex p = baocc, eavirt
      moaindex p1= baocc, eavirt
      moaindex p2= baocc, eavirt
      moaindex p3= baocc, eavirt
#
      mobindex q = bbocc, ebvirt
      mobindex q1= bbocc, ebvirt
      mobindex q2= bbocc, ebvirt
      mobindex q3= bbocc, ebvirt

      index kroot    = 1, 12
      index indstate = 1, 12
      index kindex12 = 1, 12
      index indone   = 1, 1
#
# Declare EOM specific arrays
#
      scalar ecorrT
      scalar R0
      SCALAR  iroot
      SCALAR  rootcount
      SCALAR  ZERO
      SCALAR  OMEGA
      SCALAR  OMEGA2
      SCALAR  L_OMEGA
      SCALAR  root_thresh
      SCALAR RNORM
      SCALAR LNORM
      SCALAR LRNORM
      scalar etemp1
      scalar etemp2
      scalar etemp3
      scalar etemp4
      scalar etemp5
      scalar sum1
      scalar sum2
      scalar sum3
      scalar sum4
      scalar sum5
      scalar onehalf 


      STATIC  ST_ROOTS (kroot,indone)
      STATIC  ST_ECORR (kroot,indone)
      TEMP         TEE (kroot,indone)
      TEMP         T1EE (kroot,indone)
      TEMP  tt1ia   (i1,a1)
      TEMP  tt1ai   (a1,i1)
      TEMP  tt2ai   (a1,i1)
      TEMP  ttiajb  (i1,a1,j1,b1)
      TEMP  tt1iaia (i1,a1,i2,a1)
      TEMP  tt1aiai (a1,i1,a2,i2)
      TEMP  tt2aiai (a1,i1,a2,i2)
      TEMP  ttaibj  (a1,i1,b1,j1)
      TEMP  tt1aibj (a1,i1,b1,j1)
      temp taiai(a,i,a1,i1)
      temp t1aiai(a,i,a1,i1)
      temp tiaia(i,a,i1,a1)
      temp taibj(a,i,b,j)
      temp t1iaia(i,a,i1,a1)
      TEMP tai(a,i)
      TEMP tia(i,a)

      TEMP  tt1jb   (j1,b1)
      TEMP  tt1bj   (b1,j1)
      TEMP  tt2bj   (b1,j1)
      TEMP  ttjbjb  (j1,b1,j1,b1)
      TEMP  tt1jbjb (j1,b1,j2,b1)
      TEMP  tt1bjbj (b1,j1,b2,j2)
      TEMP  tt2bjbj (b1,j1,b2,j2)
      TEMP  ttbjbj  (b1,j1,b1,j1)
      temp tbjbj(b,j,b1,j1)
      temp t1bjbj(b,j,b1,j1)
      temp tjbjb(j,b,j1,b1)
      temp t1jbjb(j,b,j1,b1)
      TEMP tbj(b,j)
      TEMP tjb(j,b)

      DISTRIBUTED  REE (kroot,indone)
      DISTRIBUTED  LEE (kroot,indone)

      DISTRIBUTED  R1A_VECS (a1,i1,kroot)
      DISTRIBUTED  R1B_VECS (b1,j1,kroot)
      DISTRIBUTED  L1A_VECS (i1,a1,kroot)
      DISTRIBUTED  L1B_VECS (j1,b1,kroot)
     
      SERVED  R2AA_VECS (a1,i1,a2,i2,kroot)
      SERVED  R2AB_VECS (a1,i1,b1,j1,kroot)
      SERVED  R2BB_VECS (b1,j1,b2,j2,kroot)
      SERVED  L2AA_VECS (i1,a1,i2,a2,kroot)
      SERVED  L2AB_VECS (i1,a1,j1,b1,kroot)
      SERVED  L2BB_VECS (j1,b1,j2,b2,kroot)

      distributed HBAR_ia (i1,a)
      distributed HBAR_jb (j1,b)

      SERVED  Vxjqj (mu,j,q,j1)
      SERVED  Vxjxj (mu,j,nu,j1)

      TEMP    Txjxj (mu,j2,lambda,j)
      TEMP    Tqjqj (q,j,q1,j1)
      TEMP    Txjqj (mu,j,q,j1)
      TEMP    T1xjqj (mu,j,q,j1)

      distributed l1a_old (i,a) 
      distributed l1b_old (j,b) 
      served LSiaia (i,a,i1,a1) 
      served L2iajb (i,a,j,b) 
      served LSjbjb (j,b,j1,b1) 
      served LSaiai(a,i,a1,i1) 
      served LSbjbj(b,j,b1,j1) 
      served L2aibj(a,i,b,j) 
      served s1la(a,i) 
      served s1lb(b,j) 
      temp tppqp(a,a1,b,k1)  
  
#
# Declare static arrays
# ---------------------
      served T2aiai(a,i,a1,i1)
      served VSpipi(p,i,p1,i1)
      served VSqjqj(q,j,q1,j1)
      served  Vpiqj(p,i,q,j)
      temp   taaai(a,a1,a2,i)
      temp   taabj(a,a1,b2,j)
      temp   tbbai(b,b1,a2,i)
      served Vaabj(a,a1,b2,j)
      served Vbbai(b,b1,a,i)
      served VSaaai(a,a1,a2,i1)
      served TSaiai(a3,i1,a1,i1) 
      served TSbjbj(b,j,b1,j1) 
      served T2aibj(a,i,b,j) 

      temp   taaii(a,a1,i,i1)
      temp    tiaai(i,a,a1,i1)
      served  Vaaii(a,a1,i,i1)
      served  Viaai(i,a,a1,i1)
      distributed Daa(a,a1)
      temp taaa(a,a1,a2) 
      temp taa(a3,a1)
      temp sa(p)
#
      temp dpppp(p,p1,p2,p3) 
      temp tqqqq(q,q1,q2,q3) 
      temp tpppp(p,p1,p2,p3) 
      temp t1pppp(p,p1,p2,p3) 
      temp t2pppp(p,p1,p2,p3) 
      temp t3pppp(p,p1,p2,p3) 
      temp t4pppp(p,p1,p2,p3) 
      temp txpppp(p,p1,p2,p3) 
#
#VVVVV
      temp tppqq(p,p1,q2,q3) 
      temp t1qqpp(q,q1,p2,p3) 
      temp t1qpqp(q,p,q1,p1) 
      temp tqqp(q,q1,p) 
      temp t1qpq(q1,p,q) 
      temp t1qpqs(q1,p,q,ii) 
      temp t2qpq(q1,p,q1) 
      temp t1pqq(p,q1,q) 
      temp tpqqp(p2,q,q1,p1) 
      temp t1pqqs(p2,q,q1,ii)   
      temp t2pqqs(p2,q,q1,ii)   
      temp tpqq(p2,q,q1)  
      temp t1ppqq(p,p1,q,q1) 
      temp tpqqs(p,q2,q,ii) 
      temp t2ppqq(p,p1,q,q1)   
      temp t1pqqp(p3,q,q1,p1) 
      temp t2pqqp(p3,q,q1,p1) 
      temp tqpqp(q2,p1,q,p1) 
      temp tqpqs(q2,p,q1,jj) 
      temp tqpq(q2,p,q1) 
      temp t3pqqp(p,q,q1,p1) 
      temp t4pqqp(p,q,q1,p1) 
      temp t2pqq(p,q,q1)   
      temp t3pqqs(p1,q,q1,ii) 
      temp t3pqq(p1,q,q1) 
      temp t4pqqs(p,q,q1,ii) 
      temp t4pqq(p,q,q1) 
#
      local Xaaaiii(a,a1,b,k1,ii,jj) 
      local Raaaiii(a,a1,b,k1,ii,jj) 
      temp taaaiii(a,a1,b,k1,ii,jj) 
      served t1a_old(a,i1) 
      served t1b_old(b,j1) 
      temp xai(a,ii) 
      temp x1ai(a,ii) 
      distributed sai(a,ii) 
      distributed zbj(b,j1) 

      static pinf(kiter,kptr1)
      temp tpinf(kiter,kptr1)
      scalar ncount1
#
# Declare scalars
# ---------------
#
      scalar etemp
      scalar xtemp
      scalar xtemp1
      scalar xtemp2
      scalar xtemp3
      scalar xtemp4
      scalar xtemp5
      scalar xtemp6
      scalar xtemp7
      scalar xtemp8
      scalar xtemp9
      scalar xtemp10
      scalar xtemp11
      scalar xtemp12
      scalar xtemp13
      scalar xtemp14
      scalar xtemp15

      scalar one
      scalar two
      scalar three
      scalar four
      scalar five
      scalar six
      scalar seven
      scalar eight
      scalar nine
      scalar ten
      scalar eleven
      scalar twelve
      scalar thirteen
      scalar fourteen
      scalar fifteen

      scalar esum
      scalar easum
      scalar eaab  
      scalar esaab  
      scalar efact 
      scalar fact 

      scalar imin 
      scalar imax  
      scalar jmin 
      scalar jmax  
      scalar icount 
      scalar iicount 
      scalar jcount 
      scalar jjcount 
      scalar kcount 
      scalar ncount 
      scalar pcount 
      scalar fcount 
      scalar xcount 
      scalar nsects 

      scalar istart 
      scalar iend  
      scalar jstart 
      scalar jend  
      scalar kstart 
      scalar kend 
      scalar whichi 
      scalar whichj 

      scalar TCOMB                                                        

      temp iflag(i1) 
      temp jflag(j1) 
      temp tppps(p,p1,p2,ii) 
      temp t1ppps(p,p1,p2,ii) 
      temp t2ppps(p,p1,p2,ii) 
      temp t3ppps(p,p1,p2,ii) 
      temp t4ppps(p,p1,p2,ii) 
#
      temp tqqps(b1,b,a1,jj) 
#
      temp tppp(p,p1,p2) 
      temp t1ppp(p,p1,p2) 
      temp t2ppp(p,p1,p2) 
      temp t3ppp(p,p1,p2) 
      temp t4ppp(p,p1,p2) 
      temp tpsp(p,ii,p2) 
      temp tpps(p,p2,ii) 
      temp t1pps(p,p2,ii) 
      temp tpp(p,p2) 
      temp t1pp(p,p2) 
      temp tqq(q,q2) 
      temp t1qq(q,q2) 
#
      local Lxxxi(mu,nu,lambda,i)
      local Lxxxj(mu,nu,lambda,j)
      local Lxxai(mu,nu,a,i)
      local Lxxbj(mu,nu,b,j)
      local Lxaai(mu,a1,a,i)
      local Lxabj(mu,a1,b,j)
      local Lxbai(mu,b1,a,i) 
      served Vxxxi(mu,nu,lambda,i)
      served Vxxxj(mu,nu,lambda,j)
      served Vxixi(mu,i1,lambda,i)
      served Vxixj(mu,i1,lambda,j)
      served Vxxii(mu,nu,i1,i)
      served Vixxi(i1,nu,lambda,i)
      served Vxipi(mu,i,p,i1)
      served Vxiqj(mu,i,q,j1)
      served Vixai(i,mu,a,i1)
      served Vxaii(mu,a,i,i1)
      served Vxxai(mu,nu,a,i)
      served Vxxbj(mu,nu,b,j)
      served Vxaai(mu,a1,a,i)
      served Vxbai(mu,b1,a,i)
      served Vxabj(mu,a1,b,j)
      temp aoint(mu,nu,lambda,sigma)
      temp Txxxi(mu,nu,lambda,i)
      temp T1xxxi(mu,nu,lambda,i)
      temp Txxxj(mu,nu,lambda,j)
      temp T1xxxj(mu,nu,lambda,j)
      temp Txixi(mu,i1,lambda,i)
      temp Txixj(mu,i1,lambda,j)
      temp Txxai(mu,nu,a,i)
      temp Txxbj(mu,nu,b,j)
      temp Txaai(mu,a1,a,i)
      temp Txbai(mu,b1,a,i)
      temp Txabj(mu,a1,b,j)
      temp Txipi(mu,i,p,i1)
      temp Txiqj(mu,i,q,j1)
      temp T1xipi(mu,i,p,i1)
      local Laaai(a2,a,a1,i)
      local Laabj(a2,a,b1,j)
      local Lbbai(b2,b,a1,i)
      temp T1aaai(a2,a,a1,i)
      temp T1aabj(a2,a,b1,j)
      temp T1bbai(b2,b,a1,i)
      temp Tpipi(p,i,p1,i1) 
      temp Tpiqj(p,i,q1,j1) 
      temp T1pipi(p,i,p1,i1) 
#
#    ------------------------------------------------------------------------
#
#    Perform the first two stages of the transformation in two N5 steps.
#
     PROC TRAN_TRAN2
#
#    ------------------------------------------------------------------------
#
     PARDO mu, nu, lambda
#
          allocate Lxxxi(mu,nu,lambda,*)
#
          DO sigma
             compute_integrals aoint(mu,nu,lambda,sigma)
             DO i
                 T1xxxi(mu,nu,lambda,i)  = aoint(mu,nu,lambda,sigma)*ca(sigma,i)
                 Lxxxi(mu,nu,lambda,i)  += T1xxxi(mu,nu,lambda,i)
             ENDDO i
          ENDDO sigma

          DO i
             T1xxxi(mu,nu,lambda,i)         = Lxxxi(mu,nu,lambda,i)
             PREPARE Vxxxi(mu,nu,lambda,i)  = T1xxxi(mu,nu,lambda,i)
           DO i1
              Txixi(mu,i1,lambda,i)      = Lxxxi(mu,nu,lambda,i)*ca(nu,i1)
              PREPARE Vxixi(mu,i1,lambda,i) += Txixi(mu,i1,lambda,i)
           ENDDO i1
         ENDDO i
#
         deallocate Lxxxi(mu,nu,lambda,*)
#
     ENDPARDO mu, nu, lambda
#
     PARDO mu, nu, lambda

          allocate Lxxxj(mu,nu,lambda,*)

          DO sigma
             compute_integrals aoint(mu,nu,lambda,sigma)
             DO j
                 T1xxxj(mu,nu,lambda,j)  = aoint(mu,nu,lambda,sigma)*cb(sigma,j)
                 Lxxxj(mu,nu,lambda,j)  += T1xxxj(mu,nu,lambda,j)
             ENDDO j
          ENDDO sigma

          DO j
             T1xxxj(mu,nu,lambda,j)         = Lxxxj(mu,nu,lambda,j)
             PREPARE Vxxxj(mu,nu,lambda,j)  = T1xxxj(mu,nu,lambda,j)
           DO i1
              Txixj(mu,i1,lambda,j)      = Lxxxj(mu,nu,lambda,j)*ca(nu,i1)
              PREPARE Vxixj(mu,i1,lambda,j) += Txixj(mu,i1,lambda,j)
           ENDDO i1
           DO j2
              Txjxj(mu,j2,lambda,j)      = Lxxxj(mu,nu,lambda,j)*cb(nu,j2)
              PREPARE Vxjxj(mu,j2,lambda,j) += Txjxj(mu,j2,lambda,j)
           ENDDO j2
         ENDDO j

         deallocate Lxxxj(mu,nu,lambda,*)

     ENDPARDO mu, nu, lambda

     execute server_barrier
#
#    ------------------------------------------------------------------------
#
     PARDO mu, nu, i
#
        ALLOCATE Lxxai(mu,nu,*,i)
#
        DO lambda
           REQUEST Vxxxi(mu,nu,lambda,i) i

           DO a
              Txxai(mu,nu,a,i) = Vxxxi(mu,nu,lambda,i)*ca(lambda,a)
              Lxxai(mu,nu,a,i) += Txxai(mu,nu,a,i)
           ENDDO a

        ENDDO lambda
#
        DO a
           Txxai(mu,nu,a,i)         = Lxxai(mu,nu,a,i) 
           PREPARE Vxxai(mu,nu,a,i) = Txxai(mu,nu,a,i)
        ENDDO a

        DEALLOCATE Lxxai(mu,nu,*,i)
#
     ENDPARDO mu, nu, i
#
     PARDO mu, nu, j

        ALLOCATE Lxxbj(mu,nu,*,j)

        DO lambda
           REQUEST Vxxxj(mu,nu,lambda,j) j

           DO b
              Txxbj(mu,nu,b,j) = Vxxxj(mu,nu,lambda,j)*cb(lambda,b)
              Lxxbj(mu,nu,b,j) += Txxbj(mu,nu,b,j)
           ENDDO b

        ENDDO lambda

        DO b
           Txxbj(mu,nu,b,j)         = Lxxbj(mu,nu,b,j) 
           PREPARE Vxxbj(mu,nu,b,j) = Txxbj(mu,nu,b,j)
        ENDDO b

        DEALLOCATE Lxxbj(mu,nu,*,j)

     ENDPARDO mu, nu, j
#
#    ------------------------------------------------------------------------
#
     execute server_barrier
     destroy Vxxxi
     destroy Vxxxj
#
#    ------------------------------------------------------------------------
#
     ENDPROC TRAN_TRAN2
#
#    ------------------------------------------------------------------------
#
#    Perform the third N5 stage of the transformation.
#
     PROC TRAN_TRAN3
#
#    ------------------------------------------------------------------------
#
     PARDO mu, nu, i, i1
           REQUEST Vxixi(mu,i,nu,i1) i1
           DO p
              Txipi(mu,i,p,i1)          = Vxixi(mu,i,nu,i1)*ca(nu,p)
              PREPARE Vxipi(mu,i,p,i1) += Txipi(mu,i,p,i1)
           ENDDO p
     ENDPARDO mu, nu, i, i1

     PARDO mu, nu, j, j1
           REQUEST Vxjxj(mu,j,nu,j1) j1
           DO q
              Txjqj(mu,j,q,j1)          = Vxjxj(mu,j,nu,j1)*cb(nu,q)
              PREPARE Vxjqj(mu,j,q,j1) += Txjqj(mu,j,q,j1)
           ENDDO q
     ENDPARDO mu, nu, j, j1

#
     PARDO mu, nu, i, j1
           REQUEST Vxixj(mu,i,nu,j1) j1
           DO q
              Txiqj(mu,i,q,j1)          = Vxixj(mu,i,nu,j1)*cb(nu,q)
              PREPARE Vxiqj(mu,i,q,j1) += Txiqj(mu,i,q,j1)
           ENDDO q
     ENDPARDO mu, nu, i, j1
#
#    ------------------------------------------------------------------------
#
     PARDO mu, a, i
#
        ALLOCATE Lxaai(mu,*,a,i)

        DO nu
           REQUEST Vxxai(mu,nu,a,i) i
#
           DO a1
#
              Txaai(mu,a1,a,i)  = Vxxai(mu,nu,a,i)*ca(nu,a1)
              Lxaai(mu,a1,a,i) += Txaai(mu,a1,a,i)
#
           ENDDO a1
        ENDDO nu
#
        DO a1
           Txaai(mu,a1,a,i)         = Lxaai(mu,a1,a,i) 
           PREPARE Vxaai(mu,a1,a,i) = Txaai(mu,a1,a,i)
        ENDDO a1

        DEALLOCATE Lxaai(mu,*,a,i)
     ENDPARDO mu, a, i
#
     PARDO mu, a, i
#
        ALLOCATE Lxbai(mu,*,a,i)

        DO nu
           REQUEST Vxxai(mu,nu,a,i) i
#
           DO b1
#
              Txbai(mu,b1,a,i)  = Vxxai(mu,nu,a,i)*cb(nu,b1)
              Lxbai(mu,b1,a,i) += Txbai(mu,b1,a,i)
#
           ENDDO b1
        ENDDO nu
#
        DO b1
           Txbai(mu,b1,a,i)         = Lxbai(mu,b1,a,i) 
           PREPARE Vxbai(mu,b1,a,i) = Txbai(mu,b1,a,i)
        ENDDO b1

        DEALLOCATE Lxbai(mu,*,a,i)
     ENDPARDO mu, a, i
#
     PARDO mu, b, j
#
        ALLOCATE Lxabj(mu,*,b,j)

        DO nu
           REQUEST Vxxbj(mu,nu,b,j) j
#
           DO a1
#
              Txabj(mu,a1,b,j)  = Vxxbj(mu,nu,b,j)*ca(nu,a1)
              Lxabj(mu,a1,b,j) += Txabj(mu,a1,b,j)
#
           ENDDO a1
        ENDDO nu
#
        DO a1
           Txabj(mu,a1,b,j)         = Lxabj(mu,a1,b,j) 
           PREPARE Vxabj(mu,a1,b,j) = Txabj(mu,a1,b,j)
        ENDDO a1

        DEALLOCATE Lxabj(mu,*,b,j)
     ENDPARDO mu, b, j
#
#    ------------------------------------------------------------------------
#
     execute server_barrier
     destroy Vxxai
#
     ENDPROC TRAN_TRAN3
#
#    ------------------------------------------------------------------------
#
#    ------------------------------------------------------------------------
#
     PROC TRAN_TRAN4
#
#    ------------------------------------------------------------------------
#
     PARDO mu, p, i, i1
           REQUEST             Vxipi(mu,i,p,i1) i1
           REQUEST             Vxipi(mu,i1,p,i) i
           Txipi(mu,i,p,i1)  = Vxipi(mu,i,p,i1)
           T1xipi(mu,i,p,i1) = Vxipi(mu,i1,p,i)
           Txipi(mu,i,p,i1) -= T1xipi(mu,i,p,i1)

           DO p1
              Tpipi(p1,i,p,i1)           = Txipi(mu,i,p,i1)*ca(mu,p1)
              PREPARE VSpipi(p1,i,p,i1) += Tpipi(p1,i,p,i1)
           ENDDO p1
     ENDPARDO mu, p, i, i1

     PARDO mu, q, j, j1
           REQUEST             Vxjqj(mu,j,q,j1) j1
           REQUEST             Vxjqj(mu,j1,q,j) j
           Txjqj(mu,j,q,j1)  = Vxjqj(mu,j,q,j1)
           T1xjqj(mu,j,q,j1) = Vxjqj(mu,j1,q,j)
           Txjqj(mu,j,q,j1) -= T1xjqj(mu,j,q,j1)

           DO q1
              Tqjqj(q1,j,q,j1)           = Txjqj(mu,j,q,j1)*cb(mu,q1)
              PREPARE VSqjqj(q1,j,q,j1) += Tqjqj(q1,j,q,j1)
           ENDDO q1
     ENDPARDO mu, q, j, j1

     PARDO mu, q, i, j1
           REQUEST Vxiqj(mu,i,q,j1) j1
           DO p1
              Tpiqj(p1,i,q,j1)          = Vxiqj(mu,i,q,j1)*ca(mu,p1)
              PREPARE Vpiqj(p1,i,q,j1) += Tpiqj(p1,i,q,j1)
           ENDDO p1
     ENDPARDO mu, q, i, j1
#
     PARDO a, a1, i
#
        ALLOCATE Laaai(*,a,a1,i)

        DO mu
           REQUEST Vxaai(mu,a,a1,i) i
#
           DO a2
#
              T1aaai(a2,a,a1,i)          = Vxaai(mu,a,a1,i)*ca(mu,a2)
              Laaai(a2,a,a1,i)          += T1aaai(a2,a,a1,i)
#
           ENDDO a2
        ENDDO mu
#
        DO a2
           T1aaai(a1,a,a2,i)          = Laaai(a2,a,a1,i)
           PREPARE VSaaai(a2,a,a1,i) += Laaai(a2,a,a1,i)
           T1aaai(a1,a,a2,i)         *= -1.0
           PREPARE VSaaai(a1,a,a2,i) += T1aaai(a1,a,a2,i)
        ENDDO a2

        DEALLOCATE Laaai(*,a,a1,i)

     ENDPARDO a, a1, i
#
     PARDO a, b1, j
#
        ALLOCATE Laabj(*,a,b1,j)

        DO mu
           REQUEST Vxabj(mu,a,b1,j) j
#
           DO a2
#
              T1aabj(a2,a,b1,j)          = Vxabj(mu,a,b1,j)*ca(mu,a2)
              Laabj(a2,a,b1,j)          += T1aabj(a2,a,b1,j)
#
           ENDDO a2
        ENDDO mu
#
        DO a2
           PREPARE Vaabj(a2,a,b1,j)   = Laabj(a2,a,b1,j)
        ENDDO a2

        DEALLOCATE Laabj(*,a,b1,j)

     ENDPARDO a, b1, j
#
     PARDO b, a1, i
#
        ALLOCATE Lbbai(*,b,a1,i)

        DO mu
           REQUEST Vxbai(mu,b,a1,i) i
#
           DO b2
#
              T1bbai(b2,b,a1,i)          = Vxbai(mu,b,a1,i)*cb(mu,b2)
              Lbbai(b2,b,a1,i)          += T1bbai(b2,b,a1,i)
#
           ENDDO b2
        ENDDO mu
#
        DO b2
           PREPARE Vbbai(b2,b,a1,i)   = Lbbai(b2,b,a1,i)
        ENDDO b2

        DEALLOCATE Lbbai(*,b,a1,i)

     ENDPARDO b, a1, i
#
#    ------------------------------------------------------------------------
#
     ENDPROC TRAN_TRAN4
#
#    ------------------------------------------------------------------------
#
#    ------------------------------------------------------------------------
#
     PROC TRAN_UHF
#
#        CALL COMP_INTEGRALS # --> compute integrals and put into served array
         CALL TRAN_TRAN2     # --> performs the first two stages of the
                             #     two-electron integral transformation.
         CALL TRAN_TRAN3     # --> performs the third stage
                             #     two-electron integral transformation.
         CALL TRAN_TRAN4     # --> performs the fourth stage of the
                             #     two-electron integral transformation.
#
     ENDPROC TRAN_UHF
#
#    ------------------------------------------------------------------------
#
#    ------------------------------------------------------------------------
#
# --------------------------------------------------------------------------
#
     PROC READ_BLOCKDATA
#    -------------------
#
#   Read BLOCKDATA file.
#
      execute sip_barrier

      execute list_to_blocks                ree

      execute list_to_blocks                R1A_VECS
      execute list_to_blocks                R1B_VECS
      execute list_to_blocks                R2AA_VECS
      execute list_to_blocks                R2BB_VECS
      execute list_to_blocks                R2AB_VECS

      execute list_to_blocks                HBAR_ia
      execute list_to_blocks                HBAR_jb

      execute list_to_blocks                t1a_old
      execute list_to_blocks                t1b_old
      execute list_to_blocks                TSaiai
      execute list_to_blocks                T2aibj
      execute list_to_blocks                TSbjbj

      execute list_to_blocks                l1a_old
      execute list_to_blocks                l1b_old
      execute list_to_blocks                LSiaia
      execute list_to_blocks                L2iajb
      execute list_to_blocks                LSjbjb

      execute list_to_blocks                lee
      execute list_to_blocks                L1A_VECS
      execute list_to_blocks                L1B_VECS
      execute list_to_blocks                L2AA_VECS
      execute list_to_blocks                L2BB_VECS
      execute list_to_blocks                L2AB_VECS

      execute read_list_to_blocks
      execute server_barrier


      PARDO a, i, a1, i1
            REQUEST LSiaia(i,a,i1,a1) a
            tpipi(a,i,a1,i1) = LSiaia(i,a,i1,a1)
            PREPARE LSaiai(a,i,a1,i1) = tpipi(a,i,a1,i1)
      ENDPARDO a, i, a1, i1

      PARDO a, i, b, j 
            REQUEST L2iajb(i,a,j,b) a 
            tpiqj(a,i,b,j) = L2iajb(i,a,j,b) 
            PREPARE L2aibj(a,i,b,j) = tpiqj(a,i,b,j) 
      ENDPARDO a, i, b, j 
       

      execute server_barrier
#
      PARDO a, i
           GET l1a_old(i,a)
           tpp(a,i) = l1a_old(i,a)
           PREPARE s1la(a,i) = tpp(a,i)
      ENDPARDO a, i
#
      PARDO b, j
           GET l1b_old(j,b)
           tqq(b,j) = l1b_old(j,b)
           PREPARE s1lb(b,j) = tqq(b,j)
      ENDPARDO b, j
#
     ENDPROC READ_BLOCKDATA
#    ----------------------
#
# ------------------------------------------------------------------------------ 
#
      PROC V4O3_1 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# TERM 1 
#
# ------------------------------------------------------------------------------ 
#
            DO a2 
               kcount = 0.0 
            DO k1 
               kcount = kcount + 1 
               if kcount == kstart 
               REQUEST Vaabj(a2,a1,b,k1) b 
               jcount = 0.0 
               DO i2 
                  jcount = jcount + 1 
                  if jcount == whichj  
                     icount = 0.0 
                     DO i1 
                        icount = icount + 1 
                        if icount == whichi 

                           REQUEST   TSaiai(a2,i1,a,i2) a 
                           jjcount = 0.0 

                           DO jj 
                              jjcount = jjcount + 1 
                              if jjcount >= jstart  
                              if jjcount <= jend 

                                 tppps(a2,i1,a,jj) = 0.0 
                                 execute stripi      TSaiai tppps  
                                 t1ppp(a2,i1,a)    = tppps(a2,i1,a,jj) 
                                 tppp(a,a2,i1)     = t1ppp(a2,i1,a)  
                                 tppp(a,a2,i1)    *= -1.0  
                                 iicount           = 0.0 

                                 DO ii 
                                    iicount = iicount + 1 
                                    if ii <= jj # VFL 
                                    if iicount >= istart  
                                    if iicount <= iend  
                                       tpps(a,a2,ii)             = 0.0 
                                       execute stripi              tppp tpps  
                                       tpp(a,a2)                 = tpps(a,a2,ii) 
                                       tppqq(a,a1,b,k1)          = Vaabj(a2,a1,b,k1)*tpp(a,a2)  
                                      #taaaiii(a,a1,b,k1,ii,jj)  = tpppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)
                                       execute sum_64ss Xaaaiii tppqq 
                                    endif  
                                    endif  
                                    endif  
                                 ENDDO ii 

                              endif  
                              endif  
                           ENDDO jj 
                        ENDIF 
                     ENDDO i1
                  ENDIF 
               ENDDO i2 
               endif 
            ENDDO k1
            ENDDO a2 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V4O3_1 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V4O3_2 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 2 
#
# ------------------------------------------------------------------------------ 
#
            DO b1 
               jcount = 0.0 
            DO i2 
               jcount = jcount + 1 
               if jcount == whichj  
               REQUEST Vbbai(b1,b,a1,i2) b 
               kcount = 0.0 
               DO k1 
                  kcount = kcount + 1 
                  if kcount == kstart   
                     icount = 0.0 
                     DO i1 
                        icount = icount + 1 
                        if icount == whichi 

                           REQUEST              T2aibj(a,i1,b1,k1) a 
                           t1qpqp(b1,a,k1,i1) = T2aibj(a,i1,b1,k1) 
                           jjcount              = 0.0 
                           DO jj 
                              jjcount = jjcount + 1 
                              if jjcount >= jstart  
                              if jjcount <= jend 
                                 tqqps(b1,b,a1,jj) = 0.0 
                                 execute stripi Vbbai tqqps 
                                 tqqp(b1,b,a1) = tqqps(b1,b,a1,jj) 
                                 t1qpq(b1,a1,b) = tqqp(b1,b,a1) 

                                 iicount = 0.0 

                                 DO ii 
                                    iicount = iicount + 1 
                                    if ii <  jj # VFL 
                                    if iicount >= istart  
                                    if iicount <= iend  
                                       t1qpqs(b1,a,k1,ii) = 0.0 
                                       execute stripi t1qpqp t1qpqs 
                                       t2qpq(b1,a,k1) = t1qpqs(b1,a,k1,ii) 

                                       tppqq(a,a1,b,k1) = t1qpq(b1,a1,b)*t2qpq(b1,a,k1)   
                                      #taaaiii(a,a1,b,k1,ii,jj)  = tpppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)
                                       execute sum_64ss Xaaaiii tppqq 

                                    endif  
                                    endif  
                                    endif  
                                 ENDDO ii 

                              endif  
                              endif  
                           ENDDO jj 
                        ENDIF 
                     ENDDO i1
                  ENDIF 
               ENDDO k1
               endif 
            ENDDO i2 
            ENDDO b1 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V4O3_2 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V4O3_3 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 3 
#
# ------------------------------------------------------------------------------ 
#
            DO b1 
               icount = 0.0 
            DO i1 
               icount = icount + 1 
               if icount == whichi  
               REQUEST Vbbai(b1,b,a1,i1) b 
               kcount = 0.0 
               DO k1 
                  kcount = kcount + 1 
                  if kcount == kstart   
                     jcount = 0.0 
                     DO i2 
                        jcount = jcount + 1 
                        if jcount == whichj 

                           REQUEST              T2aibj(a,i2,b1,k1) a 
                           t1qpqp(b1,a,k1,i2) = T2aibj(a,i2,b1,k1) 
                           iicount            = 0.0 
                           DO ii 
                              iicount = iicount + 1 
                              if iicount >= istart  
                              if iicount <= iend 
                                 tqqps(b1,b,a1,ii) = 0.0 
                                 execute stripi      Vbbai tqqps 
                                 tqqp(b1,b,a1)     = tqqps(b1,b,a1,ii) 
                                 t1qpq(b1,a1,b)    = tqqp(b1,b,a1) 
                                 t1qpq(b1,a1,b)   *= -1.0  
                                 jjcount           = 0.0 

                                 DO jj 
                                    jjcount = jjcount + 1 
                                    if jj >  ii # VFL 
                                    if jjcount >= jstart  
                                    if jjcount <= jend  

                                       t1qpqs(b1,a,k1,jj) = 0.0 
                                       execute stripi t1qpqp t1qpqs 
                                       t2qpq(b1,a,k1) = t1qpqs(b1,a,k1,jj) 
                                       tppqq(a,a1,b,k1) = t1qpq(b1,a1,b)*t2qpq(b1,a,k1)   
                                      #taaaiii(a,a1,b,k1,ii,jj)  = tpppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)
                                       execute sum_64ss Xaaaiii tppqq 

                                    endif  
                                    endif  
                                    endif  
                                 ENDDO jj 

                              endif  
                              endif  
                           ENDDO ii 
                        ENDIF 
                     ENDDO i2 
                  ENDIF 
               ENDDO k1
               endif 
            ENDDO i1
            ENDDO b1 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V4O3_3 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V4O3_4 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 4 
#
# ------------------------------------------------------------------------------ 
#
            DO a2 
               kcount = 0.0 
            DO k1 
               kcount = kcount + 1 
               if kcount == kstart 
               REQUEST Vaabj(a,a2,b,k1) b 
               jcount = 0.0 
               DO i2 
                  jcount = jcount + 1 
                  if jcount == whichj  
                     icount = 0.0 
                     DO i1 
                        icount = icount + 1 
                        if icount == whichi 

                           REQUEST              TSaiai(a2,i1,a1,i2) a1 
                           jjcount              = 0.0 
                           DO jj 
                              jjcount = jjcount + 1 
                              if jjcount >= jstart  
                              if jjcount <= jend 

                                 tppps(a2,i1,a1,jj) = 0.0 
                                 execute stripi   TSaiai tppps  
                                 t1ppp(a2,i1,a1) = tppps(a2,i1,a1,jj) 
                                 tppp(a2,a1,i1)  = t1ppp(a2,i1,a1)  
                                 iicount = 0.0 

                                 DO ii 
                                    iicount = iicount + 1 
                                    if ii <= jj # VFL 
                                    if iicount >= istart  
                                    if iicount <= iend  
                                       tpps(a2,a1,ii)    = 0.0 
                                       execute stripi      tppp tpps  
                                       tpp(a2,a1)        = tpps(a2,a1,ii) 
                                       tppqq(a,a1,b,k1) = Vaabj(a,a2,b,k1)*tpp(a2,a1)  

                                      #taaaiii(a,a1,b,k1,ii,jj)  = tpppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                       execute sum_64ss Xaaaiii tppqq 
                                    endif  
                                    endif  
                                    endif  
                                 ENDDO ii 

                              endif  
                              endif  
                           ENDDO jj 
                        ENDIF 
                     ENDDO i1
                  ENDIF 
               ENDDO i2 
               endif 
            ENDDO k1
            ENDDO a2 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V4O3_4 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V4O3_5 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 5 
#
# ------------------------------------------------------------------------------ 
#
            DO b1 
               icount = 0.0 
            DO i1 
               icount = icount + 1 
               if icount == whichi  
               REQUEST Vbbai(b1,b,a,i1) b 
               kcount = 0.0 
               DO k1 
                  kcount = kcount + 1 
                  if kcount == kstart   
                     jcount = 0.0 
                     DO i2 
                        jcount = jcount + 1 
                        if jcount == whichj 

                           REQUEST               T2aibj(a1,i2,b1,k1) a1 
                           t1qpqp(b1,a1,k1,i2) = T2aibj(a1,i2,b1,k1) 
                           iicount             = 0.0 
                           DO ii 
                              iicount = iicount + 1 
                              if iicount >= istart  
                              if iicount <= iend 
                                 tqqps(b1,b,a,ii) = 0.0 
                                 execute stripi Vbbai tqqps 
                                 tqqp(b1,b,a) = tqqps(b1,b,a,ii) 
                                 t1pqq(a,b1,b) = tqqp(b1,b,a) 

                                 jjcount = 0.0 

                                 DO jj 
                                    jjcount = jjcount + 1 
                                    if jj >  ii # VFL 
                                    if jjcount >= jstart  
                                    if jjcount <= jend  
                                       t1qpqs(b1,a1,k1,jj) = 0.0 
                                       execute stripi t1qpqp t1qpqs 
                                       t2qpq(b1,a1,k1) = t1qpqs(b1,a1,k1,jj) 

                                       tppqq(a,a1,b,k1) = t1pqq(a,b1,b)*t2qpq(b1,a1,k1)   
                                      #taaaiii(a,a1,b,k1,ii,jj)  = tpppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                       execute sum_64ss Xaaaiii tppqq 

                                    endif  
                                    endif  
                                    endif  
                                 ENDDO jj 

                              endif  
                              endif  
                           ENDDO ii 
                        ENDIF 
                     ENDDO i2 
                  ENDIF 
               ENDDO k1
               endif 
            ENDDO i1
            ENDDO b1 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V4O3_5 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V4O3_6 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 6 
#
# ------------------------------------------------------------------------------ 
#
            DO b1 
               jcount = 0.0 
            DO i2 
               jcount = jcount + 1 
               if jcount == whichj  
               REQUEST Vbbai(b1,b,a,i2) b 
               kcount = 0.0 
               DO k1 
                  kcount = kcount + 1 
                  if kcount == kstart   
                     icount = 0.0 
                     DO i1 
                        icount = icount + 1 
                        if icount == whichi 

                           REQUEST               T2aibj(a1,i1,b1,k1) a1
                           t1qpqp(b1,a1,k1,i1) = T2aibj(a1,i1,b1,k1) 
                           jjcount             = 0.0 
                           DO jj 
                              jjcount = jjcount + 1 
                              if jjcount >= jstart  
                              if jjcount <= jend 
                                 tqqps(b1,b,a,jj) = 0.0 
                                 execute stripi Vbbai tqqps 
                                 tqqp(b1,b,a) = tqqps(b1,b,a,jj) 
                                 t1pqq(a,b1,b) = tqqp(b1,b,a) 
                                 t1pqq(a,b1,b) *= -1.0  

                                 iicount = 0.0 

                                 DO ii 
                                    iicount = iicount + 1 
                                    if ii <  jj # VFL 
                                    if iicount >= istart  
                                    if iicount <= iend  
                                       t1qpqs(b1,a1,k1,ii) = 0.0 
                                       execute stripi t1qpqp t1qpqs 
                                       t2qpq(b1,a1,k1) = t1qpqs(b1,a1,k1,ii) 

                                       tppqq(a,a1,b,k1) = t1pqq(a,b1,b)*t2qpq(b1,a1,k1)   
                                      #taaaiii(a,a1,b,k1,ii,jj)  = tpppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                       execute sum_64ss Xaaaiii tppqq 

                                    endif  
                                    endif  
                                    endif  
                                 ENDDO ii 

                              endif  
                              endif  
                           ENDDO jj 
                        ENDIF 
                     ENDDO i1
                  ENDIF 
               ENDDO k1
               endif 
            ENDDO i2 
            ENDDO b1 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V4O3_6 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V4O3_7 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 7 
#
# ------------------------------------------------------------------------------ 
#
            DO a2 
               jcount = 0.0 
            DO i2 
               jcount = jcount + 1 
               if jcount == whichj  
               REQUEST VSaaai(a,a2,a1,i2) a 
               icount = 0.0 
               DO i1 
                  icount = icount + 1 
                  if icount == whichi  
                     kcount = 0.0 
                     DO k1 
                        kcount = kcount + 1 
                        if kcount == kstart  

                           REQUEST              T2aibj(a2,i1,b,k1) b 
                           tpqqp(a2,b,k1,i1) = T2aibj(a2,i1,b,k1) 
                           jjcount              = 0.0 
                           DO jj 
                              jjcount = jjcount + 1 
                              if jjcount >= jstart  
                              if jjcount <= jend 

                                 tppps(a,a2,a1,jj) = 0.0 
                                 execute stripi   VSaaai tppps  
                                 t1ppp(a,a2,a1) = tppps(a,a2,a1,jj) 
                                 t2ppp(a,a1,a2) = t1ppp(a,a2,a1) 
                                 iicount = 0.0 

                                 DO ii 
                                    iicount = iicount + 1 
                                    if ii <  jj # VFL 
                                    if iicount >= istart  
                                    if iicount <= iend  
                                       t1pqqs(a2,b,k1,ii)    = 0.0 
                                       execute stripi      tpqqp t1pqqs  
                                       tpqq(a2,b,k1)        = t1pqqs(a2,b,k1,ii) 

                                       t1ppqq(a,a1,b,k1) = t2ppp(a,a1,a2)*tpqq(a2,b,k1)  
                                      #taaaiii(a,a1,b,k1,ii,jj)  = t1pppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                       execute sum_64ss Xaaaiii t1ppqq 
                                    endif  
                                    endif  
                                    endif  
                                 ENDDO ii 

                              endif  
                              endif  
                           ENDDO jj 
                        ENDIF 
                     ENDDO k1
                  ENDIF 
               ENDDO i1
               endif 
            ENDDO i2 
            ENDDO a2 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V4O3_7 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V4O3_8 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 8 
#
# ------------------------------------------------------------------------------ 
#
            DO a2 
               icount = 0.0 
            DO i1 
               icount = icount + 1 
               if icount == whichi  
               REQUEST VSaaai(a,a2,a1,i1) a 
               jcount = 0.0 
               DO i2 
                  jcount = jcount + 1 
                  if jcount == whichj  
                     kcount = 0.0 
                     DO k1 
                        kcount = kcount + 1 
                        if kcount == kstart  

                           REQUEST              T2aibj(a2,i2,b,k1) b 
                           tpqqp(a2,b,k1,i2) = T2aibj(a2,i2,b,k1) 
                           tpqqp(a2,b,k1,i2) *= -1.0  
                           iicount              = 0.0 
                           DO ii 
                              iicount = iicount + 1 
                              if iicount >= istart  
                              if iicount <= iend 

                                 tppps(a,a2,a1,ii) = 0.0 
                                 execute stripi   VSaaai tppps  
                                 t1ppp(a,a2,a1) = tppps(a,a2,a1,ii) 
                                 t2ppp(a,a1,a2) = t1ppp(a,a2,a1) 
                                 jjcount = 0.0 

                                 DO jj 
                                    jjcount = jjcount + 1 
                                    if jj >  ii # VFL 
                                    if jjcount >= jstart  
                                    if jjcount <= jend  
                                       t1pqqs(a2,b,k1,jj)    = 0.0 
                                       execute stripi      tpqqp t1pqqs  
                                       tpqq(a2,b,k1)        = t1pqqs(a2,b,k1,jj) 

                                       t1ppqq(a,a1,b,k1) = t2ppp(a,a1,a2)*tpqq(a2,b,k1)  
                                      #taaaiii(a,a1,b,k1,ii,jj)  = t1pppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                       execute sum_64ss Xaaaiii t1ppqq 
                                    endif  
                                    endif  
                                    endif  
                                 ENDDO jj 

                              endif  
                              endif  
                           ENDDO ii 
                        ENDIF 
                     ENDDO k1
                  ENDIF 
               ENDDO i2 
               endif 
            ENDDO i1
            ENDDO a2 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V4O3_8 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# Done the expensive terms, now do the 'cheap' terms scaling as VVVOOOO 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V3O4_1 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# TERM 1 
#
# ------------------------------------------------------------------------------ 
#
            DO j2
               icount = 0.0
               DO i1
                  icount = icount + 1
                  if icount == whichi
                     REQUEST            T2aibj(a,i1,b,j2) a
                     tpqqp(a,j2,b,i1) = T2aibj(a,i1,b,j2)
                     tpqqp(a,j2,b,i1)*= -1.0
                     jcount = 0.0
                     DO i2 
                        jcount = jcount + 1
                        if jcount == whichj
                           kcount = 0.0
                           DO k1
                              kcount = kcount + 1
                              if kcount == kstart
                                 REQUEST               Vpiqj(a1,i2,j2,k1) a1
                                 t1qpqp(j2,a1,k1,i2) = Vpiqj(a1,i2,j2,k1)

                                 iicount = 0.0
                                 DO ii
                                    iicount = iicount + 1
                                    if iicount >= istart
                                    if iicount <= iend
                                       tpqqs(a,j2,b,ii) = 0.0
                                       execute stripi tpqqp tpqqs
                                       tpqq(a,j2,b) = tpqqs(a,j2,b,ii)

                                       jjcount = 0.0
                                       DO jj
                                          jjcount = jjcount + 1
                                          if jj >= ii # VFL 
                                          if jjcount >= jstart
                                          if jjcount <= jend
                                             t1qpqs(j2,a1,k1,jj) = 0.0
                                             execute stripi t1qpqp t1qpqs
                                             t1qpq(j2,a1,k1) = t1qpqs(j2,a1,k1,jj)

                                             t2ppqq(a,a1,b,k1)         = tpqq(a,j2,b)*t1qpq(j2,a1,k1)
                                            #taaaiii(a,a1,b,k1,ii,jj)  = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 

                                          endif
                                          endif
                                          endif
                                       ENDDO jj

                                    endif
                                    endif
                                 ENDDO ii
                              ENDIF
                           ENDDO k1
                        ENDIF
                     ENDDO i2 
                  endif
               ENDDO i1
            ENDDO j2
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V3O4_1 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V3O4_2 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 2 
#
# ------------------------------------------------------------------------------
#
            DO j2
               jcount = 0.0
               DO i2 
                  jcount = jcount + 1
                  if jcount == whichj
                     REQUEST            T2aibj(a,i2,b,j2) a
                     tpqqp(a,j2,b,i2) = T2aibj(a,i2,b,j2)
                     icount = 0.0
                     DO i1
                        icount = icount + 1
                        if icount == whichi
                           kcount = 0.0
                           DO k1
                              kcount = kcount + 1
                              if kcount == kstart
                                 REQUEST               Vpiqj(a1,i1,j2,k1) a1
                                 t1qpqp(j2,a1,k1,i1) = Vpiqj(a1,i1,j2,k1)

                                 jjcount = 0.0
                                 DO jj
                                    jjcount = jjcount + 1
                                    if jjcount >= jstart
                                    if jjcount <= jend
                                       tpqqs(a,j2,b,jj) = 0.0
                                       execute stripi tpqqp tpqqs
                                       tpqq(a,j2,b) = tpqqs(a,j2,b,jj)

                                       iicount = 0.0
                                       DO ii
                                          iicount = iicount + 1
                                          if ii <= jj # VFL 
                                          if iicount >= istart
                                          if iicount <= iend
                                             t1qpqs(j2,a1,k1,ii) = 0.0
                                             execute stripi t1qpqp t1qpqs
                                             t1qpq(j2,a1,k1) = t1qpqs(j2,a1,k1,ii)

                                             t2ppqq(a,a1,b,k1) = tpqq(a,j2,b)*t1qpq(j2,a1,k1)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO ii

                                    endif
                                    endif
                                 ENDDO jj
                              ENDIF
                           ENDDO k1
                        ENDIF
                     ENDDO i1
                  endif
               ENDDO i2 
            ENDDO j2
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V3O4_2 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V3O4_3 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 3 
#
# ------------------------------------------------------------------------------
#
            DO i3 
               kcount = 0.0
               DO k1
                  kcount = kcount + 1
                  if kcount == kstart
                     REQUEST            T2aibj(a,i3,b,k1) a
                     tppqq(a,i3,b,k1) = T2aibj(a,i3,b,k1)
                     tppqq(a,i3,b,k1)*= -1.0
                     icount = 0.0
                     DO i1
                        icount = icount + 1
                        if icount == whichi
                           jcount = 0.0
                           DO i2 
                              jcount = jcount + 1
                              if jcount == whichj
                                 REQUEST               VSpipi(a1,i2,i3,i1) a1
                                 t1pppp(i3,a1,i2,i1) = VSpipi(a1,i2,i3,i1)

                                 iicount = 0.0
                                 DO ii
                                    iicount = iicount + 1
                                    if iicount >= istart
                                    if iicount <= iend
                                       tppps(i3,a1,i2,ii) = 0.0
                                       execute stripi   t1pppp tppps
                                       tppp(i3,a1,i2) = tppps(i3,a1,i2,ii)

                                       jjcount = 0.0
                                       DO jj
                                          jjcount = jjcount + 1
                                          if jj >= ii # VFL 
                                          if jjcount >= jstart
                                          if jjcount <= jend
                                             tpps(i3,a1,jj) = 0.0
                                             execute stripi tppp tpps
                                             tpp(i3,a1)   = tpps(i3,a1,jj)

                                             t2ppqq(a,a1,b,k1)         = tppqq(a,i3,b,k1)*tpp(i3,a1)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO jj

                                    endif
                                    endif
                                 ENDDO ii
                              ENDIF
                           ENDDO i2 
                        ENDIF
                     ENDDO i1
                  endif
               ENDDO k1
            ENDDO i3 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V3O4_3 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V3O4_4 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 4 
#
# ------------------------------------------------------------------------------
#
            DO i3 
               jcount = 0.0
               DO i2 
                  jcount = jcount + 1
                  if jcount == whichj
                     REQUEST             TSaiai(a1,i2,a,i3) a
                     tpppp(a,a1,i3,i2) = TSaiai(a1,i2,a,i3)
                     tpppp(a,a1,i3,i2)*= -1.0
                     icount = 0.0
                     DO i1
                        icount = icount + 1
                        if icount == whichi
                           kcount = 0.0
                           DO k1
                              kcount = kcount + 1
                              if kcount == kstart
                                 REQUEST              Vpiqj(i3,i1,b,k1) b
                                 t1pqqp(i3,b,k1,i1) = Vpiqj(i3,i1,b,k1)

                                 jjcount = 0.0
                                 DO jj
                                    jjcount = jjcount + 1
                                    if jjcount >= jstart
                                    if jjcount <= jend
                                       tppps(a,a1,i3,jj) = 0.0
                                       execute stripi tpppp tppps
                                       tppp(a,a1,i3) = tppps(a,a1,i3,jj)

                                       iicount = 0.0
                                       DO ii
                                          iicount = iicount + 1
                                          if ii <= jj # VFL 
                                          if iicount >= istart
                                          if iicount <= iend
                                             t1pqqs(i3,b,k1,ii) = 0.0
                                             execute stripi t1pqqp t1pqqs
                                             t1pqq(i3,b,k1) = t1pqqs(i3,b,k1,ii)

                                             t2ppqq(a,a1,b,k1) = tppp(a,a1,i3)*t1pqq(i3,b,k1)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO ii
                                    endif
                                    endif
                                 ENDDO jj
                              ENDIF
                           ENDDO k1
                        ENDIF
                     ENDDO i1
                  endif
               ENDDO i2 
            ENDDO i3 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V3O4_4 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V3O4_5 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 5 
#
# ------------------------------------------------------------------------------
#
            DO i3 
               icount = 0.0
               DO i1
                  icount = icount + 1
                  if icount == whichi
                     REQUEST             TSaiai(a1,i1,a,i3) a
                     tpppp(a,a1,i3,i1) = TSaiai(a1,i1,a,i3)
                     jcount = 0.0
                     DO i2 
                        jcount = jcount + 1
                        if jcount == whichj
                           kcount = 0.0
                           DO k1
                              kcount = kcount + 1
                              if kcount == kstart
                                 REQUEST              Vpiqj(i3,i2,b,k1) b
                                 t1pqqp(i3,b,k1,i2) = Vpiqj(i3,i2,b,k1)

                                 iicount = 0.0
                                 DO ii
                                    iicount = iicount + 1
                                    if iicount >= istart
                                    if iicount <= iend
                                       tppps(a,a1,i3,ii) = 0.0
                                       execute stripi tpppp tppps
                                       tppp(a,a1,i3) = tppps(a,a1,i3,ii)

                                       jjcount = 0.0
                                       DO jj
                                          jjcount = jjcount + 1
                                          if jj >= ii # VFL 
                                          if jjcount >= jstart
                                          if jjcount <= jend
                                             t1pqqs(i3,b,k1,jj) = 0.0
                                             execute stripi t1pqqp t1pqqs
                                             t1pqq(i3,b,k1) = t1pqqs(i3,b,k1,jj)

                                             t2ppqq(a,a1,b,k1) = tppp(a,a1,i3)*t1pqq(i3,b,k1)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO jj

                                    endif
                                    endif
                                 ENDDO ii
                              ENDIF
                           ENDDO k1
                        ENDIF
                     ENDDO i2 
                  endif
               ENDDO i1
            ENDDO i3 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V3O4_5 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V3O4_6 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 6 
#
# ------------------------------------------------------------------------------
#
            DO i3 
               kcount = 0.0
               DO k1
                  kcount = kcount + 1
                  if kcount == kstart
                     REQUEST            T2aibj(a1,i3,b,k1) a1
                     tppqq(i3,a1,b,k1) = T2aibj(a1,i3,b,k1)
                     jcount = 0.0
                     DO i2 
                        jcount = jcount + 1
                        if jcount == whichj
                           icount = 0.0
                           DO i1
                              icount = icount + 1
                              if icount == whichi
                                 REQUEST              VSpipi(a,i2,i3,i1) a
                                 t1pppp(i3,a,i2,i1) = VSpipi(a,i2,i3,i1)

                                 iicount = 0.0
                                 DO ii
                                    iicount = iicount + 1
                                    if iicount >= istart
                                    if iicount <= iend
                                       tppps(i3,a,i2,ii) = 0.0
                                       execute stripi   t1pppp tppps
                                       tppp(i3,a,i2) = tppps(i3,a,i2,ii)

                                       jjcount = 0.0
                                       DO jj
                                          jjcount = jjcount + 1
                                          if jj >= ii # VFL 
                                          if jjcount >= jstart
                                          if jjcount <= jend
                                             tpps(i3,a,jj) = 0.0
                                             execute stripi tppp tpps
                                             tpp(i3,a)   = tpps(i3,a,jj)

                                             t2ppqq(a,a1,b,k1)         = tppqq(i3,a1,b,k1)*tpp(i3,a)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO jj

                                    endif
                                    endif
                                 ENDDO ii
                              ENDIF
                           ENDDO i1
                        ENDIF
                     ENDDO i2 
                  endif
               ENDDO k1
            ENDDO i3 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V3O4_6 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V3O4_7 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 7 
#
# ------------------------------------------------------------------------------
#
            DO j2
               icount = 0.0
               DO i1
                  icount = icount + 1
                  if icount == whichi
                     REQUEST             T2aibj(a1,i1,b,j2) b
                     tqpqp(j2,a1,b,i1) = T2aibj(a1,i1,b,j2)
                     jcount = 0.0
                     DO i2 
                        jcount = jcount + 1
                        if jcount == whichj
                           kcount = 0.0
                           DO k1
                              kcount = kcount + 1
                              if kcount == kstart
                                 REQUEST              Vpiqj(a,i2,j2,k1) a
                                 t1qpqp(j2,a,k1,i2) = Vpiqj(a,i2,j2,k1)

                                 jjcount = 0.0
                                 DO jj
                                    jjcount = jjcount + 1
                                    if jjcount >= jstart
                                    if jjcount <= jend
                                       tqpqs(j2,a,k1,jj) = 0.0
                                       execute stripi t1qpqp tqpqs
                                       tqpq(j2,a,k1) = tqpqs(j2,a,k1,jj)

                                       iicount = 0.0
                                       DO ii
                                          iicount = iicount + 1
                                          if ii <= jj # VFL 
                                          if iicount >= istart
                                          if iicount <= iend
                                             t1qpqs(j2,a1,b,ii) = 0.0
                                             execute stripi tqpqp t1qpqs
                                             t1qpq(j2,a1,b) = t1qpqs(j2,a1,b,ii)

                                             t2ppqq(a,a1,b,k1) = t1qpq(j2,a1,b)*tqpq(j2,a,k1)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO ii

                                    endif
                                    endif
                                 ENDDO jj
                              ENDIF
                           ENDDO k1
                        ENDIF
                     ENDDO i2 
                  endif
               ENDDO i1
            ENDDO j2
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V3O4_7 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC V3O4_8 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 8 
#
# ------------------------------------------------------------------------------
#
            DO j2
               jcount = 0.0
               DO i2 
                  jcount = jcount + 1
                  if jcount == whichj
                     REQUEST             T2aibj(a1,i2,b,j2) b
                     tqpqp(j2,a1,b,i2) = T2aibj(a1,i2,b,j2)
                     tqpqp(j2,a1,b,i2)*= -1.0
                     icount = 0.0
                     DO i1
                        icount = icount + 1
                        if icount == whichi
                           kcount = 0.0
                           DO k1
                              kcount = kcount + 1
                              if kcount == kstart
                                 REQUEST              Vpiqj(a,i1,j2,k1) a
                                 t1qpqp(j2,a,k1,i1) = Vpiqj(a,i1,j2,k1)

                                 iicount = 0.0
                                 DO ii
                                    iicount = iicount + 1
                                    if iicount >= istart
                                    if iicount <= iend
                                       tqpqs(j2,a,k1,ii) = 0.0
                                       execute stripi t1qpqp tqpqs
                                       tqpq(j2,a,k1) = tqpqs(j2,a,k1,ii)

                                       jjcount = 0.0
                                       DO jj
                                          jjcount = jjcount + 1
                                          if jj >= ii # VFL 
                                          if jjcount >= jstart
                                          if jjcount <= jend
                                             t1qpqs(j2,a1,b,jj) = 0.0
                                             execute stripi tqpqp t1qpqs
                                             t1qpq(j2,a1,b) = t1qpqs(j2,a1,b,jj)

                                             t2ppqq(a,a1,b,k1) = t1qpq(j2,a1,b)*tqpq(j2,a,k1)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO jj

                                    endif
                                    endif
                                 ENDDO ii
                              ENDIF
                           ENDDO k1
                        ENDIF
                     ENDDO i1
                  endif
               ENDDO i2 
            ENDDO j2
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC V3O4_8 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV4O3_1 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# TERM 1 
#
# ------------------------------------------------------------------------------ 
#
            DO a2 
               kcount = 0.0 
            DO k1 
               kcount = kcount + 1 
               if kcount == kstart 
               REQUEST Vaabj(a2,a1,b,k1) b 
               jcount = 0.0 
               DO i2 
                  jcount = jcount + 1 
                  if jcount == whichj  
                     icount = 0.0 
                     DO i1 
                        icount = icount + 1 
                        if icount == whichi 

                           REQUEST   LSaiai(a2,i1,a,i2) a 
                           jjcount = 0.0 

                           DO jj 
                              jjcount = jjcount + 1 
                              if jjcount >= jstart  
                              if jjcount <= jend 

                                 tppps(a2,i1,a,jj) = 0.0 
                                 execute stripi      LSaiai tppps  
                                 t1ppp(a2,i1,a)    = tppps(a2,i1,a,jj) 
                                 tppp(a,a2,i1)     = t1ppp(a2,i1,a)  
                                 tppp(a,a2,i1)    *= -1.0  
                                 iicount           = 0.0 

                                 DO ii 
                                    iicount = iicount + 1 
                                    if ii <= jj # VFL 
                                    if iicount >= istart  
                                    if iicount <= iend  
                                       tpps(a,a2,ii)             = 0.0 
                                       execute stripi              tppp tpps  
                                       tpp(a,a2)                 = tpps(a,a2,ii) 
                                       tppqq(a,a1,b,k1)          = Vaabj(a2,a1,b,k1)*tpp(a,a2)  
                                      #taaaiii(a,a1,b,k1,ii,jj)  = tpppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)
                                       execute sum_64ss Xaaaiii tppqq 
                                    endif  
                                    endif  
                                    endif  
                                 ENDDO ii 

                              endif  
                              endif  
                           ENDDO jj 
                        ENDIF 
                     ENDDO i1
                  ENDIF 
               ENDDO i2 
               endif 
            ENDDO k1
            ENDDO a2 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV4O3_1 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV4O3_2 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 2 
#
# ------------------------------------------------------------------------------ 
#
            DO b1 
               jcount = 0.0 
            DO i2 
               jcount = jcount + 1 
               if jcount == whichj  
               REQUEST Vbbai(b1,b,a1,i2) b 
               kcount = 0.0 
               DO k1 
                  kcount = kcount + 1 
                  if kcount == kstart   
                     icount = 0.0 
                     DO i1 
                        icount = icount + 1 
                        if icount == whichi 

                           REQUEST              L2aibj(a,i1,b1,k1) a 
                           t1qpqp(b1,a,k1,i1) = L2aibj(a,i1,b1,k1) 
                           jjcount              = 0.0 
                           DO jj 
                              jjcount = jjcount + 1 
                              if jjcount >= jstart  
                              if jjcount <= jend 
                                 tqqps(b1,b,a1,jj) = 0.0 
                                 execute stripi Vbbai tqqps 
                                 tqqp(b1,b,a1) = tqqps(b1,b,a1,jj) 
                                 t1qpq(b1,a1,b) = tqqp(b1,b,a1) 

                                 iicount = 0.0 

                                 DO ii 
                                    iicount = iicount + 1 
                                    if ii <  jj # VFL 
                                    if iicount >= istart  
                                    if iicount <= iend  
                                       t1qpqs(b1,a,k1,ii) = 0.0 
                                       execute stripi t1qpqp t1qpqs 
                                       t2qpq(b1,a,k1) = t1qpqs(b1,a,k1,ii) 

                                       tppqq(a,a1,b,k1) = t1qpq(b1,a1,b)*t2qpq(b1,a,k1)   
                                      #taaaiii(a,a1,b,k1,ii,jj)  = tpppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)
                                       execute sum_64ss Xaaaiii tppqq 

                                    endif  
                                    endif  
                                    endif  
                                 ENDDO ii 

                              endif  
                              endif  
                           ENDDO jj 
                        ENDIF 
                     ENDDO i1
                  ENDIF 
               ENDDO k1
               endif 
            ENDDO i2 
            ENDDO b1 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV4O3_2 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV4O3_3 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 3 
#
# ------------------------------------------------------------------------------ 
#
            DO b1 
               icount = 0.0 
            DO i1 
               icount = icount + 1 
               if icount == whichi  
               REQUEST Vbbai(b1,b,a1,i1) b 
               kcount = 0.0 
               DO k1 
                  kcount = kcount + 1 
                  if kcount == kstart   
                     jcount = 0.0 
                     DO i2 
                        jcount = jcount + 1 
                        if jcount == whichj 

                           REQUEST              L2aibj(a,i2,b1,k1) a 
                           t1qpqp(b1,a,k1,i2) = L2aibj(a,i2,b1,k1) 
                           iicount            = 0.0 
                           DO ii 
                              iicount = iicount + 1 
                              if iicount >= istart  
                              if iicount <= iend 
                                 tqqps(b1,b,a1,ii) = 0.0 
                                 execute stripi      Vbbai tqqps 
                                 tqqp(b1,b,a1)     = tqqps(b1,b,a1,ii) 
                                 t1qpq(b1,a1,b)    = tqqp(b1,b,a1) 
                                 t1qpq(b1,a1,b)   *= -1.0  
                                 jjcount           = 0.0 

                                 DO jj 
                                    jjcount = jjcount + 1 
                                    if jj >  ii # VFL 
                                    if jjcount >= jstart  
                                    if jjcount <= jend  

                                       t1qpqs(b1,a,k1,jj) = 0.0 
                                       execute stripi t1qpqp t1qpqs 
                                       t2qpq(b1,a,k1) = t1qpqs(b1,a,k1,jj) 
                                       tppqq(a,a1,b,k1) = t1qpq(b1,a1,b)*t2qpq(b1,a,k1)   
                                      #taaaiii(a,a1,b,k1,ii,jj)  = tpppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)
                                       execute sum_64ss Xaaaiii tppqq 

                                    endif  
                                    endif  
                                    endif  
                                 ENDDO jj 

                              endif  
                              endif  
                           ENDDO ii 
                        ENDIF 
                     ENDDO i2 
                  ENDIF 
               ENDDO k1
               endif 
            ENDDO i1
            ENDDO b1 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV4O3_3 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV4O3_4 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 4 
#
# ------------------------------------------------------------------------------ 
#
            DO a2 
               kcount = 0.0 
            DO k1 
               kcount = kcount + 1 
               if kcount == kstart 
               REQUEST Vaabj(a,a2,b,k1) b 
               jcount = 0.0 
               DO i2 
                  jcount = jcount + 1 
                  if jcount == whichj  
                     icount = 0.0 
                     DO i1 
                        icount = icount + 1 
                        if icount == whichi 

                           REQUEST              LSaiai(a2,i1,a1,i2) a1 
                           jjcount              = 0.0 
                           DO jj 
                              jjcount = jjcount + 1 
                              if jjcount >= jstart  
                              if jjcount <= jend 

                                 tppps(a2,i1,a1,jj) = 0.0 
                                 execute stripi   LSaiai tppps  
                                 t1ppp(a2,i1,a1) = tppps(a2,i1,a1,jj) 
                                 tppp(a2,a1,i1)  = t1ppp(a2,i1,a1)  
                                 iicount = 0.0 

                                 DO ii 
                                    iicount = iicount + 1 
                                    if ii <= jj # VFL 
                                    if iicount >= istart  
                                    if iicount <= iend  
                                       tpps(a2,a1,ii)    = 0.0 
                                       execute stripi      tppp tpps  
                                       tpp(a2,a1)        = tpps(a2,a1,ii) 
                                       tppqq(a,a1,b,k1) = Vaabj(a,a2,b,k1)*tpp(a2,a1)  

                                      #taaaiii(a,a1,b,k1,ii,jj)  = tpppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                       execute sum_64ss Xaaaiii tppqq 
                                    endif  
                                    endif  
                                    endif  
                                 ENDDO ii 

                              endif  
                              endif  
                           ENDDO jj 
                        ENDIF 
                     ENDDO i1
                  ENDIF 
               ENDDO i2 
               endif 
            ENDDO k1
            ENDDO a2 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV4O3_4 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV4O3_5 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 5 
#
# ------------------------------------------------------------------------------ 
#
            DO b1 
               icount = 0.0 
            DO i1 
               icount = icount + 1 
               if icount == whichi  
               REQUEST Vbbai(b1,b,a,i1) b 
               kcount = 0.0 
               DO k1 
                  kcount = kcount + 1 
                  if kcount == kstart   
                     jcount = 0.0 
                     DO i2 
                        jcount = jcount + 1 
                        if jcount == whichj 

                           REQUEST               L2aibj(a1,i2,b1,k1) a1 
                           t1qpqp(b1,a1,k1,i2) = L2aibj(a1,i2,b1,k1) 
                           iicount             = 0.0 
                           DO ii 
                              iicount = iicount + 1 
                              if iicount >= istart  
                              if iicount <= iend 
                                 tqqps(b1,b,a,ii) = 0.0 
                                 execute stripi Vbbai tqqps 
                                 tqqp(b1,b,a) = tqqps(b1,b,a,ii) 
                                 t1pqq(a,b1,b) = tqqp(b1,b,a) 

                                 jjcount = 0.0 

                                 DO jj 
                                    jjcount = jjcount + 1 
                                    if jj >  ii # VFL 
                                    if jjcount >= jstart  
                                    if jjcount <= jend  
                                       t1qpqs(b1,a1,k1,jj) = 0.0 
                                       execute stripi t1qpqp t1qpqs 
                                       t2qpq(b1,a1,k1) = t1qpqs(b1,a1,k1,jj) 

                                       tppqq(a,a1,b,k1) = t1pqq(a,b1,b)*t2qpq(b1,a1,k1)   
                                      #taaaiii(a,a1,b,k1,ii,jj)  = tpppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                       execute sum_64ss Xaaaiii tppqq 

                                    endif  
                                    endif  
                                    endif  
                                 ENDDO jj 

                              endif  
                              endif  
                           ENDDO ii 
                        ENDIF 
                     ENDDO i2 
                  ENDIF 
               ENDDO k1
               endif 
            ENDDO i1
            ENDDO b1 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV4O3_5 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV4O3_6 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 6 
#
# ------------------------------------------------------------------------------ 
#
            DO b1 
               jcount = 0.0 
            DO i2 
               jcount = jcount + 1 
               if jcount == whichj  
               REQUEST Vbbai(b1,b,a,i2) b 
               kcount = 0.0 
               DO k1 
                  kcount = kcount + 1 
                  if kcount == kstart   
                     icount = 0.0 
                     DO i1 
                        icount = icount + 1 
                        if icount == whichi 

                           REQUEST               L2aibj(a1,i1,b1,k1) a1
                           t1qpqp(b1,a1,k1,i1) = L2aibj(a1,i1,b1,k1) 
                           jjcount             = 0.0 
                           DO jj 
                              jjcount = jjcount + 1 
                              if jjcount >= jstart  
                              if jjcount <= jend 
                                 tqqps(b1,b,a,jj) = 0.0 
                                 execute stripi Vbbai tqqps 
                                 tqqp(b1,b,a) = tqqps(b1,b,a,jj) 
                                 t1pqq(a,b1,b) = tqqp(b1,b,a) 
                                 t1pqq(a,b1,b) *= -1.0  

                                 iicount = 0.0 

                                 DO ii 
                                    iicount = iicount + 1 
                                    if ii <  jj # VFL 
                                    if iicount >= istart  
                                    if iicount <= iend  
                                       t1qpqs(b1,a1,k1,ii) = 0.0 
                                       execute stripi t1qpqp t1qpqs 
                                       t2qpq(b1,a1,k1) = t1qpqs(b1,a1,k1,ii) 

                                       tppqq(a,a1,b,k1) = t1pqq(a,b1,b)*t2qpq(b1,a1,k1)   
                                      #taaaiii(a,a1,b,k1,ii,jj)  = tpppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                       execute sum_64ss Xaaaiii tppqq 

                                    endif  
                                    endif  
                                    endif  
                                 ENDDO ii 

                              endif  
                              endif  
                           ENDDO jj 
                        ENDIF 
                     ENDDO i1
                  ENDIF 
               ENDDO k1
               endif 
            ENDDO i2 
            ENDDO b1 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV4O3_6 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV4O3_7 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 7 
#
# ------------------------------------------------------------------------------ 
#
            DO a2 
               jcount = 0.0 
            DO i2 
               jcount = jcount + 1 
               if jcount == whichj  
               REQUEST VSaaai(a,a2,a1,i2) a 
               icount = 0.0 
               DO i1 
                  icount = icount + 1 
                  if icount == whichi  
                     kcount = 0.0 
                     DO k1 
                        kcount = kcount + 1 
                        if kcount == kstart  

                           REQUEST              L2aibj(a2,i1,b,k1) b 
                           tpqqp(a2,b,k1,i1) = L2aibj(a2,i1,b,k1) 
                           jjcount              = 0.0 
                           DO jj 
                              jjcount = jjcount + 1 
                              if jjcount >= jstart  
                              if jjcount <= jend 

                                 tppps(a,a2,a1,jj) = 0.0 
                                 execute stripi   VSaaai tppps  
                                 t1ppp(a,a2,a1) = tppps(a,a2,a1,jj) 
                                 t2ppp(a,a1,a2) = t1ppp(a,a2,a1) 
                                 iicount = 0.0 

                                 DO ii 
                                    iicount = iicount + 1 
                                    if ii <  jj # VFL 
                                    if iicount >= istart  
                                    if iicount <= iend  
                                       t1pqqs(a2,b,k1,ii)    = 0.0 
                                       execute stripi      tpqqp t1pqqs  
                                       tpqq(a2,b,k1)        = t1pqqs(a2,b,k1,ii) 

                                       t1ppqq(a,a1,b,k1) = t2ppp(a,a1,a2)*tpqq(a2,b,k1)  
                                      #taaaiii(a,a1,b,k1,ii,jj)  = t1pppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                       execute sum_64ss Xaaaiii t1ppqq 
                                    endif  
                                    endif  
                                    endif  
                                 ENDDO ii 

                              endif  
                              endif  
                           ENDDO jj 
                        ENDIF 
                     ENDDO k1
                  ENDIF 
               ENDDO i1
               endif 
            ENDDO i2 
            ENDDO a2 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV4O3_7 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV4O3_8 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 8 
#
# ------------------------------------------------------------------------------ 
#
            DO a2 
               icount = 0.0 
            DO i1 
               icount = icount + 1 
               if icount == whichi  
               REQUEST VSaaai(a,a2,a1,i1) a 
               jcount = 0.0 
               DO i2 
                  jcount = jcount + 1 
                  if jcount == whichj  
                     kcount = 0.0 
                     DO k1 
                        kcount = kcount + 1 
                        if kcount == kstart  

                           REQUEST              L2aibj(a2,i2,b,k1) b 
                           tpqqp(a2,b,k1,i2) = L2aibj(a2,i2,b,k1) 
                           tpqqp(a2,b,k1,i2) *= -1.0  
                           iicount              = 0.0 
                           DO ii 
                              iicount = iicount + 1 
                              if iicount >= istart  
                              if iicount <= iend 

                                 tppps(a,a2,a1,ii) = 0.0 
                                 execute stripi   VSaaai tppps  
                                 t1ppp(a,a2,a1) = tppps(a,a2,a1,ii) 
                                 t2ppp(a,a1,a2) = t1ppp(a,a2,a1) 
                                 jjcount = 0.0 

                                 DO jj 
                                    jjcount = jjcount + 1 
                                    if jj >  ii # VFL 
                                    if jjcount >= jstart  
                                    if jjcount <= jend  
                                       t1pqqs(a2,b,k1,jj)    = 0.0 
                                       execute stripi      tpqqp t1pqqs  
                                       tpqq(a2,b,k1)        = t1pqqs(a2,b,k1,jj) 

                                       t1ppqq(a,a1,b,k1) = t2ppp(a,a1,a2)*tpqq(a2,b,k1)  
                                      #taaaiii(a,a1,b,k1,ii,jj)  = t1pppp(a,a1,b,k1) 
                                      #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                       execute sum_64ss Xaaaiii t1ppqq 
                                    endif  
                                    endif  
                                    endif  
                                 ENDDO jj 

                              endif  
                              endif  
                           ENDDO ii 
                        ENDIF 
                     ENDDO k1
                  ENDIF 
               ENDDO i2 
               endif 
            ENDDO i1
            ENDDO a2 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV4O3_8 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# Done the expensive terms, now do the 'cheap' terms scaling as VVVOOOO 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV3O4_1 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# TERM 1 
#
# ------------------------------------------------------------------------------ 
#
            DO j2
               icount = 0.0
               DO i1
                  icount = icount + 1
                  if icount == whichi
                     REQUEST            L2aibj(a,i1,b,j2) a
                     tpqqp(a,j2,b,i1) = L2aibj(a,i1,b,j2)
                     tpqqp(a,j2,b,i1)*= -1.0
                     jcount = 0.0
                     DO i2 
                        jcount = jcount + 1
                        if jcount == whichj
                           kcount = 0.0
                           DO k1
                              kcount = kcount + 1
                              if kcount == kstart
                                 REQUEST               Vpiqj(a1,i2,j2,k1) a1
                                 t1qpqp(j2,a1,k1,i2) = Vpiqj(a1,i2,j2,k1)

                                 iicount = 0.0
                                 DO ii
                                    iicount = iicount + 1
                                    if iicount >= istart
                                    if iicount <= iend
                                       tpqqs(a,j2,b,ii) = 0.0
                                       execute stripi tpqqp tpqqs
                                       tpqq(a,j2,b) = tpqqs(a,j2,b,ii)

                                       jjcount = 0.0
                                       DO jj
                                          jjcount = jjcount + 1
                                          if jj >= ii # VFL 
                                          if jjcount >= jstart
                                          if jjcount <= jend
                                             t1qpqs(j2,a1,k1,jj) = 0.0
                                             execute stripi t1qpqp t1qpqs
                                             t1qpq(j2,a1,k1) = t1qpqs(j2,a1,k1,jj)

                                             t2ppqq(a,a1,b,k1)         = tpqq(a,j2,b)*t1qpq(j2,a1,k1)
                                            #taaaiii(a,a1,b,k1,ii,jj)  = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 

                                          endif
                                          endif
                                          endif
                                       ENDDO jj

                                    endif
                                    endif
                                 ENDDO ii
                              ENDIF
                           ENDDO k1
                        ENDIF
                     ENDDO i2 
                  endif
               ENDDO i1
            ENDDO j2
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV3O4_1 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV3O4_2 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 2 
#
# ------------------------------------------------------------------------------
#
            DO j2
               jcount = 0.0
               DO i2 
                  jcount = jcount + 1
                  if jcount == whichj
                     REQUEST            L2aibj(a,i2,b,j2) a
                     tpqqp(a,j2,b,i2) = L2aibj(a,i2,b,j2)
                     icount = 0.0
                     DO i1
                        icount = icount + 1
                        if icount == whichi
                           kcount = 0.0
                           DO k1
                              kcount = kcount + 1
                              if kcount == kstart
                                 REQUEST               Vpiqj(a1,i1,j2,k1) a1
                                 t1qpqp(j2,a1,k1,i1) = Vpiqj(a1,i1,j2,k1)

                                 jjcount = 0.0
                                 DO jj
                                    jjcount = jjcount + 1
                                    if jjcount >= jstart
                                    if jjcount <= jend
                                       tpqqs(a,j2,b,jj) = 0.0
                                       execute stripi tpqqp tpqqs
                                       tpqq(a,j2,b) = tpqqs(a,j2,b,jj)

                                       iicount = 0.0
                                       DO ii
                                          iicount = iicount + 1
                                          if ii <= jj # VFL 
                                          if iicount >= istart
                                          if iicount <= iend
                                             t1qpqs(j2,a1,k1,ii) = 0.0
                                             execute stripi t1qpqp t1qpqs
                                             t1qpq(j2,a1,k1) = t1qpqs(j2,a1,k1,ii)

                                             t2ppqq(a,a1,b,k1) = tpqq(a,j2,b)*t1qpq(j2,a1,k1)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO ii

                                    endif
                                    endif
                                 ENDDO jj
                              ENDIF
                           ENDDO k1
                        ENDIF
                     ENDDO i1
                  endif
               ENDDO i2 
            ENDDO j2
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV3O4_2 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV3O4_3 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 3 
#
# ------------------------------------------------------------------------------
#
            DO i3 
               kcount = 0.0
               DO k1
                  kcount = kcount + 1
                  if kcount == kstart
                     REQUEST            L2aibj(a,i3,b,k1) a
                     tppqq(a,i3,b,k1) = L2aibj(a,i3,b,k1)
                     tppqq(a,i3,b,k1)*= -1.0
                     icount = 0.0
                     DO i1
                        icount = icount + 1
                        if icount == whichi
                           jcount = 0.0
                           DO i2 
                              jcount = jcount + 1
                              if jcount == whichj
                                 REQUEST               VSpipi(a1,i2,i3,i1) a1
                                 t1pppp(i3,a1,i2,i1) = VSpipi(a1,i2,i3,i1)

                                 iicount = 0.0
                                 DO ii
                                    iicount = iicount + 1
                                    if iicount >= istart
                                    if iicount <= iend
                                       tppps(i3,a1,i2,ii) = 0.0
                                       execute stripi   t1pppp tppps
                                       tppp(i3,a1,i2) = tppps(i3,a1,i2,ii)

                                       jjcount = 0.0
                                       DO jj
                                          jjcount = jjcount + 1
                                          if jj >= ii # VFL 
                                          if jjcount >= jstart
                                          if jjcount <= jend
                                             tpps(i3,a1,jj) = 0.0
                                             execute stripi tppp tpps
                                             tpp(i3,a1)   = tpps(i3,a1,jj)

                                             t2ppqq(a,a1,b,k1)         = tppqq(a,i3,b,k1)*tpp(i3,a1)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO jj

                                    endif
                                    endif
                                 ENDDO ii
                              ENDIF
                           ENDDO i2 
                        ENDIF
                     ENDDO i1
                  endif
               ENDDO k1
            ENDDO i3 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV3O4_3 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV3O4_4 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 4 
#
# ------------------------------------------------------------------------------
#
            DO i3 
               jcount = 0.0
               DO i2 
                  jcount = jcount + 1
                  if jcount == whichj
                     REQUEST             LSaiai(a1,i2,a,i3) a
                     tpppp(a,a1,i3,i2) = LSaiai(a1,i2,a,i3)
                     tpppp(a,a1,i3,i2)*= -1.0
                     icount = 0.0
                     DO i1
                        icount = icount + 1
                        if icount == whichi
                           kcount = 0.0
                           DO k1
                              kcount = kcount + 1
                              if kcount == kstart
                                 REQUEST              Vpiqj(i3,i1,b,k1) b
                                 t1pqqp(i3,b,k1,i1) = Vpiqj(i3,i1,b,k1)

                                 jjcount = 0.0
                                 DO jj
                                    jjcount = jjcount + 1
                                    if jjcount >= jstart
                                    if jjcount <= jend
                                       tppps(a,a1,i3,jj) = 0.0
                                       execute stripi tpppp tppps
                                       tppp(a,a1,i3) = tppps(a,a1,i3,jj)

                                       iicount = 0.0
                                       DO ii
                                          iicount = iicount + 1
                                          if ii <= jj # VFL 
                                          if iicount >= istart
                                          if iicount <= iend
                                             t1pqqs(i3,b,k1,ii) = 0.0
                                             execute stripi t1pqqp t1pqqs
                                             t1pqq(i3,b,k1) = t1pqqs(i3,b,k1,ii)

                                             t2ppqq(a,a1,b,k1) = tppp(a,a1,i3)*t1pqq(i3,b,k1)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO ii
                                    endif
                                    endif
                                 ENDDO jj
                              ENDIF
                           ENDDO k1
                        ENDIF
                     ENDDO i1
                  endif
               ENDDO i2 
            ENDDO i3 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV3O4_4 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV3O4_5 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 5 
#
# ------------------------------------------------------------------------------
#
            DO i3 
               icount = 0.0
               DO i1
                  icount = icount + 1
                  if icount == whichi
                     REQUEST             LSaiai(a1,i1,a,i3) a
                     tpppp(a,a1,i3,i1) = LSaiai(a1,i1,a,i3)
                     jcount = 0.0
                     DO i2 
                        jcount = jcount + 1
                        if jcount == whichj
                           kcount = 0.0
                           DO k1
                              kcount = kcount + 1
                              if kcount == kstart
                                 REQUEST              Vpiqj(i3,i2,b,k1) b
                                 t1pqqp(i3,b,k1,i2) = Vpiqj(i3,i2,b,k1)

                                 iicount = 0.0
                                 DO ii
                                    iicount = iicount + 1
                                    if iicount >= istart
                                    if iicount <= iend
                                       tppps(a,a1,i3,ii) = 0.0
                                       execute stripi tpppp tppps
                                       tppp(a,a1,i3) = tppps(a,a1,i3,ii)

                                       jjcount = 0.0
                                       DO jj
                                          jjcount = jjcount + 1
                                          if jj >= ii # VFL 
                                          if jjcount >= jstart
                                          if jjcount <= jend
                                             t1pqqs(i3,b,k1,jj) = 0.0
                                             execute stripi t1pqqp t1pqqs
                                             t1pqq(i3,b,k1) = t1pqqs(i3,b,k1,jj)

                                             t2ppqq(a,a1,b,k1) = tppp(a,a1,i3)*t1pqq(i3,b,k1)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO jj

                                    endif
                                    endif
                                 ENDDO ii
                              ENDIF
                           ENDDO k1
                        ENDIF
                     ENDDO i2 
                  endif
               ENDDO i1
            ENDDO i3 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV3O4_5 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV3O4_6 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 6 
#
# ------------------------------------------------------------------------------
#
            DO i3 
               kcount = 0.0
               DO k1
                  kcount = kcount + 1
                  if kcount == kstart
                     REQUEST            L2aibj(a1,i3,b,k1) a1
                     tppqq(i3,a1,b,k1) = L2aibj(a1,i3,b,k1)
                     jcount = 0.0
                     DO i2 
                        jcount = jcount + 1
                        if jcount == whichj
                           icount = 0.0
                           DO i1
                              icount = icount + 1
                              if icount == whichi
                                 REQUEST              VSpipi(a,i2,i3,i1) a
                                 t1pppp(i3,a,i2,i1) = VSpipi(a,i2,i3,i1)

                                 iicount = 0.0
                                 DO ii
                                    iicount = iicount + 1
                                    if iicount >= istart
                                    if iicount <= iend
                                       tppps(i3,a,i2,ii) = 0.0
                                       execute stripi   t1pppp tppps
                                       tppp(i3,a,i2) = tppps(i3,a,i2,ii)

                                       jjcount = 0.0
                                       DO jj
                                          jjcount = jjcount + 1
                                          if jj >= ii # VFL 
                                          if jjcount >= jstart
                                          if jjcount <= jend
                                             tpps(i3,a,jj) = 0.0
                                             execute stripi tppp tpps
                                             tpp(i3,a)   = tpps(i3,a,jj)

                                             t2ppqq(a,a1,b,k1)         = tppqq(i3,a1,b,k1)*tpp(i3,a)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO jj

                                    endif
                                    endif
                                 ENDDO ii
                              ENDIF
                           ENDDO i1
                        ENDIF
                     ENDDO i2 
                  endif
               ENDDO k1
            ENDDO i3 
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV3O4_6 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV3O4_7 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 7 
#
# ------------------------------------------------------------------------------
#
            DO j2
               icount = 0.0
               DO i1
                  icount = icount + 1
                  if icount == whichi
                     REQUEST             L2aibj(a1,i1,b,j2) b
                     tqpqp(j2,a1,b,i1) = L2aibj(a1,i1,b,j2)
                     jcount = 0.0
                     DO i2 
                        jcount = jcount + 1
                        if jcount == whichj
                           kcount = 0.0
                           DO k1
                              kcount = kcount + 1
                              if kcount == kstart
                                 REQUEST              Vpiqj(a,i2,j2,k1) a
                                 t1qpqp(j2,a,k1,i2) = Vpiqj(a,i2,j2,k1)

                                 jjcount = 0.0
                                 DO jj
                                    jjcount = jjcount + 1
                                    if jjcount >= jstart
                                    if jjcount <= jend
                                       tqpqs(j2,a,k1,jj) = 0.0
                                       execute stripi t1qpqp tqpqs
                                       tqpq(j2,a,k1) = tqpqs(j2,a,k1,jj)

                                       iicount = 0.0
                                       DO ii
                                          iicount = iicount + 1
                                          if ii <= jj # VFL 
                                          if iicount >= istart
                                          if iicount <= iend
                                             t1qpqs(j2,a1,b,ii) = 0.0
                                             execute stripi tqpqp t1qpqs
                                             t1qpq(j2,a1,b) = t1qpqs(j2,a1,b,ii)

                                             t2ppqq(a,a1,b,k1) = t1qpq(j2,a1,b)*tqpq(j2,a,k1)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO ii

                                    endif
                                    endif
                                 ENDDO jj
                              ENDIF
                           ENDDO k1
                        ENDIF
                     ENDDO i2 
                  endif
               ENDDO i1
            ENDDO j2
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV3O4_7 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
      PROC LV3O4_8 
#     ----------- 
#
# ------------------------------------------------------------------------------ 
#
# ------------------------------------------------------------------------------ 
#
# TERM 8 
#
# ------------------------------------------------------------------------------
#
            DO j2
               jcount = 0.0
               DO i2 
                  jcount = jcount + 1
                  if jcount == whichj
                     REQUEST             L2aibj(a1,i2,b,j2) b
                     tqpqp(j2,a1,b,i2) = L2aibj(a1,i2,b,j2)
                     tqpqp(j2,a1,b,i2)*= -1.0
                     icount = 0.0
                     DO i1
                        icount = icount + 1
                        if icount == whichi
                           kcount = 0.0
                           DO k1
                              kcount = kcount + 1
                              if kcount == kstart
                                 REQUEST              Vpiqj(a,i1,j2,k1) a
                                 t1qpqp(j2,a,k1,i1) = Vpiqj(a,i1,j2,k1)

                                 iicount = 0.0
                                 DO ii
                                    iicount = iicount + 1
                                    if iicount >= istart
                                    if iicount <= iend
                                       tqpqs(j2,a,k1,ii) = 0.0
                                       execute stripi t1qpqp tqpqs
                                       tqpq(j2,a,k1) = tqpqs(j2,a,k1,ii)

                                       jjcount = 0.0
                                       DO jj
                                          jjcount = jjcount + 1
                                          if jj >= ii # VFL 
                                          if jjcount >= jstart
                                          if jjcount <= jend
                                             t1qpqs(j2,a1,b,jj) = 0.0
                                             execute stripi tqpqp t1qpqs
                                             t1qpq(j2,a1,b) = t1qpqs(j2,a1,b,jj)

                                             t2ppqq(a,a1,b,k1) = t1qpq(j2,a1,b)*tqpq(j2,a,k1)
                                            #taaaiii(a,a1,b,k1,ii,jj) = t2pppp(a,a1,b,k1)
                                            #Xaaaiii(a,a1,b,k1,ii,jj) += taaaiii(a,a1,b,k1,ii,jj)

                                             execute sum_64ss Xaaaiii t2ppqq 
                                          endif
                                          endif
                                          endif
                                       ENDDO jj

                                    endif
                                    endif
                                 ENDDO ii
                              ENDIF
                           ENDDO k1
                        ENDIF
                     ENDDO i1
                  endif
               ENDDO i2 
            ENDDO j2
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC LV3O4_8 
#     -------------- 
#
# ------------------------------------------------------------------------------ 
#
#
# ------------------------------------------------------------------------------ 
#
      PROC COMP_T3aaaiii  
#     ------------------ 
#
# ------------------------------------------------------------------------------
#
# Form Taaaiii 
# ------------
#
            kcount = 0.0
            DO k1
               kcount = kcount + 1
               if kcount == kstart
            icount = 0.0
            DO i1
               icount = icount + 1
               if icount == whichi
            jcount = 0.0
            DO i2 
               jcount = jcount + 1
               if jcount == whichj
#
                  iicount = 0.0
                  DO ii
                     iicount = iicount + 1
                     if iicount >= istart
                     if iicount <= iend
                  jjcount = 0.0
                  DO jj
                     jjcount = jjcount + 1
                     if jj >= ii # VFL 
                     if jjcount >= jstart
                     if jjcount <= jend

                        taaaiii(a,a1,b,k1,ii,jj) = xaaaiii(a,a1,b,k1,ii,jj)
                        execute energy_tdenominator taaaiii(a,a1,b,k1,ii,jj) 
#
#        Replace xaaaiii by the amplitude(include denominator). 
#        ------------------------------------------------------ 
                        xaaaiii(a,a1,b,k1,ii,jj) = taaaiii(a,a1,b,k1,ii,jj) 
#
                     endif
                     endif
                     endif
                  ENDDO jj
                     endif
                     endif
                  ENDDO ii
#
               endif
             ENDDO i2 
               endif
             ENDDO i1
               endif
             ENDDO k1
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC COMP_T3aaaiii  
#     --------------------- 
#
# ------------------------------------------------------------------------------
#
# ------------------------------------------------------------------------------ 
#
      PROC COMP_E4T 
#     ------------- 
#
# ------------------------------------------------------------------------------
#
# Form Taaaiii and form energy contribution
# -----------------------------------------
#
            pcount = 0.0
            fcount = 0.0
            efact  = 1.0 
#
            if a < a1
               fcount = fcount + 1
               efact = 2.0 
            endif
#
            kcount = 0.0
            DO k1
               kcount = kcount + 1
               if kcount == kstart
            icount = 0.0
            DO i1
               icount = icount + 1
               if icount == whichi
            jcount = 0.0
            DO i2 
               jcount = jcount + 1
               if jcount == whichj
#
                  iicount = 0.0
                  DO ii
                     iicount = iicount + 1
                     if iicount >= istart
                     if iicount <= iend
                  jjcount = 0.0
                  DO jj
                     jjcount = jjcount + 1
                     if jj >= ii # VFL 
                     if jjcount >= jstart
                     if jjcount <= jend
#
                        tppqq(a,a1,b,k1)  = Raaaiii(a,a1,b,k1,ii,jj) 
                        t1ppqq(a,a1,b,k1) = Xaaaiii(a,a1,b,k1,ii,jj) 
                        etemp             = tppqq(a,a1,b,k1)*t1ppqq(a,a1,b,k1) 
                        etemp            *= efact 

                        if jj > ii 
                           etemp *= 2.0  
                        endif 

                        esum += etemp
#
                     endif
                     endif
                     endif
                  ENDDO jj
                     endif
                     endif
                  ENDDO ii
#
               endif
             ENDDO i2 
               endif
             ENDDO i1
               endif
             ENDDO k1
#
# ------------------------------------------------------------------------------ 
#
      ENDPROC COMP_E4T 
#     ---------------- 
#
# ------------------------------------------------------------------------------
#
# ------------------------------------------------------------------------------
#
      PROC COMP_E5S 
#     ------------- 
#
# ------------------------------------------------------------------------------ 
#
# Form sai so that the singles contribution can be computed. 
#
# ------------------------------------------------------------------------------ 
#
# PERM 1 
# ------ 
      fact = 4.0 # efact  
#
#     Symmetry 1 
#     ---------- 
#
            kcount = 0.0
            DO k1
               kcount = kcount + 1
               if kcount == kstart
            icount = 0.0
            DO i1
               icount = icount + 1
               if icount == whichi
               REQUEST              Vpiqj(a1,i1,b,k1) a1 
               REQUEST              Vpiqj(a,i1,b,k1) a 
               t3pqqp(a1,b,k1,i1) = Vpiqj(a1,i1,b,k1)  
               t4pqqp(a,b,k1,i1)  = Vpiqj(a,i1,b,k1) 
            jcount = 0.0
            DO i2 
               jcount = jcount + 1
               if jcount == whichj

                  REQUEST              Vpiqj(a,i2,b,k1) a 
                  REQUEST              Vpiqj(a1,i2,b,k1) b 
                  t1pqqp(a1,b,k1,i2) = Vpiqj(a1,i2,b,k1)  
                  t2pqqp(a,b,k1,i2)  = Vpiqj(a,i2,b,k1) 
#
                  iicount = 0.0
                  DO ii
                     iicount = iicount + 1
                     if iicount >= istart
                     if iicount <= iend
                  jjcount = 0.0
                  DO jj
                     jjcount = jjcount + 1
                     if jj >= ii # VFL 
                     if jjcount >= jstart
                     if jjcount <= jend
#
                        tppqq(a,a1,b,k1)   = xaaaiii(a,a1,b,k1,ii,jj) 
#
                        t1pqqs(a1,b,k1,jj) = 0.0 
                        execute stripi       t1pqqp t1pqqs 
                        t1pqq(a1,b,k1)     = t1pqqs(a1,b,k1,jj)  
                        t1pqqs(a1,b,k1,ii) = t1pqq(a1,b,k1)  
#
# ---------------------------------------------------------------------------------------------------- 
#
               IF a < a1 
               IF ii < jj 
#
                       xai(a,ii)      = tppqq(a,a1,b,k1)*t1pqqs(a1,b,k1,ii)
                       xai(a,ii)     *= fact  
                       PUT sai(a,ii) += xai(a,ii) 
#
                      #REQUEST Vpiqj(a,i2,b,k1) a 
                      #t2pppp(a,b,k1,i2) = Vpiqj(a,i2,b,k1) 
                       t2pqqs(a,b,k1,jj) = 0.0 
                       execute stripi t2pqqp t2pqqs 
                       t2pqq(a,b,k1)     = t2pqqs(a,b,k1,jj)
                       t2pqqs(a,b,k1,ii) = t2pqq(a,b,k1) 
#
                       xai(a1,ii)           = tppqq(a,a1,b,k1)*t2pqqs(a,b,k1,ii) 
                       xai(a1,ii)          *= fact   
                       xai(a1,ii)          *= -1.0  
                       PUT sai(a1,ii)      += xai(a1,ii) 
#
                      #REQUEST Vpiqj(a1,i1,b,k1) a1 
                      #t3pppp(a1,b,k1,i1) = Vpiqj(a1,i1,b,k1)  
                       t3pqqs(a1,b,k1,ii) = 0.0
                       execute stripi t3pqqp t3pqqs 
                       t3pqq(a1,b,k1) = t3pqqs(a1,b,k1,ii)
                       t3pqqs(a1,b,k1,jj) = t3pqq(a1,b,k1) 
#
                       xai(a,jj)           = tppqq(a,a1,b,k1)*t3pqqs(a1,b,k1,jj) 
                       xai(a,jj)          *= fact   
                       xai(a,jj)          *= -1.0  
                       PUT sai(a,jj)      += xai(a,jj) 
#
                      #REQUEST Vpiqj(a,i1,b,k1) a 
                      #t4pppp(a,b,k1,i1) = Vpiqj(a,i1,b,k1) 
                       t4pqqs(a,b,k1,ii) = 0.0 
                       execute stripi t4pqqp t4pqqs 
                       t4pqq(a,b,k1) = t4pqqs(a,b,k1,ii) 
                       t4pqqs(a,b,k1,jj) = t4pqq(a,b,k1) 
#
                       xai(a1,jj)           = tppqq(a,a1,b,k1)*t4pqqs(a,b,k1,jj) 
                       xai(a1,jj)          *= fact   
                       PUT sai(a1,jj)      += xai(a1,jj) 
#
              ENDIF 
              ENDIF 
#
# ---------------------------------------------------------------------------------------------------- 
#
                     endif
                     endif
                     endif
                  ENDDO jj
                     endif
                     endif
                  ENDDO ii
#
               endif
             ENDDO i2 
               endif
             ENDDO i1
               endif
             ENDDO k1
#
#     Symmetry 2 
#     ---------- 
#
            kcount = 0.0
            DO k1
               kcount = kcount + 1
               if kcount == kstart
            icount = 0.0
            DO i1
               icount = icount + 1
               if icount == whichi
               REQUEST              Vpiqj(a1,i1,b,k1) a1 
               t2pqqp(a1,b,k1,i1) = Vpiqj(a1,i1,b,k1)  
            jcount = 0.0
            DO i2 
               jcount = jcount + 1
               if jcount == whichj

                  REQUEST              Vpiqj(a1,i2,b,k1) b 
                  t1pqqp(a1,b,k1,i2) = Vpiqj(a1,i2,b,k1)  
#
                  iicount = 0.0
                  DO ii
                     iicount = iicount + 1
                     if iicount >= istart
                     if iicount <= iend
                  jjcount = 0.0
                  DO jj
                     jjcount = jjcount + 1
                     if jj >= ii # VFL 
                     if jjcount >= jstart
                     if jjcount <= jend
#
                        tppqq(a,a1,b,k1)   = xaaaiii(a,a1,b,k1,ii,jj) 
#
                        t1pqqs(a1,b,k1,jj) = 0.0 
                        execute stripi       t1pqqp t1pqqs 
                        t1pqq(a1,b,k1)     = t1pqqs(a1,b,k1,jj)  
                        t1pqqs(a1,b,k1,ii) = t1pqq(a1,b,k1)  
#
# ---------------------------------------------------------------------------------------------------- 
#
# ---------------------------------------------------------------------------------------------------- 
#
               IF a == a1 
               IF ii < jj 
#
                        xai(a,ii)      = tppqq(a,a1,b,k1)*t1pqqs(a1,b,k1,ii)
                        xai(a,ii)     *= fact  
                        PUT sai(a,ii) += xai(a,ii) 
#
                       #REQUEST Vpiqj(a1,i1,b,k1) a1 
                       #t2pppp(a1,b,k1,i1) = Vpiqj(a1,i1,b,k1)  
                        t2pqqs(a1,b,k1,ii) = 0.0
                        execute stripi t2pqqp t2pqqs 
                        t2pqq(a1,b,k1) = t2pqqs(a1,b,k1,ii)
                        t2pqqs(a1,b,k1,jj) = t2pqq(a1,b,k1) 
#
                        xai(a,jj)           = tppqq(a,a1,b,k1)*t2pqqs(a1,b,k1,jj) 
                        xai(a,jj)          *= fact   
                        xai(a,jj)          *= -1.0  
                        PUT sai(a,jj)      += xai(a,jj) 
#
                endif 
                endif 
#
# ---------------------------------------------------------------------------------------------------- 
#
# ---------------------------------------------------------------------------------------------------- 
#
                     endif
                     endif
                     endif
                  ENDDO jj
                     endif
                     endif
                  ENDDO ii
#
               endif
             ENDDO i2 
               endif
             ENDDO i1
               endif
             ENDDO k1
#
#     Symmetry 3 
#     ---------- 
#
            kcount = 0.0
            DO k1
               kcount = kcount + 1
               if kcount == kstart
            icount = 0.0
            DO i1
               icount = icount + 1
               if icount == whichi
               REQUEST              Vpiqj(a1,i1,b,k1) a1 
               t2pqqp(a1,b,k1,i1) = Vpiqj(a1,i1,b,k1)  
            jcount = 0.0
            DO i2 
               jcount = jcount + 1
               if jcount == whichj

                  REQUEST              Vpiqj(a1,i2,b,k1) b 
                  t1pqqp(a1,b,k1,i2) = Vpiqj(a1,i2,b,k1)  
#
                  iicount = 0.0
                  DO ii
                     iicount = iicount + 1
                     if iicount >= istart
                     if iicount <= iend
                  jjcount = 0.0
                  DO jj
                     jjcount = jjcount + 1
                     if jj >= ii # VFL 
                     if jjcount >= jstart
                     if jjcount <= jend
#
                        tppqq(a,a1,b,k1)   = xaaaiii(a,a1,b,k1,ii,jj) 
#
                        t1pqqs(a1,b,k1,jj) = 0.0 
                        execute stripi       t1pqqp t1pqqs 
                        t1pqq(a1,b,k1)     = t1pqqs(a1,b,k1,jj)  
                        t1pqqs(a1,b,k1,ii) = t1pqq(a1,b,k1)  
#
# ---------------------------------------------------------------------------------------------------- 
#
# ---------------------------------------------------------------------------------------------------- 
#
               IF a < a1 
               IF ii == jj 
#
                        xai(a,ii)      = tppqq(a,a1,b,k1)*t1pqqs(a1,b,k1,ii)
                        xai(a,ii)     *= fact  
                        PUT sai(a,ii) += xai(a,ii) 
#
                       #REQUEST Vpiqj(a1,i1,b,k1) a1 
                       #t2pppp(a1,b,k1,i1) = Vpiqj(a1,i1,b,k1)  
                        t2pqqs(a1,b,k1,ii) = 0.0
                        execute stripi t2pqqp t2pqqs 
                        t2pqq(a1,b,k1) = t2pqqs(a1,b,k1,ii)
                        t2pqqs(a1,b,k1,jj) = t2pqq(a1,b,k1) 
#
                        xai(a,jj)           = tppqq(a,a1,b,k1)*t2pqqs(a1,b,k1,jj) 
                        xai(a,jj)          *= fact   
                        xai(a,jj)          *= -1.0  
                        PUT sai(a,jj)      += xai(a,jj) 
#
                endif 
                endif 
#
# ---------------------------------------------------------------------------------------------------- 
#
# ---------------------------------------------------------------------------------------------------- 
#
                     endif
                     endif
                     endif
                  ENDDO jj
                     endif
                     endif
                  ENDDO ii
#
               endif
             ENDDO i2 
               endif
             ENDDO i1
               endif
             ENDDO k1
#
#     Symmetry 4 
#     ---------- 
#
            kcount = 0.0
            DO k1
               kcount = kcount + 1
               if kcount == kstart
            icount = 0.0
            DO i1
               icount = icount + 1
               if icount == whichi
            jcount = 0.0
            DO i2 
               jcount = jcount + 1
               if jcount == whichj

                  REQUEST              Vpiqj(a1,i2,b,k1) b 
                  t1pqqp(a1,b,k1,i2) = Vpiqj(a1,i2,b,k1)  
#
                  iicount = 0.0
                  DO ii
                     iicount = iicount + 1
                     if iicount >= istart
                     if iicount <= iend
                  jjcount = 0.0
                  DO jj
                     jjcount = jjcount + 1
                     if jj >= ii # VFL 
                     if jjcount >= jstart
                     if jjcount <= jend
#
                        tppqq(a,a1,b,k1)   = xaaaiii(a,a1,b,k1,ii,jj) 
#
                        t1pqqs(a1,b,k1,jj) = 0.0 
                        execute stripi       t1pqqp t1pqqs 
                        t1pqq(a1,b,k1)     = t1pqqs(a1,b,k1,jj)  
                        t1pqqs(a1,b,k1,ii) = t1pqq(a1,b,k1)  
#
# ------------------------------------------------------------------------------------------------ 
#
#
               IF a == a1 
               IF ii == jj 
#
                        xai(a,ii)      = tppqq(a,a1,b,k1)*t1pqqs(a1,b,k1,ii)
                        xai(a,ii)     *= fact  
                        PUT sai(a,ii) += xai(a,ii) 
#
                endif 
                endif 
#
# ------------------------------------------------------------------------------------------------ 
#
                     endif
                     endif
                     endif
                  ENDDO jj
                     endif
                     endif
                  ENDDO ii
#
               endif
             ENDDO i2 
               endif
             ENDDO i1
               endif
             ENDDO k1
#
# END PERM 1 
# ---------- 
#
# PERM X 
# ------ 
#
            kcount = 0.0
            DO k1
               kcount = kcount + 1
               if kcount == kstart
            icount = 0.0
            DO i1
               icount = icount + 1
               if icount == whichi
            jcount = 0.0
            DO i2 
               jcount = jcount + 1
               if jcount == whichj

                  REQUEST              VSpipi(a,i1,a1,i2) a 
                  t1pppp(a,a1,i2,i1) = VSpipi(a,i1,a1,i2)  
#
                  iicount = 0.0
                  DO ii
                     iicount = iicount + 1
                     if iicount >= istart
                     if iicount <= iend

                        t1ppps(a,a1,i2,ii) = 0.0 
                        execute stripi t1pppp t1ppps 
                        t1ppp(a,a1,i2) = t1ppps(a,a1,i2,ii) 

                  jjcount = 0.0
                  DO jj
                     jjcount = jjcount + 1
                     if jj >= ii # VFL 
                     if jjcount >= jstart
                     if jjcount <= jend
#
# Set the numerical factor 
# ------------------------ 
#
                        if a < a1
                        if ii < jj  
                           efact = 4.0 
                        endif
                        endif
#
                        if a == a1
                        if ii < jj  
                           efact = 2.0 
                        endif
                        endif
#
                        if a < a1
                        if ii == jj  
                           efact = 2.0 
                        endif
                        endif
#
                        if a == a1
                        if ii == jj  
                           efact = 1.0 
                        endif
                        endif
# ------------------------ 
#
                       #taaaiii(a,a1,b,k1,ii,jj)  = xaaaiii(a,a1,b,k1,ii,jj)
                       #execute energy_tdenominator taaaiii(a,a1,b,k1,ii,jj)
                        tppqq(a,a1,b,k1)          = xaaaiii(a,a1,b,k1,ii,jj) 
#
                        t1pps(a,a1,jj) = 0.0 
                        execute stripi   t1ppp t1pps 
                        t1pp(a,a1)     = t1pps(a,a1,jj)  
                          
                        tqq(b,k1)      = tppqq(a,a1,b,k1)*t1pp(a,a1)
                        tqq(b,k1)     *= efact  
                        PUT zbj(b,k1) += tqq(b,k1) 
#
                     endif
                     endif
                     endif
                  ENDDO jj
                     endif
                     endif
                  ENDDO ii
#
               endif
             ENDDO i2 
               endif
             ENDDO i1
               endif
             ENDDO k1
#
# ------------------------------------------------------------------------------
#
      ENDPROC COMP_E5S 
#     ---------------- 
#
# ------------------------------------------------------------------------------ 
#
# ---------------------------------------------------------- 
# Virtual symetry combination one.                          
# ---------------------------------------------------------- 
#
# ------------------------------------------------------------------ 
#
     PROC OSEG_TRIP1 
#    ---------------  
#
# Loop over the occupied combinations 
# ----------------------------------- 
#
      ncount = 0.0 
      DO NT 

         ncount = ncount + 1.0  
         execute print_scalar ncount 

         whichi = 1.0 
         execute get_ijk whichi ncount  

         istart = 2.0 
         execute get_ijk istart ncount  

         iend   = 3.0 
         execute get_ijk iend ncount  

         whichj = 4.0 
         execute get_ijk whichj ncount  

         jstart = 5.0 
         execute get_ijk jstart ncount  

         jend   = 6.0 
         execute get_ijk jend ncount  

         kstart = 7.0 
         execute get_ijk kstart ncount  
         kend = kstart 

         if kstart <= 0.0  
            exit 
         endif  
         if ncount <= xtemp1  
         IF whichj >= whichi   
#
# ---------------------------------------------------------- 
# Virtual symetry combination one.                          
# ---------------------------------------------------------- 
#
# Set up the parallelization over the three virtual segments  
# ----------------------------------------------------------  
#
      PARDO a1, a, b 
      where a  <= a1 
#
# Allocate the partial amplitude array 
# ------------------------------------ 
#
            icount = 0 
            DO ii  
               icount = icount + 1 
               if icount >= istart 
               if icount <= iend  
               jcount = 0 
               DO jj 
                  jcount = jcount + 1 
                  if jcount >= jstart 
                  if jcount <= jend  
                  kcount = 0 
                  DO k1 
                     kcount = kcount + 1 
                     if kcount == kstart 
                        allocate Xaaaiii(a,a1,b,k1,ii,jj) 
                        allocate Raaaiii(a,a1,b,k1,ii,jj) 
                     endif 
                  ENDDO k1 
                  endif 
                  endif 
               ENDDO jj  
               endif 
               endif 
            ENDDO ii  
#
# First do the expensive part involving 3-virtual integrals and of order VVVVooo
# ------------------------------------------------------------------------------ 
      CALL V4O3_1    
      CALL V4O3_2   
      CALL V4O3_3  
      CALL V4O3_4 
      CALL V4O3_5 
      CALL V4O3_6 
      CALL V4O3_7 
      CALL V4O3_8 
#                
# Second do the cheaper part involving 3-virtual integrals and of order VVVVooo           
# ------------------------------------------------------------------------------         
      CALL V3O4_1                                                                       
      CALL V3O4_2                                                                      
      CALL V3O4_3                                                                     
      CALL V3O4_4                                                                    
      CALL V3O4_5                                                                   
      CALL V3O4_6                                                                  
      CALL V3O4_7                                                                 
      CALL V3O4_8                                                               
#
# Compute the 4th-order energy contribution 
# ----------------------------------------- 
      CALL COMP_T3aaaiii
#                                                                          
# Compute the 5th-order energy contribution                               
# -----------------------------------------                              
      CALL COMP_E5S                                                     
#  ---------------------------------------------------------------------------------- 
#  Put the right hand amplitude in Raaaiii 
#
      icount = 0
      DO ii
         icount = icount + 1
         if icount >= istart
         if icount <= iend
         jcount = 0
         DO jj
            jcount = jcount + 1
            if jcount >= jstart
            if jcount <= jend
            kcount = 0
            DO k1
               kcount = kcount + 1
               if kcount == kstart

                  Raaaiii(a,a1,b,k1,ii,jj) = Xaaaiii(a,a1,b,k1,ii,jj)
                  tppqp(a,a1,b,k1)         = 0.0
                  Xaaaiii(a,a1,b,k1,ii,jj) = tppqp(a,a1,b,k1)
               endif
            ENDDO k1
            endif
            endif
         ENDDO jj
         endif
         endif
      ENDDO ii
# First do the expensive part involving 3-virtual integrals and of order VVVVooo
# ------------------------------------------------------------------------------ 
      CALL LV4O3_1
      CALL LV4O3_2
      CALL LV4O3_3
      CALL LV4O3_4
      CALL LV4O3_5
      CALL LV4O3_6
      CALL LV4O3_7
      CALL LV4O3_8
#
# Second do the cheaper part involving 3-virtual integrals and of order VVVVooo
# ------------------------------------------------------------------------------

      CALL LV3O4_1
      CALL LV3O4_2
      CALL LV3O4_3
      CALL LV3O4_4
      CALL LV3O4_5
      CALL LV3O4_6
      CALL LV3O4_7
      CALL LV3O4_8
#                                                                              
# Compute the 4th-order energy contribution                                   
# -----------------------------------------                                  
      CALL COMP_E4T                                                         
#                                                                      
# deAllocate the partial amplitude array                                                                         
# --------------------------------------
#
            deallocate Xaaaiii(a,a1,b,k1,ii,jj) 
            deallocate Raaaiii(a,a1,b,k1,ii,jj) 
#
      ENDPARDO a1, a, b 
      execute server_barrier 
#
      endif 
      endif 
      ENDDO NT 
#                                                           
# ----------------------------------------------------------
# End Virtual symetry combination one.                      
# ----------------------------------------------------------
#
     ENDPROC OSEG_TRIP1 
#    -------------------  
#
# ------------------------------------------------------------------------------ 



#-------------------------------------------------------------------------
#
#    -------------------
      PROC  GET_RL_AMPS
#    -------------------
#
#
      rootcount = 0

      DO indone
      DO kroot

         GET  REE (kroot,indone)
         tee (kroot,indone) = REE (kroot,indone)

         rootcount += 1
         IF rootcount == iroot
            EXECUTE  RETURN_SVAL  tee  OMEGA
         ENDIF

      ENDDO kroot
      ENDDO indone

      EXECUTE  SIP_BARRIER

      ncount    = 0
      rootcount = 0
      DO indone
      DO kroot

         GET                  LEE (kroot,indone)
         tee (kroot,indone) = LEE (kroot,indone)
         EXECUTE  RETURN_SVAL  tee  L_OMEGA
         etemp = L_OMEGA - OMEGA
         IF etemp < 0.0
            etemp *= -1.0
         ENDIF

         rootcount += 1
         IF etemp < root_thresh
            ncount = rootcount
            EXIT
         ENDIF

      ENDDO kroot
      ENDDO indone

      EXECUTE  SIP_BARRIER

#
#
#          ...Grab an R  array...
#                      k
#
#
      PARDO  a1, i1
         rootcount = 0
         DO kroot
            GET  R1A_VECS (a1,i1,kroot)
            rootcount += 1
            IF  rootcount == iroot
                tt1ai (a1,i1) = R1A_VECS (a1,i1,kroot)
                PREPARE  t1a_old (a1,i1) = tt1ai (a1,i1)
            ENDIF
         ENDDO kroot
      ENDPARDO  a1, i1

      PARDO  b1, j1
         rootcount = 0
         DO kroot
            GET  R1B_VECS (b1,j1,kroot)
            rootcount += 1
            IF  rootcount == iroot
                tt1bj (b1,j1) = R1B_VECS (b1,j1,kroot)
                PREPARE  t1b_old (b1,j1) = tt1bj (b1,j1)
            ENDIF
         ENDDO kroot
      ENDPARDO  b1, j1

      PARDO  a1, i1, a2, i2
         rootcount = 0
         DO kroot
            REQUEST  R2AA_VECS (a1,i1,a2,i2,kroot) kroot
            rootcount += 1
            IF  rootcount == iroot
                tt1aiai (a1,i1,a2,i2) = R2AA_VECS (a1,i1,a2,i2,kroot)
                PREPARE  TSaiai (a1,i1,a2,i2) = tt1aiai (a1,i1,a2,i2)
            ENDIF
         ENDDO kroot
      ENDPARDO  a1, i1, a2, i2

      PARDO  b1, j1, b2, j2
         rootcount = 0
         DO kroot
            REQUEST  R2BB_VECS (b1,j1,b2,j2,kroot) kroot
            rootcount += 1
            IF  rootcount == iroot
                tt1bjbj (b1,j1,b2,j2) = R2BB_VECS (b1,j1,b2,j2,kroot)
                PREPARE  TSbjbj (b1,j1,b2,j2) = tt1bjbj (b1,j1,b2,j2)
            ENDIF
         ENDDO kroot
      ENDPARDO  b1, j1, b2, j2

      PARDO  a1, i1, b1, j1
         rootcount = 0
         DO kroot
            REQUEST  R2AB_VECS (a1,i1,b1,j1,kroot) kroot
            rootcount += 1
            IF  rootcount == iroot
                ttaibj (a1,i1,b1,j1) = R2AB_VECS (a1,i1,b1,j1,kroot)
                PREPARE  T2aibj (a1,i1,b1,j1) = ttaibj (a1,i1,b1,j1)
            ENDIF
         ENDDO kroot
      ENDPARDO  a1, i1, b1, j1
#
#
#          ...Grab the corresponding L  array...
#                                     k
#
#
#
#
#          We found a matching excitation energy, so grab
#          the corresponding root!
#
#
      IF ncount > ZERO

         PARDO  a1, i1
            rootcount = 0
            DO kroot
               GET  L1A_VECS (i1,a1,kroot)
               rootcount += 1
               IF  rootcount == ncount
                   tt1ia (i1,a1) = L1A_VECS (i1,a1,kroot)
                   tt1ai (a1,i1) = tt1ia (i1,a1)
                   PREPARE  s1la (a1,i1) = tt1ai (a1,i1)
                   EXIT
               ENDIF
            ENDDO kroot
         ENDPARDO  a1, i1

         PARDO  b1, j1
            rootcount = 0
            DO kroot
               GET  L1B_VECS (j1,b1,kroot)
               rootcount += 1
               IF  rootcount == ncount
                   tt1jb (j1,b1) = L1B_VECS (j1,b1,kroot)
                   tt1bj (b1,j1) = tt1jb (j1,b1)
                   PREPARE  s1lb (b1,j1) = tt1bj (b1,j1)
                   EXIT
               ENDIF
            ENDDO kroot
         ENDPARDO  b1, j1

         PARDO  a1, i1, a2, i2
            rootcount = 0
            DO kroot
               REQUEST  L2AA_VECS (i1,a1,i2,a2,kroot) kroot
               rootcount += 1
               IF  rootcount == ncount
                   tt1iaia (i1,a1,i2,a2) = L2AA_VECS (i1,a1,i2,a2,kroot)
                   tt1aiai (a1,i1,a2,i2) = tt1iaia (i1,a1,i2,a2)
                   PREPARE  LSaiai (a1,i1,a2,i2) = tt1aiai (a1,i1,a2,i2)
               ENDIF
            ENDDO kroot
         ENDPARDO  a1, i1, a2, i2

         PARDO  b1, j1, b2, j2
            rootcount = 0
            DO kroot
               REQUEST  L2BB_VECS (j1,b1,j2,b2,kroot) kroot
               rootcount += 1
               IF  rootcount == ncount
                   tt1jbjb (j1,b1,j2,b2) = L2BB_VECS (j1,b1,j2,b2,kroot)
                   tt1bjbj (b1,j1,b2,j2) = tt1jbjb (j1,b1,j2,b2)
                   PREPARE  LSbjbj (b1,j1,b2,j2) = tt1bjbj (b1,j1,b2,j2)
               ENDIF
            ENDDO kroot
         ENDPARDO  b1, j1, b2, j2

         PARDO  a1, i1, b1, j1
            rootcount = 0
            DO kroot
               REQUEST  L2AB_VECS (i1,a1,j1,b1,kroot) kroot
               rootcount += 1
               IF  rootcount == ncount
                  ttiajb (i1,a1,j1,b1) = L2AB_VECS (i1,a1,j1,b1,kroot)
                  ttaibj (a1,i1,b1,j1) = ttiajb (i1,a1,j1,b1)
                  PREPARE  L2aibj (a1,i1,b1,j1) = ttaibj (a1,i1,b1,j1)
               ENDIF
            ENDDO kroot
         ENDPARDO  a1, i1, b1, j1

      ENDIF # ncount > 0
#
#
#          In the event that none of the L excitation energies
#          match the the current R excitation energy, we need
#          to put in R^t as L.
#
#
      IF ncount == ZERO

         EXECUTE  PRINT_SCALAR  ZERO
         EXECUTE  PRINT_SCALAR  ZERO
         EXECUTE  PRINT_SCALAR  ZERO
         EXECUTE  PRINT_SCALAR  ZERO
         EXECUTE  PRINT_SCALAR  ZERO
         EXECUTE  PRINT_SCALAR  ZERO
         EXECUTE  PRINT_SCALAR  ZERO
         EXECUTE  PRINT_SCALAR  ZERO
         EXECUTE  PRINT_SCALAR  ZERO
         EXECUTE  PRINT_SCALAR  ZERO

         PARDO  a1, i1
            rootcount = 0
            DO kroot
               GET  R1A_VECS (a1,i1,kroot)
               rootcount += 1
               IF  rootcount == iroot
                   tt1ai (a1,i1) = R1A_VECS (a1,i1,kroot)
                   PREPARE  s1la (a1,i1) = tt1ai (a1,i1)
               ENDIF
            ENDDO kroot
         ENDPARDO  a1, i1

         PARDO  b1, j1
            rootcount = 0
            DO kroot
               GET  R1B_VECS (b1,j1,kroot)
               rootcount += 1
               IF  rootcount == iroot
                   tt1bj (b1,j1) = R1B_VECS (b1,j1,kroot)
                   PREPARE  s1lb (b1,j1) = tt1bj (b1,j1)
               ENDIF
            ENDDO kroot
         ENDPARDO  b1, j1

         PARDO  a1, i1, a2, i2
            rootcount = 0
            DO kroot
               REQUEST  R2AA_VECS (a1,i1,a2,i2,kroot) kroot
               rootcount += 1
               IF  rootcount == iroot
                   tt1aiai (a1,i1,a2,i2) = R2AA_VECS (a1,i1,a2,i2,kroot)
                   PREPARE  LSaiai (a1,i1,a2,i2) = tt1aiai (a1,i1,a2,i2)
               ENDIF
            ENDDO kroot
         ENDPARDO  a1, i1, a2, i2

         PARDO  b1, j1, b2, j2
            rootcount = 0
            DO kroot
               REQUEST  R2BB_VECS (b1,j1,b2,j2,kroot) kroot
               rootcount += 1
               IF  rootcount == iroot
                   tt1bjbj (b1,j1,b2,j2) = R2BB_VECS (b1,j1,b2,j2,kroot)
                   PREPARE  LSbjbj (b1,j1,b2,j2) = tt1bjbj (b1,j1,b2,j2)
               ENDIF
            ENDDO kroot
         ENDPARDO  b1, j1, b2, j2

         PARDO  a1, i1, b1, j1
            rootcount = 0
            DO kroot
               REQUEST  R2AB_VECS (a1,i1,b1,j1,kroot) kroot
               rootcount += 1
               IF  rootcount == iroot
                  ttaibj (a1,i1,b1,j1) = R2AB_VECS (a1,i1,b1,j1,kroot)
                  PREPARE  L2aibj (a1,i1,b1,j1) = ttaibj (a1,i1,b1,j1)
               ENDIF
            ENDDO kroot
         ENDPARDO  a1, i1, b1, j1

      ENDIF

      EXECUTE  SERVER_BARRIER
#
      ENDPROC  GET_RL_AMPS
#-------------------------------------------------------------------------

#-------------------------------------------------------------------------
#
#    --------------------
      PROC  COMP_LR_NORM
#    --------------------
#
#
#    Compute R  due to the formula
#             0
#                 _               -1
#        R  = <0|(H R) |0> * omega
#         0           c
#
#-------------------------------------------------------------------------
#
#
#          ...Compute the contributions...
#
#
      R0 = 0.0

      etemp1 = 0.0
      etemp2 = 0.0
      etemp3 = 0.0
      etemp4 = 0.0
      etemp5 = 0.0
      sum1 = 0.0
      sum2 = 0.0
      sum3 = 0.0
      sum4 = 0.0
      sum5 = 0.0

      PARDO  a, i

         GET  HBAR_ia (i,a)
         GET  R1A_VECS (a,i,indstate)
         tai (a,i) = R1A_VECS (a,i,indstate) 
         etemp = HBAR_ia (i,a) * tai(a,i)
         sum1 += etemp

      ENDPARDO  a, i

      PARDO  b, j

         GET  HBAR_jb (j,b)
         GET  R1B_VECS (b,j,indstate)
         tbj (b,j) = R1B_VECS (b,j,indstate)
         etemp = HBAR_jb (j,b) * tbj(b,j)
         sum2 += etemp

      ENDPARDO  b, j

      PARDO  a, a1, i, i1

         REQUEST  R2AA_VECS  (a,i,a1,i1,indstate) i1
         REQUEST  VSpipi (a,i,a1,i1) i1
         tpppp(a,i,a1,i1) = R2AA_VECS  (a,i,a1,i1,indstate)
         etemp = tpppp (a,i,a1,i1) * VSpipi (a,i,a1,i1)
         sum3 += etemp

      ENDPARDO  a, a1, i, i1

      PARDO  b, b1, j, j1

         REQUEST  R2BB_VECS  (b,j,b1,j1,indstate) j1
         REQUEST  VSqjqj (b,j,b1,j1) j1
         tqqqq(b,j,b1,j1) = R2BB_VECS  (b,j,b1,j1,indstate)
         etemp = tqqqq (b,j,b1,j1) * VSqjqj (b,j,b1,j1)
         sum4 += etemp

      ENDPARDO  b, b1, j, j1

      PARDO  a, i, b, j

         REQUEST  R2AB_VECS (a,i,b,j,indstate) j
         REQUEST  Vpiqj (a,i,b,j) j
         taibj(a,i,b,j) = R2AB_VECS (a,i,b,j,indstate)
         etemp = taibj (a,i,b,j) * Vpiqj (a,i,b,j)
         sum5 += etemp

      ENDPARDO  a, i, b, j

      EXECUTE  SERVER_BARRIER

      collective  etemp1 += sum1
      collective  etemp2 += sum2
      collective  etemp3 += sum3
      collective  etemp4 += sum4
      collective  etemp5 += sum5

      etemp3 *= 0.25
      etemp4 *= 0.25

      R0 += etemp1
      R0 += etemp2
      R0 += etemp3
      R0 += etemp4
      R0 += etemp5

      EXECUTE  SIP_BARRIER

      R0      = R0 / OMEGA
      OMEGA2  = TWO / THREE
      OMEGA2 *= OMEGA

      EXECUTE  PRINT_SCALAR  R0
#
# Right Norm 
#
      RNORM  = R0
      RNORM *= R0
      esum   = 0.0

      PARDO  i, a

         GET         R1A_VECS (a,i,indstate)
         tai (a,i) = R1A_VECS (a,i,indstate)  
         etemp  = tai (a,i) * tai (a,i)
         esum  += etemp

      ENDPARDO  i, a

      PARDO  j, b

         GET         R1B_VECS (b,j,indstate)
         tbj (b,j) = R1B_VECS (b,j,indstate)
         etemp  = tbj (b,j) * tbj (b,j)
         esum  += etemp

      ENDPARDO  j, b

      PARDO  a, i, a1, i1

         REQUEST             R2AA_VECS (a,i,a1,i1,indstate) i1
         taiai (a,i,a1,i1) = R2AA_VECS (a,i,a1,i1,indstate)  
         etemp  = taiai (a,i,a1,i1) * taiai (a,i,a1,i1)
         etemp  = etemp/4.0
         esum  += etemp

      ENDPARDO  a, i, a1, i1

      PARDO  b, j, b1, j1

         REQUEST             R2BB_VECS (b,j,b1,j1,indstate) j1
         tbjbj (b,j,b1,j1) = R2BB_VECS (b,j,b1,j1,indstate)
         etemp  = tbjbj (b,j,b1,j1) * tbjbj (b,j,b1,j1)
         etemp  = etemp/4.0
         esum  += etemp

      ENDPARDO  b, j, b1, j1

      PARDO  a, i, b, j

         REQUEST           R2AB_VECS (a,i,b,j,indstate) j
         taibj (a,i,b,j) = R2AB_VECS (a,i,b,j,indstate) 
         etemp  = taibj (a,i,b,j) * taibj (a,i,b,j)
         esum  += etemp

      ENDPARDO  a, i, b, j

      EXECUTE  SIP_BARRIER
      EXECUTE  SERVER_BARRIER

      COLLECTIVE  RNORM += esum

      EXECUTE SIP_BARRIER
      EXECUTE  SQUARE_ROOT  RNORM  ONEHALF

      RNORM  = 1.0 / RNORM

#
#
# Leftp norm
#
      LNORM  = 0.0
      esum   = 0.0

      PARDO  i, a

         GET         R1A_VECS (a,i,indstate)
         REQUEST         s1la (a,i) a
         tai (a,i) = R1A_VECS (a,i,indstate)
         etemp  = tai (a,i) * s1la (a,i)
         esum  += etemp

      ENDPARDO  i, a

      PARDO  j, b

         GET         R1B_VECS (b,j,indstate)
         REQUEST         s1lb (b,j) b
         tbj (b,j) = R1B_VECS (b,j,indstate)
         etemp  = tbj (b,j) * s1lb (b,j)
         esum  += etemp

      ENDPARDO  j, b

      PARDO  i, a, i1, a1

         REQUEST             R2AA_VECS (a,i,a1,i1,indstate) i1
         REQUEST             LSAiAi (a,i,a1,i1) a1
         taiai (a,i,a1,i1) = R2AA_VECS (a,i,a1,i1,indstate)
         etemp  = taiai (a,i,a1,i1) * LSaiai (a,i,a1,i1)
         etemp  = etemp/4.0
         esum  += etemp

      ENDPARDO  i, a, i1, a1

      PARDO  j, b, j1, b1

         REQUEST             R2BB_VECS (b,j,b1,j1,indstate) j1
         REQUEST             LSbjbj (b,j,b1,j1) b1
         tbjbj (b,j,b1,j1) = R2BB_VECS (b,j,b1,j1,indstate)
         etemp  = tbjbj (b,j,b1,j1) * LSbjbj (b,j,b1,j1)
         etemp  = etemp/4.0
         esum  += etemp

      ENDPARDO  j, b, j1, b1

      PARDO  a, i, b, j

         REQUEST           R2AB_VECS (a,i,b,j,indstate) j
         REQUEST           L2aibj (a,i,b,j) j
         taibj (a,i,b,j) = R2AB_VECS (a,i,b,j,indstate)
         etemp  = taibj (a,i,b,j) * L2aibj (a,i,b,j)
         esum  += etemp

      ENDPARDO  a, i, b, j

      EXECUTE  SIP_BARRIER
      EXECUTE  SERVER_BARRIER

      COLLECTIVE  LNORM += esum

      EXECUTE SIP_BARRIER
      LNORM *= RNORM
      etemp = LNORM
      LNORM = 1.0 / etemp
      LRNORM = LNORM * RNORM
#
      execute print_scalar R0
      execute print_scalar rnorm
      execute print_scalar lnorm
      execute print_scalar lrnorm
#

#
      ENDPROC  COMP_LR_NORM
#-------------------------------------------------------------------------


# ----------------------------------------------------------
#
# BEGIN MAIN PROGRAM
# ------------------
#
      esum = 0.0
      eaab = 0.0
      root_thresh = eom_tol
      one = 1.0
      two = 2.0
      three = 3.0
      four  = 4.0
      five  = 5.0
      six   = 6.0
      seven = 7.0
      eight = 8.0
      nine  = 9.0
      ten   = 10.0
      eleven = 11.0
      twelve = 12.0
      thirteen = 13.0
      fourteen = 14.0
      fifteen = 15.0
      onehalf = 0.5

      CREATE  REE
      CREATE  LEE
      CREATE  R1A_VECS
      CREATE  R1B_VECS
      CREATE  L1A_VECS
      CREATE  L1B_VECS
      CREATE HBAR_ia
      CREATE HBAR_jb

      create l1a_old 
      create l1b_old 
      execute sip_barrier

#
# Read transformed integrals from lists
# -------------------------------------
#
      CALL READ_BLOCKDATA  
      execute print_scalar etemp 
      execute server_barrier 
      CALL TRAN_UHF 
#
# Set the partitioning of the occupied segments 
# --------------------------------------------- 
     iroot = 0
     DO indstate
        iroot += 1 
        execute print_scalar iroot
         
        esum = 0.0
        eaab = 0.0
        eSaab = 0.0
        create sai
        create zbj
     
         CALL  GET_RL_AMPS

         IF OMEGA == 100000.0
             EXIT # Because we are all out of excitation energies!
         ENDIF

         CALL  COMP_LR_NORM

         EXECUTE  SIP_BARRIER

         esum = 0.0
         eaab = 0.0
         eSaab = 0.0

         DO i1 
         DO i2 
            execute set_ijk_aab iflag jflag # (i1) 
         ENDDO i2 
         ENDDO i1 
         execute sip_barrier 
         execute server_barrier 
#            
# Determine the total number of combinations                                  
# ------------------------------------------                                    
#                               
         ncount = 0.0              
         DO NT                    
            ncount = ncount + 1       
            kstart = 7.0              
            execute get_ijk kstart ncount   
                                        
            if kstart <= 0.0              
               ncount = ncount - 1       
               exit                     
            endif                      
         ENDDO NT                     
         TCOMB = ncount              
         execute print_scalar ncount      
#
         xcount = 2.0
        #execute pardo_sects xcount ncount
         nsects = 1.0 # ncount
#
         xtemp = TCOMB/nsects
         execute print_scalar nsects
         execute print_scalar xtemp
#
# ----------------------------------------------------------
#
# ----------------------------
# Combination 1.
# ----------------------------
     #if nsects == one
         xtemp1 = xtemp
         CALL OSEG_TRIP1 
     #endif
#
# ------------------------------------------------------------------ 
#
         execute server_barrier
#
# --------------------------------------------------------------------------
#
# Compute contribution to the energy from sai
# -------------------------------------------
#
        easum = 0.0
        esaab = 0.0 
        execute sip_barrier
        PARDO a, ii
#
              x1ai (a,ii) = 0.0
              PREQUEST x1ai(a,ii) = s1la(a,i1)
              GET                 sai(a,ii)
              etemp             = x1ai(a,ii)*sai(a,ii)
              etemp            *= 0.25
              easum             += etemp
#
        ENDPARDO a, ii
#
        PARDO b, j1
#
              REQUEST             s1lb(b,j1) b
              GET                 zbj(b,j1)
              etemp             = s1lb(b,j1)*zbj(b,j1)
              etemp            *= 0.25
              easum             += etemp
#
        ENDPARDO b, j1
#
        execute sip_barrier
        execute server_barrier
        collective esaab += easum
        execute sip_barrier
        execute print_scalar esaab  
        execute server_barrier
#
# --------------------------------------------------------------------------
#
         esum = esum/4.0 
         execute sip_barrier
         collective eaab += esum 
         execute sip_barrier
         execute print_scalar eaab 

     ### eaab *= 2.0
     ### eSaab *= 2.0
     ### totenerg += eaab
     ### totenerg += eSaab 

         ecorrT  = eaab
         ecorrT += eSaab
         ecorrT *= LRNORM
         execute print_scalar ecorrT

         one = 1.0 
         two = 2.0 
         do kiter
            DO kptr1
               tpinf(kiter,kptr1) = 0.0  
               pinf(kiter,kptr1)  = tpinf(kiter,kptr1)
            ENDDO kptr1
            ncount1 = 0.0
            DO kptr1
               ncount1 = ncount1 + 1.0
               if ncount1 == one
                  tpinf(kiter,kptr1) = eSaab
                  pinf(kiter,kptr1)  = tpinf(kiter,kptr1)
               endif
            ENDDO kptr1

            ncount1 = 0.0
            DO kptr1
               ncount1 = ncount1 + 1.0
               if ncount1 == two
                  tpinf(kiter,kptr1) = eaab
                  pinf(kiter,kptr1)  = tpinf(kiter,kptr1)
               endif
            ENDDO kptr1

         enddo kiter
         execute sip_barrier

         etemp = 19.0
         execute print_rel_info etemp pinf
#
         execute sip_barrier

         rootcount = 0
         DO indone
         DO kroot
            rootcount += 1
            if rootcount == iroot
               tee  (kroot,indone) = OMEGA
               t1ee (kroot,indone) = ecorrT
               ST_ROOTS (kroot,indone) = tee  (kroot,indone)
               ST_ECORR (kroot,indone) = t1ee (kroot,indone)
               exit
            endif
         ENDDO kroot
         ENDDO indone

         EXECUTE  PRINT_SCALAR  OMEGA
         OMEGA += ecorrT
         EXECUTE  PRINT_SCALAR  OMEGA
         EXECUTE  PRINT_SCALAR  ZERO

         EXECUTE  SIP_BARRIER
         DELETE  Sai
         DELETE  zbj

      ENDDO indstate

     EXECUTE  EOMROOT_PRINT_NEW  ST_ROOTS  ST_ECORR

#
                           ENDSIAL CCSD_RHF_SV1
#
